"use strict";var Panopto=Panopto||{};Panopto.BatchUpload=Panopto.BatchUpload||{},Panopto.BatchUpload.Data=Panopto.BatchUpload.Data||{},Panopto.BatchUpload.MultipartUploader=function(e){var t,o=0,a=1,n=2,r=3,l=4,i={},p=0;function s(e){var t=i[e],o=t.file,r=Panopto.Core.ServiceInterface.MultipartUploadManager.predictRemainingSeconds(e);_.extend(this,{BytesUploaded:t.bytesUploaded,Extension:t.ext,Id:e,IsInvalid:t.status===l,Name:t.name,PercentUploaded:t.bytesUploaded/o.size*100,RemainingTime:r>=0?moment().startOf("day").seconds(r).format("HH:mm:ss"):"",SessionCreated:!!t.sessionId,SessionId:t.sessionId||Panopto.Core.Constants.EmptyGuid,Size:o.size,UploadInProgress:t.status===a,UploadNearCompletion:t.status===a&&t.bytesUploaded===o.size,UploadCompleted:t.status===n})}var d=function(){var e=_.countBy(i,(function(e){return e.status}));Panopto.BatchUpload.FileList.updateProgress({Total:_.keys(i).length,Invalid:e[l]||0,NotStarted:e[o]||0,Uploading:e[a]||0,Complete:e[n]||0,Failed:e[r]||0})};e.setupDragDrop=function(a){t=a,Panopto.Core.ServiceInterface.SessionUploadManagement.setHost(window.location.origin),Panopto.Core.ServiceInterface.MultipartUploadManager.setThrottlingDelay(Panopto.features.webUIDelayWhileThrottling);var n=function(e){e.stopPropagation(),e.preventDefault()},r=function(e){n(e),t.toggleClass("drop-target-drag")};_.each(["mouseover","mouseleave","dragover"],(function(e){t.on(e,n)})),_.each(["dragenter","dragleave"],(function(e){t.on(e,r)}));const i=function(e){const t=e.originalEvent;return t.target.files||t.dataTransfer.files},c=function(t){const a=i(t);if(a.length>0){const t=(n=a,r=[],_.each(n,(function(t,a){let n,i;n={file:t,id:p++,name:Panopto.Core.StringHelpers.parseFilename(t.name),ext:Panopto.Core.StringHelpers.parseExtension(t.name),bytesUploaded:0,status:o},(!_.contains(Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS,"."+n.ext)||Panopto.features.uploadByteLimit&&t.size>Panopto.features.uploadByteLimit)&&(n.status=l),e.registerFile(n.id,n),i=new s(n.id),i.Index=a+1,r[a]=i})),d(),r);Panopto.BatchUpload.FileList.addFiles(t)}var n,r;f.val(null)};t.on("drop",(function(e){r(e),c(e),PanoptoCore.InternalAnalytics.trackPendoEvent({name:"Video(s) created: Upload modal > drag and drop",metadata:{numVideos:i(e).length}})}));var u=!1!==Panopto.BatchUpload.Data.currentFolder.canPassMultiple&&!(PanoptoCore.Browser.$_safari&&PanoptoCore.Browser.$_mobile&&PanoptoCore.Browser.$_versionNumber<8),f=$("<input />",{type:"file",multiple:u,accept:Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS.join(",")}).on("change",(e=>{c(e),PanoptoCore.InternalAnalytics.trackPendoEvent({name:"Video(s) created: Upload modal > file picker",metadata:{numVideos:i(e).length}})})).hide().insertAfter(t);Panopto.Core.UI.Handlers.button(t,(function(){f.click()}),{keyEvent:"keypress"})},e.registerFile=function(e,t){i[e]=t,d()},e.removeFile=function(e){delete i[e],d()},e.startUpload=function(e,t,o){var p=i[e],f=new Panopto.Core.CancellableRequest,U=new Panopto.Core.CancellableRequest;p.sessionId=t,o=o||$.noop;var P=function(a,l){p.status=a,Panopto.BatchUpload.FileList.updateFile(new s(e)),d(),a===n&&o(!0),a===r&&(Panopto.BatchUpload.FileList.handleImportError(e,t,l),o(!1))};return p.status!==l&&(P(a),f=Panopto.Core.ServiceInterface.SessionUploadManagement.openUpload({sessionId:t,filename:p.file.name,startTime:new Date},(function(t){p.uploadId=t.ID;const o=t=>{p.bytesUploaded=t,Panopto.BatchUpload.FileList.updateFile(new s(e))},a=()=>{U=Panopto.Core.ServiceInterface.SessionUploadManagement.closeUpload(t,(function(){P(n)}),(function(){P(r,"Failed to close upload.")}))},l=()=>{P(r,"Failed to upload file.")};Panopto.BatchUpload.Data.useV2Upload?u(t,p,e,P,o,a,l):c(t,p,e,o,a,l)}),(function(){P(r,"Failed to open upload.")}))),new Panopto.Core.CancellableRequest((function(){f.cancel(),U.cancel()}))},e.stopUpload=function(e,t){var a=i[e];a.status=o,a.bytesUploaded=0,d(),Panopto.Core.ServiceInterface.MultipartUploadManager.cancelUpload(e,t)},e.pauseUpload=function(e){},e.resumeUpload=function(e){},e.uploadStarted=function(e){return!!i[e]&&i[e].status!==o},e.uploadCompleted=function(e){return!!i[e]&&i[e].status===n},e.isInvalid=function(e){return!i[e]||i[e].status===l},e.getSessionId=function(e){return i[e]&&i[e].sessionId?i[e].sessionId:Panopto.Core.Constants.EmptyGuid},e.resetSessionId=function(e){var t=i[e];t&&(t.sessionId=null,Panopto.BatchUpload.FileList.updateFile(new s(e)))},e.setTargetText=function(e){t.find(".uploader-text").text(e)},e.setComponent=function(e,t){e.Simulate=t};const c=(e,t,o,a,n,r)=>{Panopto.Core.ServiceInterface.MultipartUploadManager.queueUpload({file:t.file,fileId:o,uploadUri:e.UploadTarget},a,n,r),Panopto.Core.ServiceInterface.MultipartUploadManager.upload()},u=(e,t,o,a,n,l,i)=>{let p={fileId:o,file:t.file,streamUpload:e,bytesUploaded:[],contentStoreOpenUrl:void 0,contentStoreFileId:void 0,contentStoreUploadId:void 0};Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.getOpenContentStoreUploadUrl(p,(e=>{p.contentStoreOpenUrl=e.SignedUrl,p.contentStoreFileId=e.FileID,p.contentStoreUploadId=e.contentStoreUploadId,Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.queueUpload(p,n,l,i),Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.upload()}),(()=>{a(r,"Failed to upload file.")}))};return e}(Panopto.BatchUpload.MultipartUploader||{});
//# sourceMappingURL=file://engfs.d.panopto.com/share/jenkinsbuilds/rel_rtc_16.4.0/16.4.0.00038/_PublishedWebsites/WebUI/Scripts/Panopto/BatchUpload/MultipartUploader.js.map
