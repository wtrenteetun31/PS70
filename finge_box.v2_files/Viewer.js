"use strict";!function(e){!function(e){!function(e){e.AddStreamOverlay=class{constructor(t,i,o,n){this.target=t,this.overlayUploader=i,this.onCloseClick=o,this.resources=n,this.errorMessageDuration=3e3,this.errorFiles=[],this.renderElement(),this.target.append(this.element),this.closeButton=this.element.find(".close-button"),Panopto.Core.UI.Handlers.button(this.closeButton,this.onCloseClick),this.processingStatus=this.element.find(".processing-status"),this.fileProcessingRegion=new e.FileProcessingRegion(this.processingStatus,this.resources),this.hide()}show(e){this.element.show(),this.closeButton.toggle(e)}hide(){this.element.hide()}toggleProcessingStatus(e){if(e.length){this.fileProcessingRegion.render(e),this.processingStatus.show();if(_.some(e.filter((e=>-1==this.errorFiles.indexOf(e.uploadId))),(e=>1!==e.state&&2!==e.state))){const t=Panopto.cacheRoot+"/Images/upload_error.svg",i=_.find(e.reverse(),(e=>1!==e.state&&2!==e.state));if(this.errorFiles.push(i.uploadId),1===i.streamType){const e=this.element.find(".primary-stream-text"),o=this.element.find(".primary-stream-graphic");e.text(Panopto.GlobalResources.ViewerPlus_Overlay_InvalidFiletype.format(i.filename)),o.attr("src",t),setTimeout((function(){e.text(Panopto.GlobalResources.ViewerPlus_PrimaryOverlay_Subtitle),o.attr("src",Panopto.cacheRoot+"/Images/upload_primary_stream_large.svg")}),this.errorMessageDuration)}else{const e=this.element.find(".secondary-stream-text"),o=this.element.find(".secondary-stream-graphic");e.text(Panopto.GlobalResources.ViewerPlus_Overlay_InvalidFiletype.format(i.filename)),o.attr("src",t),setTimeout((function(){e.text(Panopto.GlobalResources.ViewerPlus_SecondaryOverlay_Subtitle),o.attr("src",Panopto.cacheRoot+"/Images/upload_secondary_stream.svg")}),this.errorMessageDuration)}}}else this.processingStatus.hide()}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Analytics=function(e){return e.Actions={Navigate:"navigate",PrimaryResize:"primary-resize",SecondaryResize:"secondary-resize",Transport:"transport",HideThumbnails:"hide-thumbnails",ShowThumbnails:"show-thumbnails",VolumeUp:"volume-up",VolumeDown:"volume-down",Mute:"mute",Unmute:"unmute",Play:"play",Pause:"pause",Rewind:"rewind",SkipToStart:"skip-to-start",Forward:"forward",SkipToEnd:"skip-to-end",Seek:"seek",Prereq:"prereq",Exit:"exit",Add:{Success:"add-event",Error:"add-error",Retry:"add-retry",Cancel:"add-cancel"},Edit:{Success:"edit-event",Error:"edit-error",Retry:"edit-retry",Cancel:"edit-cancel"},Delete:{Success:"delete-event",Error:"delete-error",Retry:"delete-retry",Cancel:"delete-cancel"},Speed:"speed",Bitrate:"bitrate",SecondaryTab:"secondary-tab",Quality:"quality",Desync:"multi-stream-desync"},e.Labels={Thumbnail:"thumbnail",Transcript:"caption",Attachment:"attachment",Content:"chapter",Search:"search",Normal:"normal",Fullscreen:"fullscreen",Hotkey:"hotkey",Login:"login",Folder:"folder",DoubleClick:"double-click",Forward:"forward",Note:"note",Bookmark:"bookmark",Comment:"comment",Question:"question",Access:"access",SessionList:"session-list",Settings:"settings",Share:"share",Editor:"editor",EditContents:"edit-contents",EditTranscript:"edit-transcript",EditSlides:"edit-slides",EditCut:"edit-cut",EditStream:"edit-stream",EditQuestionList:"edit-question-list",PrimaryAhead:"primary-ahead",SecondaryAhead:"secondary-ahead",OndemandAutoLevel:"onedmand-auto",OndemandManualLevel:"ondemand-manual",BroadcastAutoLevel:"broadcast-auto",BroadcastManualLevel:"broadcast-manual"},e.sendEvent=function(e){Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.behavior,source:"player",action:e.action,label:e.label})},e.sendFullScreenEvent=function(t,i){e.sendEvent({action:t?e.Actions.PrimaryResize:e.Actions.SecondaryResize,label:i?e.Labels.DoubleClick:e.Labels.Normal})},e.sendDesyncEvent=function(t){Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.sync,source:"player",action:e.Actions.Desync,label:t.diff>0?e.Labels.PrimaryAhead:e.Labels.SecondaryAhead,value:Math.round(1e3*Math.abs(t.diff)),customFields:{dimension1:Panopto.webServerFQDN,dimension2:t.deliveryId,dimension3:t.invocationId}})},e.QualityReporter=function(t){var i,o,n,a,r,s,l,d,c=!1,p=0,u=!t.isAudioOnly;return(l=(t.isBroadcast?new RegExp("Sessions/(?:(?:_hlsbc)|(?:_rtmp))/([a-z0-9-]{36})/master.m3u8\\??(.*)","i"):new RegExp("Sessions/[a-z0-9-]{36}/([a-z0-9-]{36}(?:-[a-z0-9-]{36})?)..*hls/master.m3u8\\??(.*)","i")).exec(t.streamUrl))&&l.length?(l.length>=2&&(i=l[1]),l.length>=3&&(d=new RegExp("InvocationID=([a-z0-9-]{36})","i").exec(l[2]),o=d&&2===d.length?d[1]:"")):u=!1,{flushQualityReport:function(l,d,h,m,v,P){var g=d-p;u&&c&&g>=t.minDuration&&Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.quality,source:"player",action:e.Actions.Quality,label:t.isBroadcast?s?e.Labels.BroadcastAutoLevel:e.Labels.BroadcastManualLevel:s?e.Labels.OndemandAutoLevel:e.Labels.OndemandManualLevel,customFields:{dimension1:Panopto.webServerFQDN,dimension2:i,dimension3:o,metric1:Math.round((n+1)/a*100*g),metric2:Math.round(r/1024*g),metric3:Math.round(g)}}),c=l,p=d,n=h,a=m,r=v,s=P}}},e}(Panopto.Viewer.Analytics||{}),(Panopto=Panopto||{}).Core=Panopto.Core||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.GlobalResources=Panopto.GlobalResources||{},function(e){!function(e){class t{}let i;t.TimedSyncRate=30,t.ControlSyncRate=1e3,t.SecondarySyncThreshold=1,t.SecondarySynchronizingUpdateRateMillis=50,t.InitialSecondaryThreshold=5,t.SecondaryStreamOffset=1.5,t.MinSegmentGap=1,t.ContiguousSegmentThreshold=.2,t.EndPositionThreshold=.1,t.BroadcastEndedIncrement=5e3,t.QualityReportThreshold=2,t.BroadcastStreamRetryTimeout=5e3,t.LivePositionTolerance=1,t.BroadcastEndThreshold=1,t.MaxPositionInterpolation=500,t.BufferingTimeoutThreshold=1e3,t.BadSeekThreshold=.1,t.NativePositionFallbackRegion=1,t.CircularLogBufferSize=2048,t.UploadByteLimit=5368709120,t.SecondaryContentClass="secondary-content",t.SecondaryPlayerClass="secondaryPlayer",t.SlideDeckId="slideDeck",t.ScreenCaptureClass="screen-capture",t.ObjectVideoTabClass="object-video",t.UrlTabClass="url",t.TocIconClass="toc",t.YouTubeIconClass="youtube",t.SmartChapterIconClass="smart-chapter",t.SmartChapterLinkIconClass="smart-chapter-link",t.AIChapterIconClass="ai-chapter",t.SlideDeckTabClass="slide-deck",t.PrimaryTabHeaderClass="primary-header",t.SecondaryTabHeaderClass="secondary-header",t.RecentBroadcastThreshold=144e5,t.PlayKeyCode=32,t.RewindKeyCode=37,t.ForwardKeyCode=39,t.VolumeUpKeyCode=38,t.VolumeDownKeyCode=40,t.MuteKeyCode=77,t.VolumeIncrement=10,t.PositionIncrement=10,t.MinVolume=0,t.MaxVolume=100,t.InitialVolume=100,t.SilverlightVersion="4.0.50401.0",t.PlaySpeedSilverlightVersion="5.0",t.QuickRewindSeconds=10,t.QuickForwardSeconds=30,t.FullScreenControlInterval=3,t.EditJumpSeconds=5,t.TOCMaxLength=200,t.EditorTimelineEndOffsetSeconds=.01,t.DisplayTimePrecisionMultiplier=Math.pow(10,Panopto.Core.Constants.DisplayTimeMillisecondPrecision),t.UrlEventClosenessTolerance=.1,t.BoundaryCutTolerance=.1,t.StreamDeleteCutTolerance=.01,t.LeftPaneRatio=.35,t.LeftPaneMinWidth=460,t.RightPaneMinWidth=480,t.HeaderBuffer=60,t.MaxDesktopTitleCharacters=120,t.MaxMobileTitleCharacters=60,t.EventRegionMinHeight=300,t.PlayerMinHeight=50,t.LeftPlayerDefaultHeight=260,t.LiveNotesClass="live-notes",t.MaxInlineSecondaryTabs=3,t.CollapseSecondaryTabsWidth=1200,t.SliderDragThreshold=2,t.InputMargin=14,t.InputOptionsMargin=4,t.ScrollBarWidth=20,t.AudioOnlyMinimumWidth=2,t.ThumbnailScrollTimeout=5e3,t.EventScrollTimeout=5e3,t.FlyoutTimeout=2e3,t.MissingSeekedEventTimeout=5e3,t.BaseUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.appRoot,t.EditorUrl=t.BaseUrl+"/Pages/Viewer.aspx?id={0}&edit=true",t.SessionListUrl=t.BaseUrl+"/Pages/Sessions/List.aspx",t.SilverlightEditorUrlTemplate=t.BaseUrl+"/Pages/Editor/Default.aspx#{0}",t.SlideImageUrl=t.BaseUrl+"/Pages/Viewer/Image.aspx",t.ThumbUrl=t.BaseUrl+"/Pages/Viewer/Thumb.aspx",t.DummyPDFUrl=t.BaseUrl+"/Scripts/PluginDetect/empty.pdf",t.FlashPlayerUrl="https://get.adobe.com/flashplayer",t.SinglePageAppUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.relativeSinglePageAppUrl,t.QuizEditUrlTemplate=t.SinglePageAppUrl+"quiz-configure/{0}?sessionId={1}",t.YouTubeEditUrlTemplate=t.SinglePageAppUrl+"youtubeEmbed/configure/{0}",t.HlsLevelFileNames=["index.m3u8","index2.m3u8"],t.JoinChannelOptionValue="joinChannel",t.SearchExpandDuration=400,t.FadeInterval=150,t.PlaySpeedResourceString="ViewerPlus_Speeds_{0}",t.BitrateResourcePrefixString="ViewerPlus_Bitrates_",t.BitrateResourceString=t.BitrateResourcePrefixString+"{0}",t.SearchTypeResourceString="ViewerPlus_Search_{0}",t.BitrateLevels=[Panopto.GlobalResources[t.BitrateResourcePrefixString+"Low"],Panopto.GlobalResources[t.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[t.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[t.BitrateResourcePrefixString+"High"]],t.PluginDetectPDFReader="PDFReader",t.SortRelevanceValue="relevance",t.SortTimeValue="time",t.SearchSortOrders=[{value:t.SortRelevanceValue,name:Panopto.GlobalResources.ViewerPlus_SortByRelevance},{value:t.SortTimeValue,name:Panopto.GlobalResources.ViewerPlus_SortByTime}],t.SearchRateLimitMilliseconds=1e3,t.MP4MimeType="video/mp4",t.HLSMimeType="application/x-mpegurl",t.Hive="Hive",t.Kollective="Kollective",t.KollectiveLongPollUrlBase="/api/v1/longpoll?ts={0}&ktoken=",t.LTIPage="/Panopto/LTI/LTI.aspx",t.OutcomeFormat="resultScore={0}&lis_result_sourcedid={1}&oauth_consumer_key={2}&lis_outcome_service_url={3}&lti_message_type=panopto_outcome_pox_response&lti_version=LTI-1p0",t.AGSEndpointFormat="/Panopto/lti/adv/platforms/{0}/agsScore",e.Constants=t,function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.LiveNotes=3]="LiveNotes"}(i=e.ViewMode||(e.ViewMode={})),function(e){e.HttpHeaders={Date:"date",LastModified:"last-modified"}}(t=e.Constants||(e.Constants={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){Panopto.Core.StringHelpers.parseQueryString(window.location.hash.slice(1)).debug&&(window.fireDebugEvent=function(e){var t=new CustomEvent(e.typeArg(),{detail:e});document.dispatchEvent(t)});e.DebugEventModel=class{}}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){e.EditorRouter=class{constructor(e,t,i,o,n,a,r,s){this.showHtmlEditorCallback=e,this.showPurgedDeliveryCallback=t,this.showSilverlightEditorCallback=i,this.showSessionNotReadyCallback=o,this.showPendingTranscriptionCallback=n,this.showEditorRehydationProcessingCallback=a,this.showEditorReferenceCopyCallback=r,this.showHasElaiInteractivityCallback=s}routeDelivery(e){e.isReferenceCopy?this.showEditorReferenceCopyCallback():e.sessionInteractivityType?this.showHasElaiInteractivityCallback():e.isReadyForEditing?!Panopto.viewer.editingEnabled||e.requiresAdvancedEditor?this.showSilverlightEditorCallback():e.isPurgedLegacyEncode?this.showPurgedDeliveryCallback():Panopto.viewer.hasEditedTranscriptionRequest?this.showPendingTranscriptionCallback():this.showHtmlEditorCallback():e.rehydrationAvailable&&Panopto.viewer.enableEditorProcessingPageDuringHydration?this.showEditorRehydationProcessingCallback():this.showSessionNotReadyCallback()}}}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},(PanoptoLegacy=Panopto).Viewer.Layout=function(e,t,i,o,n,a,r,s,l,d){var c,p,u,h=PanoptoTS.Viewer.ViewMode,m=PanoptoTS.Viewer.Constants,v=$("#viewer"),P=$("#viewerContent"),g=$("#searchRegion"),y=$("#eventTabs"),f=$("#eventTabControl"),S=$("#eventsExpanderButton"),C=$("#playControls"),w=$("#thumbnailList"),b=$("#timelineContainer"),T=$("#inlineMessageLetterbox"),E=$("#inlineMessage"),V=$("#dockedCaption"),I=$("#dockedCaptionText"),R=$("#overlayCaption"),D=$("#playlistOverlay"),k="",L=!1,x=!l&&!d,A=!1,U=f.outerWidth(),M=m.LeftPaneMinWidth,O=function(o,n){var a=i.getLeftPane();a.stop(),o?n?(a.width(M).css("max-width",M),A=!1):a.animate({width:M,"max-width":M},{duration:2*m.FadeInterval,progress:function(){e.resize()},complete:function(){A=!1}}):(A=!0,n?a.width(U).css("max-width",U+"px"):a.animate({width:U,"max-width":U},{step:function(){e.resize()}})),S.find("div").text(o?Panopto.GlobalResources.ViewerPlus_HideEventTabs:Panopto.GlobalResources.ViewerPlus_ShowEventTabs).attr("aria-expanded",o),g.toggleClass("collapsed",!o),t.viewer.setState({eventPaneIsExpanded:o})},H=function(e,t){var i=T.is(":visible");T.width(e).height(t).show(),E.css("margin-top",(t-E.height())/2),i||T.hide()},B=function(){var e=$(i.getSecondaryPlayers()[o.getPrimaryPlayerIndex()]),t=i.getRightPlayerContainer().offset();i.getPrimaryPlayer().css("left",t.left+"px").css("top",t.top+"px");var n=i.getLeftPlayerContainer().offset();e.css("left",n.left+"px").css("top",n.top+"px")},F=function(e){var t=o.getPrimaryPlayerIndex();if(t!==o.PrimaryDefaultIndex&&e===PanoptoTS.Viewer.ViewMode.Secondary){const e=i.getPrimaryPlayer(),o=$(i.getSecondaryPlayers()[t]);B(),e.addClass("roaming"),o.addClass("roaming")}else i.getPrimaryPlayer().add(i.getSecondaryPlayers()[t]).removeClass("roaming").css("left","").css("top",""),i.getSecondaryPlayers().removeClass("roaming").css("left","").css("top","")};$("#wrapper").css("min-width","0px"),$("body").css("overflow","hidden"),$("#logoutWarningMessage").addClass("bottom"),$(window).resize((function(){e.resize()}));var z="clicked";$(document).on("mousedown","a",(function(e){$(e.currentTarget).addClass(z)})).on("blur","a",(function(e){$(e.currentTarget).removeClass(z)})),x&&(S.show(),Panopto.Core.UI.Handlers.button(S.find("div"),(function(){O(A,void 0)}))),e.resize=function(){var n,l,p,u,f,S=i.getLeftPane(),T=(o.getLeftPlayerElement(),o.getLeftPlayer()),E=i.getLeftPlayerContainer(),I=i.getRightPlayerContainer(),R=b.is(":visible")&&b.hasClass(Panopto.Core.Constants.ExpandedClass),k=$(window).height()-s.height()-(R?b.outerHeight():0),L=$(window).width(),x=S.outerWidth()-S.width(),M=g.is(":visible")?g.outerHeight(!0):0,O=(b.is(":visible")&&!R?b.outerHeight():0)+(V.is(":visible")?V.outerHeight():0)+(w.is(":visible")?w.outerHeight():0),F=Math.max(k-C.outerHeight()-O,m.PlayerMinHeight),z=I.outerWidth()-I.width(),N=I.outerHeight()-I.height();switch(P.height(k),b.css("top",R?$(window).height()-b.outerHeight()+"px":""),c){case h.Primary:l=m.LeftPaneMinWidth,n=A?parseInt(S.css("max-width").slice(0,-2)):l,u=Math.max(L-n-x,m.RightPaneMinWidth),S.width(n),f=Math.max(k,m.EventRegionMinHeight)-M,y.height(f),t.viewer.setState({eventPaneSize:{width:n-U,height:f}}),D.width(l),D.height(k),s.setLeftPaneWidth(l),T.resize(u,F),I.width(u),I.height(F),E.height(0),H(u,F),$("#copyrightNoticeContainer").height(k),v.css("min-width",n+x+m.RightPaneMinWidth),d&&d.resize(R?n+x+u:u),w.width(u),e.toggleInlineSecondaries(),e.resizeCaption();break;case h.Secondary:l=r.isPrimaryAudioOnly||d?m.LeftPaneMinWidth:Math.max(L*m.LeftPaneRatio,m.LeftPaneMinWidth),n=A?parseInt(S.css("max-width").slice(0,-2)):l,u=Math.max(L-n-x,m.RightPaneMinWidth),S.width(n).css("max-width",n),T&&(k-(p=0===T.height()||0===T.width()||r.isPrimaryAudioOnly?e.forceLeftPlayerHeight?m.LeftPlayerDefaultHeight:0:n*T.height()/T.width())>=m.EventRegionMinHeight?(T.resize(n,p),E.width(n),E.height(p),f=k-p-M):(T.resize(n,Math.max(k-m.EventRegionMinHeight,m.PlayerMinHeight)),E.width(n),E.height(Math.max(k-m.EventRegionMinHeight,m.PlayerMinHeight)),f=m.EventRegionMinHeight-M)),y.height(f),t.viewer.setState({eventPaneSize:{width:n-U,height:f}}),D.width(l),D.height(k),s.setLeftPaneWidth(n);var G,j,Q=u-z,W=F-N;1===a.length?(G=Q,j=W):4===a.length?(G=Q/2,j=W/2):u>F?(G=Q/a.length,j=W):(G=Q,j=W/a.length),I.width(Q),I.height(W),_.each(o.getRightPlayers(),((e,t)=>{if(e){let n=0,a=0;if(t!==o.getPrimaryPlayerIndex()){const e=i.getSecondaryPlayers()[t].children[0];$(e).css("border-left-width")&&(n+=parseFloat($(e).css("border-left-width"))),$(e).css("border-right-width")&&(n+=parseFloat($(e).css("border-right-width"))),$(e).css("border-top-width")&&(a+=parseFloat($(e).css("border-top-width"))),$(e).css("border-bottom-width")&&(a+=parseFloat($(e).css("border-bottom-width")))}e.resize(G-n/2,j-a/2)}})),o.getPrimaryPlayerIndex()!=o.PrimaryDefaultIndex&&B(),H(u,F),d&&d.resize(R?n+x+u:u),$("#copyrightNoticeContainer").height(j),w.width(u),e.toggleInlineSecondaries(),e.resizeCaption();break;case h.LiveNotes:n=m.LeftPaneMinWidth,S.width(n),t.viewer.setState({eventPaneSize:{width:n-U,height:k}}),D.width(0)}e.positionAutoplayMessage()};var N=function(t){o.swapLeftAndRight(t),F(c),e.resize()},G=e=>{var t=o.getLeftPlayerElement(),n=o.getRightPlayerElements();switch(e){case h.Primary:n.css("max-height",0),t.css("max-height",""),t.hasClass("primary-only")||t.addClass("primary-only"),x&&(S.css("visibility","visible"),!c||r.isPrimaryAudioOnly&&A||O(!0,!0));break;case h.Secondary:t.css("max-height",""),n.css("max-height",""),r.isPrimaryAudioOnly||(A&&O(!0,!0),i.getLeftPane().css("max-width",""),S.css("visibility","hidden")),t.removeClass("primary-only"),t.css("height",""),t.css("width",""),V.add(C).css("margin-top",""),v.css("min-width","");break;case h.LiveNotes:s.toggleLiveNotes(!0),t.hide(),C.hide(),f.hide(),i.getRightPane().hide()}};e.swapLeftToRight=function(t){(e.isSecondarySwapAllowed()||o.getPrimaryPlayerIndex()!==o.PrimaryDefaultIndex&&t===o.PrimaryDefaultIndex)&&N(t)},e.swapPrimaryAndFirstSecondary=function(){e.swapLeftToRight(o.getPrimaryPlayerIndex()==o.PrimaryDefaultIndex?0:o.PrimaryDefaultIndex)},e.interruptLayoutChanges=function(t){if(a.length>1){(t||e.viewMode())===h.Secondary&&(u=a.length,e.setSecondaryCount(1))}var i=o.getPrimaryPlayerIndex();i!=o.PrimaryDefaultIndex&&(void 0!==t&&o.setViewMode(t),p=i,N(o.PrimaryDefaultIndex))},e.restoreLayoutChanges=function(){if(void 0!==u){let t=u;u=void 0,e.setSecondaryCount(t)}var t=void 0!==p;if(t){var i=p;p=void 0,N(i)}return t},e.isSecondarySwapAllowed=function(){return e.viewMode()===h.Secondary&&!r.isPrimaryAudioOnly&&r.flowPlayerEnabled&&!e.isFullscreen()&&!d&&void 0===p&&1===a.length&&!_.any(a,(e=>e.getTabControl()&&e.getTabControl().selectedTab()&&e.getTabControl().selectedTab().content().isSecondaryPaneOnly))},e.viewMode=function(i){if(void 0===i)return c;i!==c&&(G(i),!c&&x&&(i!==h.Primary&&!r.isPrimaryAudioOnly||t.viewer&&t.viewer.props&&t.viewer.props.initialSearchTerm||r.contents.length?O(!0,!0):O(!1,!0)),c=i,i===h.Primary&&o.getPrimaryPlayerIndex()!==o.PrimaryDefaultIndex?(e.interruptLayoutChanges(i),G(i)):(o.setViewMode(i),i===h.Secondary&&void 0!==p?(e.restoreLayoutChanges(),G(i)):F(i)),e.resize())},e.toggleInlineSecondaries=function(){var e,t=$(window).width()<m.CollapseSecondaryTabsWidth,i=$("#transportControls > ."+m.SecondaryTabHeaderClass),o=$("#selectedSecondary");Panopto.viewer.allowMultipleSecondaryDisplay?(o.hide(),i.hide()):1===a.length&&(e=_.filter(a[0].getTabs(),(function(e){return!e.hiddenTab()})),t?(o.toggle(e.length>1),i.css("display","none")):(o.toggle(e.length>m.MaxInlineSecondaryTabs),i.css("display",e.length>1&&e.length<=m.MaxInlineSecondaryTabs?"":"none")))},e.expandLeftPane=function(){x&&A&&O(!0,void 0)},e.expandTimeline=function(t){b.toggleClass(Panopto.Core.Constants.ExpandedClass,t),e.resize()},e.resizeCaption=function(t,i){var a=o.getLeftPlayerElement(),r=o.getRightPlayerElements().first();const s=o.getPrimaryPlayerIndex()!==o.PrimaryDefaultIndex;var l=e.fullscreenPlayer(),d=l?l===n?s?r:a:s?a:r:c===h.Primary?a:r,p=d.find(".screen:visible"),u=0;let m=!1;if(l?(d=d.find("video"),u=$(".fullscreen-controls").outerHeight(!0)+10):p.length&&p.width()&&p.offset().left>0&&(d=p),"string"==typeof t){const e=Panopto.Core.TextHelpers.displayLineBreaks(Panopto.Core.TextHelpers.cleanTextWithoutHighlighting(t));m=e!==k,k=e}void 0!==i&&(L=i),l||!L?(R.html(k),R.toggle(!!k).css({"max-height":d.height(),"max-width":d.width(),top:0,left:0}),d.offset()&&R.css({left:d.offset().left+(d.width()-R.outerWidth())/2,top:d.offset().top+d.height()-R.outerHeight()-u})):(I.html(k),m&&e.resize(),R.hide())}};var PanoptoLegacy=Panopto=Panopto||{};!function(e){!function(e){class t{static getInstance(){return t.instance}static setInstance(e){t.instance=e}}e.QuizResultsController=t}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){let t;!function(e){e[e.Single=0]="Single",e[e.Double=1]="Double",e[e.Quad=2]="Quad"}(t=e.SecondaryLayoutType||(e.SecondaryLayoutType={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){t.StandardPlayerLayout=class{get onSecondaryLayoutChanged(){return this._onSecondaryLayoutChanged}constructor(e,i,o){this.PrimaryDefaultIndex=-1,this._onSecondaryLayoutChanged=new PanoptoCore.TypedCallback,this.primaryPlayerIndex=this.PrimaryDefaultIndex,this.playerSwapHandlers=[],this.secondaryLayout=t.SecondaryLayoutType.Single,this.pageStructureElements=e,this.primaryPlayer=i,this.secondaryContentContainers=o}getPrimaryPlayerIndex(){return this.viewMode!==e.Viewer.ViewMode.Secondary?this.PrimaryDefaultIndex:this.primaryPlayerIndex}getLeftPlayer(){return this.primaryPlayerIndex===this.PrimaryDefaultIndex||this.viewMode!==e.Viewer.ViewMode.Secondary?this.primaryPlayer:this.secondaryContentContainers[this.primaryPlayerIndex].getCurrentPlayer()}getLeftPlayerElement(){return this.primaryPlayerIndex===this.PrimaryDefaultIndex||this.viewMode!==e.Viewer.ViewMode.Secondary?this.pageStructureElements.getPrimaryPlayer():$(this.pageStructureElements.getSecondaryPlayers()[this.primaryPlayerIndex])}getRightPlayers(){var t=_.map(this.secondaryContentContainers,(e=>e.getCurrentPlayer()));return this.primaryPlayerIndex!==this.PrimaryDefaultIndex&&this.viewMode===e.Viewer.ViewMode.Secondary&&(t[this.primaryPlayerIndex]=this.primaryPlayer),t}getRightPlayerElements(){var t=this.pageStructureElements.getSecondaryPlayers();return this.primaryPlayerIndex!==this.PrimaryDefaultIndex&&this.viewMode===e.Viewer.ViewMode.Secondary&&(t[this.primaryPlayerIndex]=this.pageStructureElements.getPrimaryPlayer()[0]),t}getPlayerFromElement(e){var t,i=this.pageStructureElements.getPlayerFromElement(e);if(1===i.length)if(i[0]===this.pageStructureElements.getPrimaryPlayer()[0])t=this.primaryPlayer;else{let e=this.pageStructureElements.getSecondaryPlayers().toArray().indexOf(i[0]);e>=0&&(t=this.secondaryContentContainers[e].getCurrentPlayer())}return t}setViewMode(e){this.viewMode=e}swapLeftAndRight(e){var t=this.primaryPlayerIndex;this.primaryPlayerIndex=e,_.each(this.playerSwapHandlers,(e=>e(t,this.primaryPlayerIndex)))}onPlayerSwap(e){_.contains(this.playerSwapHandlers,e)||this.playerSwapHandlers.push(e)}offPlayerSwap(e){var t=this.playerSwapHandlers.indexOf(e);t>=0&&(this.playerSwapHandlers=this.playerSwapHandlers.splice(t,1))}getSecondaryLayout(){return this.secondaryLayout}getAllowedSecondaryLayouts(){return[t.SecondaryLayoutType.Single,t.SecondaryLayoutType.Double,t.SecondaryLayoutType.Quad]}setSecondaryLayout(e){e!==this.secondaryLayout&&(this.secondaryLayout=e,this._onSecondaryLayoutChanged.fire(this.secondaryLayout))}}}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){var t;(function(t){class i{getPrimaryPlayer(){return $(i.primaryPlayerSelector)}getSecondaryPlayers(){return $(i.secondaryPlayerSelector)}getLeftPane(){return $("#leftPane")}getLeftPlayerContainer(){return $("#leftPlayerContainer")}getRightPane(){return $("#rightPane")}getRightPlayerContainer(){return $("#rightPlayersContainer")}getPlayerFromElement(e){return e.closest(i.primaryPlayerSelector+", "+i.secondaryPlayerSelector)}}i.primaryPlayerSelector="#primaryPlayer",i.secondaryPlayerSelector="."+e.Viewer.Constants.SecondaryPlayerClass,t.PageElements=i})((t=e.Viewer||(e.Viewer={})).Viewer||(t.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){var t;(function(t){t.TabElements=class{constructor(e,t,i,o){this.tabElements=[],this.contentContainer=e,this.tabContainer=t,this.selected=i,this.expander=o}getTabs(){return $(this.tabElements)}getSelected(){return this.selected}getExpander(){return this.expander}getContentContainer(){return this.contentContainer}getContent(){return this.contentContainer.children().first()}addTab(e,t){this.tabElements.push(e),this.selected.before(e),this.tabElements.push(t),this.expander.find(".flyout-close").before(t)}setContentClass(t){this.getContent().attr("class",e.Viewer.Constants.SecondaryContentClass+" "+t)}setSelectedText(e){this.selected.find("#selectedSecondaryText").text(e)}setSelectedIcon(e,t){e?this.selected.find("#selectedSecondaryIcon").html(e).attr("class","material-icons"):this.selected.find("#selectedSecondaryIcon").html("").attr("class",t)}}})((t=e.Viewer||(e.Viewer={})).Viewer||(t.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Discussion=Panopto.Viewer.Tabs.Discussion||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Core=Panopto.Core||{},Panopto.Core.PlayResumption=Panopto.Core.PlayResumption||{},Panopto.viewer=Panopto.viewer||{};var Silverlight=Silverlight;const WEBCAST_MAX_PLAY_SPEED_LIVE=PanoptoViewer.PlaySpeed.Normal;PanoptoViewer.configure({hlsJsConfig:Panopto.viewer?.hlsJsConfig,flowplayerKey:Panopto.viewer?.flowplayerKey,serverAuthoritativeLeadingEvents:Panopto.features.serverAuthoritativeLeadingEvents,enableTextTrackCaptionSource:!1,enableReactQuiz:Panopto.viewer.enableReactQuiz,defaultMBRBitrate:Panopto.viewer.defaultMBRBitrate,enableSecureCdn:Panopto.viewer.enableSecureCdn}),Panopto.Viewer.Viewer=function(e,t,i,o,n,a){const r=PanoptoCore.Logging.Logger;let s=PanoptoTS.Viewer.Constants;const l=new PanoptoViewer.ViewerLogging(Panopto.globalServicesFQDN);var d,c,p,u,h,m,v=$.Deferred();let P=!1;var g,y,f,S,C,w,b=[],T=new PanoptoTS.Viewer.Controls.ManualFullScreenStateControlGroup;let E;var V,I=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1),!0,!0),R="true"===I.edit,D=I.tid,k=!!I.notes;let L;const x=parseInt(I.start,10);var A=!1;let U;var M,O,H,B,F=PanoptoViewer.Data.ViewerPlayState.Paused,z=0,N=0,G=0,j=!1,Q=!0;let W=!1;var q,K,J,Y,X,Z,ee,te=!1,ie=!1,oe=!0,ne=new PanoptoTS.Viewer.Viewer.PageElements;let ae,re=!1;var se;let le;$(document).ready((()=>{ae=PanoptoReactComponents.bootstrapReactComponentV2(PanoptoViewer.Controls.VcaDialog)(document.getElementById("vcaContainer"),{mode:"empty",onStart:()=>{},onAffirm:()=>{},onClose:()=>{}})}));var de,ce,pe=PanoptoCore.getUserSetting("defaultVolume"),ue=!1;const he=new PanoptoTS.Viewer.Logic.PlayerFactory({isEditor:R,playerHelpers:e});let me;var ve,Pe,ge=`<div class="${s.SecondaryPlayerClass} player"><div class="secondaryContent"></div></div>`,ye="true"===I.startMuted;let fe;const Se="true"===I.legacylti,Ce="true"===I.gradable;let we,be;Ce&&(Se?we={outcomeId:I.outcome_did,oauthConsumerKey:I.oauth_consumer_key,outcomeServiceUrl:I.lis_outcome_service_url}:be={deliveryId:I.id,providerId:I.providerid,lti13LineItemUrl:I.lti13lineitemurl,ltiUserId:I.ltiuserid});const Te=Panopto.Core.StringHelpers.parseQueryString(window.location.hash.slice(1)),Ee=Te.debug?new PanoptoTS.Viewer.Controls.MockSessions(Panopto.Core.ServiceInterface.Rest.Sessions):Panopto.Core.ServiceInterface.Rest.Sessions,Ve=new PanoptoTS.Viewer.EditorRouter((()=>{V.isViewable=V.isReadyForEditing,V.isRecentBroadcast=!1,V.multiBitrateEnabled=!1,w&&w.deregisterCallbacks(),w=Panopto.Viewer.Controls.Timeline.TimelineEditor(Te,e,U,V,Ee,(()=>{e.resize=void 0,Be(),w.overlayController.ready.then((()=>{Y.show(),e.resize()}))}))}),(()=>{const t=Panopto.Core.StringHelpers.format("<a href='#'>{0}</a>",Panopto.GlobalResources.ViewerPlus_Edit_ForceReprocess);Fe(t);var i=$("#messageText a");Panopto.Core.UI.Handlers.button(i,(function(){e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionManage",modalHeader:Panopto.Core.TextHelpers.innerText(V.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:V.id})})}))}),(()=>{window.location.href=Panopto.Core.StringHelpers.format(s.SilverlightEditorUrlTemplate,V.id)}),(()=>{ee.hide();const e=document.getElementById("sessionNotReadyContainer");PanoptoReactComponents.bootstrapReactComponentV2(PanoptoViewer.Controls.SessionNotReady)(e,{deliveryId:V.id,sessionId:V.sessionId,sessionName:V.title,onSessionReady:()=>{location.reload()}})}),(()=>{Fe(Panopto.GlobalResources.ViewerPlus_Edit_PendingEditedTranscriptionRequest)}),(()=>{ee.hide(),Panopto.Viewer.Header(e,V,void 0,void 0,void 0,t),Panopto.EditorProcessing(document.getElementById("processing"),{resources:Panopto.GlobalResources,delivery:V,deliveryThumbnailUrl:Panopto.viewer.data.thumbnailUrl})}),(()=>{ee.hide(),Panopto.Viewer.Header(e,V,void 0,void 0,void 0,t);const i=Panopto.GlobalResources.ViewerPlus_Edit_ReferenceCopy.replace(/\\n/g,"  ").replace(/{(.+)}/,(function(e,t){return'<a href="https://support.panopto.com/s/article/Learn-About-Video-Reference-Copies" target="_blank">{0}</a>'.format(t)}));if(e.toggleMessage(_.template($("#referenceCopyMessageTemplate").html())({title:Panopto.GlobalResources.ViewerPlus_Edit_ReferenceCopy_Title,message:i,unlink:Panopto.GlobalResources.ViewerPlus_Edit_Unlink,editOriginal:Panopto.GlobalResources.ViewerPlus_Edit_Original,cancel:Panopto.GlobalResources.ViewerPlus_Edit_Cancel})),Panopto.Core.UI.Handlers.button($(".reference-copy-unlink"),(function(){$("#referenceCopyMessage").hide(),ee.show(),Panopto.Core.ServiceInterface.Rest.Sessions.unlink(V.id,(function(e){window.location.reload()}),(function(){e.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,`mailto:${Panopto.supportEmailAddress}`)}))})),V.sourceDeliveryId){var o=$(".reference-copy-edit-original");Panopto.Core.UI.Handlers.button(o,(function(){window.location.href=PanoptoTS.Viewer.Constants.EditorUrl.format(V.sourceDeliveryId)})),o.show()}Panopto.Core.UI.Handlers.button($(".reference-copy-cancel"),(function(){if(window.opener&&window.close(),window.history.length>1)return void window.history.back();if((document.referrer||"").toLowerCase().includes("/viewer.aspx"))return void(window.location.search=window.location.search.replace(/([&?])edit=true(&?)/,""));const e=V.folder.id,t=PanoptoApiClient.buildAppUrl(["Pages","Sessions","List.aspx"],{hashParams:{folderID:e}});window.location.href=t}))}),(()=>{Fe(Panopto.GlobalResources.ViewerPlus_Edit_HasElaiInteractivity),$("#viewerMessage a").hide()})),Ie=new PanoptoViewer.GeneratedCaptionWarningOverlay(Panopto.viewer.captionDisclaimerEnabled,PanoptoCore.getUserSetting("defaultCaptionSize")??Panopto.Captions.selectedStyles.textSize);let _e,Re,De;const ke=t=>{const i=c&&c.visible()||Le();Re===t&&De===i||(t&&i||($(".plugin-screen").css({"max-height":t?"":0,border:t?"":0,overflow:t?"":"hidden"}),e.resize&&e.resize()),Re=t,De=i)};var Le=function(){return Panopto.Core.StringHelpers.parseQueryString(window.location.hash).modalPage};var xe=function(t,i){N=i="number"==typeof i?i:Math.max(z,e.position());var o,n,r,l,d,h,v=Date.now(),P=m.streamLength(),E=w?w.timelinePosition(t,i):i;if(E!==i)E===w.timelineEndPosition()&&(e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,void 0,void 0),E-=PanoptoTS.Viewer.Constants.EditorTimelineEndOffsetSeconds),e.setPosition(E);else if(P>0&&P!==1/0&&le!==P&&(le=P,me.updateDuration(le),_.each(b,(e=>{_.each(e.getTabs(),(function(e){e.adjustTimeline(le)}))}))),i=Math.clamp(i,0,le),o=Math.round(i),n=Math.max(0,Math.round(le-i)),me.updateFurthestWatchedPoint(i),C.synchronize(i,G,t,!!w)){M.state.playerState.position!=i&&M.setState({playerState:{position:i}}),S&&S.position(i),(t||!de||v-de>s.ControlSyncRate)&&(de=v,r=Panopto.Core.TimeHelpers.formatDuration(o,Panopto.GlobalResources.TimeSeparator),l=(n?"-":"")+Panopto.Core.TimeHelpers.formatDuration(n,Panopto.GlobalResources.TimeSeparator),d=Panopto.Core.TimeHelpers.formatDuration(Math.round(le),Panopto.GlobalResources.TimeSeparator),p.synchronize(i,le,r,l,d)),w&&w.synchronize(i,F===PanoptoViewer.Data.ViewerPlayState.Playing),T.syncTimes(r,d),V.multiBitrateEnabled&&p.synchronizeBitrate(),u&&u.updateProgress(i);const P=document.getElementById("primaryVideo"),C=P?.textTracks?.length>0;p.synchronizeCaption(C),function(t){var i,o,n=e.fullscreenPlayer();if(V.captions&&p.captionsSelected()){i=V.captions[_.findLastIndex(V.captions,(e=>e.time<=t))],(i?.captionDuration&&Panopto.viewer.enableCaptionEndTimeInViewer?i.time+i.captionDuration:void 0)<t&&(i=void 0);const e=document.getElementById("rightPlayersContainer");e&&Ie.attachToDOM(e)}else Ie.detachFromDOM();const r=document.getElementById("primaryVideo");r?.textTracks?.length>0&&V.isBroadcast&&(!V.hasCaptions&&p.captionsSelected()?r.textTracks[0].mode="showing":r.textTracks[0].mode="disabled"),o=i?i.text:"",n?n.getCaptionControl()&&n.getCaptionControl().setCaptionText(o):p.captionsDocked()?(g&&g.setCaptionText(""),y&&y.setCaptionText("")):e.viewMode()===a.Secondary?(g&&g.setCaptionText(""),y&&y.setCaptionText(o)):g&&g.setCaptionText(o),e.resizeCaption(o,p.captionsDocked())}(i),f.updateAudioDescriptions(V.audioDescriptions,i),t?f.seek(i):f.synchronizeTimelinePosition(i),m.isEndedBy(i)?re||(h=V.isBroadcast&&!Q,e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,!0,!0),async function(){re=!0,PanoptoViewer.Controllers.vcaSetState("canaffirm"),PanoptoViewer.Controllers.vcaCanSeek()||await new Promise((e=>{ae.setProps({mode:"affirm",onAffirm:async()=>{PanoptoViewer.Controllers.vcaSetState("affirmed"),u?.updateProgress(G,!0),await PanoptoViewer.Services.createViewerCompletionAffirmation(V.id),ae.setProps({mode:"end"}),e()}})})),Panopto.viewer.data.playlist?c.queueNextItem():!V.nextDelivery&&!h||w?w||e.isActiveBroadcast()||Panopto.viewer.vcaEnabled||e.setPosition(0,!0):(h?(te=!0,Z.text(q)):(e.setPosition(0,!0),V.nextDelivery.folderName=V.folder.name,Panopto.Core.UI.Components.nextDelivery(Z,V.nextDelivery,Panopto.GlobalResources,(function(){e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,void 0,void 0)}))),X.show(),ke(!1))}()):re&&(ae.setProps({mode:"empty"}),re=!1)}const I=p.playSpeed(),R=me.getValidPlaySpeed(I,N);R!==I&&(PanoptoCore.Logging.Logger.info(`Viewer.synchronize: slowing down to max play speed, currently at or after live edge. currentPlaySpeed: ${I}`),p.setPlaySpeed(R||WEBCAST_MAX_PLAY_SPEED_LIVE)),_e?.updateState({timelinePosition:N,paused:e.playState()===PanoptoViewer.Data.ViewerPlayState.Paused}),G=N},Ae=function(t){let i=0;if(void 0===Panopto.viewer.data.playlist&&void 0===w&&(i=Panopto.Core.PlayResumption.calculateStartTime(V.lastViewingPosition,V.duration)),w&&!t||Y.show(),le=V.isBroadcast?0:V.duration,me=new PanoptoViewer.TimelineSeekHelper(le,je(),V.isBroadcast),"all-seeking"!==Panopto.viewer.seekAndVspBehavior&&V.completionPercentage&&e.reportPercentCompleted(V.completionPercentage),I.isscorm){try{i=(u=new PanoptoViewer.Scorm.ScormControl(e.reportPercentCompleted,V.duration,Panopto.viewer.vcaEnabled)).lastPosition??i,u.completed&&Panopto.viewer.vcaEnabled&&(PanoptoViewer.Controllers.vcaSetState("disabled"),e.updateSeekAndVspBehavior("all-seeking"))}catch(e){PanoptoCore.Logging.Logger.error("Viewer: error initializing ScormControl.",e)}$("#allBookmarksLink").hide()}let a=0;a=isNaN(x)?i:me.getValidPosition(x)??i,function(t){if(!m){const i=$("#primaryScreen");if(Panopto.viewer.viewerWatermarkPosition&&Panopto.branding.embedLogo.png){let e=new PanoptoViewer.WatermarkLogo(Panopto.branding.embedLogo.png,Panopto.viewer.viewerWatermarkPosition);$("#primaryPlayer .letterbox").append(e.getBrandElem()),Panopto.viewer.viewerWatermarkPosition===PanoptoViewer.Data.ViewerWatermarkPositionOptions.TopRight&&e.setOffset(50)}const o=new PanoptoTS.Viewer.Players.AudioOnlyOverlay;o.getElement().insertAfter(i),o.onClick.add((()=>{e.togglePlaying(n.Labels.Normal)})),o.onShowOverlay.add((()=>{w.streamTab().showUploadOverlay({secondaryOnly:!1})})),m=w?PanoptoLegacy.Viewer.Players.PrimarySegmentPlayer(ne.getPrimaryPlayer(),i,he,e,w,o):PanoptoLegacy.Viewer.Players.PrimaryPlayer(ne.getPrimaryPlayer(),i,he,e,V,o,(()=>PanoptoViewer.handleSpanUpdateBlocked(Panopto.GlobalResources,l,Panopto.enableAutomaticLogsUpload,Panopto.viewer.analyticsIngestBlockedSupportPageUrl,V.id,V.invocationId,(()=>{e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,!1,!1)})))),V.primaryStreams.length&&e.reloadPrimaryContent(!0,t),g=m.getCaptionControl(),m.getFullscreenStateControl()&&T.add(m.getFullscreenStateControl())}}(a),M.setState({eventTabLogic:Oe()}),(ce=new PanoptoTS.Viewer.StandardPlayerLayout(ne,m,b)).onSecondaryLayoutChanged.add((t=>{let i;switch(t){case PanoptoTS.Viewer.SecondaryLayoutType.Single:i=1;break;case PanoptoTS.Viewer.SecondaryLayoutType.Double:i=2;break;case PanoptoTS.Viewer.SecondaryLayoutType.Quad:i=4}e.setSecondaryCount(i)}));const r=new PanoptoTS.Viewer.Controls.PlayerLayoutControls(w);r.onShowOverlay.add((()=>{w.streamTab().showUploadOverlay({secondaryOnly:!1})})),(f=new PanoptoViewer.AudioDescriptionPlayer).addEventListener("audioDescriptionStart",(()=>{e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,!1,!1)})),f.addEventListener("audioDescriptionEnd",(()=>{e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,!1,!1)})),p=Panopto.Viewer.PlayControls(e,V,m,pe,ne,ce,b,r,!!w,f,me,U.eventPane.state.tabSet),function(){let t=_.filter(V.documents,(e=>e.isQuiz));const i=new PanoptoQuiz.QuizResultsController(t,(()=>e.togglePlaying()),(()=>e.togglePlaying()),we,be);PanoptoTS.Viewer.QuizResultsController.setInstance(i),e.setSecondaryCount(1),S||w||(S=o.ThumbnailPlayer(V.thumbnails,e))}();const s=U.eventPane.state.tabSet;if(s?.captionsTab?.fetch(),s?.audioDescriptionsTab?.fetch(),PanoptoLegacy.Viewer.Layout(e,U,ne,ce,m,b,V,d,!1,w),!Panopto.viewer.allowMultipleSecondaryDisplay)for(let e of b)e.getTabControl().attachTabHandlers();ye&&!m.isMuted()&&e.toggleMuted();var h=K&&!Panopto.viewer.data.playlist?PanoptoViewer.Data.ViewerPlayState.Playing:PanoptoViewer.Data.ViewerPlayState.Paused;const v=$("#ltiQuizBlock");Panopto.LTIQuizBlock(v[0],{deliveryId:V.id,sessionHasQuiz:V.hasQuiz,ltiBlockSetting:PanoptoViewer.LTIQuizBlockingMode[Panopto.viewer.blockLTISessionsWithQuiz],ltiQueryParam:Ce,checkBlockSessionOnQuizReporting:Panopto.Core.ServiceInterface.Rest.Sessions.blockSessionOnQuizReporting,onPopupResolved:()=>{v.hide(),e.setPlayState(h,void 0,void 0)},resources:Panopto.GlobalResources}),!a||u||w?u||xe(!0,null):e.setPosition(a,!0),e.toggleScreens(!Le()),J&&!K&&(p.toggleAutoplayMessage(!0),c&&setTimeout((()=>{c.hide()}),c.autoHideDelay)),j=!0};const Ue=PanoptoCore.mapEnum(PanoptoViewer.Data.ErrorCode,(e=>e));var Me=function(t){if(ee.hide(),ie=!0,t&&t.ErrorCode){switch(t.ErrorCode){case PanoptoViewer.Data.ErrorCode.SiteDisabled:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_SiteDisabled);break;case PanoptoViewer.Data.ErrorCode.LoginRequired:n.sendEvent({action:n.Actions.Prereq,label:n.Labels.Login}),window.location.href=Panopto.viewer.unauthorizedViewerTransferUrl;break;case PanoptoViewer.Data.ErrorCode.AccessRequired:n.sendEvent({action:n.Actions.Prereq,label:n.Labels.Access}),window.location.href=t.RedirectUrl;break;case PanoptoViewer.Data.ErrorCode.InvalidUrl:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidUrl,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl);break;case PanoptoViewer.Data.ErrorCode.InvalidDelivery:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidDelivery,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl);break;case PanoptoViewer.Data.ErrorCode.NotInAvailabilityWindow:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_NotInAvailabilityWindow,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl);break;case PanoptoViewer.Data.ErrorCode.InvalidFormatForSSL:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidFormatForSSL,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl);break;case PanoptoViewer.Data.ErrorCode.HasPendingMergeOrCopyJobs:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_HasPendingMergeOrCopyJobs);break;case PanoptoViewer.Data.ErrorCode.Archived:ze();break;case PanoptoViewer.Data.ErrorCode.UnknownError:default:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,`mailto:${Panopto.supportEmailAddress}`)}PanoptoCore.InternalAnalytics.trackPendoEvent({name:"Delivery Error",metadata:{errorCode:Ue[t.ErrorCode]}})}else e.toggleMessage(Panopto.GlobalResources.ViewerPlus_NetworkError)},Oe=function(){return R?new PanoptoTS.Viewer.Logic.EditorEventTabLogic(V,e,D,w,Ee,Te,t,Panopto.Core.ServiceInterface.Rest.TagsRequest,Panopto.Core.ServiceInterface.Rest.SubscriptionRequest,Panopto.Core.ServiceInterface.Rest.Users):k?new PanoptoTS.Viewer.Logic.LiveNotesEventTabLogic(V,e,t):new PanoptoTS.Viewer.Logic.ViewerEventTabLogic(V,e,D,t,Panopto.Core.ServiceInterface.Rest.TagsRequest,Panopto.Core.ServiceInterface.Rest.SubscriptionRequest,Panopto.Core.ServiceInterface.Rest.Users)},He=function(i){ie=!1;var o,n=i.flowPlayerEnabled||!V.isBroadcast;if(V=i,M.setState({delivery:V}),oe=V.flowPlayerEnabled,I.isscorm&&(V.nextDelivery=null),R||(V.availableAudioDescriptionLanguages=PanoptoViewer.AudioDescriptionPlayer.filterToSupportedLanguages(V.availableAudioDescriptionLanguages),V.availableAudioDescriptionLanguages.length&&!0===PanoptoCore.getUserSetting("defaultAudioDescriptions")&&(K=!1)),I.notes)if(V.user.key){if(d=Panopto.Viewer.Header(e,V,void 0,void 0,void 0,t),M.setState({eventTabLogic:Oe()}),ce=new PanoptoTS.Viewer.StandardPlayerLayout(ne,null,b),PanoptoLegacy.Viewer.Layout(e,U,ne,ce,null,b,V,d,!0,w),e.viewMode(a.LiveNotes),Y.show(),Panopto.authCookieTimeoutMinutes){const e=Math.min(60*Panopto.authCookieTimeoutMinutes*1e3/2,2e9);setInterval(t.refreshAuthCookie,e)}}else Panopto.features.usePanoptoState?Panopto.Application.setPanoptoState(window.location.href).then((e=>{window.location.href=Panopto.loginUrl+"?panoptoState="+e?.panoptoStateId})):window.location.href=Panopto.loginUrl+"?ReturnUrl="+encodeURIComponent(window.location.href);else if(V.isViewable){e.toggleMessage(void 0),ve&&ve.remove(),d=Panopto.Viewer.Header(e,V,K,w,Panopto.viewer.data.playlist,t),c=d.playlistOverlay();let i=PanoptoViewer.Language.getStoredCaptionLanguage();!R&&V.availableCaptions.find((e=>e.language===i))||(i=V.availableCaptions.length>0?V.availableCaptions[0].language:Panopto.viewer.defaultContentLanguage);let a=PanoptoViewer.Language.getStoredADLanguage();if((R||void 0===a||V.availableAudioDescriptionLanguages.indexOf(a)<0)&&(a=V.availableAudioDescriptionLanguages.length>0?V.availableAudioDescriptionLanguages[0]:Panopto.viewer.defaultContentLanguage),PanoptoViewer.Language.setCaptionLanguages(V.availableCaptions),PanoptoViewer.Language.setCurrentCaptionLanguage(i),PanoptoViewer.Language.setADLanguages(V.availableAudioDescriptionLanguages),PanoptoViewer.Language.setCurrentADLanguage(a),Panopto.viewer.vcaEnabled||PanoptoViewer.Controllers.vcaSetState("disabled"),_e=new PanoptoViewer.Controllers.InteractivityController(V.sessionInteractivityType?V.id:void 0,(()=>e.updateSeekAndVspBehavior("no-seeking")),(t=>{e.setPosition(t)}),(t=>{e.setPlayState(t?PanoptoViewer.Data.ViewerPlayState.Paused:PanoptoViewer.Data.ViewerPlayState.Playing,!1,!1)})),V.requiresSilverlight)!(o=Silverlight.isInstalled(s.SilverlightVersion))||V.activePrimary.mediaFileType===PanoptoViewer.Services.Panopto_Shared_MediaFileType.wmv&&PanoptoCore.Browser.isSafari?(o?e.toggleMessage(Panopto.GlobalResources.ViewerPlus_Webkit_WMV_Warning):e.toggleMessage(Panopto.GlobalResources.Silverlight_DisabledChromeViewer,Panopto.GlobalResources.Silverlight_DisabledLink,"https://support.panopto.com/ChromeSilverlight"),n&&V.podcastCompleted&&($("#embedControl").show(),$("#embedControl").html(V.embedUrl))):Ae();else if(n){const e=V.primaryStreams.some((e=>0!==e.vrType))||V.secondaryStreams.some((e=>0!==e.vrType));Ae(e)}else Panopto.viewer.htmlPlaybackOnly?e.toggleMessage(Panopto.GlobalResources.ViewerPlus_NoInternetExplorer):e.toggleMessage(Panopto.GlobalResources.ViewerPlus_InstallOrEnable,Panopto.GlobalResources.ViewerPlus_AdobeFlashPlayer,s.FlashPlayerUrl,"adobe-download")}else if(d=Panopto.Viewer.Header(e,V,K,w,Panopto.viewer.data.playlist,t),V.isBroadcast){if(!V.activePrimary&&!ve){let e=Panopto.viewer.data.hasCustomThumbnail?Panopto.viewer.data.thumbnailUrl:null;(ve=new PanoptoTS.Viewer.Controls.WaitingRoom($("#waitingRoomContainer"),V,e)).render()}}else $e()},$e=function(){var t,i;V.folder.id?(t=Panopto.GlobalResources.ViewerPlus_SessionNotReady_WatchSomethingElse.format(V.folder.name),i=Panopto.Application.getBookmarkURL(s.SessionListUrl,{folderID:V.folder.id})):(t=Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,i=s.SessionListUrl),e.toggleMessage(Panopto.GlobalResources.ViewerPlus_SessionNotReady+"<br>"+Panopto.GlobalResources.ViewerPlus_SessionNotReadyRefresh,t,i)},Be=function(){ee.hide(),He(V)},Fe=function(i){ee.hide(),d=Panopto.Viewer.Header(e,V,void 0,void 0,void 0,t),e.toggleMessage(i,Panopto.GlobalResources.ViewerPlus_Edit_MoreInformation,Panopto.viewer.editorSupportUrl)};const ze=()=>{const t=e=>{$("#viewer").css("display","none"),$("#viewerArchivedPage").css("height","100%");Panopto.ViewerArchivedPage(document.getElementById("viewerArchivedPage"),{resources:Panopto.GlobalResources,deliveryArchiveStatus:e,requestRestoreFromArchive:(t,i)=>{const o=[{DeliveryID:e.deliveryId}];Panopto.Core.ServiceInterface.Rest.Sessions.batchRestoreFromArchive(o,t,i,$.noop)}})},i=PanoptoTS.API.Rest.ServiceFactory.getArchiveService();I.id?i.getDeliveryArchiveStatus(I.id,t,(()=>e.toggleMessage(Panopto.GlobalResources.ViewerPlus_ArchivedRestoreUnavailable,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl))):I.tid&&i.getDeliveryArchiveStatusByInviteId(I.tid,t,(()=>e.toggleMessage(Panopto.GlobalResources.ViewerPlus_ArchivedRestoreUnavailable,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl)))},Ne=(e,t)=>{let i=t;if(E){let t=_.findLastIndex(E,(t=>t.start>=e)),o=E[t];for(;o&&o.start<e+i;)i+=o.end-o.start,o=E[++t]}return i};$(document).ready((function(){U=Panopto.Viewer.createViewerBridge(document.getElementById("viewerBridge")),(M=U.viewer).onEventTabFocused=()=>e.expandLeftPane(),M.onEventTabSelected=()=>e.expandLeftPane(),new PanoptoTS.Viewer.Controls.EventPane(U);var t="true"===I.edit,o=I.id;!o&&Panopto.viewer.data.playlist&&(o=Panopto.viewer.data.playlist.initialDeliveryId),Y=$("#viewerContent"),X=$("#inlineMessageLetterbox"),Z=$("#inlineMessage"),ee=$("#loadingSpinnerContainer"),PanoptoReactComponents.bootstrapReactComponentV2(PanoptoViewer.Controls.LoadingSpinner)(ee[0],{message:Panopto.GlobalResources.Loading}),ee.show(),h=Panopto.Core.UI.Components.CopyrightNotice($("#copyrightNoticeContainer"),Panopto.viewer.copyrightNoticeText,Panopto.viewer.copyrightNoticeAutoDismissDuration,Panopto.viewer.allowInsecureHTMLTagsInCopyrightAndPolicyTexts);let n=Panopto.Core.StringHelpers.parseBoolean(I.advance);J=(Panopto.features.autoPlayEnabled&&"false"!==I.autoplay||n)&&!t;let a=0===pe||ye;const l=PanoptoViewer.canAutoplay({muted:a,playsInline:!0,autoPlayRequested:J});Pe=function(){l.then((n=>{K=n.canAutoplay,function(t,o,n){fe=i(t,o,n,!1,k,!0,(e=>(L=e.SessionId,new PanoptoTS.Viewer.Data.Delivery(e))),(async e=>{V=e,PanoptoViewer.Language.setADLanguages(V.availableAudioDescriptionLanguages),PanoptoViewer.Language.setCaptionLanguages(V.availableCaptions),await PanoptoViewer.AudioDescriptionPlayer.initializeSpeechSynthesisVoices(),(Panopto.viewer.isHiveEnabled||Panopto.viewer.isKollectiveEnabled)&&(V.primaryStreams.forEach((e=>{e.mediaFileType===PanoptoViewer.Services.Panopto_Shared_MediaFileType.mp4&&(Panopto.viewer.isHiveEnabled=!1,Panopto.viewer.isKollectiveEnabled=!1,r.info("[Viewer] Disabling hive due to mp4 primary"))})),V.secondaryStreams.forEach((e=>{e.mediaFileType===PanoptoViewer.Services.Panopto_Shared_MediaFileType.mp4&&(Panopto.viewer.isHiveEnabled=!1,Panopto.viewer.isKollectiveEnabled=!1,r.info("[Viewer] Disabling hive due to mp4 secondary"))}))),n?V.user.role<=Panopto.Data.AclRoleType.Viewer?window.location.href=Panopto.viewer.unauthorizedEditorTransferUrl:Ve.routeDelivery(V):Be()}),(e=>{He(e)}),(t=>{e.updateDelivery(t)}),(()=>{window.location.reload()}),Me),(PanoptoViewer.enableSecureCdn()?PanoptoViewer.Controllers.enableSignedUrl(t):Promise.resolve()).then((()=>{fe.start()}))}(I.id||o,I.tid,t)}))},Panopto.viewer.data.playlist&&Panopto.viewer.data.playlist.errorCode?function(t){switch(t){case PanoptoViewer.Data.ErrorCode.InvalidPlaylist:case PanoptoViewer.Data.ErrorCode.InvalidPlaylistUrl:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidPlaylist,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl);break;case PanoptoViewer.Data.ErrorCode.InvalidPlaylistNoSessions:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_PlaylistHasNoViewableSessions,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,s.SessionListUrl);break;case PanoptoViewer.Data.ErrorCode.UnknownError:default:e.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,`mailto:${Panopto.supportEmailAddress}`)}PanoptoCore.InternalAnalytics.trackPendoEvent({name:"Playlist Error",metadata:{errorCode:Ue[t]}})}(Panopto.viewer.data.playlist.errorCode):Pe(),t&&($(document).on("dragstart",(e=>{e.target.classList.contains("ui-draggable")||e.preventDefault()})),Y.on("dragenter",(()=>{w.streamTab().showUploadOverlay({secondaryOnly:!1})})));const d=document.getElementsByTagName("main")[0],c=document.getElementById("vcaContainer");if(d&&c){new ResizeObserver((()=>{requestAnimationFrame((()=>{if(PanoptoCore.Helpers.getFullscreenElement())c.style.top="0px",c.style.left="0px",c.style.width="100%",c.style.height="100%";else{const e=d.getBoundingClientRect();c.style.top=`${e.top}px`,c.style.left=`${e.left}px`,c.style.width=`${e.width}px`,c.style.height=`${e.height}px`}}))})).observe(d)}})),e.isDeliveryError=function(){return ie},e.positionAutoplayMessage=function(){p&&p.positionAutoplayMessage()},e.isLive=function(){return m&&m.isLive()},e.position=function(t,i){if(void 0===t)return m?m.position():0;i||(t=me.getValidPosition(t)),void 0!==t&&(V.isBroadcast&&m.setIsLive(t===1/0,null),m.setPosition(t,null),V.isBroadcast&&e.playState()===PanoptoViewer.Data.ViewerPlayState.Playing&&m.setPlayStateWithLogging(PanoptoViewer.Data.ViewerPlayState.Playing,!0),z=t,xe(!0,t),X.hide(),ke(!0),te=!1)},e.getPosition=()=>new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(e.position()*Panopto.Core.Constants.TimelineChunkMultiplier),e.setPosition=e.position;let Ge=!1;e.playState=function(t,i,o){if(void 0===t)return F;PanoptoCore.Browser.isSafari&&e.isDVRDisabled()&&!P?p.togglePlayState(!0):(p.togglePlayState(t===PanoptoViewer.Data.ViewerPlayState.Paused),Panopto.viewer.showCopyrightNotice&&!w||v.resolve(),t===PanoptoViewer.Data.ViewerPlayState.Playing&&"pending"===v.state()?(h.isShowingNotice()||m.onReady.then((()=>{ce.getLeftPlayerElement().hide(),ce.getRightPlayerElements().hide(),h.showNotice((()=>{ce.getLeftPlayerElement().show(),ce.getRightPlayerElements().show(),v.resolve(),e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,!1,!1)}))})),t=PanoptoViewer.Data.ViewerPlayState.Paused,p.togglePlayState(t===PanoptoViewer.Data.ViewerPlayState.Paused)):t!==PanoptoViewer.Data.ViewerPlayState.Playing||PanoptoViewer.Controllers.vcaCanResume()||(Ge||(Ge=!0,ae.setProps({mode:"start",onStart:()=>{PanoptoViewer.Controllers.vcaSetState("canplay"),ae.setProps({mode:"empty"}),Ge=!1,e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,!1,!1)}})),t=PanoptoViewer.Data.ViewerPlayState.Paused,p.togglePlayState(t===PanoptoViewer.Data.ViewerPlayState.Paused)),t!==F&&(F=t,V.isBroadcast&&t===PanoptoViewer.Data.ViewerPlayState.Paused&&!i&&m.setIsLive(!1,null),t===PanoptoViewer.Data.ViewerPlayState.Playing&&(te?e.setPosition(0):V.isBroadcast&&m.isLive()&&(PanoptoCore.Browser.isSafari||(m.setIsLive(!1,null),e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,void 0,void 0)),m.setIsLive(!0,(()=>{e.synchronize(!0)})))),m.setPlayStateWithLogging(t,!o),se&&V.isBroadcast||(t===PanoptoViewer.Data.ViewerPlayState.Paused?clearInterval(se):se=setInterval((function(){xe(!1,null)}),s.TimedSyncRate)),t===PanoptoViewer.Data.ViewerPlayState.Playing&&p.toggleAutoplayMessage(!1),C.clearSyncTimeout(),_.each(b,(e=>{var t=e.getCurrentPlayer();t&&t.playState(F)})),T.syncPlayState(F),X.hide(),ke(!0),w&&w.synchronize(e.position(),F===PanoptoViewer.Data.ViewerPlayState.Playing),t===PanoptoViewer.Data.ViewerPlayState.Playing&&f.resume(e.position())))},e.setPlayState=e.playState,e.isAudioDescriptionsSelected=()=>p.audioDescriptionsSelected(),e.reloadPrimaryContent=function(t,i){i&&m.setStartPosition(i),m.setPrimaryContent(V.primaryStreams,V.activePrimary,t,(function(){P=!0,e.synchronize(!0)})),i&&m.setStartPosition(void 0)},e.setPrimarySegments=function(t,i,o,n){if(w&&m&&i.length&&(E=_.filter(t,(e=>!e.element.containsPrimary())),m.setSegments(t,i,o,n),!A&&!isNaN(x))){const t=Ne(0,x);e.setPosition(t),A=!0}},e.activePrimary=function(){return m.activePrimary()},e.activeSecondary=function(){var e=b.length>0&&b[0].getTabControl().selectedTab();return e&&e.content()},e.selectSecondaryTab=function(e,t){b.length>0&&b[0].getTabControl().selectTabById(e,t)},e.toggleMessage=function(t,i,o,n,a){var r=$("#viewerMessage"),s=r.find("#messageLink");t?(O=e.position(),j&&!B&&(B=e.playState(),e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,void 0,void 0)),e.setFullscreenPlayer(void 0),Y.hide(),ee.hide(),ve&&ve.toggle(!1),r.find("#messageText").html(t),i?(s.text(i).attr("href",o).show(),a&&Panopto.Core.UI.Handlers.button(s,a)):s.hide(),r.find("#messageIcon").removeClass().addClass(n).attr("href",o),r.show()):r.is(":visible")&&(r.hide(),j?(Y.show(),e.reloadPrimaryContent(!0,e.position()),b.forEach((e=>{var t=e.getStreamPlayer();t&&t.setContent(t.content(),!0,null)})),e.setPlayState(B,void 0,void 0),m.playState(B),V.isBroadcast||e.setPosition(O,!0),B=void 0):ve&&ve.toggle(!0))},e.toggleScreens=function(t){e.viewMode&&e.viewMode()!==a.LiveNotes&&!X.is(":visible")&&(t&&H?(ke(!0),e.setPlayState(H,void 0,void 0),H=void 0):t||H||(H=F,e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,void 0,void 0),ke(!1))),ue||(Panopto.ModalPopup.defaultInstance.hide((function(){e.toggleScreens(!0)})),ue=!0)},e.playlistOverlayToggled=function(e){oe||ke(!e)},e.fullscreenPlayer=function(){var e;if(m&&m.isFullscreen())e=m;else{var t=_.find(b,(function(e){return e.getStreamPlayer()&&e.getStreamPlayer().isFullscreen()}));t&&(e=t.getStreamPlayer())}return e},e.setFullscreenPlayer=function(e){m&&m.setIsFullscreen(e===m);for(let t of b){let i=t.getStreamPlayer();i&&i.setIsFullscreen(e===i)}const t=document.getElementById("interactivitySurface");t&&(e?document.getElementById("fullscreenControlsWrapper")?.prepend(t):document.getElementById("rightPlayersContainer")?.prepend(t));const i=document.getElementById("vcaContainer");i&&(e?document.getElementById("fullscreenControlsWrapper")?.prepend(i):document.getElementById("proLoginBanner")?.prepend(i))},e.isFullscreen=function(){return!!e.fullscreenPlayer()},e.ensureSecondaryIsMinimized=function(){b.forEach((e=>{var t=e.getStreamPlayer();t&&t.minimizeIfHidden()}))},e.setCaptionStyles=function(e){g&&g.setCaptionStyles(e),y&&y.setCaptionStyles(e)},e.synchronize=xe,e.refreshPlayers=function(){_.each(b,(t=>{t.reinitializeTabs(V,e),t.getTabControl().attachTabHandlers()}))},e.updateDelivery=function(t){if(V=t,Y.is(":visible")){const t=!V.broadcastInterrupted&&W;e.reloadPrimaryContent(t,e.position())}b.forEach((t=>{t.updateTabs(V,e,m.streamLength())})),e.toggleMessage(void 0),PanoptoCore.Logging.Logger.verbose(`Viewer.updateDelivery: ended: ${V.broadcastEnded}, interrupted: ${V.broadcastInterrupted}`),W=V.broadcastInterrupted,V.broadcastEnded?e.endBroadcast():e.restartBroadcast()},e.endBroadcast=function(){var t;PanoptoCore.Logging.Logger.verbose(`Viewer.endBroadcast: broadcastActive: ${Q}`),Q&&(Q=!1,q=V.broadcastInterrupted?Panopto.GlobalResources.ViewerPlus_BroadcastInterrupted:Panopto.GlobalResources.ViewerPlus_BroadcastEnded_Notification,t=V.activePrimary.relativeEnd-s.BroadcastEndThreshold,m.updateMaxPosition(t),e.position()>t&&e.setPosition(t),M.setState({viewerState:_.extend({},M.state,{isEnded:!0})}))},e.restartBroadcast=function(){PanoptoCore.Logging.Logger.verbose(`Viewer.restartBroadcast: broadcastActive: ${Q}`),Q||(Q=!0,te=!1,m.updateMaxPosition(null),m.isLive()&&(X.hide(),PanoptoCore.Browser.isSafari||(m.setIsLive(!1,null),e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,void 0,void 0)),m.setIsLive(!0,(()=>{e.synchronize(!0)}))),M.setState({viewerState:_.extend({},M.state.viewerState,{isEnded:!0})}))},e.isActiveBroadcast=function(){return V.isBroadcast&&Q},e.logDesync=function(e,t,i,o){o?(n.sendDesyncEvent({diff:e,deliveryId:V.id,invocationId:V.invocationId,syncLogic:t,actionMessage:i}),r.verbose(`(${t}) ${i} for delta ${e}`)):r.debug(`(${t}) ${i} for delta ${e}`)},e.submitClientLog=function(e,t){const i={InvocationId:V.invocationId,Entries:[`SessionId: ${V.sessionId}`,...l.retrieveLogs()]};Panopto.Core.ServiceInterface.WCFRest.DataCS.submitViewerClientLog(i,e,t)},e.togglePlaying=function(t){if(!Le())if(n.sendEvent({action:F===PanoptoViewer.Data.ViewerPlayState.Playing?n.Actions.Pause:n.Actions.Play,label:t||n.Labels.Fullscreen}),F===PanoptoViewer.Data.ViewerPlayState.Playing)e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,void 0,void 0);else _e?.overrideResume()||e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,void 0,void 0)},e.rewind=function(t,i){e.userSeekEnabled()&&(n.sendEvent({action:n.Actions.Rewind,label:t||n.Labels.Fullscreen}),i=i||s.QuickRewindSeconds,i=((e,t)=>{let i=t;if(E){let t=_.findLastIndex(E,(t=>t.end<=e)),o=E[t];for(;o&&o.end>e-i;)i+=o.end-o.start,o=E[--t]}return i})(e.position(),i),e.setPosition(Math.max(0,e.position()-i)))},e.skipToStart=function(t){e.userSeekEnabled()&&(n.sendEvent({action:n.Actions.SkipToStart,label:t||n.Labels.Fullscreen}),e.setPosition(0))},e.forward=function(t,i){e.userSeekEnabled()&&(n.sendEvent({action:n.Actions.Forward,label:t||n.Labels.Fullscreen}),i=i||s.QuickForwardSeconds,V.isBroadcast&&m.isLive()||(i=Ne(e.position(),i),e.setPosition(Math.min(le,e.position()+i))))},e.skipToEnd=function(t){e.userSeekEnabled()&&(n.sendEvent({action:n.Actions.SkipToEnd,label:t||n.Labels.Fullscreen}),e.setPosition(le))},e.volumeUp=function(e,t){e=e||n.Labels.Fullscreen,t=t||s.VolumeIncrement,p.updateVolume(m.volume()+t,!0,e)},e.volumeDown=function(e,t){e=e||n.Labels.Fullscreen,t=t||s.VolumeIncrement,p.updateVolume(m.volume()-t,!0,e)},e.toggleMuted=function(e){n.sendEvent({action:m.isMuted()?n.Actions.Unmute:n.Actions.Mute,label:e||n.Labels.Fullscreen}),p.toggleMuted()},e.hotkey=function(t){switch(t){case s.PlayKeyCode:e.togglePlaying(n.Labels.Hotkey);break;case s.RewindKeyCode:e.rewind(n.Labels.Hotkey,s.PositionIncrement);break;case s.ForwardKeyCode:e.forward(n.Labels.Hotkey,s.PositionIncrement);break;case s.VolumeUpKeyCode:p.showVolumeControl(),e.volumeUp(n.Labels.Hotkey);break;case s.VolumeDownKeyCode:p.showVolumeControl(),e.volumeDown(n.Labels.Hotkey);break;case s.MuteKeyCode:e.toggleMuted(n.Labels.Hotkey)}},e.getQuestionList=function(e){return w?w.getQuestionList(e):void 0},e.updateQuestionList=function(e){return w?w.updateQuestionList(e):void 0},e.getSinglePageAppConfig=function(){return{quizFillInTheBlankEnabled:!0}},e.getSessionLength=function(){return w?w.activeState().duration()/Panopto.Core.Constants.TimelineChunkToMillisMultiplier:void 0},e.getEvent=function(e){return w?w.getEvent(e):void 0},e.validateEventTime=function(e){return w?w.validateEventTime(e):void 0},e.updateEvent=function(e){return w?w.updateEvent(e):void 0},e.isDVRDisabled=function(){const e=m.optimizationProvider()===PanoptoTS.Viewer.Constants.Hive&&PanoptoCore.Browser.isSafari;return V.isBroadcast&&e},e.userSeekEnabled=()=>{const t=Boolean(m&&e.isDVRDisabled());return("no-seeking"!==Panopto.viewer.seekAndVspBehavior||!!V.isBroadcast)&&!t||!!w};const je=()=>{const t=Boolean(m&&e.isDVRDisabled());let i;return i=w?"all-seeking":t?"no-seeking":Panopto.viewer.seekAndVspBehavior,i};e.reportPercentCompleted=t=>{const i=Math.min((t-1)/100,1)*le;me.updateFurthestWatchedPoint(i),"all-seeking"!==Panopto.viewer.seekAndVspBehavior&&Panopto.viewer.enableSeekAndVspAfterPercentage>0&&Panopto.viewer.enableSeekAndVspAfterPercentage<t&&!Panopto.viewer.vcaEnabled&&e.updateSeekAndVspBehavior("all-seeking")},e.updateSeekAndVspBehavior=t=>{Panopto.viewer.seekAndVspBehavior!==t&&(Panopto.viewer.seekAndVspBehavior=t,me.enableSeekAndVsp(),"all-seeking"===Panopto.viewer.seekAndVspBehavior&&me.updateDuration(le),p&&p.onUserSeekEnabledChanging(e.userSeekEnabled()))},e.setSecondaryCount=function(t){if(t!==b.length){for(;b.length<t;){var i,o=$.parseHTML(ge);ne.getRightPlayerContainer().append(o),i=Panopto.viewer.allowMultipleSecondaryDisplay?new PanoptoTS.Viewer.Controls.OverlayTabControlElements($(o)):new PanoptoTS.Viewer.Viewer.TabElements($(o),$("#transportControls"),$("#selectedSecondary"),$("#secondaryExpander"));var n=new PanoptoTS.Viewer.Controls.SecondaryContentContainer(i,V,e,w?.editableQuizService,b.length);b.push(n);var a=n.getStreamPlayer();a&&(y=a.getCaptionControl(),a.getFullscreenStateControl()&&T.add(a.getFullscreenStateControl()))}for(var s=ce.getRightPlayerElements();b.length>t;){$(s[b.length-1]).remove(),(n=b[b.length-1]).remove(),b.length=b.length-1}if(t!==b.length){const e=b.length;r.error(`Expected to resolve to ${t} secondary containers. Found ${e}`)}C&&C.clearSyncTimeout(),b.length>0&&(C=PanoptoTS.Viewer.Logic.PlayerSynchronizationLogicFactory.create(e,p,m,b)),e.resize&&(e.isSecondarySwapAllowed()||ce.getPrimaryPlayerIndex()===ce.PrimaryDefaultIndex||e.swapLeftToRight(ce.PrimaryDefaultIndex),e.resize(),e.synchronize())}},e.hasPendingSecondaryUploads=function(){return!!w&&w.streamTab().hasPendingSecondaryUploads()},e.toggleSecondaryPlaceholder=function(e){w&&w.overlayController.toggleSecondaryPlaceholder(e)},e.reinitializeDelivery=function(){w.overlayController.closeOverlays(),Pe()},e.forceLeftPlayerHeight=!1,e.pageStructureElements=function(){return ne},e.playerFactory=he;const Qe=[];return e.addSessionNameUpdateListener=function(e){Qe.push(e)},e.updateSessionName=function(e,{fromHeader:t}){Qe.forEach((i=>i(e,{fromHeader:t})))},e.getSessionId=()=>L,e.getContentInitialized=()=>j,e},function(e){!function(t){!function(t){const i=PanoptoCore.Logging.Logger;class o{constructor(e,t){this.queues={},this.name=e,this.currentState=t}getCurrentState(){return this.currentState}getCurrentTransition(){return this.currentTransition}handleTrigger(e,t,i){var n=this.createTriggerRecord(e,t,i);null!=this.currentTriggerRecord||this.getInternalQueue(o.mainQueue).data.length?this.queueTrigger(o.mainQueue,n):this.runTrigger(n)}getInternalQueue(t){var i=this.queues[t.name];return i||(i=new e.Logic.StateMachine.Machine.TriggerRecordQueue(t.name),this.queues[t.name]=i),i}shouldQueueTrigger(e,t){var i=!0;if(!t.completeCallback){var n,a=this.getInternalQueue(e);a.data.length?n=a.data[a.data.length-1]:e===o.mainQueue&&(n=this.currentTriggerRecord),n&&n.trigger===t.trigger&&n.data===t.data&&(i=!1)}return i}logQueue(e){var t=_.reduce(e.data,((e,t,i)=>e+"["+i+"] "+t.trigger.name+" "),"");i.verbose(Panopto.Core.StringHelpers.format("[{0}] {1} {2}: {3}",this.name,"Queue",e.name,t))}getTransition(e,t){return _.find(e.transitions,(e=>e.trigger===t.trigger))}getExpectedState(e,t){var i;if(e){var o=this.getTransition(e,t);o?(i=o.toState)?i.triggerOnEnter&&(i=this.getExpectedState(i,this.createTriggerRecord(i.triggerOnEnter,void 0,void 0))):i=e:_.contains(e.ignoreTriggers,t.trigger)&&(i=e)}return i}queueTrigger(e,t){if(this.shouldQueueTrigger(e,t)){var i=this.getInternalQueue(e);e===o.mainQueue&&(i.expectedEndState||(i.expectedEndState=this.getExpectedState(this.currentState,this.currentTriggerRecord)),t.expectedStartState=i.expectedEndState,i.expectedEndState=this.getExpectedState(i.expectedEndState,t)),i.data.push(t),this.logTriggerRecord(t,e===o.mainQueue?"Queued":"Delay queued"),this.logQueue(i)}}createTriggerRecord(e,t,i){return{trigger:e,data:t,completeCallback:i}}logTriggerRecord(e,t){var o=new Date,n=Panopto.Core.StringHelpers.format("[{0}] {1}:{2}.{3} {4} trigger {5} from state {6}{7}{8}",this.name,o.getMinutes(),o.getSeconds(),o.getMilliseconds(),t,e.trigger.name,this.currentState.name,void 0!==e.data?" with data "+("object"==typeof e.data?JSON.stringify(e.data):e.data):"",e.expectedStartState?" expectedState "+e.expectedStartState.name:"");i.verbose(n)}runTrigger(e){var t=this.getTransition(this.currentState,e);if(t)if(t.delayToQueue)this.queueTrigger(t.delayToQueue,e);else{this.currentTriggerRecord=e,this.currentTransition=t;var i=this.getInternalQueue(o.mainQueue);if(this.currentTriggerRecord.expectedStartState!==this.currentState&&i.data.length){this.currentTriggerRecord.expectedStartState=this.currentState;var n=!1,a=this.currentState;_.each(i.data,(e=>{n||e.expectedStartState===a?n=!0:(e.expectedStartState=a,a=this.getExpectedState(a,e))})),n||(i.expectedEndState=a)}this.logTriggerRecord(e,"Running");var r=()=>{this.detachEvent&&this.detachEvent(void 0),e.completeCallback&&e.completeCallback(),this.exitTransition(this.currentTransition,e.data)};if(this.currentTransition.exitEvent&&this.attachEvent(void 0,this.currentTransition.exitEvent,r),t.releaseQueue){i=this.getInternalQueue(o.mainQueue);var s=this.getInternalQueue(t.releaseQueue);i.data=s.data.concat(i.data),s.data.length=0,s.expectedEndState=void 0}t.action?t.action(e.data,r):r()}else _.contains(this.currentState.ignoreTriggers,e.trigger)||this.logTriggerRecord(e,"No transition for"),this.exitTransition(void 0,void 0)}enterState(e){_.any(this.currentState.transitions,(e=>!!e.triggerEvent))&&this.detachEvent(this.currentState),this.currentState=e,_.each(this.currentState.transitions,(e=>{e.triggerEvent&&this.attachEvent(this.currentState,e.triggerEvent,(()=>this.handleTrigger(e.trigger,void 0,void 0)))}))}exitTransition(e,t){if(e&&e!==this.currentTransition)i.info("Transition ended which is not the current transition");else{var n;this.currentTriggerRecord=void 0,this.currentTransition=void 0,e&&e.toState&&(this.enterState(e.toState),e.toState.triggerOnEnter&&(n=this.createTriggerRecord(e.toState.triggerOnEnter,t,void 0)));var a=this.getInternalQueue(o.mainQueue);!n&&a.data.length&&(n=a.data[0],a.data=a.data.slice(1),a.expectedEndState=void 0),n&&this.runTrigger(n)}}}o.mainQueue={name:"main"},t.Machine=o}(t.StateMachine||(t.StateMachine={}))}(e.Logic||(e.Logic={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){e.TriggerRecordQueue=class{constructor(e){this.name=e,this.data=[]}}}(e.Machine||(e.Machine={}))}(e.StateMachine||(e.StateMachine={}))}(e.Logic||(e.Logic={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t extends e.AddStreamOverlay{renderElement(){let e={primaryImage:Panopto.cacheRoot+"/Images/upload_primary_stream_large.svg",secondaryImage:Panopto.cacheRoot+"/Images/upload_secondary_stream.svg",resx:this.resources};this.element=$(t.template(e)),this.overlayUploader.attachPrimaryTargetHandler(this.element.find(".primary-stream .graphic-container")),this.overlayUploader.attachSecondaryOrSlidesTargetHandler(this.element.find(".secondary-stream .graphic-container"))}}t.template=_.template('\n            <div class="session-overlay">\n                <a\n                    href="#"\n                    class="close-button"\n                    role="button"\n                    aria-label="<@- resx.Viewer_ClosePopup @>">\n                    <i class="material-icons">&#xE5CD;</i>\n                </a>\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell" colspan="2">\n                            <div class="overlay-title">\n                                <@- resx.ViewerPlus_PrimaryOrSecondaryOverlay_Title @>\n                            </div>\n                            <div class="processing-status" style="display:none;"></div>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td class="primary-stream side-by-side-cell">\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- primaryImage @>" class="standard-graphic-image primary-stream-graphic">\n                                    <div>\n                                        <span class="primary-stream-text"><@- resx.ViewerPlus_PrimaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                        <td class="secondary-stream side-by-side-cell">\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- secondaryImage @>" class="standard-graphic-image secondary-stream-graphic">\n                                    <div>\n                                        <span class="secondary-stream-text"><@- resx.ViewerPlus_SecondaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),e.AddPrimaryOrSecondaryOverlay=t}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t extends e.AddStreamOverlay{renderElement(){let e={sessionImage:Panopto.cacheRoot+"/Images/upload_primary_stream_small.svg",resx:this.resources};this.element=$(t.template(e)),this.overlayUploader.attachPrimaryTargetHandler(this.element.find(".graphic-container"))}}t.template=_.template('\n            <div class="session-overlay">\n                <a\n                    href="#"\n                    class="close-button"\n                    role="button"\n                    aria-label="<@- resx.Viewer_ClosePopup @>">\n                    <i class="material-icons">&#xE5CD;</i>\n                </a>\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell">\n                            <div class="overlay-title">\n                                <@- resx.ViewerPlus_PrimaryOverlay_Title @>\n                            </div>\n                            <div class="processing-status" style="display:none;"></div>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td>\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- sessionImage @>" class="standard-graphic-image primary-stream-graphic" />\n                                    <div>\n                                        <span class="primary-stream-text"><@- resx.ViewerPlus_PrimaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),e.AddPrimaryOverlay=t}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t extends e.AddStreamOverlay{renderElement(){let e={sessionImage:Panopto.cacheRoot+"/Images/upload_secondary_stream.svg",resx:this.resources};this.element=$(t.template(e)),this.overlayUploader.attachSecondaryOrSlidesTargetHandler(this.element.find(".graphic-container"))}}t.template=_.template('\n            <div class="session-overlay">\n                <a\n                    href="#"\n                    class="close-button"\n                    role="button"\n                    aria-label="<@- resx.Viewer_ClosePopup @>">\n                    <i class="material-icons">&#xE5CD;</i>\n                </a>\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell">\n                            <div class="overlay-title">\n                                <@- resx.ViewerPlus_SecondaryOverlay_Title @>\n                            </div>\n                            <div class="processing-status" style="display:none;"></div>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td>\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- sessionImage @>" class="standard-graphic-image secondary-stream-graphic" />\n                                    <div>\n                                        <span class="secondary-stream-text"><@- resx.ViewerPlus_SecondaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),e.AddSecondaryOverlay=t}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){class i{get editCallbacks(){return this._editCallbacks}get deleteCallbacks(){return this._deleteCallbacks}constructor(t,o,n,a){this._editCallbacks=new PanoptoCore.TypedCallback,this._deleteCallbacks=new PanoptoCore.TypedCallback;const r=$(i.template());r.appendTo(t),o.click((e=>{e.stopPropagation()})),a&&a.toggleAppearsOnHover&&Panopto.Core.UI.Handlers.hoverableParent(t,o,(e=>o.css({opacity:e?1:0})));const s="edit-menu-open";this.editButton=$(i.editButtonTemplate({resources:n})),this.editButton.appendTo(r),Panopto.Core.UI.Handlers.button(this.editButton,(()=>{o.focus(),this._editCallbacks.fire(this.event)})),this.deleteButton=$(i.deleteButtonTemplate({resources:n})),this.deleteButton.appendTo(r),Panopto.Core.UI.Handlers.button(this.deleteButton,(()=>{o.focus(),this._deleteCallbacks.fire(this.event)}));let l=new e.Core.UI.Components.PopupMenuBehavior({menu:r,menuButton:o,itemSelector:".edit-event-menu-button"});l.onOpened.add((()=>{const e=o.offset().top;r.offset({left:o.offset().left+o.outerWidth()-r.outerWidth(),top:e<$(window).height()/2?e+o.outerHeight():e-r.height()}),t.addClass(s)})),l.onClosed.add((()=>{t.removeClass(s)}))}setEvent(e,t){this.event=e,this.editButton.toggle(!!t.canEdit),this.deleteButton.toggle(!!t.canDelete)}}i.template=_.template("\n            <div class='edit-event-menu' style='display:none;'></div>\n        "),i.editButtonTemplate=_.template("\n            <div\n                class='edit-event-menu-button menu-edit-button'\n                tabindex='0'\n                style='display:none;'\n            >\n                <i class='material-icons' aria-hidden='true'>&#xE150;</i>\n                <span><@- resources.ViewerPlus_EventEdit @></span>\n            </div>\n        "),i.deleteButtonTemplate=_.template("\n            <div\n                class='edit-event-menu-button menu-delete-button'\n                tabindex='0'\n                style='display:none;'\n            >\n                <i class='material-icons' aria-hidden='true'>&#xE872;</i>\n                <span><@- resources.ViewerPlus_EventDelete @></span>\n            </div>\n        "),t.EditEventMenu=i}(t.Controls||(t.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t extends e.AddStreamOverlay{renderElement(){let e={sessionImage:Panopto.cacheRoot+"/Images/video_player.svg",resources:this.resources};this.element=$(t.template(e)),this.overlayUploader.attachPrimaryTargetHandler(this.element.find(".graphic-container"))}show(){super.show(!1)}}t.template=_.template('\n            <div class="session-overlay empty-session-overlay">\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell">\n                            <p class="overlay-title">\n                                <@- resources.ViewerPlus_EmptySessionOverlay_Title @>\n                            </p>\n                            <p>\n                                <@- resources.ViewerPlus_EmptySessionOverlay_Subtitle @>\n                            </p>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td>\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- sessionImage @>" class="standard-graphic-image primary-stream-graphic" />\n                                    <div>\n                                        <span class="primary-stream-text"><@- resources.ViewerPlus_EmptySessionOverlay_Target @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),e.EmptySessionOverlay=t}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.EventPane=class{constructor(e){this.eventTabPanes=$("#eventTabPanes"),this.onResize=this.onResize.bind(this),this.eventPaneBridge=e.eventPane,this.eventPaneBridge.onResize=this.onResize}onResize(e){e&&e.width>0&&e.height>0&&(this.eventTabPanes.width(e.width),_.each(this.eventPaneBridge.state.tabSet.tabs,(function(t){t.resize(e.width,e.height)})))}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t{constructor(e,i){this.resources=i,e.html(t.template()),this.element=e.find(".file-processing-region")}render(e){const t=this.element.find(".file-processing-text"),i=this.element.find(".file-processing-percentage"),o=this.element.find(".upload-spinner"),n="error";if(_.some(e,(e=>1!==e.state&&2!==e.state)))t.addClass(n).text(this.resources.FileProcessingRegion_Error),i.hide(),o.hide();else if(1===e.length){const a=e[0];if(t.removeClass(n),1===a.state)t.text(Panopto.Core.StringHelpers.format(this.resources.FileProcessingRegion_Uploading,a.filename)),i.show().text(Math.round(a.bytesUploaded/a.fileSize*100)+"%"),o.hide();else t.text(Panopto.Core.StringHelpers.format(this.resources.FileProcessingRegion_Processing,a.filename)),i.hide(),o.show()}else t.removeClass(n).text(Panopto.Core.StringHelpers.format(this.resources.FileProcessingRegion_ProcessingMultiple,e.length)),i.hide(),o.show()}}t.template=_.template('\n            <div class="file-processing-region">\n                <span class="file-processing-text"></span>\n                <span class="file-processing-percentage"></span>\n                <span class="upload-spinner"></span>\n            </div>'),e.FileProcessingRegion=t}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Header=function(e,t,i,o,n,a){var r,s,l,d,c=PanoptoTS.Viewer.Constants,p=$("#viewerHeader"),u=p.find("#logoContainer"),h=p.find("#deliveryTitle"),m=p.find("#editDeliveryTitle"),v=m.find("input"),P=p.find("#parentContext"),g=p.find("#starRating"),y=p.find("#podcastDownload"),f=p.find("#settingsButton"),S=p.find("#shareButton"),C=p.find("#editButton");const w=p.find("#statsButton");var b=p.find("#viewerHelpLink"),T=p.find("#signInButton"),E=p.find(".login-status"),V=p.find("#saveMessage"),I=p.find("#undoButton"),R=p.find("#redoButton"),D=p.find("#commitButton"),k=p.find("#revertButton"),L=p.find("#closeButton");const x=document.getElementById("header-right-react");var A,U,M=t.user.rating||0,O=!PanoptoCore.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe,H=PanoptoTS.StringHelpers.format("{0}/Pages/Sessions/List.aspx",c.BaseUrl);!function(){var e;if(n)e={icon:"&#xE05F;",name:n.name};else if(t.folder.name)e={icon:"&#xE2C7;",name:t.folder.name};else{var i=$("<div />");s=i,l=i,d=i}e&&(P.html(_.template($("#parentContextTemplate").html())(e)),r=P.find("#parentClickTarget"),s=P.find(".parent-icon"),l=P.find("#parentName"),d=P.find(".chevron"),n?(r.attr("aria-label",Panopto.GlobalResources.Viewer_PlaylistButton),s.addClass("playlist-icon"),l.addClass("ellipsis")):t.folder.name&&t.folder.id&&O?(r.attr("role","link"),r.attr("aria-label",Panopto.GlobalResources.Folder),Panopto.Core.UI.Handlers.button(r,(()=>window.open(PanoptoTS.StringHelpers.format("{0}?folderID={1}",H,t.folder.id))))):r.removeAttr("tabindex").addClass(Panopto.Core.Constants.DisabledClass))}();var B=[u,s,l,d,h,m,g,y,V,I,R,D,k,f,S,C,w,L,b,T],F=o?[{elements:[u,s,l,d,m,V,I,R,D,k,f,w,L,b]},{elements:[u,s,d,m,V,I,R,D,k,f,w,L,b]},{elements:[u,s,d,m,V,I,R,D,k,L,b]},{elements:[u,s,d,m,V,I,R,D,k,b]},{elements:[u,s,d,m,V,I,R,D,k]},{elements:[u,s,V,I,R,D,k]},{elements:[u,s,I,R,D,k]},{elements:[u,s]}]:[{elements:[u,s,l,d,h,g,y,f,S,C,w,b,T]},{elements:[u,s,d,h,g,y,f,S,C,w,b,T]},{elements:[u,s,d,h,y,f,S,C,w,b,T]},{elements:[u,s,d,h,b,T]},{elements:[u,s,d,h,b]},{elements:[u,s,b]},{elements:[u,s]}],z=!1,N=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),G=c.LeftPaneMinWidth,j=function(){let e=$(window).width()>1400;e&&t.title.length<=c.MaxDesktopTitleCharacters||!e&&t.title.length<=c.MaxMobileTitleCharacters?h.text(t.title):(K=e?Math.floor((c.MaxDesktopTitleCharacters-Panopto.GlobalResources.ViewerPlus_TitleEllipsis.length)/2):Math.floor((c.MaxMobileTitleCharacters-Panopto.GlobalResources.ViewerPlus_TitleEllipsis.length)/2),q=t.title.slice(0,K)+Panopto.GlobalResources.ViewerPlus_TitleEllipsis+t.title.slice(-K),h.text(q),h.attr("title",t.title))},Q=function(){if(!z){W(B).show(),n&&l.css("max-width",G-l[0].offsetLeft),j(),_.each(F,(function(e){e.width=_.reduce(e.elements,((e,t)=>e+t.outerWidth(!0)),0)}));var e=$(window).width(),t=_.find(F,(t=>t.width<e-c.HeaderBuffer));W(B).hide(),t&&W(t.elements).show()}},W=function(e){return _.reduce(e,((e,t)=>e.add(t)),$())};var q,K,J=function(){$(document).attr("title",v.val()),Q()},Y=(Panopto.Core.TimeHelpers.utcDateToFormattedString(t.date,"LL"),p.find("#viewerSupportDropdown")),X=Y.find(".send-client-log"),Z=function(e){e.width(0),e.css({visibility:"hidden"})};Panopto.Branding.createLogo(u,Panopto.branding.smallLogo,O),$(document).attr("title",t.title),o?(v.attr(Panopto.Core.Constants.InitAttribute,t.title),A=Panopto.Core.UI.Components.editableLabel(v,(function(t){var i=o.session();i.name=t,Panopto.Core.ServiceInterface.Rest.Sessions.update(i,(function(){A.save(),e.updateSessionName(t,{fromHeader:!0}),J()}),(function(){A.revert(),i.name=v.val()}))})),e.addSessionNameUpdateListener(((e,{fromHeader:t})=>{t||(A.resetValue(e),J())}))):j();{$("#header-right").hide();const i=t.user.permissions[PanoptoCore.Permission.SessionEditContent]&&O&&!t.isBroadcast&&!o,n=Panopto.features.enableSaveAsButton&&t.user.permissions[PanoptoCore.Permission.SessionCopySource];Panopto.ViewerHeaderRight(x,{deliveryData:{deliveryId:t.id,deliveryTitle:t.title,deliveryDownloadUrl:t.downloadUrl,deliveryIsBroadcast:t.isBroadcast,deliveryFolderId:t.folder.id,deliveryFolderName:t.folder.name},sessionId:t.sessionId,isReferenceCopy:t.isReferenceCopy,showRatings:t.user.key&&Panopto.features.areRatingsEnabled&&!o,rating:t.user.rating,isEditing:!!o,editorActionButtonsProps:{onSave:o?.save,onRevert:o?.revert,onUndo:o?.undo,onRedo:o?.redo,onApply:o?.commit},saveAsProps:{onCheckCuts:()=>o?.activeState().cuts().length>0,onGetChangesetId:()=>o?.getCurrentChangeset().id},showShareButton:Panopto.features.viewerLinkShareEnabled&&O,showCopyButton:!o&&n,showDownloadButton:!!t.downloadUrl&&!o,showEditButton:i,showSaveAsButton:!!o&&n,showStatsButton:t.user.permissions[PanoptoCore.Permission.SessionViewAnalytics]&&O&&!Panopto.features.disableFeaturesRequiringExternalNetworkAccess,showSettingsButton:t.user.permissions[PanoptoCore.Permission.SessionEditMetadata]&&O,useFullShareModal:t.user.permissions[PanoptoCore.Permission.SessionShareAccessControlPolicyEnumerate],showHelp:O&&!(!t.user.key&&Panopto.features.minimizeInteractiveViewerHeaderUX),helpMenuProps:{...Panopto.siteHeader.helpMenuProps,onCreatorTourClick:()=>{Panopto.UI.GuidedTour.startCreatorTour()},onViewerTourClick:()=>{Panopto.UI.GuidedTour.startViewerTour()},onSendLogsClick:()=>{e.submitClientLog((function(e){alert(Panopto.GlobalResources.ViewerPlus_LogsSent+e)}),(function(){alert(Panopto.GlobalResources.ViewerPlus_LogsError)}))}},showLogin:!t.user.key&&O&&!Panopto.features.minimizeInteractiveViewerHeaderUX,showUserMenu:!!t.user.key,userMenuProps:{...Panopto.siteHeader.userMenuProps,useReactPopover:!0,onUserSettingsClick:()=>{e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"UserInfo",modalHeader:Panopto.GlobalResources.Account,modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({publicId:Panopto.siteHeader.userMenuProps.userId,isInternal:Panopto.siteHeader.userMenuProps.isInternal})})}},onEdit:function(){const i=new URLSearchParams(window.location.search);i.get("id")||i.set("id",t.id),i.set("edit","true"),i.set("start",e.position().toString()),window.location.search=i.toString()},onShare:()=>(e.toggleScreens(!1),e.getPosition().seconds()),onSettings:()=>{e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(t.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:t.id})})}})}if(t.downloadUrl?Panopto.Core.UI.Handlers.button(y,(()=>{window.open(t.downloadUrl,"_self")})):Z(y),t.user.permissions[PanoptoCore.Permission.SessionEditContent]&&O?(o&&(Panopto.ModalPopup.defaultInstance.opener=o,o.updateData=function(){window.location.reload()}),t.isBroadcast||o?Z(C):Panopto.Core.UI.Handlers.button(C,(function(){var i=Panopto.Core.StringHelpers.setQueryParameters(location.href,{id:t.id,edit:!0,start:e.position()});location.href=i}))):Z(C),t.user.permissions[PanoptoCore.Permission.SessionEditMetadata]&&O?Panopto.Core.UI.Handlers.button($("#settingsButton"),(function(){e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(t.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:t.id})})})):Z(f),t.user.permissions[PanoptoCore.Permission.SessionShareAccessControlPolicyEnumerate]&&O)Panopto.Core.UI.Handlers.button($("#shareButton"),(function(){e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionShare",modalHeader:Panopto.Core.TextHelpers.innerText(t.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:t.id,viewerTime:e.getPosition().seconds()})})}));else if(Panopto.features.viewerLinkShareEnabled&&O){const i=e=>`${Panopto.uriScheme}://${Panopto.webServerFQDN}${Panopto.appRoot}/Pages/Viewer.aspx?id=${t.id}`+(e?`&start=${e}`:""),o=PanoptoReactComponents.bootstrapReactComponent(PanoptoReactComponents.Control.LinkShare)(document.getElementById("linkShareModal"),{isDialogOpen:!1,startTime:0,formatLink:i,onClose:()=>o.setProps({isDialogOpen:!1})});Panopto.Core.UI.Handlers.button($("#shareButton"),(function(){o.setProps({isDialogOpen:!0,startTime:e.getPosition().seconds()})}))}else Z(S);if(t.user.permissions[PanoptoCore.Permission.SessionViewAnalytics]&&O&&!Panopto.features.disableFeaturesRequiringExternalNetworkAccess?Panopto.Core.UI.Handlers.button(w,(()=>{const e=!o&&t.isBroadcast?{webcastId:t.id}:{sessionId:t.id},i=(new PanoptoTS.Locations).getAnalyticsDashboardUrl(e);window.open(i)})):Z(w),n){var ee=!Panopto.Core.StringHelpers.parseBoolean(N.advance);U=new PanoptoTS.Core.UI.Components.PlaylistOverlay($("#playlistOverlay"),r,n.id,N.id,PanoptoTS.Core.UI.Components.PlaylistOverlaySkin.Interactive,{includeViewableOnly:!0},ee,i&&!e.isDeliveryError(),new PanoptoTS.Core.API.Rest.PlaylistWithSessionsService);const o=function(t){r.toggleClass("active",t),e.playlistOverlayToggled(t)};o(ee),U.onToggle(o),U.onPlayItem((function(i){if(i===t.id)e.activePrimary()&&e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,void 0,void 0);else{var o=Panopto.Core.StringHelpers.setQueryParameters(location.href,{id:i,advance:!0});location.replace(o)}}))}if(t.user.key&&Panopto.features.areRatingsEnabled&&!o){const e=PanoptoReactComponents.bootstrapReactComponent(PanoptoReactComponents.Input.RatingSelector)(g[0],{currentRating:M,onRatingSelected:i=>{i&&(e.setProps({currentRating:i}),PanoptoViewer.Services.rateDelivery(t.id,i).then((()=>{M=i})).catch((()=>{e.setProps({currentRating:M})})))}})}if(O){let t=new PanoptoTS.Core.UI.Components.PopupMenuBehavior({menu:Y,menuButton:b,itemSelector:"a, input"});t.onOpened.add((()=>{e.toggleScreens(!1),Y.css({right:$(window).width()-b.offset().left-b.outerWidth(),top:b.offset().top+b.outerHeight()})})),t.onClosed.add((()=>e.toggleScreens(!0))),X.show(),Panopto.Core.UI.Handlers.button(X,(function(){e.submitClientLog((function(e){alert(Panopto.GlobalResources.ViewerPlus_LogsSent+e)}),(function(){alert(Panopto.GlobalResources.ViewerPlus_LogsError)}))}))}else Z(b),Z(T);return!t.user.key&&Panopto.features.minimizeInteractiveViewerHeaderUX&&(Z(b),Z(E)),p.show(),Q(),u.find("image").length||u.find("img").on("load error",Q),{height:function(){return p.outerHeight()},setLeftPaneWidth:function(e){G=e,Q()},playlistOverlay:function(){return U},toggleLiveNotes:function(e){z=e,p.toggleClass(c.LiveNotesClass,z),g.toggle(!z)}}},function(e){!function(e){!function(e){e.ManualFullScreenStateControlGroup=class{constructor(){this.items=new Array}add(e){this.items.some(((t,i,o)=>t===e))||this.items.push(e)}syncTimes(e,t){this.items.forEach(((i,o,n)=>i.syncTimes(e,t)))}syncPlayState(e){this.items.forEach(((t,i,o)=>t.syncPlayState(e)))}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.MaterialDesignIconHelpers=class{static getStreamIconCode(e){var t;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:t=Panopto.Core.Constants.AudioIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:t=Panopto.Core.Constants.ScreenIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:t=Panopto.Core.Constants.ObjectVideoIconCode}return t}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.OrderedContainer=class{constructor(e){this.sortedChildren=[],this.element=e}contains(e){return _.some(this.sortedChildren,(t=>t.childElement===e))}insert(e,i){this.contains(e)&&this.remove(e,!0);const o=new t(e,i),n=_.find(this.sortedChildren,(e=>e.sortValue>o.sortValue));n?(this.sortedChildren.splice(this.sortedChildren.indexOf(n),0,o),n.childElement.before(o.childElement)):(this.sortedChildren.push(o),this.element.append(o.childElement))}remove(e,t=!1){const i=_.find(this.sortedChildren,(t=>t.childElement===e));i&&(this.sortedChildren.splice(this.sortedChildren.indexOf(i),1),t?i.childElement.detach():i.childElement.remove())}rowCount(){return this.sortedChildren.length}};class t{constructor(e,t){this.childElement=e,this.sortValue=t}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var i=PanoptoCore.VoidCallback;class o{get onShowOverlays(){return this._onShowOverlays}get onCloseOverlays(){return this._onCloseOverlays}constructor(e,t,n){this.pageStructureElements=e,this.overlayUploader=t,this.resources=n,this.ready=$.Deferred(),this._onShowOverlays=new i,this._onCloseOverlays=new i,this.overlayShowingClickHandler=e=>{$(e.target).closest(".MuiDialog-root").length||$(e.target).closest(o.sessionOverlaySelector).length||this.overlayShown&&this.closeOverlays()},document.addEventListener("click",this.overlayShowingClickHandler,!0)}setOverlaysStreamUploader(e){this.overlayUploader.setStreamUploader(e),this.overlayUploader.areUploadersSet()&&this.setupUploadOverlays(this.pageStructureElements)}setOverlaysSlideUploader(e){this.overlayUploader.setSlideUploader(e),this.overlayUploader.areUploadersSet()&&this.setupUploadOverlays(this.pageStructureElements)}setEditSlidesTabAddButton(e){this.editSlidesTabAddButton=e}setupUploadOverlays(t){const i=$("#primaryPlayer .letterbox"),n=t.getRightPlayerContainer();n.css("position","relative");const a=()=>{this.closeOverlays()};$("#viewerContent").find(o.sessionOverlaySelector).remove(),i.find(o.sessionOverlaySelector).remove(),n.find(o.sessionOverlaySelector).remove(),this.emptySessionOverlay=new e.Viewer.Controls.EmptySessionOverlay($("#viewerContent"),this.overlayUploader,a,this.resources),this.primaryOrSecondaryOverlay=new e.Viewer.Controls.AddPrimaryOrSecondaryOverlay(i,this.overlayUploader,a,this.resources),this.primaryOverlay=new e.Viewer.Controls.AddPrimaryOverlay(i,this.overlayUploader,a,this.resources),this.secondaryPlaceholder=new e.Viewer.Controls.SecondaryPlaceholder(n,this.overlayUploader,a,this.resources),this.secondaryOverlay=new e.Viewer.Controls.AddSecondaryOverlay(n,this.overlayUploader,a,this.resources),this.overlayUploader.attachSlidesTargetHandler(this.editSlidesTabAddButton),this.ready.resolve()}filterPendingUploadsByType(e,t){return _.filter(e,(e=>e.streamType===t))}showOverlays(t,i,o,n,{secondaryOnly:a=!1}={}){const r=this.filterPendingUploadsByType(o,1).length>0,s=this.filterPendingUploadsByType(o,2).length>0;t||r?(this.emptySessionOverlay.hide(),this.pageStructureElements.getLeftPane().removeAttr("inert"),this.pageStructureElements.getRightPane().removeAttr("inert"),n===e.Viewer.ViewMode.Primary?(this.primaryOverlayCloseable=t,this.primaryOrSecondaryOverlay.show(this.primaryOverlayCloseable),this.primaryOverlay.hide(),this.secondaryOverlay.hide(),this.secondaryPlaceholder.hide()):n===e.Viewer.ViewMode.Secondary&&(this.primaryOverlayCloseable=t,this.primaryOverlayCloseable&&a||this.primaryOverlay.show(this.primaryOverlayCloseable),this.secondaryOverlayCloseable=i||!s,this.secondaryOverlay.show(this.secondaryOverlayCloseable),this.primaryOrSecondaryOverlay.hide())):(this.primaryOverlayCloseable=!1,this.emptySessionOverlay.show(),this.pageStructureElements.getLeftPane().attr("inert",""),this.pageStructureElements.getRightPane().attr("inert","")),this.updateOverlayProcessing(o),this.overlayShown=!0,this._onShowOverlays.fire()}closeOverlays(){this.primaryOverlayCloseable&&(this.emptySessionOverlay.hide(),this.primaryOrSecondaryOverlay.hide(),this.primaryOverlay.hide()),this.secondaryOverlayCloseable&&this.secondaryOverlay.hide(),this.overlayShown=!1,this._onCloseOverlays.fire()}forceCloseOverlays(){this.emptySessionOverlay.hide(),this.primaryOrSecondaryOverlay.hide(),this.primaryOverlay.hide(),this.secondaryOverlay.hide(),this.overlayShown=!1,this._onCloseOverlays.fire()}toggleSecondaryPlaceholder(e){this.secondaryPlaceholder&&(e?this.secondaryPlaceholder.show():this.secondaryPlaceholder.hide())}updateOverlayProcessing(e){this.primaryOrSecondaryOverlay.toggleProcessingStatus(e),this.primaryOverlay.toggleProcessingStatus(this.filterPendingUploadsByType(e,1)),this.secondaryOverlay.toggleProcessingStatus(this.filterPendingUploadsByType(e,2)),this.secondaryPlaceholder.toggleProcessingStatus(this.filterPendingUploadsByType(e,2))}}o.sessionOverlaySelector=".session-overlay",t.OverlayController=o}(t.Controls||(t.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.OverlayTabControlElements=class{constructor(e){this.contentContainer=e,this.tabs=[]}getTabs(){return this.attachedTabs?$(this.attachedTabs):$(this.tabs)}getSelected(){return this.selectedContainer}getExpander(){return this.expanderContainer}getContentContainer(){return this.contentContainer}getContent(){return this.contentContainer.children().first()}addTab(e,t){this.tabs.push(t)}setContentClass(t){this.getContent().attr("class",e.Viewer.Constants.SecondaryContentClass+" "+t)}setSelectedText(e){this.selectedText=e,this.selectedContainer&&this.updateSelectedText()}setSelectedIcon(e,t){this.selectedIconCode=e,this.selectedIconClass=t,this.selectedContainer&&this.updateSelectedIcon()}attachTabs(e,t){this.selectedContainer=e,this.expanderContainer=t,this.updateSelectedText(),this.updateSelectedIcon(),this.attachedTabs=this.tabs,this.expanderContainer.empty(),this.expanderContainer.append(this.attachedTabs)}detachTabs(){this.selectedContainer=void 0,this.expanderContainer=void 0,$(this.attachedTabs).remove(),this.attachedTabs=void 0}updateSelectedText(){this.selectedContainer.find("#selectedSecondaryText").text(this.selectedText)}updateSelectedIcon(){this.selectedIconCode?this.selectedContainer.find("#selectedSecondaryIcon").html(this.selectedIconCode).attr("class","material-icons"):this.selectedContainer.find("#selectedSecondaryIcon").html("").attr("class",this.selectedIconClass)}}}(t.Controls||(t.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){var t,i,o,n;n=e.Viewer||(e.Viewer={}),t=n.Controls||(n.Controls={}),i=e.Viewer.Constants,o=e.Core.Logic.Time.UneditedFirstPrimaryRelative,t.OverlayUploader=class{constructor(e,t){this.viewer=e,this.timeConverter=t,this.pptExtensions=[".ppt",".pptx"],this.fileProcessingRegionAnimation=$.Deferred().resolve()}getStreamStartTime(){let e;if(this.timelineState.absoluteStart()===1/0||0===this.timelineState.duration())e=this.absoluteSessionStart;else{const t=this.timelineState.findNextTimeNotInSessionReference(this.viewer.position()),i=this.timeConverter.toWin32EpochRelative(new o(t));e=new Date(i.milliseconds()+PanoptoCore.Constants.Win32EpochDate)}return e}parseEventForFirstFile(e){let t=e.originalEvent.target.files||e.originalEvent.dataTransfer.files;if(t.length&&t[0].size)return t[0]}parseEventForPrimaryStream(e){let t=this.parseEventForFirstFile(e);if(t)return{streamUploader:this.streamUploader,file:t,streamType:Panopto.Core.StreamType.PrimaryVideo,startTime:this.getStreamStartTime()}}parseEventForSecondary(e){let t=this.parseEventForFirstFile(e);if(t){let e=Panopto.Core.StringHelpers.parseExtension(t.name);return _.contains(this.pptExtensions,`.${e}`)?{streamUploader:this.slideUploader,file:t,streamType:Panopto.Core.StreamType.SecondaryPresentation,startTime:null}:{streamUploader:this.streamUploader,file:t,streamType:Panopto.Core.StreamType.SecondaryVideo,startTime:this.getStreamStartTime()}}}parseEventForSlides(e){let t=this.parseEventForFirstFile(e);if(t)return{streamUploader:this.slideUploader,file:t,streamType:Panopto.Core.StreamType.SecondaryPresentation,startTime:null}}applyState(e){this.timelineState=e}setAbsoluteSessionStart(e){this.absoluteSessionStart=e}setStreamUploader(e){this.streamUploader=e}setSlideUploader(e){this.slideUploader=e}areUploadersSet(){return!!this.streamUploader&&!!this.slideUploader}attachPrimaryTargetHandler(e){this.attachTargetHandler(e,Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS,(e=>this.parseEventForPrimaryStream(e)))}attachSecondaryOrSlidesTargetHandler(e){let t=Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS.concat(this.pptExtensions);this.attachTargetHandler(e,t,(e=>this.parseEventForSecondary(e)))}attachSlidesTargetHandler(e){this.attachTargetHandler(e,this.pptExtensions,(e=>this.parseEventForSlides(e)))}attachTargetHandler(e,t,o){if(!this.streamUploader||!this.slideUploader)throw Error("streamUploader or slideUploader has not been set.");let n=e=>{let t=o(e);if(t){if(t.file.size>i.UploadByteLimit){const e=document.createElement("div");document.body.appendChild(e);const t=()=>{n.unmount(),e.remove()},o=i.UploadByteLimit/1073741824+"GB",n=PanoptoReactComponents.bootstrapReactComponentV2(PanoptoViewer.Controls.FileTooBigDialog)(e,{limitValueWithUnit:o,onClose:t})}else t.streamUploader.startUpload(t.file,t.streamType,t.startTime);const o=e.target;o&&"file"===o.type&&(o.value="")}};var a=function(e){e.stopPropagation(),e.preventDefault()},r=function(t){a(t),e.toggleClass("drop-target-drag")};let s=$("<input />",{type:"file",multiple:!1,accept:t.join(",")});s.on("change",(e=>n(e))).hide().insertAfter(e),Panopto.Core.UI.Handlers.button(e,(function(){s.click()}),{keyEvent:"keypress"}),_.each(["mouseover","mouseleave","dragover"],(function(t){e.on(t,a)})),_.each(["dragenter","dragleave"],(function(t){e.on(t,r)})),e.on("drop",(e=>{r(e),n(e)}))}}}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.PlayControls=function(e,t,i,o,n,a,r,s,l,d,c,p){var u=PanoptoTS.Viewer.ViewMode,h=PanoptoTS.Viewer.Constants,m=Panopto.Viewer.Analytics,v=Panopto.GlobalResources,P=$("#playControlsWrapper"),g=$("#playControls"),y=$("#skipToStartButton"),f=$("#rewindButton"),S=$("#playButton"),C=$("#forwardButton"),w=$("#skipToEndButton"),b=$("#timeElapsed"),T=$("#timeRemaining"),E=$("#positionSlider"),V=$("#elapsedBar"),I=$("#volumeControl"),R=$("#volumeFlyout"),D=$("#volumeSlider"),k=$("#muteButton"),L=$("#volumeAlert"),x=$("#captionsButton"),A=$("#audioDescriptionsButton"),U=$("#dockedCaption"),M=$("#dockedCaptionText"),O=$("#overlayCaption"),H=$("#quickRewindButton"),B=$("#quickFastForwardButton"),F=E.find("#positionHandle"),z=E.find("#hoverTimestamp"),N=E.find("#hoverTick"),G=$("#seekToLiveButton"),j=$("#liveButton"),Q=$("#autoplayMessage"),W="fullscreen-controls",q=$("#viewer"),K=$("#absoluteControls");const J=PanoptoTS.ImageHelpers.getImageUrl("Viewer/audio-description.svg");var Y,X;s.onMaximize.add((e=>{var t=e?e.getStreamPlayer():i;Re(t)})),s.onRestore.add((()=>{Re(void 0)})),s.onSwap.add((()=>{var t=a.getPrimaryPlayerIndex()===a.PrimaryDefaultIndex?0:a.PrimaryDefaultIndex;e.swapLeftToRight(t)}));var Z=$("#primaryBuffering"),ee=$("#secondaryBuffering"),te=PanoptoCore.getUserSetting("defaultCaptions"),ie="boolean"==typeof te?te:Panopto.viewer.captionsEnabledByDefault,oe=PanoptoCore.getUserSetting("defaultCaptionPlacement"),ne=PanoptoCore.getUserSetting("defaultCaptionSize"),ae=PanoptoCore.getUserSetting("defaultCaptionColor"),re=void 0!==oe&&void 0!==ne&&void 0!==ae?new PanoptoCore.Models.Settings.CaptionStyles(oe,ne,ae):Panopto.Captions.selectedStyles;let se=!1,le=!0;var de,ce,pe,ue=!0===PanoptoCore.getUserSetting("defaultAudioDescriptions"),he=!1,me=PanoptoViewer.PlaySpeed.Normal,ve=t.flowPlayerEnabled?"vertical":"horizontal",Pe=0,ge=t.duration,ye="video, .fp-ui, .slide-deck #slideDeck-image",fe="#primaryPlayer, .secondaryPlayer",Se=function(){return re.placement===PanoptoCore.Models.Settings.CaptionPlacement.Docked},Ce=function(t){t=t??e.isFullscreen();var i=_.find(Panopto.Captions.ColorOptions,(e=>e.key===re.colorSchemeKey));U.add(O).css({"font-size":re.textSize+"px",color:i.color,"text-shadow":i.textShadow}),U.css({"min-height":3*re.textSize,"border-color":i.dockedBorderColor,"background-color":i.dockedBackgroundColor}),M.css({"max-height":6*re.textSize}),O.css({opacity:i.overlayOpacity,"background-color":i.backgroundColor}),e.setCaptionStyles(re),Ae.setProps({isFullscreen:t,captionsStyles:re})},we=function(e,t){i.bitrate(e),_.each(r,(function(t){var i=t.getCurrentPlayer();i&&i.bitrate(e)})),Ae.setProps({quality:e}),t&&PanoptoCore.setUserSetting("defaultBitrateMBR",e)},be=function(e){var t=i.isMuted();k.toggleClass("muted",t),k.attr("title",t?v.ViewerPlus_Unmute:v.ViewerPlus_Mute),e&&D.slider("value",i.volume())},Te=function(e,t,o){e=Panopto.Core.ElementHelpers.clampSliderValue(D,e),o&&m.sendEvent({action:i.volume()<e?m.Actions.VolumeUp:m.Actions.VolumeDown,label:o});var n="horizontal"===ve?"width":"height";$("#volumeLevel").css(n,e+"%"),i.setVolume(e),be(!1),t&&D.slider("value",e),PanoptoCore.setUserSetting("defaultVolume",e),d.setVolume(e/100)},Ee=function(e){V.css("width",100*e/E.slider("option","max")+"%")},Ve=function(e,t,i){var o;e="number"==typeof t?ge*(t/E.width()):e,e=Math.round(Panopto.Core.ElementHelpers.clampSliderValue(E,e));try{o=G.is(":hover")}catch(e){o=!1}var n=o||i?v.ViewerPlus_Live:Panopto.Core.TimeHelpers.formatDuration(e,v.TimeSeparator),a=F.offset().left-F.parent().offset().left,r=a+F.outerWidth();z.text(n),z.show(),void 0!==t?(t=Math.clamp(t,0,E.width()),z.css("left",t>=a&&t<=r?r:t-z.width()/2),N.show().css("left",t),N.toggleClass("accent-tick",N.offset().left<F.offset().left)):(z.css("left",e/ge*E.width()+F.outerWidth(!0)),N.hide())},Ie=function(){x.toggleClass("safety-text",ie),le=t.isBroadcast?se:t.hasCaptions,x.toggleClass("disabled",!le);var e=le?ie?v.ViewerPlus_Captions_Hide:v.ViewerPlus_Captions_Show:v.ViewerPlus_Captions_Disabled;Ae.setProps({isCaptionsActive:ie}),x.attr({title:e,"aria-label":e})},_e=function(){A.toggleClass("safety-text",ue);var e=ue?v.ViewerPlus_AudioDescriptions_Disable:v.ViewerPlus_AudioDescriptions_Enable;Ae.setProps({isAudioDescriptionsActive:ue}),A.attr({title:e,"aria-label":e}),d.setEnabled(ue)},Re=function(o){e.setFullscreenPlayer(o),Panopto.viewer.viewerWatermarkPosition&&Panopto.branding.embedLogo.png&&(0===$("#absoluteControls").find(".logo-while-playing").length&&(X=new PanoptoViewer.WatermarkLogo(Panopto.branding.embedLogo.png,Panopto.viewer.viewerWatermarkPosition),$("#absoluteControls #fullscreenControlsWrapper").append(X.getBrandElem())),Panopto.viewer.viewerWatermarkPosition!==PanoptoViewer.Data.ViewerWatermarkPositionOptions.TopLeft&&X.setOffset(50)),t.flowPlayerEnabled&&PanoptoCore.Helpers.fullscreenEnabled&&(o?(0===K.find(g).length&&(g.addClass(W),g.children().not("#transportControls").hide(),$("#fullscreenControlsWrapper").prepend(g),$("#fullscreenControlsWrapper").show()),o.container().find(ye).parent().append(K)):(0===P.find(g).length&&(g.removeClass(W).show(),g.children().not("#transportControls").hide(),$("#fullscreenControlsWrapper").hide(),P.append(g)),q.append(K)));let n=void 0!==o,a=o===i;s.updateFullscreenButtons({allowFullscreen:!0,isFullscreen:n}),n&&s.toggleSwap(!1),Ce(n),s.hide({animate:!1}),Z.css("z-index",a||!n?"":-1),ee.css("z-index",a&&n?-1:""),e.synchronize()};const De=t=>{const o=c.getValidPlaySpeed(t,e.position());if(void 0!==o){me=o,i.playSpeed(me);for(const e of r)for(const t of e.getTabs())t.playSpeed(me);Ae.setProps({playSpeed:me}),m.sendEvent({action:m.Actions.Speed,label:me.toString()})}};Panopto.Core.UI.Handlers.button(S,(function(){e.togglePlaying(m.Labels.Normal)})),S.toggleClass("pause-disabled",e.isDVRDisabled()),Panopto.Core.UI.Handlers.button(y,(function(){e.skipToStart(m.Labels.Normal)})),Panopto.Core.UI.Handlers.button(f,(function(){e.rewind(m.Labels.Normal,h.EditJumpSeconds)})),f.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_Rewind,h.EditJumpSeconds)),Panopto.Core.UI.Handlers.button(C,(function(){e.forward(m.Labels.Normal,h.EditJumpSeconds)})),C.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_Forward,h.EditJumpSeconds)),Panopto.Core.UI.Handlers.button(w,(function(){e.skipToEnd(m.Labels.Normal)})),Panopto.Core.UI.Handlers.button(H,(function(){e.rewind(m.Labels.Normal)})),H.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_Rewind,h.QuickRewindSeconds)),e.userSeekEnabled()||H.hide(),Panopto.Core.UI.Handlers.button(B,(function(){e.forward(m.Labels.Normal,10)})),B.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_FastForward,10)),e.userSeekEnabled()||B.hide(),E.mousemove((function(t){!ce&&e.userSeekEnabled()&&(Pe=t.clientX-E.offset().left,Ve(0,Pe,!1),pe=!0)})).mouseleave((function(){ce||(z.hide(),N.hide(),pe=!1)})),F.mouseup((function(t){if(e.userSeekEnabled()){var i=t.clientX-E.offset().left;Math.abs(i-Pe)<=h.SliderDragThreshold&&(Y=t.clientX,e.setPosition(i/E.width()*ge))}})),I.addClass(ve),"vertical"===ve&&I.find(".ui-slider-handle").on("keydown keyup",(function(e){e.keyCode===Panopto.Core.Key.Home?e.keyCode=Panopto.Core.Key.End:e.keyCode===Panopto.Core.Key.End&&(e.keyCode=Panopto.Core.Key.Home)})),Panopto.Core.UI.Handlers.hoverOrDrag(I,(function(e){e?(I.toggleClass("active",!0),R.fadeIn(h.FadeInterval)):R.fadeOut(h.FadeInterval,(function(){I.toggleClass("active",!1),R.show()}))})),Panopto.Core.UI.Handlers.key(I,(function(){I.toggleClass("active",!1)}),[Panopto.Core.Key.Esc]),D.slider({max:100,min:0,value:h.InitialVolume,step:1,orientation:ve,change:function(e,t){let i=e;Te(t.value,!1,!!i.originalEvent&&m.Labels.Normal)},slide:function(e,t){Te(t.value,!1,void 0)}}),Panopto.Core.UI.Accessibility.slider(D,(function(e){return PanoptoTS.StringHelpers.format(v.ViewerPlus_ARIA_PercentValue,e)}),v.Viewer_Aria_VolumeSlider),Panopto.Core.UI.Handlers.button(k,(function(){e.toggleMuted(m.Labels.Normal)})),k.on("keydown keyup",(function(e){e.keyCode>=33&&e.keyCode<=40&&D.find(".ui-slider-handle").trigger(e)})),Te("number"==typeof o?o:h.InitialVolume,!0,void 0),E.slider({max:ge,min:0,value:0,step:1,orientation:"horizontal",disabled:!e.userSeekEnabled(),change:function(t,o){let n=t;var a,r=Panopto.Core.ElementHelpers.clampSliderValue(E,o.value);if(ce=!1,Ee(r),n.originalEvent){if(F.hide(),(a=$(document.elementFromPoint(n.clientX||0,n.clientY||0))).is(".timeline-event"))a.click();else if(void 0!==n.clientX){if(n.clientX!==Y){Y=n.clientX;let t=(n.clientX-E.offset().left)/E.width()*ge;t=Math.max(0,t),e.setPosition(t)}}else e.setPosition(r);F.show(),i.setPlayStateWithLogging(e.playState(),!0),N.hide(),z.hide(),m.sendEvent({action:m.Actions.Seek,label:m.Labels.Normal})}else pe&&Ve(0,Pe,!1)},slide:function(e,t){var o=Panopto.Core.ElementHelpers.clampSliderValue(E,t.value);ce=!0,i.playState(PanoptoViewer.Data.ViewerPlayState.Paused),_.each(r,(e=>{var t=e.getCurrentPlayer();t&&t.playState(PanoptoViewer.Data.ViewerPlayState.Paused)})),Ve(o,void 0,!1),Ee(o)}}),Panopto.Core.UI.Accessibility.slider(E,(function(e){return Panopto.Core.TimeHelpers.formatDuration(e,v.TimeSeparator)}),v.Viewer_Aria_PositionSlider),e.userSeekEnabled()||(E.css("pointer-events","none"),F.attr("tabindex",-1)),t.isBroadcast&&(j.show(),G.show(),e.userSeekEnabled()?(Panopto.Core.UI.Handlers.button(G.add(j),(function(){i.isLive()||(e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,void 0,void 0),i.setIsLive(!0,(function(){e.synchronize(!0)})))})),G.focus((function(){Ve(0,G.position().left+G.width()/2,!0)}))):(j.addClass("seek-disabled"),j.add(G).attr("tabindex",-1)));const ke=t=>{ie=void 0!==t&&"boolean"==typeof t?t:!ie,PanoptoCore.setUserSetting("defaultCaptions",ie),Ie(),e.synchronize()};Panopto.Core.UI.Handlers.button(x,(()=>{le&&ke()})),A.html(`<img src="${J}" crossorigin onload="SVGInject(this)" />`);const Le=t=>{ue=void 0!==t&&"boolean"==typeof t?t:!ue,PanoptoCore.setUserSetting("defaultAudioDescriptions",ue),_e(),e.synchronize(!0)};Panopto.Core.UI.Handlers.button(A,Le);const xe=t.playSpeedEnabled&&(!t.requiresSilverlight||Silverlight.isInstalled(h.PlaySpeedSilverlightVersion)),Ae=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.CaptionsSettings.CaptionsSettingsButton)(document.getElementById("reactCaptionsSettingsButton"),{isEmbed:!1,isMobile:!!PanoptoCore.Browser.$_mobile,isFullscreen:e.isFullscreen(),isLive:t.isBroadcast&&i.isLive(),isCaptionsActive:ie,isAudioDescriptionsActive:ue,speedButtonEnabled:xe,qualityButtonEnabled:!1,captionsStyles:re,playSpeed:PanoptoViewer.PlaySpeed.Normal,qualityCount:0,quality:PanoptoViewer.Services.getInitialBitrate(),onCaptionsActiveChanged:e=>{ke(ie="toggle"===e?!ie:"active"===e)},onCaptionsStylesUpdated:t=>{re=t,PanoptoCore.setUserSetting("defaultCaptionPlacement",re.placement),PanoptoCore.setUserSetting("defaultCaptionColor",re.colorSchemeKey),PanoptoCore.setUserSetting("defaultCaptionSize",re.textSize),Ce(),e.synchronize(),e.resize()},onAudioDescriptionsActiveChanged:e=>{Le(ue="toggle"===e?!ue:"active"===e)},onSpeedSelected:e=>{De(e)},onQualitySelected:e=>{we(e,!0),m.sendEvent({action:m.Actions.Bitrate,label:e})}});PanoptoViewer.Language.addLanguageEventListener("currentaudiodescription",(()=>{p.audioDescriptionsTab?.fetch()})),PanoptoViewer.Language.addLanguageEventListener("currentcaption",(()=>{p.captionsTab?.fetch()})),_e(),$(document).keydown((function(t){$(t.target).closest([".MuiDialog-root",".MuiPopover-root",".react-root-ignore-keydown"].join(", ")).length||e.hotkey(t.keyCode)})),$(document).on("dblclick",fe,(e=>{var t=a.getPlayerFromElement($(e.currentTarget));t.isFullscreen&&t.setIsFullscreen&&Re(t.isFullscreen()?void 0:t)})),K.on("dblclick",(e=>e.stopPropagation()));var Ue,Me=function(t){t.css("cursor","default"),clearTimeout(Ue),Ue=window.setTimeout((()=>{t.css("cursor","none"),$("."+W).finish().fadeOut(h.FadeInterval),X&&X.setOffset(0)}),1e3*h.FullScreenControlInterval);let i=a.getPlayerFromElement(t);if(Panopto.viewer.allowMultipleSecondaryDisplay){const t=_.chain(r).filter((e=>e.getCurrentPlayer()===i)).first().value();t?(t.getTabControl().updateAvailableTabs(e.position()),s.showTabsFor(t)):s.showTabsFor(void 0)}else r.length&&(r[0].getCurrentPlayer()===i?s.setSecondaryContentContainer(r[0]):s.setSecondaryContentContainer(void 0));let o=i&&i.container().is(".slide-deck");if(s.updateFullscreenButtons({allowFullscreen:!o,isFullscreen:e.isFullscreen()}),s.toggleSwap(e.isSecondarySwapAllowed()),s.show(t),e.isFullscreen()){$("."+W).fadeIn(h.FadeInterval);const e=Panopto.viewer.viewerWatermarkPosition!==PanoptoViewer.Data.ViewerWatermarkPositionOptions.TopLeft;X&&e&&X.setOffset(50),$("."+W).on("mouseover",(()=>{clearTimeout(Ue)}))}},Oe=function(){Q.css({left:S.offset().left+S.outerWidth()/2,top:S.offset().top-Q.outerHeight()-24})};return $(document).on("mousemove",fe,(function(e){Me($(e.currentTarget).find(ye).first())})),$(document).on("keydown",(e=>{"Tab"===e.key&&Me($(ye).last())})),a.onPlayerSwap(((e,t)=>{const i=s.getCurrentTarget();if(i){var o=0!==i.closest("."+h.SecondaryPlayerClass).length?n.getPrimaryPlayer():$(n.getSecondaryPlayers().get(e));Me(o.find(ye))}})),$(document).on("click","video",(function(){e.togglePlaying()})),$(document).on("contextmenu","video",(function(){return!1})),PanoptoCore.Helpers.handleFullscreenEvent((function(e){t.flowPlayerEnabled&&PanoptoCore.Helpers.fullscreenEnabled&&!e?Re(void 0):e||(s.hide(),$("."+W).fadeOut(h.FadeInterval))})),T.toggle(!t.isBroadcast),Ce(),Ie(),Panopto.viewer.allowMultipleSecondaryDisplay&&!l&&(new PanoptoTS.Viewer.Controls.SecondaryLayoutSelector($("#selectedSecondaryLayout"),$("#secondaryLayoutExpander"),a,v),$("#selectedSecondary").hide()),{synchronize:function(e,o,n,a,r){o>0&&o!=ge&&(ge=o,E.slider("option","max",ge),E.find(".ui-slider-handle").attr("aria-valuemax",ge)),Math.abs(e-ge)<.1&&(e=ge),E.slider("value",e),b.text(n),T.text(a),t.isBroadcast&&(j.toggleClass("live",i.isLive()),j.attr("title",i.isLive()?"":v.ViewerPlus_Live_Tooltip),j.css("cursor",i.isLive()?"":"pointer"),G.toggleClass("accent-background",i.isLive()),G.toggleClass("safety-accent-border-ifcustom",i.isLive()),Ae.setProps({isLive:i.isLive()})),A.toggle(t.availableAudioDescriptionLanguages.length>0)},synchronizeCaption:function(i){se=i;const o=!!t.hasCaptions,n=U.is(":visible"),r=!t.isBroadcast||i;x.toggle(r),U.toggle(o&&Se()&&ie),n!==U.is(":visible")&&e.resize(),a.getLeftPlayerElement().find(".letterbox").toggleClass("no-border-radius",U.is(":visible")&&e.viewMode()===u.Primary),a.getRightPlayerElements().toggleClass("no-border-radius",U.is(":visible")&&e.viewMode()===u.Secondary),Ie()},synchronizeBitrate:function(){var o,n=_.map(r,(e=>e.getCurrentPlayer())),a=_.filter(n,(e=>e&&e.hasMBR()));switch(e.viewMode()){case u.Primary:o=i;break;case u.Secondary:default:o=a.length?_.min(a,(e=>e.bitrateLevelOffset())):i}o.hasMBR(),i.optimizationProvider()&&!he&&(he=!0,i.optimizationProvider()===h.Kollective&&(!t.isBroadcast||t.flowPlayerEnabled||Panopto.viewer.kollectiveVideoJSWebcastDVREnabled||(H.hide(),B.hide(),S.hide())));const s=Math.max(...[...t.primaryStreams,...t.secondaryStreams].map((e=>e.variants.length))),l=Math.min(s,PanoptoCore.mapEnum(PanoptoViewer.MBRBitrate,(e=>e)).length-1);Ae.setProps({qualityButtonEnabled:l>1,qualityCount:l})},setBitrate:we,toggleMuted:function(){var e=!i.isMuted();i.muted(e),be(!0);var t=e?v.ViewerPlus_ARIA_Muted:v.ViewerPlus_ARIA_Unmuted;L.text(t),d.setVolume(e?0:i.volume()/100)},updateVolume:Te,showVolumeControl:function(){I.mouseenter(),de&&clearTimeout(de),de=setTimeout((function(){I.mouseleave()}),h.FlyoutTimeout)},togglePlayState:function(e){S.toggleClass("paused",e),S.attr("title",e?v.ViewerPlus_Play:v.ViewerPlus_Pause)},toggleAutoplayMessage:function(e){Q.toggle(e),e&&Oe()},positionAutoplayMessage:Oe,playSpeed:function(){return me},setPlaySpeed:De,captionsSelected:function(){return ie},audioDescriptionsSelected:function(){return ue},captionsDocked:Se,onUserSeekEnabledChanging:e=>{e?(H.show(),B.show(),E.slider("enable"),E.css("pointer-events","auto"),F.attr("tabindex",0)):(H.hide(),B.hide(),E.slider("disable"),E.css("pointer-events","none"),F.attr("tabindex",-1))}}},function(e){!function(e){!function(t){var i=PanoptoCore.VoidCallback,o=PanoptoCore.TypedCallback;t.PlayerLayoutControls=class{get onMaximize(){return this._onMaximize}get onRestore(){return this._onRestore}get onSwap(){return this._onSwap}get onShowOverlay(){return this._onShowOverlay}constructor(e){this._onMaximize=new o,this._onRestore=new i,this._onSwap=new i,this._onShowOverlay=new i,this.template=_.template(`\n            <div class="player-layout-controls" inert>\n                <div\n                    class="show-overlay-button"\n                    tabindex="0"\n                    aria-label="${Panopto.GlobalResources.Viewer_ShowOverlay}">\n                    <i class="material-icons">&#xE145;</i>\n                </div>\n                <div\n                    class="full-screen-button"\n                    tabindex="0"\n                    aria-label="${Panopto.GlobalResources.Viewer_FullScreen}">\n                    <i class="material-icons">&#xE5D0;</i>\n                </div>\n                <div\n                    class="restore-screen-button"\n                    tabindex="0"\n                    aria-label="${Panopto.GlobalResources.Viewer_RestoreScreen}">\n                    <i class="material-icons">&#xE5D1;</i>\n                </div>\n                <div\n                    class="swap-streams-button"\n                    tabindex="0"\n                    aria-label="${Panopto.GlobalResources.Viewer_SwapStreams}">\n                    <i class="material-icons">&#xE8D4;</i>\n                </div>\n                <div id="secondaryContainer" class="select-secondary-container">\n                    <div\n                        class="selected-secondary"\n                        tabindex="0"\n                        role="button"\n                        aria-haspopup="true"\n                        aria-label="${Panopto.GlobalResources.Viewer_SecondaryStreamMenu}">\n                        <div id="selectedSecondaryWrapper" class="player-tab-wrapper">\n                            <i id="selectedSecondaryIcon" class="material-icons"></i>\n                            <div id="selectedSecondaryText" class="player-tab-title ellipsis"></div>\n                            <i class="material-icons">arrow_drop_down</i>\n                        </div>\n                    </div>\n                    <div\n                        class="select-secondary-flyout"\n                        role="menu"\n                        aria-orientation="vertical"\n                        aria-label="${Panopto.GlobalResources.Viewer_SecondaryStreamMenu}">\n                        \x3c!-- templated secondary tabs go here --\x3e\n                    </div>\n                </div>\n            </div>\n        `),this.isFullscreen=!1,this.allowShowOverlayButton=!1,this.element=$(this.template()),this.fullScreenButton=$(".full-screen-button",this.element).hide(),this.restoreScreenButton=$(".restore-screen-button",this.element).hide(),this.swapStreamsButton=$(".swap-streams-button",this.element).hide(),this.showOverlayButton=$(".show-overlay-button",this.element).hide(),this.selectSecondaryContainer=$(".select-secondary-container",this.element).hide(),this.selectedSecondary=$(".selected-secondary",this.element),this.selectSecondaryFlyout=$(".select-secondary-flyout",this.element).hide(),Panopto.Core.UI.Handlers.button(this.fullScreenButton,(()=>{this._onMaximize.fire(this.attachedSecondaryContentContainer)})),Panopto.Core.UI.Handlers.button(this.restoreScreenButton,(()=>{this._onRestore.fire()})),Panopto.Core.UI.Handlers.button(this.swapStreamsButton,(()=>{this._onSwap.fire()})),Panopto.Core.UI.Handlers.button(this.showOverlayButton,(()=>{this._onShowOverlay.fire()})),null!=e&&e.onAddContentRequirementChanged.add((e=>{this.allowShowOverlayButton=e.canAddContent}))}getCurrentTarget(){return this.currentTarget}updateFullscreenButtons({allowFullscreen:e,isFullscreen:t}){this.fullScreenButton.toggle(!t&&e),this.restoreScreenButton.toggle(t),this.showOverlayButton.toggle(this.allowShowOverlayButton&&!t),this.isFullscreen!==t&&(this.isFullscreen=t,this.currentTarget=void 0,this.element.detach())}toggleSwap(e){this.swapStreamsButton.toggle(e)}show(t){const i=$.Deferred();if(this.currentTarget&&this.currentTarget[0]===t[0])i.resolve();else{let o;this.currentTarget=t,o=this.isFullscreen?this.currentTarget.parent():this.currentTarget.closest(".player-layout-controls-container"),this.element.appendTo(o),this.element.finish().fadeIn(e.Constants.FadeInterval,(()=>{i.resolve()})),t.is("#slideDeck-image")&&this.fullScreenButton.hide()}return this.getCurrentTarget().closest(".player-layout-controls-container").find(".session-overlay:visible").length||this.element.removeAttr("inert"),this.setAutoHideTimeout(),i.promise()}setSecondaryContentContainer(e){this.attachedSecondaryContentContainer=e}showTabsFor(e){e!==this.attachedSecondaryContentContainer&&(this.attachedSecondaryContentContainer&&this.attachedSecondaryContentContainer.getTabControlElements().detachTabs(),this.attachedSecondaryContentContainer=e,this.attachedSecondaryContentContainer?(this.attachedSecondaryContentContainer.getTabControlElements().attachTabs(this.selectedSecondary,this.selectSecondaryFlyout),this.attachedSecondaryContentContainer.getTabControl().attachTabHandlers(),this.selectSecondaryContainer.show()):this.selectSecondaryContainer.hide())}hide({animate:t=!0}={}){const i=$.Deferred();return this.currentTarget=void 0,t?this.element.finish().fadeOut(e.Constants.FadeInterval,(()=>{this.element.detach(),i.resolve()})):(this.element.finish().hide().detach(),i.resolve()),i.promise()}setAutoHideTimeout(){clearTimeout(this.autoHideTimeout),this.autoHideTimeout=window.setTimeout((()=>{this.element.is(":hover")||this.hide()}),1e3*e.Constants.FullScreenControlInterval)}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var i=Panopto.Viewer.Tabs;t.SecondaryContentContainer=class{constructor(e,t,i,o,n){this.viewer=i,this.editableQuizService=o,this.index=n,this.tabs=new Array,this.tabControlElements=e,this.initializeTabs(t,i)}getTabControlElements(){return this.tabControlElements}getStreamPlayer(){return this.streamPlayer}getCurrentPlayer(){var e=_.find(this.tabs,(e=>e.selected()));return e?e.getPlayer():void 0}getTabControl(){return this.tabControl}getTabs(){return this.tabs}remove(){_.each(this.tabs,(e=>{e.remove()}))}updateTabs(t,o,n){t.secondaryStreams.length&&!this.streamPlayer&&(this.streamPlayer=PanoptoLegacy.Viewer.Players.SecondaryStreamPlayer(this.tabControlElements.getContent(),o.playerFactory,this.viewer)),_.each(t.secondaryStreams,(a=>{var r=_.find(this.tabs,(e=>e.id()===a.id)),s=1e3*Math.min(0,a.timeline[0]-n);r?r.setContent(a):s<t.broadcastRefreshInterval&&setTimeout((()=>{var t=i.SecondaryTab(this.tabControlElements,this.streamPlayer,a,e.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(a));this.tabs.push(t),t.render(),this.tabControl.attachTabHandlers(),o.toggleInlineSecondaries(),o.synchronize(!0)}),s)}))}resize(e,t){var i=this.getCurrentPlayer();if(i)i.resize(e,t);else{var o=this.tabControlElements.getContentContainer();o.width(e),o.height(t)}}reinitializeTabs(e,t){this.remove(),this.tabs.length=0,this.initializeTabs(e,t)}initializeTabs(t,o){var n=this.tabControlElements.getContent();if(_.each(t.documents,(e=>{e.isPdf&&this.addDocumentPlayer(n,e)})),_.each(t.slideDecks,(e=>{var t=PanoptoLegacy.Viewer.Players.SlidePlayer(n,e,o);this.tabs.push(i.SecondaryTab(this.tabControlElements,t,e,Panopto.Core.Constants.SlideIconCode))})),t.secondaryStreams.length){this.streamPlayer||(this.streamPlayer=PanoptoLegacy.Viewer.Players.SecondaryStreamPlayer(n,o.playerFactory,this.viewer));var a=[];_.each(t.secondaryStreams,(t=>{a.push(i.SecondaryTab(this.tabControlElements,this.streamPlayer,t,e.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(t)))})),this.tabs.sort(((e,t)=>{var i=e.relativeStartTime()-t.relativeStartTime();return 0===i&&(i=e.absoluteStartTime()-t.absoluteStartTime()),i})),_.each(a,(e=>{this.tabs.push(e)}))}_.each(t.documents,(e=>{e.isPdf||this.addDocumentPlayer(n,e)})),_.each(this.tabs,(e=>{e.render()})),this.tabControl=Panopto.Viewer.SecondaryTabControl(this.tabControlElements,o,this.tabs,this.index)}addDocumentPlayer(e,t){var o=PanoptoLegacy.Viewer.Players.DocumentPlayer(e,t,this.viewer,this.editableQuizService);this.tabs.push(i.SecondaryTab(this.tabControlElements,o,t,t.iconCode))}}}(t.Controls||(t.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(i){i.SecondaryLayoutSelector=class{constructor(e,t,i,o){this.selectedContainer=e,this.expanderContainer=t,this.model=i,this.resources=o,this.optionTemplate=_.template('\n            <div class="player-tab-header transport-button accented-tab role="button" data-layout="<@- layout @>">\n                <div class="player-tab-wrapper">\n                    <img src="<@- imagePath @>"/>\n                    <div class="player-tab-title ellipsis"><@- text @></div>\n                </div>\n            </div>'),this.model.onSecondaryLayoutChanged.add((e=>this.onSecondaryLayoutChanged(e))),this.render()}onSecondaryLayoutChanged(e){e!==this.selectedPlayerLayout&&this.renderNewSelection(e)}render(){this.expanderContainer.hide(),this.renderNewSelection(this.model.getSecondaryLayout()),this.selectedContainer.show();const e=_.map(this.model.getAllowedSecondaryLayouts(),(e=>this.getOptionTemplateModel(e)));_.each(e,(e=>this.expanderContainer.append(this.optionTemplate(e)))),Panopto.Core.UI.Components.flyout({$element:this.expanderContainer,$trigger:this.selectedContainer,timeout:t.Constants.FlyoutTimeout,expandLeft:!0,expandUp:!0,fadeInterval:t.Constants.FadeInterval}),Panopto.Core.UI.Handlers.button(this.expanderContainer.find(".player-tab-header"),(e=>{this.model.setSecondaryLayout($(e).data("layout")),this.expanderContainer.hide()}))}renderNewSelection(e){this.selectedContainer.empty(),this.selectedContainer.append(this.optionTemplate(this.getOptionTemplateModel(e)))}getOptionTemplateModel(t){let i,o;switch(t){case e.Viewer.SecondaryLayoutType.Single:i=this.resources.ViewerPlus_SecondaryLayout_Single,o="Icon_Single";break;case e.Viewer.SecondaryLayoutType.Double:i=this.resources.ViewerPlus_SecondaryLayout_Split,o="Icon_Split";break;case e.Viewer.SecondaryLayoutType.Quad:i=this.resources.ViewerPlus_SecondaryLayout_Quad,o="Icon_Quad"}return{layout:t,text:i,imagePath:e.ImageHelpers.getImageUrl("Viewer/"+o+".svg")}}}}(t.Controls||(t.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t extends e.AddSecondaryOverlay{show(){super.show(!1)}}e.SecondaryPlaceholder=t}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.SecondaryTabControl=function(e,t,i,o){var n=PanoptoTS.Viewer.Constants,a=function(o,n){var a;if(_.each(i,(function(e){e!==o?e.setSelected(!1,n):(a=!e.selected(),PanoptoCore.Logging.Logger.info(`Secondary player started playing stream ${e.id()}`))})),o){const e=t.position();o.getPlayer().setStartPosition(e),o.setSelected(!0,n),o.getPlayer().setStartPosition(void 0),t.ensureSecondaryIsMinimized(),o.setPosition(e,!0,a,void 0),o.playState(t.playState()),o.content().isSecondaryPaneOnly?t.interruptLayoutChanges(void 0):t.restoreLayoutChanges(),t.resize()}else e.setSelectedText(Panopto.GlobalResources.ViewerPlus_SecondarySources),e.setSelectedIcon("","")},r=function(){return _.find(i,(function(e){return e.selected()}))};return{getTabs:function(){return i},getIndex:function(){return o},selectTabById:function(e,o){var s=r(),l=_.find(i,(function(t){return t.id()===e}));!l||!l.available(t.position())||o&&s.id()===n.SlideDeckId||a(l,!1)},attachTabHandlers:function(){let o=e.getExpander();if(o){var r=e.getTabs();let s,l=()=>o.fadeOut(n.FadeInterval);if(Panopto.viewer.allowMultipleSecondaryDisplay){let t=e.getSelected();s=()=>{t.animate({borderBottomRightRadius:"0px",borderBottomLeftRadius:"0px"},n.FadeInterval/3)},l=()=>{t.animate({borderBottomRightRadius:"5px",borderBottomLeftRadius:"5px"},n.FadeInterval)}}Panopto.Core.UI.Handlers.button(r,(function(e){var o=_.find(i,(function(t){return t.owns(e)})),n=!1;if(o&&o.enabled()){let e=o.available(t.position()),i=t.userSeekEnabled()&&!t.isFullscreen();(e||i)&&("number"==typeof o.seekTime()&&t.setPosition(o.seekTime()),a(o,!0),n=!0)}n&&l()})),Panopto.Core.UI.Components.flyout({$element:o,$trigger:e.getSelected(),timeout:n.FlyoutTimeout,expandLeft:!0,expandUp:!1,fadeInterval:n.FadeInterval,showCallback:s,hideCallback:l}),t.toggleInlineSecondaries()}},selectedTab:r,selectSecondaryTab:a,updateSecondaryTabEnabledState:function(e,t){_.each(i,(function(i){var o=i.content().isBroadcast&&!i.available(t);i.setEnabled(e&&!o)}))},updateAvailableTabs:function(e){_.each(i,(function(t){t.available(e)}))}}},function(e){!function(e){!function(e){var t=PanoptoCore.TypedCallback;e.StreamUploader=class{get onReady(){return this._onReady}get onBeforeUpload(){return this._onBeforeUpload}get onUploaded(){return this._onUploaded}get onUpdate(){return this._onUpdate}get onComplete(){return this._onComplete}get onDelete(){return this._onDelete}constructor(e,i,o,n){this.params=e,this.sessionsService=i,this.sessionUploadManagementService=o,this.multipartUploadManagerService=n,this.uploadStatusQueryIntervalMilliseconds=1e4,this.useV2Upload=Panopto.features.uploadApiEnabledForStreamUpload&&Panopto.features.useUploadAPIForWebUpload,this.pendingUploads={},this.allPendingUploads=[],this._onReady=new t,this._onBeforeUpload=new t,this._onUploaded=new t,this._onUpdate=new t,this._onComplete=new t,this._onDelete=new t,this.processV1Upload=(e,t,i,o,n,a)=>{this.multipartUploadManagerService.queueUpload({file:i,fileId:t.uploadId,uploadUri:e.UploadTarget},o,(()=>n(e)),a),this.multipartUploadManagerService.upload()},this.processV2Upload=(e,t,i,o,n,a)=>{let r={fileId:t.uploadId,file:i,streamUpload:e,bytesUploaded:[],contentStoreOpenUrl:void 0,contentStoreFileId:void 0,contentStoreUploadId:void 0};this.multipartUploadManagerService.getOpenContentStoreUploadUrl(r,(t=>{r.contentStoreOpenUrl=t.SignedUrl,r.contentStoreFileId=t.FileID,r.contentStoreUploadId=t.contentStoreUploadId,this.multipartUploadManagerService.queueUpload(r,o,(()=>n(e)),a),this.multipartUploadManagerService.upload()}),(()=>a))},this.sessionUploadManagementService.setHost(window.location.origin),$(window).on("beforeunload",(()=>this.multipartUploadManagerService.isRunning()?Panopto.GlobalResources.ViewerPlus_Edit_WaitForUpload:void 0))}getCurrentUploads(){this.sessionUploadManagementService.getUploads(this.params.sessionId,(e=>{_.each(e.ProcessingUploads,(e=>{if(_.some(this.params.supportedStreamTypes,(t=>e.StreamType===t))){if(!this.pendingUploads.hasOwnProperty(e.ID)){let t={state:1,filename:e.UserFilename,fileSize:void 0,bytesUploaded:void 0,request:new Panopto.Core.CancellableRequest,uploadId:e.ID,streamType:e.StreamType,errorMessage:void 0,startTime:this.params.showStartTime?PanoptoCore.Helpers.parseJsonDateString(e.StreamStartTime):null,iconCode:this.getIconCodeFromStreamType(e.StreamType),isComplete:!1};this.pendingUploads[e.ID]=t,this.allPendingUploads.push(t)}this.startProcessing(this.pendingUploads[e.ID])}})),this._onReady.fire(this.pendingUploads)}),(()=>$.noop()))}startUpload(e,t,i){let o=new Panopto.Core.CancellableRequest,n=new Panopto.Core.CancellableRequest,a="."+Panopto.Core.StringHelpers.parseExtension(e.name),r={state:0,filename:e.name,fileSize:e.size,bytesUploaded:0,request:new Panopto.Core.CancellableRequest((()=>{o.cancel(),n.cancel()})),uploadId:void 0,streamType:t,errorMessage:void 0,startTime:i,iconCode:this.getIconCodeFromStreamType(t),isComplete:!1};this.allPendingUploads.push(r);let s=e=>{r.state=1,r.bytesUploaded=e,this._onUpdate.fire(r)},l=e=>{n=this.sessionUploadManagementService.closeUpload(e,(()=>{this._onUploaded.fire(r),this.startProcessing(r)}),c)},d=t=>{r.state=1,r.uploadId=t.ID,this._onUpdate.fire(r),this._onBeforeUpload.fire(r),this.useV2Upload?this.processV2Upload(t,r,e,s,l,c):this.processV1Upload(t,r,e,s,l,c)},c=()=>{r.state=5,this._onUpdate.fire(r)};_.contains(this.params.supportedExtensions,a)?Panopto.features.uploadByteLimit&&e.size>Panopto.features.uploadByteLimit?(r.state=4,r.uploadId=_.uniqueId("file"),this._onUpdate.fire(r)):o=this.sessionUploadManagementService.openUpload({sessionId:this.params.sessionId,filename:e.name,startTime:i,streamType:t},d,c):(r.state=3,r.uploadId=_.uniqueId("file"),this._onUpdate.fire(r))}cancelUpload(e){e.request.cancel(),this.multipartUploadManagerService.cancelUpload(e.uploadId),e.uploadId?this.sessionUploadManagementService.deleteUpload(e.uploadId,(()=>{this._onDelete.fire(e)}),(()=>{e.state=7,this._onUpdate.fire(e)})):this._onDelete.fire(e)}hasActiveUploads(){return _.any(this.allPendingUploads,(e=>!e.isComplete&&(0===e.state||1===e.state||2===e.state)))}startProcessing(e){e.state=2,this._onUpdate.fire(e);let t=setInterval((()=>{this.sessionUploadManagementService.getUpload(e.uploadId,(i=>{i.State===Panopto.Core.UploadStatus.Complete?(clearInterval(t),e.isComplete=!0,this._onUpdate.fire(e),this._onComplete.fire(e)):i.State===Panopto.Core.UploadStatus.ProcessingError&&(clearInterval(t),this.getErrorMessage(e).then((t=>{e.state=6,e.errorMessage=t,this._onUpdate.fire(e)})))}),(()=>$.noop()))}),this.uploadStatusQueryIntervalMilliseconds)}getIconCodeFromStreamType(e){let t=Panopto.Core.Constants.ObjectVideoIconCode;if(3===e)t=Panopto.Core.Constants.SlideIconCode;return t}getErrorMessage(e){const t=$.Deferred(),i=Panopto.Core.ServiceInterface.Objects.ServiceTaskQuery({filters:{deliveryIDs:[this.params.sessionId],includeDeliverySession:!0,serviceTaskTypeIDs:[Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.UnisonPackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.UnisonEncode],mostRecentServiceTaskTypeIDs:[Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.SlidePackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.MediaPackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.ViewerEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.FastPathViewerEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.PodcastEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.LegacyRecorderUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.TransferUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.CompleteUpload],taskStates:[Panopto.Core.ServiceInterface.Objects.TaskState.PermanentFailure]}});return Panopto.Util.callWebMethod({methodName:"GetMatchingTaskStatusWebUI",params:{query:i},loadingIndicator:null,onSuccess:i=>{let o;const n=_.map(i.ServiceTaskStatuses.Results,(function(e){return Panopto.Core.ServiceInterface.Objects.ServiceTaskStatus(e)}));_.each(n,(t=>{t.sourceFilename===e.filename&&(o=this.createMessage(t))})),t.resolve(o)},onFailure:()=>{t.reject()}}),t.promise()}createMessage(e){const t=_.invert(Panopto.Core.ServiceInterface.Objects.TaskState)[e.state],i=`SessionList_${e.taskName}_${t}_Status`;let o=(Panopto.GlobalResources[i]||Panopto.GlobalResources.SessionList_MissingStatusString).format(void 0,e.sourceFilename);if(e.subState){var n="SubStatus_"+Panopto.Core.ServiceInterface.Objects.ServiceTaskResourceMapping(e),a=Panopto.GlobalResources[n]||Panopto.GlobalResources.SubStatus_MissingStatusString;o+=Panopto.GlobalResources.SubStatus_SentenceSeparator+a}return o}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(t){const i="StreamUploader_StartUpload",o=PanoptoCore.Logging.Logger;class n extends t.StreamUploader{constructor(e,t,n,s){o.info("Using debug StreamUploader.");const l=new a(t,n);super(e,t,l,new r),this.mockSessionUploadManagement=l,document.addEventListener(i,(e=>{if(e instanceof CustomEvent){const t={name:"FakeFile.wmv",size:1e7},i=e.detail.streamType,o=new Date;this.startUpload(t,i,o)}}))}}t.StreamUploaderDebug=n;t.MockSessions=class{constructor(e){this.sessionsService=e,this.streams=[]}getAllStreams(e,t,i){o.verbose(`MockSessions.getAllStreams (${this.streams.length})`),this.streams.length>0?setTimeout((()=>{t(this.streams)}),0):this.sessionsService.getAllStreams(e,t,i)}addMockStream(e){o.verbose("MockSessions.addMockStream");const t=_.uniqueId("mockStream"),i=1e7*Panopto.Core.TimeHelpers.currentWin32EpochTime,n=Panopto.Core.ServiceInterface.Rest.Objects.Stream({AbsoluteStart:i,Duration:3e8,HttpUrl:"",Id:t,IsPrimary:1===e.StreamType,Name:e.UserFilename,ThumbnailInterval:3e8,ThumbnailUrlBase:"",Type:3,TypeName:"Stream",Url:"",VRType:0});this.streams.push(n)}};class a{constructor(e,t){this.sessionsService=e,this.sessionUploadManagementService=t,this.pendingUploads=[]}setHost(e){this.sessionUploadManagementService.setHost(e)}getUploads(e,t,i){this.pendingUploads.length>0?setTimeout((()=>{t({ProcessingUploads:_.filter(this.pendingUploads,(e=>e.State!==Panopto.Core.UploadStatus.Complete))})}),0):this.sessionUploadManagementService.getUploads(e,t,i)}getUpload(e,t,i){let o=!1;_.each(this.pendingUploads,(i=>{i.ID===e&&(o=!0,setTimeout((()=>{t(i)}),0))})),o||this.sessionUploadManagementService.getUpload(e,t,i)}openUpload(e,t,i){const o={ID:_.uniqueId("pendingUpload"),SessionID:e.sessionId,State:void 0,StreamStartTime:e.startTime,StreamType:e.streamType,UploadTarget:void 0,UserFilename:e.filename};return this.pendingUploads.push(o),setTimeout((()=>{t(o)}),0),setTimeout((()=>{o.State=Panopto.Core.UploadStatus.Complete,this.sessionsService.addMockStream&&this.sessionsService.addMockStream(o)}),2e3),new Panopto.Core.CancellableRequest}deleteUpload(e,t,i){setTimeout((()=>{t()}),0)}closeUpload(e,t,i){setTimeout((()=>{t()}),0)}}class r{constructor(){this.uploadQueue=0}isRunning(){return this.uploadQueue>0}queueUpload(e,t,i,o){let n=0;const a=setInterval((()=>{t(1e6*++n)}),100);setTimeout((()=>{clearInterval(a),i(e.fileId),this.uploadQueue--}),1e3)}upload(){$.noop()}cancelUpload(e){$.noop()}}class s extends e.DebugEventModel{constructor(e,t){super(),this.streamType=e,this.neverFinish=t}typeArg(){return i}}t.StreamUploaderStartUpload=s}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.ThumbnailStrip=function(e,t,i,o,n){var a=PanoptoTS.Viewer.Constants,r=Panopto.Viewer.Analytics;var s,l,d=Panopto.Core.UI.Components.scrollingHighlight(e,!1,a.ThumbnailScrollTimeout),c=function(l){var c,p=s,u=[],h=0,m=Panopto.cacheRoot+"/Images/no_thumbnail.svg",v=function(){h++,l&&h===u.length&&l()};s=_.map(t,(function(t){var i=o?t.editorTime:t.time;return t.id=t.id||_.uniqueId(),{time:i,timestamp:Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator),id:"thumbnail"+t.id+e.attr("id"),thumbnailId:t.id,src:t.queryParams?Panopto.Core.StringHelpers.addQueryParameter(a.ThumbUrl,t.queryParams):t.thumbnailUrl||m,tabId:t.tabId||(t.type===Panopto.Core.EventTargetType.PowerPoint?PanoptoTS.Viewer.Constants.SlideDeckId:t.streamId),isSlide:t.isSlide,editable:!!o}})),c=_.filter(p,(function(e){return!_.find(s,(function(t){return e.thumbnailId===t.thumbnailId}))})),_.each(s,(function(e){var t=_.find(p,(function(t){return e.thumbnailId===t.thumbnailId}));t?t.time!==e.time&&(u.push(e),c.push(t)):u.push(e)})),_.each(c,(function(e){$("#"+e.id).remove()}));var P=_.template($("#thumbnailTemplate").html());_.each(s,(function(t,i){if(u.indexOf(t)>=0){var o=P({thumbnails:[t]});0===i?e.prepend(o):i===s.length-1?e.append(o):$("#"+s[i-1].id).after(o)}}));var g=[];_.each(u,(function(e){let t=0;var a=$("#"+e.id),s=a.find(".thumbnail-buttons"),l=s.find(".thumbnail-edit"),c=s.find(".thumbnail-delete"),p=a.find("img");_.each(p,(function(e){g.push(e)})),p.on("load",(function(){a.show(),v()})).on("error",(function(e){$(e.currentTarget).attr("src")!==m?t<2?window.setTimeout((()=>{t++,$(e.currentTarget).attr("src",$(e.currentTarget).attr("src"))}),1e3):$(e.currentTarget).attr("src",m):(a.width(a.height()),a.show(),v())})),Panopto.Core.UI.Handlers.button(a,(function(t){i.userSeekEnabled()&&d.highlight(e,(function(e){i.setPosition(e.time);!(e.time!==i.position())&&e.tabId&&i.selectSecondaryTab(e.tabId,e.isSlide),r.sendEvent({action:r.Actions.Navigate,label:r.Labels.Thumbnail})}))})),o&&(n?s.show():Panopto.Core.UI.Handlers.hoverableParent(a,s,(function(e){s.toggle(e)})),Panopto.Core.UI.Handlers.button(l,(function(){o.openEventDialog(e.thumbnailId)})),Panopto.Core.UI.Handlers.button(c,(function(){o.removeEvent(e.thumbnailId)})))})),Panopto.Core.ImageHelpers.queueLoad($(g),8)};return{render:c,position:function(e,t){var i;e!==l&&(_.each(s,(function(t){t.time<=e&&(i=t)})),d.highlight(i,!1,t),l=e)},toggle:function(t){e.toggle(t&&s.length>0)},thumbnails:function(e){if(!e)return t;t=e,c()}}},function(e){!function(e){!function(e){e.WaitingRoom=class{constructor(e,t,i){this.template=_.template('\n<div class="waiting-room-wrapper">\n    <p class="title"><@- title @></p>\n\n    <@ if (thumbnailUrl) { @>\n        <img class="thumbnail-img" src="<@- thumbnailUrl @>"/>\n    <@ } @>\n\n    <p class="description"><@= description @></p>\n    <p><@- Panopto.GlobalResources.ViewerPlus_BroadcastNotStarted @></p>\n</div>\n'),this.$element=e,this.delivery=t,this.thumbnailUrl=i}render(){let e=Panopto.Core.TextHelpers.displayLineBreaks(_.escape(this.delivery.description)),t={title:this.delivery.title,description:e,thumbnailUrl:this.thumbnailUrl};this.$element.html(this.template(t))}remove(){this.$element.empty()}toggle(e){this.$element.toggle(e)}}}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),Panopto.Viewer.Players=Panopto.Viewer.Players||{},function(e){!function(t){(t.Data||(t.Data={})).Delivery=class{constructor(t,{forceUsePodcast:i=!1,removeHlsbcFirstSegment:o=!1,useLowestBitratePodcastStreamOnIos:n=!1}={}){let a=Panopto.Viewer.Data,r=e.Viewer.Constants,s=t.Delivery.SessionName,l=Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(t.Delivery.SessionStartTime),d=t.Delivery.IsActiveBroadcast,c=t.Delivery.IsBroadcast&&t.Delivery.IsViewerEncodeComplete&&(new Date).getTime()-l.getTime()<=r.RecentBroadcastThreshold;const p=_.chain(t.Delivery.Streams).filter((e=>"Archival"===e.StreamTypeName)).filter((e=>{const t=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType;return t===PanoptoViewer.Services.Panopto_Shared_MediaFileType.ism||t===PanoptoViewer.Services.Panopto_Shared_MediaFileType.wmv})).value().length>0,u=_.chain(t.Delivery.Streams).filter((e=>{if(!e.StreamUrl)return PanoptoCore.Logging.Logger.verbose("Delivery.ctor: Missing stream URL."),!1;const t=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType;let i=!0;return t!==PanoptoViewer.Services.Panopto_Shared_MediaFileType.ism&&t!==PanoptoViewer.Services.Panopto_Shared_MediaFileType.wmv&&t!==PanoptoViewer.Services.Panopto_Shared_MediaFileType.unknown&&null!=t||(PanoptoCore.Logging.Logger.verbose(`Delivery.ctor: Legacy media type is not playable (enum: ${t}, str: ${PanoptoViewer.Services.Panopto_Shared_MediaFileType[t]}).`),i=!1),i})).value();let h,m,v,P,g=!1;if(u.length>0&&(t.Delivery.IsViewerEncodeAvailable||d)&&!i)PanoptoCore.Logging.Logger.info("Delivery.ctor: parsing and playing regular streams."),({primaryStreams:h,secondaryStreams:m,activePrimary:v,screenCaptureStream:P}=this.parseStreams(u,s,{isBroadcast:d,removeHlsbcFirstSegment:o,forceLowestBitrate:!1}));else if(t.Delivery.PodcastStreams?.length>0){PanoptoCore.Logging.Logger.info("Delivery.ctor: parsing and playing podcast stream."),g=!0,({primaryStreams:h,secondaryStreams:m,activePrimary:v}=this.parseStreams(t.Delivery.PodcastStreams,s,{isBroadcast:d,removeHlsbcFirstSegment:!1,forceLowestBitrate:i&&n}));const e=_.find(t.Delivery.Streams,(e=>"Archival"===e.StreamTypeName))?.PublicID;h.forEach((t=>t.id=e))}else h=[],m=[];let{slides:y,documents:f,thumbnails:S,contents:C,channels:w}=this.parseEvents(t.Delivery.Timestamps,t.Delivery.EventTargets,t.Delivery.PublicNotesStreams,t.Delivery.Duration,P);this.title=s,this.id=t.Delivery.PublicID,this.sessionId=t.SessionId,this.webcastVersionId=t.Delivery.WebcastVersionId,this.sourceDeliveryId=t.Delivery.SourceDeliveryId,this.date=l,this.duration=t.Delivery.Duration,this.description=t.Delivery.SessionAbstract,this.ownerId=t.Delivery.OwnerId,this.ownerFullName=t.Delivery.OwnerDisplayName,this.ownerBio=t.Delivery.OwnerBio,this.ownerIsOverQuota=t.Delivery.OwnerIsOverQuota,this.invocationId=t.InvocationId,this.embedUrl=t.EmbedUrl,this.downloadUrl=t.DownloadUrl,this.podcastCompleted=t.PodcastCompleted,this.broadcastRefreshInterval=1e3*t.BroadcastRefreshInterval,this.webcastApiRefreshInterval=1e3*t.WebcastPingIntervalInSeconds,this.broadcastSegmentBackoff=t.BroadcastSegmentBackoff,this.allowPublicNotes=t.AllowPublicNotes,this.aiChapters=t.Delivery.AIChapters,this.aiKeyPoints=t.Delivery.AIKeyPoints,this.aiSummary=t.Delivery.AISummary,this.hasAnyLinks=t.Delivery.HasAnyLinks,this.hasQuiz=t.Delivery.HasQuiz,this.firstQuizOffset=t.Delivery.FirstQuizOffset,this.hasCaptions=t.Delivery.HasCaptions,this.hasAudioDescriptions=t.Delivery.HasAudioDescriptions,this.availableCaptions=t.Delivery.AvailableCaptions.map((e=>({language:e.Language??void 0,showDisclaimer:e.ShowDisclaimer}))),this.availableAudioDescriptionLanguages=t.Delivery.AvailableAudioDescriptionLanguages,this.isBroadcast=d,this.isViewable=d&&!!v||t.Delivery.IsViewerEncodeComplete&&t.Delivery.IsViewerEncodeAvailable,this.isEmbedViewable=this.isViewable||h.length>0,this.isReadyForEditing=t.Delivery.IsReadyForEditing,this.isReferenceCopy=t.Delivery.IsReferenceCopy,this.rehydrationAvailable=t.Delivery.RehydrationAvailable,this.isPurgedEncode=t.Delivery.IsPurgedEncode,this.isPurgedLegacyEncode=t.Delivery.IsPurgedLegacyEncode,this.requiresAdvancedEditor=t.Delivery.RequiresAdvancedEditor,this.broadcastEnded=t.Delivery.BroadcastEnded,this.broadcastInterrupted=t.Delivery.BroadcastInterrupted,this.isRecentBroadcast=c,this.isPrimaryAudioOnly=t.Delivery.IsPrimaryAudioOnly,this.requiresSilverlight=p,this.flowPlayerEnabled=Panopto.viewer.flowplayerEnabled&&!p,this.multiBitrateEnabled=v?.mediaFileType===PanoptoViewer.Services.Panopto_Shared_MediaFileType.hls,this.playSpeedEnabled=!0,this.discussionEnabled=t.Delivery.DiscussionEnabled,this.discussionCacheSeconds=t.DiscussionCacheSeconds,this.lastViewingPosition=t.LastViewingPosition,this.completionPercentage=t.CompletionPercentage,this.normalizeVolume=t.Delivery.NormalizeVolume,this.sessionInteractivityType=t.SessionInteractivityType,this.activePrimary=v,this.primaryStreams=h,this.secondaryStreams=m,this.slideDecks=!g&&y.length?[a.SlideDeck(y)]:[],this.documents=f,this.thumbnails=S,this.captions=[],this.audioDescriptions=[],this.contents=C,this.channels=w,this.aiChapters=t.Delivery.AIChapters,this.tags=t.Delivery.Tags,this.user={email:t.UserEmail,name:t.UserName,key:(t.UserKey||"").toLowerCase(),rating:t.UserRating,role:t.SessionRole,canCreateQuestionLists:t.UserCanCreateQuestionLists,permissions:t.Delivery.Permissions||[]},this.folder={name:t.Delivery.SessionGroupLongName,description:t.Delivery.SessionGroupAbstract,id:t.Delivery.SessionGroupPublicID},this.nextDelivery=void 0,t.Delivery.NextDeliveryUrl&&(this.nextDelivery={id:t.Delivery.NextDeliveryId,url:t.Delivery.NextDeliveryUrl,title:t.Delivery.NextDeliveryTitle,description:t.Delivery.NextDeliveryDescription,duration:Panopto.Core.TimeHelpers.formatDuration(t.Delivery.NextDeliveryDuration,Panopto.GlobalResources.TimeSeparator),thumbUrl:t.Delivery.NextDeliveryThumbUrl,isLive:t.Delivery.NextDeliveryIsLive,folderName:void 0})}parseStreams(e,i,{isBroadcast:o=!1,removeHlsbcFirstSegment:n=!1,forceLowestBitrate:a=!1}={}){let r=_.map(_.filter(e,(e=>"Archival"===e.StreamTypeName)),(e=>Panopto.Viewer.Data.Stream(e,o,i)));r=_.sortBy(r,"relativeStart"),a&&r.forEach((e=>{if(e.variants.length){const t=e.variants.sort(((e,t)=>e.bandwidth-t.bandwidth))[0];e.url=t.url}}));let s=r.length?o?_.find(r,(e=>!e.relativeEnd))||_.max(r,(e=>e.relativeEnd)):r[0]:void 0,l=o?r:s?[s]:[],d=_.map(_.filter(e,(e=>"Archival"!==e.StreamTypeName)),(e=>Panopto.Viewer.Data.Stream(e,o,i))),c=_.find(d,(e=>e.tabClass===t.Constants.ScreenCaptureClass));return n&&[...l,...d].forEach((e=>{/_hlsbc/i.test(e.url)&&(e.url=e.url.replace("master.m3u8","master2.m3u8"))})),{primaryStreams:l,secondaryStreams:d,activePrimary:s,screenCaptureStream:c}}parseEvents(t,i,o,n,a){let r=Panopto.Viewer.Data,s=_.filter(t,(e=>(e.Time||0===e.Time)&&e.Time<=n&&e.ObjectIdentifier&&e.ObjectSequenceNumber)),l=_.filter(s,(e=>"PowerPoint"===e.EventTargetType)),d=_.filter(s,(e=>e.Url)),c=[];_.each(d,(t=>c.push(new e.Viewer.Data.Document(t)))),_.each(i,(t=>c.push(new e.Viewer.Data.Document(t))));let p=_.filter(s,(e=>!e.Url&&_.contains(["ObjectVideo","Primary","SmartOcrToc","AIChapters"],e.EventTargetType))).concat(l);p.sort(((e,t)=>e.Time-t.Time));let u,h=_.map(p,(t=>new e.Viewer.Data.Thumbnail(t,a))).filter((e=>e.showInTableOfContents)),m=_.chain(p.concat(d)).unique().map((t=>new e.Viewer.Data.Event(t))).filter((e=>!!jQuery.trim(e.text)&&e.showInTableOfContents)).value();return o&&(u=_.map(o,(e=>r.Channel(e,e,!0)))),{slides:l,documents:c,thumbnails:h,contents:m,channels:u}}}}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Stream=function(e,t,i){const o="screen";var n,a=[],r=[];const s=e.Name||(e.Tag?.toLowerCase()===o?Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle:Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle),l=e.Tag?.toLowerCase()===o?PanoptoTS.Viewer.Constants.ScreenCaptureClass:PanoptoTS.Viewer.Constants.ObjectVideoTabClass;var d=function(e,i){var o=e-PanoptoTS.Viewer.Constants.SecondaryStreamOffset;return t||i&&o<=i+PanoptoTS.Viewer.Constants.MinSegmentGap?e:Math.max(0,o)};switch(e.RelativeSegments&&e.RelativeSegments.length?_.each(e.RelativeSegments,(function(e,t){var i=new PanoptoTS.Viewer.Data.SecondarySegment(e),o=r[t-1];i.timelineStart=d(i.relativeStart,o?o.relativeEnd:0),r.push(i),a.push(i.timelineStart,i.relativeEnd)})):(a.push(d(e.RelativeStart,void 0)),e.RelativeEnd&&a.push(e.RelativeEnd)),(n=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(s,e.PublicID,l,a,e.AbsoluteStart,"","",!1,!1,!1,t,!1)).url=e.StreamUrl,n.mediaFileType=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType,n.relativeStart=e.RelativeStart,n.relativeEnd=e.RelativeEnd,n.length=e.RelativeEnd?e.RelativeEnd-e.RelativeStart:0,n.segments=r,n.interrupted=e.Interrupted,n.deliveryTitle=i,n.broadcastSegmentDuration=e.BroadcastSegmentDuration,n.broadcastSegmentBackoff=Panopto.viewer.broadcastSegmentBackoff,n.vrType=e.VRType,n.variants=e.Variants?.map((e=>({url:e.Url,bandwidth:e.Bandwidth})))??[],Panopto.viewer.pureHlsJsPlayback&&n.vrType!==PanoptoViewer.MediaVRType.None&&PanoptoCore.Browser.isSafari&&(window.location.href=window.location.href+"&pureHlsJs=false"),e.Tag?.toLowerCase()){case"audio":n.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,n.isAudioOnly=!0;break;case o:n.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen,n.isAudioOnly=!1;break;default:n.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera,n.isAudioOnly=!1}return n.optimizationToken=e.OptimizationToken,n},function(e){!function(e){!function(e){e.SecondarySegment=class{constructor(e){this.relativeStart=e.RelativeStart,this.relativeEnd=e.End?e.RelativeStart+(e.End-e.Start):1/0,this.streamOffset=e.Start}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t{getStreamFriendlyType(){var e;switch(this.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:e=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:e=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:e=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return e}getStreamName(){return this.name||this.getStreamFriendlyType()}static convertFromApiModel(e){var i=new t;return i.id=e.id,i.url=e.url,i.httpUrl=e.httpUrl,i.absoluteStart=e.absoluteStart,i.duration=e.duration,i.thumbnailUrlBase=e.thumbnailUrlBase,i.thumbnailInterval=e.thumbnailInterval,i.type=e.type,i.vrType=e.vrType,i.name=e.name,i.iconCode=e.iconCode,i.absoluteEnd=e.absoluteEnd(),i.streamType=e.isPrimary?1:2,i.normalizeVolume=e.normalizeVolume,i.mediaFileType=e.viewerMediaFileType,i}}e.Stream=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){const t=PanoptoCore.Logging.Logger;e.BasePlayerSynchronizationLogic=class{constructor(e,t,i,o,n){this.viewer=e,this.playControls=t,this.primaryPlayer=i,this.secondaryContentContainers=o,this.name=n,this.wasPrimaryFullscreen=!1,this.wasBackgrounded=!1,this.previousPrimaryId=""}synchronize(e,t,i,o){this.logSynchronize(i),i&&this.clearSyncTimeout();let n,a=!1;return this.prepareForSync(e),o||(n=this.getBlockingPosition(e,t,i,this.secondaryTabs)),_.isNumber(n)&&n!==e?(this.viewer.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,!1,!1),this.viewer.setPosition(n,!0)):a=this.doRemediation(e,t,i,o),this.wasPrimaryFullscreen=this.primaryPlayer.isFullscreen(),this.wasBackgrounded="hidden"===document.visibilityState,a}getName(){return this.name}getDetails(){return this.getName()}getBlockingPosition(t,i,o,n){let a,r=_.map(n,(e=>e.content())),s=e.ContentLogic.getBlockingContent(r,t);if(s)a=s.timeline[0];else if(!o){let o=e.ContentLogic.getPausingContent(r,i,t);o&&(a=o.timeline[0])}return a}logSynchronize(e){var i=this.primaryPlayer.activePrimary();i&&(e&&t.info(`User-initiated sync of primary ${i.id}`),this.previousPrimaryId!==i.id&&(this.previousPrimaryId=i.id,t.info(`Primary player started playing stream ${i.id}`)),this.wasPrimaryFullscreen!==this.primaryPlayer.isFullscreen()&&t.info(`Primary player changed fullscreen to ${this.primaryPlayer.isFullscreen()}`))}}}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.ContentLogic=class{static getBlockingContent(e,t){return _.find(e,(e=>{let i=e.timeline[0];return e.isSessionPlaybackBlocking&&i<=t}))}static getPausingContent(e,t,i){return _.find(e,(e=>{let o=e.timeline[0];return e.pauseWhenAvailable&&o>t&&o<=i}))}}}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.EditorEventTabLogic=class{constructor(e,t,i,o,n,a,r,s,l,d){this.delivery=e,this.viewer=t,this.inviteTokenId=i,this.editor=o,this.sessionsService=n,this.clientParams=a,this.deliveryService=r,this.tagService=s,this.subscriptionService=l,this.userService=d}createTabs(t,i,o){const n=e.Viewer.Tabs.ViewerEventTabHelpers.create(this.viewer,t,i,o),a=[];let r,s,l,d,c,p;r=PanoptoLegacy.Viewer.Tabs.Editor.EditDetailsTab($("#editDetailsTabHeader"),$("#editDetailsTabPane"),this.viewer,n,this.editor,this.editor.timeConverter,this.delivery.id,this.delivery.title,this.delivery.description,this.delivery.tags,this.delivery.ownerId,this.delivery.ownerFullName,this.delivery.ownerBio,this.deliveryService,this.tagService,this.subscriptionService,this.userService),a.push(r),(Panopto.viewer.isAISummaryEnabled||!Panopto.viewer.isAIEvaluationEnabled&&(this.editor.activeState().getAIKeyPoints()||this.editor.activeState().getAISummary()))&&a.push(PanoptoLegacy.Viewer.Tabs.Editor.EditAISummaryTab($("#editAISummaryTabHeader"),$("#editAISummaryTabPane"),this.inviteTokenId,n,this.editor,this.editor.timeConverter,this.deliveryService)),a.push(PanoptoLegacy.Viewer.Tabs.Editor.EditContentsTab($("#editContentsTabHeader"),$("#editContentsTabPane"),n,this.editor,this.delivery.user.canCreateQuestionLists,this.editor.eventService,this.editor.timeConverter,this.deliveryService)),c=PanoptoLegacy.Viewer.Tabs.Editor.EditTranscriptTab($("#editTranscriptTabHeader"),$("#editTranscriptTabPane"),n,this.editor,this.editor.timeConverter,this.deliveryService),a.push(c),p=PanoptoLegacy.Viewer.Tabs.Editor.EditAudioDescriptionsTab($("#editAudioDescriptionsTabHeader"),$("#editAudioDescriptionsTabPane"),n,this.editor,this.editor.timeConverter,this.delivery.availableAudioDescriptionLanguages,this.deliveryService),a.push(p),window.slidesTab?(window.slidesTab.setTimelineEditor(this.editor),window.slidesTab.setReadyStreamUploader()):window.slidesTab=PanoptoLegacy.Viewer.Tabs.Editor.EditSlidesTab($("#editSlidesTabHeader"),$("#editSlidesTabPane"),n,this.editor,this.clientParams,window.slideUploader,this.editor.timeConverter,this.deliveryService),a.push(window.slidesTab),l=PanoptoLegacy.Viewer.Tabs.Editor.EditCutTab($("#editCutTabHeader"),$("#editCutTabPane"),n,this.editor,this.deliveryService),window.streamTab?(window.streamTab.setTimelineEditor(this.editor),window.streamTab.setReadyStreamUploader()):(window.streamTab=PanoptoLegacy.Viewer.Tabs.Editor.EditStreamTab($("#editStreamTabHeader"),$("#editStreamTabPane"),n,this.editor,this.clientParams,window.streamUploader,this.sessionsService,this.editor.timeConverter,this.deliveryService),window.streamTab.setTimelineEditor(this.editor)),s=window.streamTab;const u=a.slice();return u.push(l),u.push(s),this.delivery.user.canCreateQuestionLists&&(d=PanoptoLegacy.Viewer.Tabs.Editor.EditQuestionListTab($("#editQuestionListTabHeader"),$("#editQuestionListTabPane"),n,this.editor,this.editor.timeConverter,this.editor.eventService,this.deliveryService),u.push(d)),{tabs:u,searchTab:void 0,detailsTab:void 0,commentsTab:void 0,captionsTab:void 0,audioDescriptionsTab:void 0,editEventTabs:a,editDetailsTab:r,editStreamTab:s,editCutTab:l,editQuestionListTab:d,editCaptionsTab:c,editAudioDescriptionsTab:p}}}}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.HlsJsWebcastDurationEstimator=class{constructor(e,t){this.lastDuration=0,this.lastLevelAgeMillis=0,this.attach(e,t)}getDuration(){var e=((this.lastLevelLoadTime?(new Date).getTime()-this.lastLevelLoadTime:0)+this.lastLevelAgeMillis)/1e3;return this.lastDuration+e}attach(e,t){if(e.engine.hls&&e.engine.hls.on(PanoptoViewer.HlsJsEvents.LEVEL_LOADED,((e,t)=>this.updateDuration(t))),t){const t=e.engine.hls;t&&this.attachXhrSetup(t.config)}}attachXhrSetup(t){var i=t.xhrSetup;t.xhrSetup=(t,o)=>{if(_.any(e.Viewer.Constants.HlsLevelFileNames,(e=>o.indexOf(e)>=0))){var n=this;t.addEventListener("load",(function(e){n.updateLevelAge(this)})),i&&i(t,o)}}}updateLevelAge(t){var i=t.getResponseHeader(e.Viewer.Constants.HttpHeaders.Date),o=t.getResponseHeader(e.Viewer.Constants.HttpHeaders.LastModified);if(i&&o){var n=Date.parse(i),a=Date.parse(o);isNaN(n)||isNaN(a)||(this.lastLevelAgeMillis=n-a)}}updateDuration(e){this.lastLevelLoadTime=(new Date).getTime(),this.lastDuration=e.details.totalduration}}}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.LiveNotesEventTabLogic=class{constructor(e,t,i){this.delivery=e,this.viewer=t,this.deliveryService=i}createTabs(t,i,o){var n=e.Viewer.Tabs.ViewerEventTabHelpers.create(this.viewer,t,i,o),a=[];return a.push(PanoptoLegacy.Viewer.Tabs.NotesTab($("#notesTabHeader"),$("#notesTabPane"),n,this.delivery.id,null,this.delivery.user,this.delivery.channels,this.delivery.allowPublicNotes,!0,this.delivery.isBroadcast,this.deliveryService)),{tabs:a,searchTab:void 0,detailsTab:void 0,commentsTab:void 0,captionsTab:void 0,audioDescriptionsTab:void 0}}}}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(t){t.MultipleSecondaryPositionSynchronization=class{constructor(e,t,i){this.viewer=e,this.playControls=t,this.primaryPlayer=i}synchronizePlayPositions(t,i){if(void 0===this.synchronizingSecondaryTabControls){const o=this.getPositionDifferences(t,i),n=e.Constants.SecondarySyncThreshold*this.playControls.playSpeed();o.range>n&&this.beginSynchronization(i,o)}}stopSynchronization(){const e=!!this.synchronizingInterval;return this.synchronizingInterval&&(clearInterval(this.synchronizingInterval),this.synchronizingInterval=void 0,this.synchronizingSecondaryTabControls=void 0),e}getPositionDifferences(e,t){let i=0,o=0;return{list:_.map(t,(t=>{let n=t.selectedTab()?t.selectedTab().setPosition(e,!1,void 0,$.noop):0;return n>i&&(i=n),n<o&&(o=n),n})),max:i,min:o,range:i-o}}beginSynchronization(t,i){this.viewer.logDesync(i.range,"MultipleSecondary","pausing to corect",!0),this.synchronizingSecondaryTabControls=t,this.runSynchronization(t,i),this.synchronizingInterval=setInterval((()=>{this.synchronizingSecondaryTabControls?this.runSynchronization(this.synchronizingSecondaryTabControls,this.getPositionDifferences(this.viewer.position(),this.synchronizingSecondaryTabControls)):this.stopSynchronization()}),e.Constants.SecondarySynchronizingUpdateRateMillis)}runSynchronization(t,i){let o,n=i.range>PanoptoViewer.Constants.SecondarySyncTargetSeconds?e.Constants.SecondarySynchronizingUpdateRateMillis/1e3:PanoptoViewer.Constants.SecondarySyncTargetSeconds;_.each(t,((e,t)=>{e.selectedTab()&&(o=i.max-i.list[t]>n?PanoptoViewer.Data.ViewerPlayState.Paused:PanoptoViewer.Data.ViewerPlayState.Playing,e.selectedTab().playState(o))})),o=i.max>n?PanoptoViewer.Data.ViewerPlayState.Paused:PanoptoViewer.Data.ViewerPlayState.Playing,this.primaryPlayer.playState(o),i.range<=PanoptoViewer.Constants.SecondarySyncTargetSeconds&&this.stopSynchronization()}}}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var i=e.Viewer.Constants,o=e.Viewer.ViewMode;const n=PanoptoCore.Logging.Logger;class a extends t.BasePlayerSynchronizationLogic{constructor(e,i,o,n){super(e,i,o,n,"MultipleSecondary"),this.defaultTabMap={},this.positionSynchronization=new t.MultipleSecondaryPositionSynchronization(e,i,o)}prepareForSync(e){this.secondaryTabControls=_.map(this.secondaryContentContainers,(e=>e.getTabControl())),this.secondaryTabs=this.secondaryTabControls[0].getTabs(),this.availableTabs=_.filter(this.secondaryTabs,(t=>t.available(e)))}doRemediation(e,t,i,o){return this.checkAllSecondaryTabs(e,i,o,this.availableTabs,this.secondaryTabs,this.secondaryTabControls),!0}clearSyncTimeout(){this.positionSynchronization.stopSynchronization()}synchronizeSecondaryTabs(e,t,i){t||this.wasPrimaryFullscreen&&!this.primaryPlayer.isFullscreen()||this.wasBackgrounded&&"hidden"!==document.visibilityState?(this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),t),_.each(i,(t=>{t.selectedTab()&&t.selectedTab().setPosition(e,!0,void 0,(()=>{t.selectedTab()&&t.selectedTab().playState(this.viewer.playState())}))}))):this.primaryPlayer.isFullscreen()||"hidden"===document.visibilityState?this.positionSynchronization.stopSynchronization()&&this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),t):this.viewer.playState()===PanoptoViewer.Data.ViewerPlayState.Playing&&this.positionSynchronization.synchronizePlayPositions(e,i)}getSecondaryTabControlPriorities(e,t,i){return _.chain(e).map(((e,o)=>{let n=this.getSelectedTabPriority(e,t,i);return{selectedPriority:n,selectedPriorityCombined:void 0!==n?n:o-i.length,secondaryTabControl:e}})).sortBy((e=>e.selectedPriorityCombined)).value()}getUnusedAvailableTabs(e,t){const i=_.chain(t).filter((e=>!!e.selectedTab())).map((e=>e.selectedTab().id())).value();return _.reject(e,(e=>i.indexOf(e.id())>=0))}checkAllSecondaryTabs(e,t,i,n,a,r){const s=this.getSecondaryTabControlPriorities(r,e,n),l=this.getUnusedAvailableTabs(n,r);let d=!1,c=l.pop();_.each(s,(o=>{let a=o.secondaryTabControl,r=void 0!==o.selectedPriority;if(c){let t=this.getTabPriority(c,n),i=a.getIndex(),s=!!r&&a.selectedTab().id()===this.defaultTabMap[i];if(!r||s&&t>o.selectedPriority){const t=_.find(a.getTabs(),(e=>e.id()===c.id()));this.setSecondaryTab(a,e,t),this.defaultTabMap[i]=c.id(),c=l.pop(),d=!0}else s||(this.defaultTabMap[i]=void 0)}else r||this.clearSecondaryTab(a,e,t,i)&&(d=!0)}));let p=0!==n.length,u=p,h=this.viewer.hasPendingSecondaryUploads();if(!u){u=this.shouldShowInitialSecondaries(e,i,a)||h}u?(this.viewer.viewMode(o.Secondary),!p&&h&&this.viewer.toggleSecondaryPlaceholder(!0),this.synchronizeSecondaryTabs(e,t,r),d&&this.viewer.resize()):(this.viewer.ensureSecondaryIsMinimized(),this.viewer.viewMode(o.Primary))}setSecondaryTab(e,t,i){n.info(`${"Secondary_"+e.getIndex()} player started playing stream ${i.id()}`),e.selectSecondaryTab(i,!1),i.pauseWhenAvailable()&&(this.viewer.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,!1,!1),this.viewer.setFullscreenPlayer(void 0)),e.updateSecondaryTabEnabledState(!i.hiddenTab(),t),this.viewer.toggleSecondaryPlaceholder(!1)}getSelectedTabPriority(e,t,i){let o,n=e.selectedTab();return n&&n.available(t)&&(o=this.getTabPriority(n,i)),o}getTabPriority(e,t){var i=_.findIndex(t,(t=>t.id()===e.id()));return i>=0?i:void 0}clearSecondaryTab(e,t,i,o){const a=void 0!==e.selectedTab();return e.selectSecondaryTab(void 0,i),e.updateSecondaryTabEnabledState(!0,t),a&&n.info("Secondary_"+e.getIndex()+" player no longer has a stream"),a}shouldShowInitialSecondaries(e,t,o){let n=[];_.each(o,(e=>{n=n.concat(e.timeline())})),n.sort(((e,t)=>e-t));let a=_.find(n,(t=>t>e));return!t&&a<i.InitialSecondaryThreshold&&n.length&&n[0]<i.InitialSecondaryThreshold}}t.MultipleSecondarySynchronizationLogic=a}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={}));var HiveModule=HiveModule||{};!function(e){!function(t){!function(t){const i=PanoptoCore.Logging.Logger;class o{static log(e){i.info(`PlayerFactory: ${e}`)}constructor(e){this.config=e}create(t,i){let n;if(Panopto.viewer.isHiveEnabled&&!this.config.isEditor){o.log("HiveFlowplayerMachine"),n=new e.Viewer.Players.HiveFlowplayerMachine(t,i,this.config.playerHelpers);var a=t?"leftPlayerContainer":"rightPlayersContainer";HiveModule.initFlowplayer(flowplayer,a)}else Panopto.viewer.pureHlsJsPlayback||Panopto.viewer.isKollectiveEnabled?(Panopto.viewer.isKollectiveEnabled&&!this.config.isEditor&&PanoptoViewer.Players.PrimitivePlayerFactory.enableKollective(),o.log("SingleStreamMediaPlayer"),n=new e.Viewer.Players.SingleStreamMediaPlayer(t,i,this.config.playerHelpers)):(o.log("FlowplayerMachine"),n=new e.Viewer.Players.FlowplayerMachine(t,i,this.config.playerHelpers));return n}}t.PlayerFactory=o}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={}));var Panopto=Panopto||{};!function(e){!function(t){!function(t){const i=PanoptoCore.Logging.Logger;class o{static create(e,t,n,a){const r=o.createImpl(e,t,n,a);return i.info(`SyncLogicFactory: selecting ${r.getName()}`),r}static getRequestedVersion(){let t=Panopto.viewer.playerSyncLogicVersion??"";const i=e.StringHelpers.parseQueryString(window.location.search,!1,!0);return PanoptoCore.Browser.isSafari&&(t="allowprimarypause"),i.synclogic&&(t=i.synclogic),t.toLowerCase()}static createImpl(e,i,n,a){if(a.length>1)return new t.MultipleSecondarySynchronizationLogic(e,i,n,a);switch(o.getRequestedVersion()){case"multiplesecondary":return new t.MultipleSecondarySynchronizationLogic(e,i,n,a);case"noop":return new t.TwoPlayerSynchronizationLogic(e,i,n,a,t.Mode.NoAdjust);case"allowprimarypause":return new t.TwoPlayerSynchronizationLogic(e,i,n,a,t.Mode.AllowPrimaryPause);case"hybrid":const o=e.isActiveBroadcast()?t.Mode.AllowPrimaryPause:t.Mode.NoPausePrimary;return new t.TwoPlayerSynchronizationLogic(e,i,n,a,o);default:return new t.TwoPlayerSynchronizationLogic(e,i,n,a,t.Mode.NoPausePrimary)}}}t.PlayerSynchronizationLogicFactory=o}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){const t=PanoptoCore.Logging.Logger;let i;!function(e){e[e.Player=0]="Player",e[e.NotReady=1]="NotReady",e[e.Interrupted=2]="Interrupted",e[e.Ended=3]="Ended"}(i=e.FindPrimaryState||(e.FindPrimaryState={}));e.PrimaryTimeline=class{constructor(e){this.actualRelativeEnds={},this.maxSeekablePositionClient=0,this.totalDurationClient=0,this.handleReady=e=>{this.playingStream=e.content,this.updateEdgeValuesFromHlsjs(e.maxSeekablePosition+this.playingStream.relativeStart,e.totalDuration+this.playingStream.relativeStart)},this.handleDurationUpdate=e=>{this.updateEdgeValuesFromHlsjs(e.maxSeekablePosition+this.playingStream.relativeStart,e.totalDuration+this.playingStream.relativeStart)},this.handleDurationFinalized=e=>{const t=e.totalDuration+this.playingStream.relativeStart;this.updateEdgeValuesFromHlsjs(t,t),this.updatePrimaryStreamRelativeEndFromHlsjs(this.playingStream,t)},this.handleProgress=e=>{this.playingPosition=e+this.playingStream.relativeStart},this.handleFinish=()=>{this.updatePrimaryStreamRelativeEndFromHlsjs(this.playingStream,this.playingPosition)},e.onReady&&e.onReady.add(this.handleReady),e.onDurationUpdate&&e.onDurationUpdate.add(this.handleDurationUpdate),e.onDurationFinalized&&e.onDurationFinalized.add(this.handleDurationFinalized),e.onProgress&&e.onProgress.add(this.handleProgress),e.onFinish&&e.onFinish.add(this.handleFinish)}updatePrimaryStreamsFromDeliveryInfo(e){this.streams=_.map(e,(e=>_.clone(e))),this.patchPrimaryStreamsWithActualRelativeEnd(),this.streamAtLive=this.findPrimary(void 0,1/0).stream,0!==this.streamAtLive.relativeEnd?this.serverDeterminedDuration=this.streamAtLive.relativeEnd:this.serverDeterminedDuration=void 0}findPrimary(e,t){let o=_.find(this.primaryStreams,(e=>!e.relativeEnd||t<e.relativeEnd)),n=i.Player;if(o||(o=_.max(this.primaryStreams,(e=>e.relativeEnd||0))),!o.relativeEnd){const a=this.totalDuration-o.relativeStart;if(e>0&&a<=e)return this.findPrimary(void 0,this.totalDuration-e);void 0===e?(t=o.relativeStart,n=0===o.relativeStart?i.NotReady:i.Interrupted):t=Math.clamp(t,o.relativeStart,this.seekableDuration)}return o.relativeEnd>0&&t>=o.relativeEnd&&(t=Math.min(t,o.relativeEnd),n=i.Ended),{stream:o,streamPosition:Math.max(0,t-o.relativeStart),state:n}}get primaryStreams(){return this.streams}get seekableDuration(){let e=this.maxSeekablePositionClient;return this.serverDeterminedDuration&&(e=e?Math.min(e,this.serverDeterminedDuration):this.serverDeterminedDuration),e}get totalDuration(){let e=this.totalDurationClient;return this.serverDeterminedDuration&&(e=e?Math.min(e,this.serverDeterminedDuration):this.serverDeterminedDuration),e}updatePrimaryStreamRelativeEndFromHlsjs(e,t){(0===e.relativeEnd||e.relativeEnd>t)&&(this.actualRelativeEnds[e.id]=t),this.patchPrimaryStreamsWithActualRelativeEnd()}updateEdgeValuesFromHlsjs(e,i){this.playingStream.id===this.streamAtLive.id&&(this.maxSeekablePositionClient>e&&t.warning(`Updating maxSeekablePositionClient to a lower value: ${this.maxSeekablePositionClient} -> ${e}`),this.maxSeekablePositionClient=e,this.totalDurationClient>i&&t.warning(`Updating maxSeekablePositionClient to a lower value: ${this.totalDurationClient} -> ${i}`),this.totalDurationClient=i)}patchPrimaryStreamsWithActualRelativeEnd(){for(const e of this.streams){const t=this.actualRelativeEnds[e.id];t&&(0===e.relativeEnd||e.relativeEnd>t)&&(e.relativeEnd=t)}}}}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.TimelineLogic=class{static isOnTimeline(e,t){let i=_.filter(e,(e=>e<=t));return Boolean(i.length%2)}}}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var i=e.Viewer.Constants,o=e.Viewer.ViewMode;const n=PanoptoCore.Logging.Logger;let a;!function(e){e[e.NoPausePrimary=0]="NoPausePrimary",e[e.AllowPrimaryPause=1]="AllowPrimaryPause",e[e.NoAdjust=2]="NoAdjust"}(a=t.Mode||(t.Mode={}));class r extends t.BasePlayerSynchronizationLogic{constructor(e,t,i,o,r){super(e,t,i,o,r===a.NoAdjust?"Noop":"TwoPlayer"),this.mode=r,1!==o.length&&n.error(`(TwoPlayer) Expected a single secondary container. Received ${o.length}.`),r!==a.NoAdjust&&n.info("(TwoPlayer) "+(r===a.AllowPrimaryPause?"Allow secondaries to catch up by pausing primaries (original)":"Seek secondaries to catch up with primary (new)")),this.secondaryTabControl=o[0].getTabControl()}getDetails(){return`${this.getName()} - ${this.mode}`}prepareForSync(e){this.secondaryTabs=this.secondaryTabControl.getTabs()}doRemediation(e,t,i,o){const n=_.chain(this.secondaryTabs).filter((t=>t.available(e))).last().value();return n?(this.setSecondaryTab(e,n,this.secondaryTabs),this.synchronizeSecondaryTab(e,i,this.secondaryTabControl.selectedTab())):this.clearSecondaryTab(e,i,o,this.secondaryTabs),this.previousDefaultSecondary=n,!0}clearSyncTimeout(){window.clearTimeout(this.synchronizeTimeout),this.synchronizeTimeout=void 0}synchronizeSecondaryTab(e,t,o){var n,r,s,l=0;if(this.mode!==a.NoAdjust||t)if(t||this.wasPrimaryFullscreen&&!this.primaryPlayer.isFullscreen()||this.wasBackgrounded&&"hidden"!==document.visibilityState)this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),t),o.setPosition(e,!0,void 0,(()=>o.playState(this.viewer.playState())));else if(this.primaryPlayer.isFullscreen()||"hidden"===document.visibilityState){const e=!!this.synchronizeTimeout;this.clearSyncTimeout(),e&&this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),t)}else if(this.viewer.playState()===PanoptoViewer.Data.ViewerPlayState.Playing)if((n=(l=o.setPosition(e,!1,void 0,$.noop))?Math.abs(l):0)>i.SecondarySyncThreshold*this.playControls.playSpeed()){const t=l>0;if(t&&this.mode==a.NoPausePrimary)return void(this.primaryPlayer.isFullscreen()||(o.setPosition(e,!0,void 0,$.noop),this.logDesync(l,"seeking secondary",!0)));r=t?this.primaryPlayer:o,s=t?o:this.primaryPlayer,this.logDesync(l,"pausing "+(t?"primary":"secondary"),!0),r.playState(PanoptoViewer.Data.ViewerPlayState.Paused),s.playState(PanoptoViewer.Data.ViewerPlayState.Playing),this.clearSyncTimeout(),this.synchronizeTimeout=setTimeout((()=>{r.playState(PanoptoViewer.Data.ViewerPlayState.Playing),this.clearSyncTimeout()}),1e3*n/this.playControls.playSpeed())}else this.logDesync(l,"delta within tolerance",!1)}logDesync(e,t,i){this.synchronizeTimeout||this.viewer.logDesync(e,this.getName(),t,i)}setSecondaryTab(e,t,i){let n=!1,a=this.secondaryTabControl.selectedTab();a&&!a.available(e)&&(n=!0,a.setSelected(!1,!1)),this.viewer.viewMode(o.Secondary),n=n||!this.previousDefaultSecondary||_.indexOf(i,t)>_.indexOf(i,this.previousDefaultSecondary),n&&(this.secondaryTabControl.selectSecondaryTab(t,!1),this.viewer.resize()),n&&t.pauseWhenAvailable()&&(this.viewer.setPlayState(PanoptoViewer.Data.ViewerPlayState.Paused,!1,!1),this.viewer.setFullscreenPlayer(void 0)),this.secondaryTabControl.updateSecondaryTabEnabledState(!t.hiddenTab(),e),this.viewer.toggleSecondaryPlaceholder(!1)}clearSecondaryTab(e,t,i,a){this.secondaryTabControl.selectSecondaryTab(void 0,!1),this.viewer.ensureSecondaryIsMinimized();let r=this.shouldShowInitialSecondaries(e,i,a),s=this.viewer.hasPendingSecondaryUploads(),l=r||s;this.viewer.viewMode(l?o.Secondary:o.Primary),s&&this.viewer.toggleSecondaryPlaceholder(!0),this.secondaryTabControl.selectSecondaryTab(void 0,t),this.secondaryTabControl.updateSecondaryTabEnabledState(!0,e),this.previousDefaultSecondary&&n.info("Secondary player no longer has a stream to play")}getBlockingOrPausingPosition(e,i,o,n,a){let r,s=_.map(a,(e=>e.content())),l=t.ContentLogic.getBlockingContent(s,e);if(l)r=l.timeline[0];else if(!o){let o=t.ContentLogic.getPausingContent(s,i,e),a=n&&n.content();o&&o!==a&&(r=o.timeline[0])}return r}shouldShowInitialSecondaries(e,t,o){let n=[];_.each(o,(e=>{n=n.concat(e.timeline())})),n.sort(((e,t)=>e-t));let a=_.find(n,(t=>t>e));return!t&&a<i.InitialSecondaryThreshold&&n.length&&n[0]<i.InitialSecondaryThreshold}}t.TwoPlayerSynchronizationLogic=r}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.ViewerEventTabLogic=class{constructor(e,t,i,o,n,a,r){this.delivery=e,this.viewer=t,this.inviteTokenId=i,this.deliveryService=o,this.tagService=n,this.subscriptionService=a,this.userService=r}createTabs(t,i,o){const n=e.Viewer.Tabs.ViewerEventTabHelpers.create(this.viewer,t,i,o),a=[];let r,s,l,d,c;if(this.delivery.isBroadcast||(r=PanoptoLegacy.Viewer.Tabs.SearchTab($("#searchTabHeader"),$("#searchTabPane"),n,this.delivery.id,this.delivery.user,this.inviteTokenId,this.deliveryService),a.push(r)),(this.delivery.description||this.delivery.tags?.length||this.delivery.ownerFullName)&&(s=PanoptoLegacy.Viewer.Tabs.DetailsTab($("#detailsTabHeader"),$("#detailsTabPane"),n,this.delivery.id,this.delivery.title,this.delivery.description,this.delivery.tags,this.delivery.ownerId,this.delivery.ownerFullName,this.delivery.ownerBio,this.deliveryService,this.tagService,this.subscriptionService,this.userService),a.push(s)),Panopto.viewer.isAIEvaluationEnabled&&this.delivery.user.role===Panopto.Data.AclRoleType.Admin&&a.push(PanoptoLegacy.Viewer.Tabs.AIEvalTab($("#aiEvalTabHeader"),$("#aiEvalTabPane"),n,this.delivery.id,this.delivery.aiChapters,this.delivery.aiKeyPoints,this.delivery.aiSummary,this.deliveryService)),(Panopto.viewer.isAISummaryEnabled||!Panopto.viewer.isAIEvaluationEnabled&&(this.delivery.aiKeyPoints||this.delivery.aiSummary))&&a.push(PanoptoLegacy.Viewer.Tabs.AISummaryTab($("#aiSummaryTabHeader"),$("#aiSummaryTabPane"),n,this.delivery.aiKeyPoints,this.delivery.aiSummary,this.deliveryService)),this.delivery.contents.length&&a.push(PanoptoLegacy.Viewer.Tabs.ContentsTab($("#contentsTabHeader"),$("#contentsTabPane"),n,this.delivery.id,this.delivery.contents,this.deliveryService)),this.delivery.hasCaptions&&(d=PanoptoLegacy.Viewer.Tabs.TranscriptTab($("#transcriptTabHeader"),$("#transcriptTabPane"),n,this.delivery,this.inviteTokenId,this.deliveryService),a.push(d)),this.delivery.availableAudioDescriptionLanguages.length>0&&(c=PanoptoLegacy.Viewer.Tabs.AudioDescriptionsTab($("#audioDescriptionsTabHeader"),$("#audioDescriptionsTabPane"),n,this.delivery,this.inviteTokenId,this.delivery.availableAudioDescriptionLanguages,this.deliveryService),a.push(c)),this.delivery.hasAnyLinks&&a.push(PanoptoLegacy.Viewer.Tabs.AttachmentTab($("#attachmentTabHeader"),$("#attachmentTabPane"),n,this.delivery.id,this.inviteTokenId,this.deliveryService)),Panopto.features.areSocialFeaturesEnabled&&this.delivery.discussionEnabled){let e=this.delivery.user.role>Panopto.Data.AclRoleType.Viewer;l=PanoptoLegacy.Viewer.Tabs.CommentsTab($("#commentsTabHeader"),$("#commentsTabPane"),n,this.delivery.id,this.viewer.getSessionId(),this.inviteTokenId,this.delivery.user,this.delivery.isBroadcast,this.delivery.broadcastRefreshInterval,e,this.deliveryService)}return l&&Panopto.viewer.displayViewerDiscussionAboveNotes&&(a.push(l),$("#notesTabHeader").before($("#commentsTabHeader"))),this.delivery.user.key&&Panopto.viewer.notesEnabled&&a.push(PanoptoLegacy.Viewer.Tabs.NotesTab($("#notesTabHeader"),$("#notesTabPane"),n,this.delivery.id,this.inviteTokenId,this.delivery.user,this.delivery.channels,this.delivery.allowPublicNotes,!1,this.delivery.isBroadcast,this.deliveryService)),this.delivery.user.key&&a.push(PanoptoLegacy.Viewer.Tabs.BookmarksTab($("#bookmarksTabHeader"),$("#bookmarksTabPane"),n,this.delivery.id,this.delivery.user,this.delivery.isBroadcast,this.deliveryService)),l&&!Panopto.viewer.displayViewerDiscussionAboveNotes&&a.push(l),{tabs:a,searchTab:r,detailsTab:s,commentsTab:l,captionsTab:d,audioDescriptionsTab:c}}}}(t.Logic||(t.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(t){var i=PanoptoCore.VoidCallback;class o{get onClick(){return this._onClick}get onShowOverlay(){return this._onShowOverlay}constructor(){this._onClick=new i,this._onShowOverlay=new i,this.element=$(o.template),this.playerLayoutControlsElement=this.element.find(".player-layout-controls"),this.showOverlayElement=this.element.find(".show-overlay-button"),this.playerLayoutControlsElement.hide(),Panopto.Core.UI.Handlers.button(this.element,(()=>{this._onClick.fire()})),Panopto.Core.UI.Handlers.hoverable(this.element,(()=>{this.playerLayoutControlsElement.show(),this.setAutoHideTimeout()})),Panopto.Core.UI.Handlers.button(this.showOverlayElement,(()=>{this._onShowOverlay.fire()}))}getElement(){return this.element}toggle({showOrHide:e,allowShowOverlayButton:t}){this.element.toggle(e),this.showOverlayElement.toggle(t)}setAutoHideTimeout(){clearTimeout(this.autoHideTimeout),this.autoHideTimeout=window.setTimeout((()=>{this.playerLayoutControlsElement.is(":hover")||this.playerLayoutControlsElement.hide()}),1e3*e.Constants.FullScreenControlInterval)}}o.template='\n        <div class="audio-only-primary-player-overlay">\n            <div class="player-layout-controls">\n                <div class="show-overlay-button"><i class="material-icons">&#xE145;</i></div>\n            </div>\n            <i class="audio-only-icon material-icons">volume_up</i>\n        </div>',t.AudioOnlyOverlay=o}(e.Players||(e.Players={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.DocumentPlayer=function(e,t,i,o){let n,a;var r,s=function(){a.show(),t.isPdf&&a.addClass("plugin-screen")};if(e.append(_.template($("#documentPlayerTemplate").html())(t)),n=e.find("#"+t.id),a=n.find(".document-frame"),t.isPdf)window.PluginDetect.onDetectionDone(PanoptoTS.Viewer.Constants.PluginDetectPDFReader,(function(e){e.isMinVersion(PanoptoTS.Viewer.Constants.PluginDetectPDFReader,0)<0?n.find(".adobe-reader-install").show():(s(),a.attr("src",t.url))}),PanoptoTS.Viewer.Constants.DummyPDFUrl,!0);else if(t.isQuiz&&Panopto.viewer.enableReactQuiz){const e=PanoptoQuiz.parseQuizModeAndId(t.url),i=PanoptoQuiz.parseQuizParams(t.url);PanoptoReactComponents.bootstrapReactComponent(PanoptoQuiz.QuizController)(n[0],{quizResultsController:PanoptoTS.Viewer.QuizResultsController.getInstance(),editableQuizService:o,...e,...i,resources:Panopto.GlobalResources}),a.remove()}else s();return(r=Panopto.Viewer.Players.PlayerBase(e,n)).resize=function(t,i){e.width(t),e.height(i),n.width(t-2),n.height(i-1)},r.remove=function(){n.remove()},r.toggle=function(e){var o=e?t.url:"";n.toggle(e),a.attr("src")!==o&&(a.attr("src",o),e&&-1!==t.url.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl)&&PanoptoViewer.ensureYouTubeIframeApiIsReady((()=>{new YT.Player(t.id+"frame",{events:{onStateChange:e=>{0===e.data&&i.togglePlaying()}}})})))},r},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Players.PlayerBase=function(e,t){var i=PanoptoTS.Viewer.Constants;return{container:function(){return e},width:function(){return t.width()},height:function(){return t.height()},toggle:function(e){t.toggle(e)},resize:function(o,n,a,r){o=o-parseInt(e.css("border-left-width"),10)||o,n=n-parseInt(e.css("border-bottom-width"),10)||n,a=void 0!==a?a:t.width()/t.height();var s=o/n;let l=o,d=n;t.add(e).css({left:"",position:""}),isNaN(a)?(l=o=Math.max(o,i.AudioOnlyMinimumWidth),r&&(0===n?e.css({left:-l+"px",position:"absolute"}):t.css({left:-l/2+"px"})),d=n=Math.max(n,i.AudioOnlyMinimumWidth)):s<=a?(l=Math.max(o,i.AudioOnlyMinimumWidth),d=Math.max(o/a,i.AudioOnlyMinimumWidth)):(d=Math.max(n,i.AudioOnlyMinimumWidth),l=Math.max(n*a,i.AudioOnlyMinimumWidth)),t.width(l),t.height(d),t.css({"margin-top":-d/2+"px","margin-left":-l/2+"px"}),e.width(o),e.height(n)},content:function(e){},setContent:function(e){},playState:function(e){},position:function(e){},setPosition:function(e){},setStartPosition:function(e){},bitrate:function(e){},playSpeed:function(e){},numericBitrate:function(){return 0},hasMBR:function(){return!1},bitrateLevelOffset:function(){return 0},remove:function(){}}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.PrimaryPlayer=function(e,t,i,o,n,a,r){let s=PanoptoCore.Logging.Logger;var l,d,c,p=PanoptoLegacy.Viewer.Players.StreamPlayer(e,t,i,!0,o),u=p,h=Panopto.Core.Extensions.base(p),m=0;let v;var P=!0;let g;const y={};let f=0;var S,C,w,b,T=function(e,t,i){var o=Panopto.Core.StringHelpers.parseQueryString(e.url.slice(e.url.indexOf("?")+1));d=e,b||(b=Panopto.Core.Analytics.PlaybackLogger(p,o.InvocationID,Panopto.Core.ServiceInterface.AnalyticsIngest.addStreamRequests,{onSpanUpdateBlocked:r})).start(),e.isAudioOnly?a.toggle({showOrHide:!0,allowShowOverlayButton:!1}):a.toggle({showOrHide:!1,allowShowOverlayButton:!1}),h.content(d,t,(function(){d.isBroadcast&&S&&S(),i&&i()}))},E=function(e){let t=_.find(l,(function(t){return(e<t.relativeEnd||!t.relativeEnd)&&!t.interrupted}));return t||(t=_.max(l,(e=>e.relativeEnd))),t};return u.setPrimaryContent=function(e,t,i,o){f>0&&_.chain(e).filter((e=>0===e.relativeEnd)).forEach((e=>{e.id in y&&(0!==e.relativeEnd?(delete y[e.id],f--):(e.relativeEnd=y[e.id],s.info(`Primary player with stream id ${e.id} had its relative end patched to ${e.relativeEnd}`)))})),l=e,d&&(d=_.find(e,(function(e){return e.id===d.id}))),f>0&&(t=E(p.position())),!d&&t.isBroadcast&&h.position(1/0),d&&!i||T(d||t,i,o)},u.content=u.setPrimaryContent,u.setPosition=function(e,t){var i,o,n,a=function(){S&&S()};if(void 0===e)return i=h.position(),o=d.relativeEnd,n=E(o),o&&d.relativeStart+i>=o&&n.id!==d.id&&(T(n,!1,null),h.position(o-n.relativeStart),u.setPlayStateWithLogging(PanoptoViewer.Data.ViewerPlayState.Playing,!0)),i+d.relativeStart;(n=E(e)).id!==d.id&&T(n,!1,null),d.isBroadcast&&!P&&e&&e!==g&&e!==1/0&&e>=m-PanoptoTS.Viewer.Constants.LivePositionTolerance?u.setIsLive(!0,t):(e-=d.relativeStart,h.position(e,(function(){a(),t&&t()})),a())},u.position=u.setPosition,u.setIsLive=function(e,t){if(void 0===e)return P||p.position()>=m-PanoptoTS.Viewer.Constants.LivePositionTolerance;e&&!P?(v&&window.clearInterval(v),p.setPosition(g||1/0,t),p.playState(PanoptoViewer.Data.ViewerPlayState.Playing),P=!0):!e&&P&&(m=g||p.position(),v=window.setInterval((function(){g&&m>=g?window.clearInterval(v):m+=PanoptoTS.Viewer.Constants.TimedSyncRate/1e3}),PanoptoTS.Viewer.Constants.TimedSyncRate),P=!1)},u.isLive=u.setIsLive,u.updateMaxPosition=function(e){e||P||(P=!0,u.setIsLive(!1)),g=e,g&&m>g&&(m=g)},p.streamLength=function(){return d.isBroadcast?P?p.position():m:h.streamLength()},p.ended=function(){var e=E(d.relativeEnd),t=h.ended(),i=null;return t&&d.isBroadcast&&0===d.relativeEnd&&(y[d.id]=h.streamLength()+d.relativeStart,f++,d.relativeEnd=y[d.id],i=y[d.id],e=E(d.relativeEnd),s.info(`Ended: Primary player with stream id ${d.id} had its relative end patched to ${y[d.id]}`)),t&&e.id!==d.id?(t=!1,p.setPosition(i||d.relativeEnd),p.playState(PanoptoViewer.Data.ViewerPlayState.Playing)):g&&p.position()>=g&&(t=!0),t&&d.isBroadcast&&(P=!0),t&&w&&w(void 0,PanoptoViewer.Data.ViewerPlayState.Stopped),t},u.isEndedBy=p.ended,u.activePrimary=function(){return d},u.onSeek=function(e){S=e},u.offSeek=function(){S=void 0},u.onSpeedChange=function(e){C=e},u.offSpeedChange=function(){C=void 0},u.onPlayStateChangeLog=function(e){w=e},u.offPlayStateChangeLog=function(){w=void 0},p.playSpeed=function(e){var t=h.playSpeed();if(void 0===e)return t;h.playSpeed(e),e!==t&&C&&C()},u.playState=function(e,t){h.playState(e),t&&e!==c&&w&&w(c,e),c=e},u.setPlayStateWithLogging=p.playState,u.streamId=function(){return d.id},u},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.PrimarySegmentPlayer=function(e,t,i,o,n,a){const r=PanoptoCore.Logging.Logger;var s,l,d,c,p,u,h,m=PanoptoLegacy.Viewer.Players.StreamPlayer(e,t,i,!0,o),v=m,P=Panopto.Core.Extensions.base(m),g=!1,y=$("#primaryTabHeaders"),f=[],S=function(e){let t;return h&&(t=_.find(e.element.streams(),(function(e){return e.stream.id===h}))),t=t||_.find(e.element.streams(),(function(e){return e.stream.isPrimary})),t},C=function(e,t){var i=_.find(s,(function(t){return t.start<=e&&t.end>e}));if(t&&i&&i.start<c.start&&(i=c),i&&i!==c){const t=S(i);if(t){const o=t.stream.url!==p.stream.url||t.stream.vrType!==p.stream.vrType||t.offset!==p.offset;p=t,c=i,_.each(f,(function(t){t.available(e)})),o&&(w(_.find(f,(function(e){return e.id()===p.stream.id}))),v.setPrimaryContent(void 0,p.stream,void 0,void 0),r.verbose(`[PrimarySegmentPlayer] Choosing segment ${p.stream.id}, seeking to ${e}`),m.setPosition(e),P.playState(u))}else(i=_.find(l,(function(t){return t.start>e})))?m.setPosition(i.start):g=!0}},w=function(e){e&&(_.each(f,(function(t){t!==e&&t.selected(!1)})),e.selected(!0),h=e.id())};return v.setPrimaryContent=function(e,t,i,o){t.isAudioOnly?a.toggle({showOrHide:!0,allowShowOverlayButton:!0}):a.toggle({showOrHide:!1,allowShowOverlayButton:!0}),P.content(t)},v.content=v.setPrimaryContent,v.setSegments=function(e,t,i,a){var r=[],g=s?m.position():0,b="primary";s=e,l=t,d=i,c?C(g,void 0):(c=l[0],p=S(c),v.setPrimaryContent(void 0,p.stream,void 0,void 0)),a&&(r=_.chain(l).map((function(e){return e.element.streams()})).flatten().map((function(e){return e.stream})).filter((function(e){return e.isPrimary})).map((function(e){return e.id})).uniq().value()),y.empty(),f.length=0,r.length<2?h=void 0:(_.each(r,(function(e){if(n.getStream(e)){var t,i=[],o=!1;_.each(l,(function(n){(t=n.element.getStreamById(e))?o||(i.push(n.start),o=!0):o&&(i.push(n.start),o=!1)})),y.append(_.template($("#playerTabHeaderTemplate").html())({content:{id:e,title:n.getStreamName(void 0,e),tabClass:n.getStreamIconClass(void 0,e)},type:b,tabindex:0})),f.push(Panopto.Viewer.Tabs.PlayerTabHeader(y.find("#"+b+e),e,i,!0,t&&t.stream?PanoptoTS.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(t.stream):Panopto.Core.Constants.ObjectVideoIconCode))}})),Panopto.Core.UI.Handlers.button(y.find("."+PanoptoTS.Viewer.Constants.PrimaryTabHeaderClass),(function(e){var t=_.find(f,(function(t){return t.owns(e)})),i=m.position();t&&("number"==typeof t.seekTime()&&(i=t.seekTime(),o.setPosition(i)),w(t),p=S(c),v.setPrimaryContent(void 0,p.stream,void 0,void 0),m.setPosition(i),P.playState(u))})),_.each(f,(function(e){e.available(g)})),w(h?_.find(f,(function(e){return e.id()===h})):_.find(f,(function(e){return e.id()===p.stream.id}))))},v.activePrimary=function(){return p?p.stream:void 0},m.playState=function(e){u=e,P.playState(e)},v.setPlayStateWithLogging=m.playState,m.position=function(e){if(c){if(void 0!==e){g=!1,C(e,void 0);const t=e-c.start+p.offset/Panopto.Core.Constants.TimelineChunkMultiplier;P.position(t)}else e=P.position()+c.start-p.offset/Panopto.Core.Constants.TimelineChunkMultiplier,C(e,!0);const t=_.filter(f,(t=>t.available(e)));return y.toggle(t.length>1),e}return P.position(e)},m.setPosition=m.position,m.streamLength=function(){return l?d:P.streamLength()},m.ended=function(e){var t=P.ended();return t&&c!==_.last(l)?(t=!1,m.setPosition(c.end)):e===d&&(g=!0),g||P.ended()},v.isEndedBy=m.ended,v},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.SecondaryStreamPlayer=function(e,t,i){var o,n,a,r,s,l,d=PanoptoTS.Viewer.Constants,c=!1;e.append(_.template($("#streamPlayerTemplate").html())),a=e.find("#secondaryScreen"),o=PanoptoLegacy.Viewer.Players.StreamPlayer(e,a,t,!1,i),n=Panopto.Core.Extensions.base(o);var p=function(e,t){return e-t.relativeStart+t.streamOffset},u=function(e){let t,i;return r.segments&&r.segments.length?(t=_.find(r.segments,(function(t){return e>=t.timelineStart&&e<t.relativeEnd})),t=t||(e<r.segments[0].timelineStart?r.segments[0]:r.segments[r.segments.length-1]),i=p(e,t)):i=e-r.relativeStart,{segment:t,offset:i}};return o.content=function(e,t,i){if(void 0===e)return r;{r=e;const a=void 0!==l;if(a){var o=u(l);n.setStartPosition(o.offset+d.SecondaryStreamOffset)}n.setContent(e,t,i),a&&(n.setStartPosition(void 0),l=void 0)}},o.setContent=o.content,o.position=function(e,t,i,a){var l=t;const c=u(e);if(c.segment){if(!t&&c.segment!==s){const t=p(e,s);i=l=c.offset-t>d.ContiguousSegmentThreshold}s=c.segment}if(!l)return o.ended(c.offset)?0:c.offset-n.position();{let e=c.offset+(i?d.SecondaryStreamOffset:0),t=n.position();i||t!==c.offset+d.SecondaryStreamOffset||(e=t),n.setPosition(r.length?Math.clamp(e,0,r.length):Math.max(0,e),a)}},o.setSecondaryPosition=o.position,o.setStartPosition=function(e){l=e},o.toggle=function(e){c=e,a.toggleClass("hidden-screen",!e)},o.minimizeIfHidden=function(){c||n.setIsFullscreen(!1)},o.ended=function(e){var t=n.streamLength();return n.ended()||!(!t||r.isBroadcast)&&e>=t-d.EndPositionThreshold},o},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.SlidePlayer=function(e,t,i){var o,n,a,r,s,l=PanoptoTS.Viewer.Constants,d=1;return e.append(_.template($("#slidePlayerTemplate").html())({id:t.id})),o=e.find("#"+t.id+"-image"),n=e.find("#"+t.id+"-buffer"),r=Panopto.Viewer.Players.PlayerBase(e,o),s=Panopto.Core.Extensions.base(r),r.resize=function(e,t){s.resize(e,t,d)},r.position=function(e,r){!function(e){var r,s=_.last(_.filter(t.slides,(function(t){return t.time<=e})));(s=s||t.slides[0])&&s!==a&&(r=s.url||l.SlideImageUrl+"?"+Panopto.Core.StringHelpers.serializeObjectToQueryString(s.queryParams),Panopto.Core.ImageHelpers.bufferAndReplaceImageUrl(o,n,r,(function(e){d=e.width/e.height||0})),o.unbind("load").on("load",(function(){i.resize()})),a=s)}(e),r&&r()},r.setPosition=r.position,r.remove=function(){o.remove(),n.remove()},r},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.StreamPlayer=function(e,t,i,o,n){let a=PanoptoCore.Logging.Logger;var r=PanoptoTS.Viewer.Constants,s=Panopto.Viewer.Players.PlayerBase(e,t),l=Panopto.Core.Extensions.base(s);const d=i.create(o,t);var c,p,u,h,m=PanoptoTS.Viewer.Constants.InitialVolume,v=!1,P=o?"Primary":"Secondary",g=0,y=PanoptoViewer.PlaySpeed.Normal;return h=d.onReady?d.onReady:$.Deferred().resolve(),s.resize=function(i,o){var n;try{n=d.width()/d.height()}catch(e){}const a=PanoptoCore.Browser.isSafari||d.canMoveAudioPlayerOffscreen&&d.canMoveAudioPlayerOffscreen();l.resize(i,o,n,a),d.showShadow(e.height()===t.height())},s.content=function(e,t,i){d.content(e,t,i)},s.setContent=s.content,s.playState=function(e){d.playState(e),u!==e&&(g=d.position(),a.info(`${P} player changed play state to ${e}`)),u=e},s.position=function(e,t){if(void 0===e)return e=Math.max(d.position()||0,0),c&&e===c&&e!==g&&u===PanoptoViewer.Data.ViewerPlayState.Playing?e+=Math.min(y*((new Date).getTime()-p),r.MaxPositionInterpolation)/1e3:(c=e,p=(new Date).getTime()),e;d.position(e,t),g=e,a.info(`${P} player set position to ${e}`)},s.setPosition=s.position,s.setStartPosition=function(e){d.setStartPosition&&d.setStartPosition(e)},s.bitrate=function(e){d.bitrate(e)},s.numericBitrate=function(){return d.numericBitrate()},s.hasMBR=function(){return d.bitrateOptions().length>1},s.bitrateLevelOffset=function(){var e=d.bitrateOptions();return e.indexOf(d.numericBitrate())+1-e.length},s.playSpeed=function(e){if(void 0===e)return y;d.playSpeed(e),y!==e&&a.info(`${P} player changed playback speed to ${e}`),y=e},s.getCaptionControl=function(){return d},s.getFullscreenStateControl=function(){return d},s.volume=function(e){if(void 0===e)return v?0:m;0!==e?(d.volume(e),m=e,s.muted(!1)):s.muted(!0)},s.setVolume=s.volume,s.muted=function(e){if(void 0===e)return v;d.muted(e),v=e},s.isMuted=s.muted,s.width=function(){try{return d.width()}catch(e){return t.width()}},s.height=function(){try{return d.height()}catch(e){return t.height()}},s.streamLength=function(){return d.streamLength()},s.ended=function(){return d.ended()},s.isFullscreen=function(e){return d.isFullscreen(e)},s.setIsFullscreen=s.isFullscreen,s.optimizationProvider=function(){return d.optimizationProvider?d.optimizationProvider():void 0},s.onReady=h,s},(Panopto=Panopto||{}).UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Players.ThumbnailPlayer=function(e,t,i){var o=Panopto.Viewer.Analytics,n=Panopto.Viewer.Players.PlayerBase(a),a=$("#thumbnailList"),r=$("#toggleThumbnailsButton"),s=$("#toggleThumbnailsButtonIcon"),l=Panopto.Viewer.Controls.ThumbnailStrip(a,e,t,i),d=!1;return Panopto.Core.UI.Handlers.button(r,(function(){var e;(e=void 0===(e=void 0)?!a.is(":visible"):e)?(s.text("keyboard_arrow_down"),a.slideDown({step:function(){t.resize&&t.resize()},complete:function(){d=!1,n.position(t.position(),!0)}}),r.attr(Panopto.Core.Constants.AriaExpandedAttribute,(!0).toString()),o.sendEvent({action:o.Actions.ShowThumbnails,label:o.Labels.Normal})):(d=!0,s.text("keyboard_arrow_up"),r.attr(Panopto.Core.Constants.AriaExpandedAttribute,(!1).toString()),a.slideUp({step:function(){t.resize&&t.resize()}}),o.sendEvent({action:o.Actions.HideThumbnails,label:o.Labels.Normal}))})),r.add(a).toggle(e.length>0&&!i),l.render(),n.toggle=function(e){l.toggle(e)},n.resize=function(e,t){},n.position=function(e,t){d||l.position(e,t)},n.setPosition=n.position,n.thumbnails=function(e){if(!e)return l.thumbnails();l.thumbnails(i?_.filter(e,(function(e){return!(e.isDefaultThumbnail||e.link||e.type!==Panopto.Core.EventType.Label&&e.type!==Panopto.Core.EventType.SmartOcrToc&&e.type!==Panopto.Core.EventType.SlideChange)})):e)},n},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Hive=function(e){const t=PanoptoCore.Logging.Logger;var i=function(e){return Panopto.viewer.isHiveEnabled&&e&&!Panopto.viewer.isKollectiveEnabled&&"undefined"!=typeof hive},o=function(e,i){return{onError:function(o){var n,a=i.hiveTechOrder.indexOf(e);return-1!==a&&(n=a<i.hiveTechOrder.length?PanoptoTS.StringHelpers.format("{0} failed with message: {1}. Falling through to next tech {2} ",e,o.message,i.hiveTechOrder[a+1]):PanoptoTS.StringHelpers.format("{0} failed with message: {1}. End of tech stack falling back to source",e,o.message),t.warning(n)),!0},onActiveSession:function(i){t.info(PanoptoTS.StringHelpers.format("Session activated with tech {0}, sessionDetails:",e)+i)}}};return e.isHiveOptimized=i,e.createFlowplayerPlugin=function(e,t){var n={};if(i(e.optimizationToken)){var a={playerName:"Panopto"};a.playerVersion=Panopto.viewer.hivePlayerVersion,a.hiveTechOrder=Panopto.viewer.hiveFlowplayerPluginTechOrder.split(",").map((function(e){return e.trim()}));var r=a.hiveTechOrder.indexOf("HiveJava");t||-1===r||a.hiveTechOrder.splice(r,1),a.HiveJava=o("HiveJava",a),a.HiveJS=o("HiveJS",a),a.StatsJS=o("StatsJS",a),n={sources:[{type:"application/x-mpegurl",ticket:e.optimizationToken}],options:a}}return n},e.attachFlowplayerHlsJsConfig=function(e,t){i(e.optimizationToken)&&(t.xhrSetup||(t.xhrSetup=function(){}))},e.getHiveSourceForReload=function(e,t){return e.off("stop.hiveStop"),e.off("finish.hiveFinish"),[{type:"application/x-mpegurl",ticket:t.optimizationToken}]},e.loadHiveTicket=function(e,i,o,n,a){e.closeHiveSession(),e.load(i,o,(function(e){t.info(PanoptoTS.StringHelpers.format("Hive to load ticket: {0} reasons: ",i[0].ticket)+e),t.info(PanoptoTS.StringHelpers.format("Falling back to source {0}",n.clip.sources[0].src)),a(n,o)}))},e.addCloseHiveSessionToStopAndFinish=function(e){e.one("stop.hiveStop",(function(){e.off("finish.hiveFinish"),e.closeHiveSession()})),e.one("finish.hiveFinish",(function(){e.off("stop.hiveStop"),e.closeHiveSession()}))},e}(Panopto.Viewer.Hive||{}),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.AIEvalTab=function(e,t,i,o,n,a,r,s){const l=Panopto.AIEvaluationTab(document.getElementById("aiEvalTab"),{isVisible:!1,deliveryId:o,aiChapters:n,aiKeyPoints:a,aiSummary:r}),d=PanoptoLegacy.Viewer.Tabs.EventTab(e,t,i,void 0,[],void 0,!1,void 0,void 0,s);return d.onSelectChangeRendered=({selected:e})=>l.setProps({isVisible:e}),d},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.AISummaryTab=function(e,t,i,o,n,a){Panopto.AISummaryTab(document.getElementById("aiSummaryTab"),{isEmbed:!1,keyPoints:o,summary:n,resources:Panopto.GlobalResources});return PanoptoLegacy.Viewer.Tabs.EventTab(e,t,i,void 0,[],void 0,!1,void 0,void 0,a)},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.AttachmentTab=function(e,t,i,o,n,a){const r=[],s=_.template('\n        <a id="slidesDownload"\n            class="slide-download-link"\n            title="<@- fileName @>"\n            href="<@- slideDownloadHref @>"\n        >\n            <i class="material-icons md-24">file_download</i>\n            <span><@- fileName @></span>\n        </a>\n    '),l=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o,r,PanoptoViewer.EventType.None,!1,Panopto.Viewer.Analytics.Labels.Attachment,n,a);l.render(r,!0,void 0,void 0,void 0);return function(){const e=t.find("#slideDownloadContainer"),i=function(e){const t={id:o,tid:n,sdid:e};return Panopto.Core.StringHelpers.addQueryParameter(`${Panopto.uriScheme}://${Panopto.webServerFQDN}${Panopto.appRoot}/Handlers/SlideDeckDownload.ashx`,t)},a=$.Deferred();Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(o,(e=>{a.resolve(e)}),(()=>{a.reject()})),a.then((t=>{t.filter((e=>e.isDownloadAllowed)).forEach((t=>function(t,o){const n=$(s({slideDownloadHref:i(t),fileName:o}));e.append(n)}(t.id,t.name)))}))}(),l},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.AudioDescriptionsTab=function(e,t,i,o,n,a,r){let s;const l=t.find("#audioDescriptionsPaneHeader");if(a.length<=1)l.hide();else{const e=Panopto.LanguageSelector(l[0],{availableCaptions:a.map(PanoptoReactComponents.Helpers.createCaptionInfoFromLanguage),selectedLanguage:PanoptoViewer.Language.getCurrentADLanguage(),showOnlyAvailableLanguages:!0,onLanguageSelected:e=>{PanoptoViewer.Language.setCurrentADLanguage(e),d.fetch()}});PanoptoViewer.Language.addLanguageEventListener("currentaudiodescription",(()=>{e.setProps({selectedLanguage:PanoptoViewer.Language.getCurrentADLanguage()})}))}var d=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o.id,[],PanoptoViewer.EventType.Transcript,!0,Panopto.Viewer.Analytics.Labels.Transcript,n,r);const c=Panopto.Core.Extensions.base(d);return d.fetch=function(){d.toggleLoading(!0);const e=PanoptoViewer.Language.getCurrentADLanguage();void 0!==e&&s!==e&&(s=e,PanoptoViewer.Services.getAudioDescriptions(o.id,n,e).then((t=>{o.audioDescriptions=_.map(t,(t=>{const i=new PanoptoTS.Viewer.Data.Event(t);return i.language=e,i})),d.render(o.audioDescriptions,!0,!1,!1,!1),d.error(!1),d.toggleLoading(!1),i.synchronize(!0)})).catch((()=>{s=void 0,d.fetchError(void 0,void 0,void 0,void 0),d.toggleLoading(!1)})))},d.seekToEvent=function(e){c.seekToEvent(e),i.isAudioDescriptionsSelected()&&i.togglePlayState(!0)},d.resize=function(e,t){c.resize(e,t-(l.outerHeight()||0))},d.fetch(),d},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.BookmarksTab=function(e,t,i,o,n,a,r){var s=!1,l=PanoptoLegacy.Viewer.Tabs.EditableEventTab(e,t,i,o,[],PanoptoViewer.EventType.Bookmark,!1,n,Panopto.GlobalResources.ViewerPlus_CreateBookmark,Panopto.GlobalResources.ViewerPlus_CreateBookmark_None,Panopto.GlobalResources.ViewerPlus_Bookmarks_SignIn,Panopto.Viewer.Analytics.Labels.Bookmark,void 0,void 0,a,r),d=Panopto.Core.Extensions.base(l),c=t.find(".event-input");return l.selected=function(e){return void 0!==e&&e&&!s&&(c.hide(),l.fetch(),s=!0),PanoptoCore.Browser.inIframe()&&!Panopto.viewer.linksEnabledInIframe&&$("#allBookmarksLink").hide(),d.selected(e)},l.render=function(e,t,i,o,a){s&&n.key&&c.show(),d.render(e,t,i,o,a)},l},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.CommentsTab=function(e,t,i,o,n,a,r,s,l,d,c){let p,u=[];var h=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o,[],PanoptoViewer.EventType.Comment,!1,Panopto.Viewer.Analytics.Labels.Comment,a,c),m=h;return h.render=function(){p||(p=Panopto.ThreadedComments(document.getElementById("threadedComments"),{sessionId:n,deliveryId:o,commentPollingInterval:l,userKey:Panopto.user.userKey,userFullName:Panopto.user.fullNameOrKey,inviteTokenId:a,isBroadcast:s,isTimeShifted:!1,isDiscussionDownloadAllowed:d,tabId:"threadedCommentsTab",paneId:"threadedCommentsPane",selected:!0,isAuthenticated:Panopto.user.isAuthenticated,loginUrl:Panopto.loginUrl,sessionsService:Panopto.Core.ServiceInterface.Rest.Sessions,resources:Panopto.GlobalResources,onAddPositionListener:e=>{u.push(e),e(i.position())},onRemovePositionListener:e=>{u=u.filter((t=>t!==e))},onContentRowTimeClick:h.seekToEvent}))},h.position=function(e){s&&i.isActiveBroadcast()&&i.isLive();u.forEach((t=>t(e)))},m.toggleBroadcastIsLiveOrEnded=function(e){p?.setProps({isTimeShifted:!e})},m.render([],!1,!1,!1,!1),h.error(!1),h.toggleLoading(!1),m},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.ContentsTab=function(e,t,i,o,n,a){var r=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o,[],PanoptoViewer.EventType.Slide,!0,Panopto.Viewer.Analytics.Labels.Content,void 0,a);return r.render(n,!0,void 0,void 0,void 0),r},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.DetailsTab=function(e,t,i,o,n,a,r,s,l,d,c,p,u,h){const m=Panopto.features.tagsEnabled?PanoptoTS.Viewer.Data.TagHelper.convertDeliveryToModel(r):[],v=!PanoptoCore.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe,P=Panopto.DetailsTab(document.getElementById("detailsTab"),{isVisible:!1,sessionId:o,name:n,description:a,tags:m,ownerId:s,ownerFullName:l,ownerBio:d,linkify:v,tagsEnabled:Panopto.features.tagsEnabled,tagService:p,subscriptionsEnabled:Panopto.features.subscriptionsEnabled,subscriptionService:u,userService:h,resources:Panopto.GlobalResources});var g=PanoptoLegacy.Viewer.Tabs.EventTab(e,t,i,void 0,[],void 0,!1,void 0,void 0,c);return g.onSelectChangeRendered=({selected:e})=>P.setProps({isVisible:e}),g},(Panopto=Panopto||{}).Core=Panopto.Core||{},Panopto.Core.Key=Panopto.Core.Key||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Input=Panopto.UI.Input||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.EditableEventTab=function(e,t,i,o,n,a,r,s,l,d,c,p,u,h,m,v){var P,g,y=PanoptoTS.Viewer.Constants,f=Panopto.Viewer.Analytics,S=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o,n,a,r,p,u,v),C=S,w=Panopto.Core.Extensions.base(S);t.append(_.template($("#eventTabInputTemplate").html())({}));var b,T=t.find(".event-input"),E=t.find(".cancel-editing"),V="editing",I=0,R=T.height();C.updatePlaceholderText=function(){T.attr("placeholder",b||(n.length?l:d)),T.attr("aria-label",l)};var D=function(e){e?(P=e,t.find("#"+e.id).toggleClass(V,!0),T.val(e.text).focus().select(),L(void 0),E.show(),T.prop("disabled",!1).toggleClass(V,!0)):(P&&(t.find("#"+P.id).toggleClass(V,!1),E.hide(),T.toggleClass(V,!1)),P=void 0,T.val(""),L(R),C.updatePlaceholderText(),g=void 0,b&&T.prop("disabled",!0))},k=function(e,i,o,n){var a=t.find("#"+e.id),r=a.find(".event-error");r.find(".event-error-message").text(i),Panopto.Core.UI.Handlers.button(r.find(".event-error-retry"),o),Panopto.Core.UI.Handlers.button(r.find(".event-error-cancel"),n),a.toggleClass("errored",!0)};C.wireUpEditMenu=function(e){var i=t.find("#"+e.id),o=new PanoptoTS.Viewer.Controls.EditEventMenu(i,i.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0});o.editCallbacks.add((e=>{C.editEventClicked(e)})),o.deleteCallbacks.add((e=>{C.deleteEventClicked(e)})),o.setEvent(e,{canEdit:e.editable,canDelete:e.deletable})},C.editEventClicked=function(e){D(!1),D(e)},C.deleteEventClicked=function(e){e.saved=!1,S.render([e],!1,void 0,void 0,void 0),C.deleteEvent(e)};var L=function(e){var t=T.innerHeight()-T.height();T.height(1);var i=T[0].scrollHeight,o=e||i-t;T.height(o)};if(s.key)T.keyup((function(){var e=jQuery.trim(T.val());e&&void 0===g?g=C.getEventTime():e||(g=void 0)})),T.on("paste input",(function(){L(void 0)})),T.keydown((function(e){e.ctrlKey&&e.keyCode===Panopto.Core.Key.UpArrow||(e.stopPropagation(),e.keyCode!==Panopto.Core.Key.Enter||e.shiftKey?e.keyCode===Panopto.Core.Key.Esc&&C.resetInput():(e.preventDefault(),void 0===g&&T.keyup(),C.submitEvent(void 0)))})),Panopto.Core.UI.Handlers.button(E,(function(){D(!1)})),l&&C.updatePlaceholderText();else{T.hide();var x=_.template($("#eventTabSignInTemplate").html());Panopto.features.usePanoptoState?Panopto.Application.setPanoptoState(window.location.href).then((e=>{t.find(".event-signin").html(PanoptoTS.StringHelpers.format(c,x({url:PanoptoTS.StringHelpers.format("{0}?panoptoState={1}",Panopto.loginUrl,e?.panoptoStateId),text:Panopto.GlobalResources.ViewerPlus_EventTab_SignIn}))).show()})):t.find(".event-signin").html(PanoptoTS.StringHelpers.format(c,x({url:PanoptoTS.StringHelpers.format("{0}?ReturnUrl={1}",Panopto.loginUrl,encodeURIComponent(window.location.href)),text:Panopto.GlobalResources.ViewerPlus_EventTab_SignIn}))).show()}return S.resize=function(e,t){var i=T.is(":visible")?T.outerHeight(!0):0;E.is(":visible")&&(i+=E.outerHeight(!0)),T.width(e-y.InputMargin),w.resize(e,t-i)},S.render=function(e,t){s.key&&_.each(e,(function(e){e.editable=e.saved&&e.user===s.key,e.deletable=e.saved&&(e.editable||s.role>Panopto.Data.AclRoleType.Viewer)})),h&&_.each(e,(function(e){delete e.time})),w.render(e,t),C.updatePlaceholderText(),i.resize()},S.afterRenderItem=function(e,t,i){w.afterRenderItem(e,t,i),(e.editable||e.deletable)&&C.wireUpEditMenu(e)},S.remove=function(e){w.remove(e),C.updatePlaceholderText()},C.addEvent=function(e,t,i,n){v.createEvent(o,a,e.text,t,!h,i,m,(function(t){e.eventId=t.EventID,e.eventPublicId=t.PublicId,e.sessionId=t.SessionId,e.saved=!0,S.render([e],!1,void 0,void 0,void 0),S.toggleLoading(!1),f.sendEvent({action:f.Actions.Add.Success,label:p}),n&&n()}),(function(){k(e,Panopto.GlobalResources.ViewerPlus_EventTab_AddError,(function(){C.addEvent(e,t,i,n),f.sendEvent({action:f.Actions.Add.Retry,label:p})}),(function(){S.remove([e]),f.sendEvent({action:f.Actions.Add.Cancel,label:p})})),S.toggleLoading(!1),f.sendEvent({action:f.Actions.Add.Error,label:p}),n&&n()}))},C.editEvent=function(e,t,i){v.editEvent(e.sessionId,e.type||a,e.eventPublicId,e.text,(function(){e.saved=!0,S.render([e],!1,void 0,void 0,void 0),S.toggleLoading(!1),f.sendEvent({action:f.Actions.Edit.Success,label:p}),i&&i()}),(function(){k(e,Panopto.GlobalResources.ViewerPlus_EventTab_EditError,(function(){C.editEvent(e,t,i),f.sendEvent({action:f.Actions.Edit.Retry,label:p})}),(function(){e.text=t,e.saved=!0,S.render([e],!1,void 0,void 0,void 0),f.sendEvent({action:f.Actions.Edit.Cancel,label:p})})),S.toggleLoading(!1),f.sendEvent({action:f.Actions.Edit.Error,label:p}),i&&i()}))},C.deleteEvent=function(e,t){S.toggleLoading(!0),v.deleteEvent(e.sessionId,e.type||a,e.eventPublicId,(function(){e===P&&D(!1),S.remove([e]),S.toggleLoading(!1),f.sendEvent({action:f.Actions.Delete.Success,label:p}),t&&t()}),(function(){k(e,Panopto.GlobalResources.ViewerPlus_EventTab_DeleteError,(function(){C.deleteEvent(e,t),f.sendEvent({action:f.Actions.Delete.Retry,label:p})}),(function(){e.saved=!0,C.render([e],!1,void 0,void 0,void 0),f.sendEvent({action:f.Actions.Delete.Cancel,label:p})})),S.toggleLoading(!1),f.sendEvent({action:f.Actions.Delete.Error,label:p}),t&&t()}))},C.submitEvent=function(e){var t,i,o=jQuery.trim(T.val());o&&(T.val(""),L(R),S.toggleLoading(!0),P?(t=P,D(!1),i=t.text,t.text=o,t.saved=!1,S.render([t],!1,void 0,void 0,void 0),C.editEvent(t,i)):C.saveNewEvent(o,g,e))},C.saveNewEvent=function(e,t,i){var o=h?t-(new Date).getTime()/1e3:t,n={id:a+I.toString(),text:e,time:t,creationTime:Panopto.Core.TimeHelpers.currentWin32EpochTime(),user:s.key,userDisplayName:Panopto.viewer.displayFullNamesInDiscussion?s.name:s.key};S.render([n],!1,void 0,void 0,void 0),g=void 0,I++,C.addEvent(n,o,i),C.focusEvent(n)},C.inputDisabled=function(e){if(void 0===e)return!!b;P&&D(!1),b=e,T.prop("disabled",!!b).val(""),C.updatePlaceholderText()},C.isInputDisabled=C.inputDisabled,C.getEventTime=function(){return h?(new Date).getTime()/1e3:i.position()},C.resetInput=function(){D(!1)},C.focusEvent=function(e){},C},(Panopto=Panopto||{}).UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.UI.Accessibility=Panopto.UI.Accessibility||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.EventTab=function(e,t,i,o,n,a,r,s,l,d){var c=PanoptoTS.Viewer.Constants,p=Panopto.Viewer.Analytics,u={};t.prepend(_.template($("#eventTabErrorTemplate").html())({}));var h,m,v=$("#eventTemplate"),P=t.find(".event-tab-scroll-pane"),g=t.find(".event-tab-list"),y=t.find(".event-tab-spinner"),f=t.find(".event-tab-error"),S=t.find(".event-tab-help"),C=!1,w=Panopto.Core.UI.Components.scrollingHighlight(P,!0,c.EventScrollTimeout);let b;var T=function(e){w.highlight(_.find(n,(function(t){return t.id===e.id})),(function(e){u.seekToEvent(e)}))};u.seekToEvent=function(e){i.userSeekEnabled()&&(i.setPosition(e.time),p.sendEvent({action:p.Actions.Navigate,label:s}))};var E=function(e,t){var i=a===PanoptoViewer.EventType.Comment?e.creationTime-t.creationTime:e.time-t.time;return i||e.id===t.id||(i=e.id<t.id?-1:1),i},V=Panopto.Core.UI.Accessibility.tab(e,t),I=!PanoptoCore.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe;return Panopto.Branding.animateLoadingIndicator(Panopto.branding.accentColor),u.isHeaderVisible=function(){return C},u.toggleHeader=function(t){C=t,e.toggle(t)},u.toggleHeader(!0),P.keydown((function(e){e.ctrlKey||e.altKey||e.shiftKey||"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()})),g.length&&(b=Panopto.Core.UI.Accessibility.listNavigation(g[0])),S.toggle(I),Panopto.Core.UI.Handlers.button(e,(()=>i.fireTabSelected(u))),e.focus((()=>i.fireTabSelected(u))),u.isSameEventRendering=function(e,t){return e.id===t.id&&(void 0===e.displayTime||void 0===t.displayTime||e.displayTime===t.displayTime)&&e.inlineEditable===t.inlineEditable&&e.text===t.text&&e.showUser===t.showUser&&e.userDisplayName===t.userDisplayName&&e.time===t.time&&e.timeRange===t.timeRange&&e.editable===t.editable&&e.deletable===t.deletable},u.selected=function(o){if(void 0===o)return e.hasClass("selected");e.toggleClass("selected",o),o?t.delay(c.FadeInterval).fadeIn(c.FadeInterval,(function(){i.resize(),u.onSelectChangeRendered?.({selected:!0})})):t.fadeOut(c.FadeInterval,(()=>u.onSelectChangeRendered?.({selected:!1}))),V.selected(o)},u.headerId=function(){return e.attr("id")},u.resize=function(e,i){e===h&&i===m||(h=e,m=i,P.css("max-height",i+"px"),t.width(e))},u.position=function(e){var t;r&&(_.each(n,(function(i){i.time<=e&&(t=i)})),w.highlight(t))},u.render=function(e,t,o,r,s){if(o||e.sort(E),r){var l=function(e){for(var t=[],i=[],o=0,a=0;o<n.length&&a<e.length;){var r=n[o],s=e[a],l=E(r,s);0===l?(u.isSameEventRendering(r,s)||(t.push(s),i.push(r)),o++,a++):l<0?(i.push(r),o++):(t.push(s),a++)}for(;o<n.length;)i.push(n[o]),o++;for(;a<e.length;)t.push(e[a]),a++;return{eventsToAdd:t,eventsToRemove:i}}(e);e=l.eventsToAdd,_.each(l.eventsToRemove,(function(e){n.splice(n.indexOf(e),1),g.find("#"+e.id).remove()}))}_.each(e,(function(e){var t;"number"!=typeof e.time||e.displayTime||(e.displayTime=Panopto.Core.TimeHelpers.formatDuration(e.time,Panopto.GlobalResources.TimeSeparator)),!e.creationTime||a!==PanoptoViewer.EventType.Comment&&e.type!==PanoptoViewer.EventType.Comment&&e.displayTime||(t=Panopto.Core.TimeHelpers.toLocalPanoptoTime(Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(e.creationTime),Panopto.timeZone),e.displayDate=Panopto.GlobalResources.ViewerPlus_CommentTimestamp.format(Panopto.Core.TimeHelpers.utcDateToFormattedString(t,"LL"),Panopto.Core.TimeHelpers.utcDateToFormattedString(t,"LT"),e.userDisplayName)),e.isQuestionList?e.iconCode=Panopto.Core.Constants.QuestionListIconCode:e.url&&-1!==e.url.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl)&&(e.iconClass=PanoptoTS.Viewer.Constants.YouTubeIconClass),i.isActiveBroadcast()&&(e.createdDuringWebcast=!1);var o=Panopto.Core.TextHelpers.cleanTextWithHighlighting(e.text);I&&(o=PanoptoCore.Helpers.parseUrlsToHyperlinks(o)),e.content=Panopto.Core.TextHelpers.displayLineBreaks(o)}));var d=_.template(v.html());!r&&t?(n.length=0,_.each(e,(function(e){n.push(e)})),g.html(d({events:e})),_.each(n,(function(e){u.afterRenderItem(e,g.find("#"+e.id),!1)}))):_.each(e,(function(e){var t,i,o=d({events:[e]}),a=_.findIndex(n,(function(t){return t.eventId===e.eventId})),r=!1;if(a>=0){r=(i=g.find("#"+e.id)).hasClass(Panopto.Core.Constants.HighlightedClass)&&!s;const t=$.parseHTML($.trim(o));i.replaceWith(t),i=$(t),n[a]=e}else{n.push(e),n.sort(E),r=!s,t=n.indexOf(e);var l=$.parseHTML($.trim(o));0===t?g.prepend(l):t===n.length-1?g.append(l):g.find("#"+n[t-1].id).after(l),i=$(l)}u.afterRenderItem(e,i,r)})),u.refreshListTabbablePosition()},u.afterRenderItem=function(e,t,i){e.displayTime&&Panopto.Core.UI.Handlers.button(g.find("#"+e.id),T),i&&w.highlight(e),t.find("a").unbind("click keydown").click((function(e){e.stopPropagation()})).keydown((function(e){e.stopPropagation()}))},u.refreshListTabbablePosition=function(){b?.refreshTabbablePosition()},u.remove=function(e){_.each(e,(function(e){var t=g.find("#"+e.id);t.slideUp(void 0,(function(){t.remove()})),n.splice(n.indexOf(e),1)}))},u.toggleLoading=function(e){y.toggle(e)},u.error=function(e,t){e?(f.find(".event-tab-error-message").text(e),Panopto.Core.UI.Handlers.button(f.find(".event-tab-error-retry"),t),Panopto.Core.UI.Handlers.button(f.find(".event-tab-error-cancel"),(function(){u.error(!1)})),f.slideDown()):f.slideUp()},u.fetch=function(e,t,i,n,r){n=n||a,u.toggleLoading(!0),d.search(o,n,e,t,i,l,!r,(function(e){u.render(_.map(e,(e=>new PanoptoTS.Viewer.Data.Event(e))),!0,void 0,void 0,void 0),u.error(!1),u.toggleLoading(!1)}),(function(){u.fetchError(e,t,i,n)}))},u.fetchError=function(e,t,i,o){u.error(Panopto.GlobalResources.ViewerPlus_EventTab_LoadError,(function(){u.fetch(e,t,i,o)})),u.toggleLoading(!1)},u.events=function(){return n},u},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.NotesTab=function(e,t,i,o,n,a,r,s,l,d,c){var p,u,h,m=Panopto.Viewer.Data,v=PanoptoTS.Viewer.Constants,P=!1,g=PanoptoLegacy.Viewer.Tabs.EditableEventTab(e,t,i,o,[],PanoptoViewer.EventType.Note,!0,a,Panopto.GlobalResources.ViewerPlus_AddNote,Panopto.GlobalResources.ViewerPlus_AddNote_None,Panopto.GlobalResources.ViewerPlus_Notes_SignIn,Panopto.Viewer.Analytics.Labels.Note,void 0,l,d,c),y=g,f=Panopto.Core.Extensions.base(g),S=[],C="public",w=t.find("#channelSingleLabel"),b=t.find("#channelSelect"),T=t.find("#channelInput"),E=t.find("#channelOptionTemplate"),V=t.find("#togglePublic"),I=t.find("#notesDownload"),R=t.find("#cancelChannel"),D=t.find(".event-input"),k=function(e){b.val(e.value),b.change()},L=function(e){b.toggle(e),V.toggle(s&&e&&r&&p===u),T.toggle(!e),R.toggle(!e)},x=function(e){V.text(e?Panopto.GlobalResources.ViewerPlus_MakePrivate:Panopto.GlobalResources.ViewerPlus_MakePublic),V.toggleClass(C,e)},A=function(){g.toggleLoading(!0),c.toggleEventPrivacy(o,!V.hasClass(C),(function(e){x(e.Public),g.error(!1),g.toggleLoading(!1)}),(function(){var e=V.hasClass(C)?Panopto.GlobalResources.ViewerPlus_EventTab_TogglePrivateError:Panopto.GlobalResources.ViewerPlus_EventTab_TogglePublicError;g.error(e,(function(){A()})),g.toggleLoading(!1)}))},U=Panopto.GlobalResources.ViewerPlus_YourNotes.format(a.key);if(w.text(U),u=m.Channel("",U),S.push(u),r&&_.each(r,(function(e){e.value.toLowerCase()!==a.key&&S.push(e)})),Panopto.viewer.isCustomNotesChannelEnabled&&S.push(m.Channel(v.JoinChannelOptionValue,Panopto.GlobalResources.ViewerPlus_JoinChannel)),b.html(_.template(E.html())({channels:S})),h=b.find("option[value='"+v.JoinChannelOptionValue+"']"),b.change((function(){var e=b.val();e===v.JoinChannelOptionValue?(L(!1),T.focus()):(p=_.find(S,(function(t){return t.value===e})),P&&g.fetch(),I.attr("href",O()),V.toggle(s&&r&&e===u.value))})),b.keydown((e=>e.stopPropagation())),w.toggle(1===S.length),b.toggle(S.length>1),r){Panopto.Core.UI.Handlers.button(V,A);var M=_.find(r,(function(e){return e.name.toLowerCase()===a.key}));x(void 0!==M),V.toggle(s)}T.keydown((function(e){var t,i,o=jQuery.trim(T.val());13===e.keyCode&&(e.preventDefault(),o&&o!==v.JoinChannelOptionValue&&((t=_.find(S,(function(e){return e.value===o})))||(i=m.Channel(o),h.before(_.template(E.html())({channels:[i]})),S.splice(S.length-2,0,i),T.val(""),t=i),L(!0),k(t))),e.stopPropagation()})),Panopto.Core.UI.Handlers.button(R,(function(){T.val(""),k(p),L(!0)})),g.render=function(e,t){P&&a.key&&D.show(),_.each(e,(function(e){e.showUser=e.user!==a.key})),f.render(e,t)},g.fetch=function(){p===u?f.fetch():p.isUser?f.fetch("",p.value):f.fetch("","",p.value)};var O=function(){var e,t;p===u||(p.isUser?e=p.value:t=p.value);var i={id:o,tid:n,notesUser:e,channelName:t};return Panopto.Core.StringHelpers.addQueryParameter(`${Panopto.uriScheme}://${Panopto.webServerFQDN}${Panopto.appRoot}/Handlers/NotesDownload.ashx`,i)};return y.submitEvent=function(){var e=b.val();e===v.JoinChannelOptionValue&&(e=jQuery.trim(T.val())),e?f.submitEvent(e):f.submitEvent(p.value)},g.selected=function(e){return void 0!==e&&e&&!P&&(D.hide(),g.fetch(),P=!0),f.selected(e)},k(S[0]),y},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.PlayerTabHeader=function(e,t,i,o,n){var a,r,s=e.find(".player-seek-text"),l=!1;return e.addClass(o?PanoptoTS.Viewer.Constants.PrimaryTabHeaderClass:PanoptoTS.Viewer.Constants.SecondaryTabHeaderClass),n&&e.find(".player-tab-wrapper > i").html(n),Panopto.Core.UI.Handlers.hoverableParent(e,s,(function(t){e.hasClass(Panopto.Core.Constants.InactiveClass)&&!e.hasClass(Panopto.Core.Constants.DisabledClass)&&t?(s.show(),Panopto.viewer.allowMultipleSecondaryDisplay||s.css("left",(e.filter(":visible").width()-s.filter(":visible").outerWidth())/2)):s.hide()})),{available:function(t){var o=PanoptoTS.Viewer.Logic.TimelineLogic.isOnTimeline(i,t);e.toggleClass(Panopto.Core.Constants.InactiveClass,!o),!o&&r&&e.blur(),r=o;var n=_.find(i,(e=>e>t));return o?(a=void 0,s.text("")):(a=n||i[0],s.text(Panopto.GlobalResources.ViewerPlus_SecondarySeekText.format(Panopto.Core.TimeHelpers.formatDuration(a,Panopto.GlobalResources.TimeSeparator)))),o},selected:function(t){if(void 0===t)return l;e.toggleClass(Panopto.Core.Constants.SelectedClass,t),t&&!l&&s.hide(),e.attr("aria-pressed",t),l=t},owns:function(t){return 1===e.filter((function(){return this===t})).length},id:function(){return t},seekTime:function(){return a},timeline:function(e){i=e}}},(Panopto=Panopto||{}).UI=Panopto.UI||{},Panopto.UI.Input=Panopto.UI.Input||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.SearchTab=function(e,t,i,o,n,a,r){var s,l=PanoptoTS.Viewer.Constants,d=[],c=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o,d,PanoptoViewer.EventType.None,!1,Panopto.Viewer.Analytics.Labels.Search,a,r),p=c,u=Panopto.Core.Extensions.base(c),h="searchable",m=$("#searchRegion"),v=m.find("#searchInput"),P=m.find("#searchButton"),g=m.find("#clearButton"),y=t.find("#searchTypeSelect"),f=t.find("#searchSortSelect");m.toggle(!0),c.toggleHeader(!1);var S=[{value:"",name:Panopto.GlobalResources.ViewerPlus_Search_All}];return PanoptoCore.forEachEnum(PanoptoViewer.EventType,((e,t)=>{"None"!==e&&S.push({value:t,name:Panopto.GlobalResources[l.SearchTypeResourceString.format(e)]})})),y.html(_.template($("#searchOptionTemplate").html())({searchOptions:S})),f.html(_.template($("#searchOptionTemplate").html())({searchOptions:l.SearchSortOrders})),v.keydown((function(e){e.keyCode===Panopto.Core.Key.Enter&&c.fetch(),e.stopPropagation()})),v.keyup((function(){m.toggleClass(h,""!==jQuery.trim(v.val()))})),v.focus((function(){m.toggleClass(h,""!==jQuery.trim(v.val())),i.fireFocused()})),p.setQueryText=function(e){v.val(e)},y.change((function(){c.fetch()})),y.keydown((e=>e.stopPropagation())),f.change((function(){var e=[];_.each(d,(function(t){e.push(t)})),f.val()===l.SortTimeValue?c.render(e,void 0,void 0,void 0,void 0):c.fetch()})),f.keydown((e=>e.stopPropagation())),Panopto.Core.UI.Handlers.button(P,(function(){c.fetch()})),Panopto.Core.UI.Handlers.button(g,(function(){v.val(""),m.removeClass(h),v.focus(),c.fetch()})),v.attr("placeholder",Panopto.GlobalResources.ViewerPlus_SearchHeader),c.selected=function(e){if(void 0===e)return u.selected();u.selected(e),m.toggleClass(Panopto.Core.Constants.SelectedClass,e)},c.render=function(e){_.each(e,(function(e){"AudioDescription"===e.type.toString()?e.svgPath=PanoptoTS.ImageHelpers.getImageUrl("Viewer/audio-description.svg"):e.iconClass=e.type,e.type===PanoptoViewer.EventType.Note&&(n&&n.key===e.user||(e.showUser=!0))})),u.render(e,!0,f.val()===l.SortRelevanceValue),s&&t.find("#searchResultsAria").text(1===e.length?Panopto.GlobalResources.ViewerPlus_Search_Results_Singular:PanoptoTS.StringHelpers.format(Panopto.GlobalResources.ViewerPlus_Search_Results_Plural,e.length)),e.length?t.find(".index-event").first().focus():t.find("#searchResultsMessage").html(PanoptoTS.StringHelpers.format(Panopto.GlobalResources.ViewerPlus_Search_NoResults,PanoptoTS.StringHelpers.format("<span class='match'>{0}</span>",Panopto.Core.TextHelpers.cleanTextWithHighlighting(s)))),t.find("#searchResultsMessage").toggle(!e.length)},c.fetch=function(){s=jQuery.trim(v.val()),m.toggleClass("search-active",!!s),c.toggleHeader(!!s),i.fireSearchStarted(s),u.fetch(s,"","",y.val())},c.fetch=_.throttle(c.fetch,l.SearchRateLimitMilliseconds),p},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.SecondaryTab=function(e,t,i,o){var n,a,r=Panopto.Viewer.Analytics,s=PanoptoTS.Viewer.Constants,l=$(),d=!0,c=function(e){if(void 0===e)return d;d=e,n.toggleClass(Panopto.Core.Constants.DisabledClass,!d),l.attr("aria-disabled",String(!d))},p=function(n,s){if(void 0===n)return a.selected();if(t.toggle(n),n&&!a.selected()){if(Panopto.viewer.viewerWatermarkPosition&&0===e.getContent().find(".logo-while-playing").length&&Panopto.branding.embedLogo.png){let t=new PanoptoViewer.WatermarkLogo(Panopto.branding.embedLogo.png,Panopto.viewer.viewerWatermarkPosition);e.getContent().append(t.getBrandElem()),Panopto.viewer.viewerWatermarkPosition===PanoptoViewer.Data.ViewerWatermarkPositionOptions.TopRight&&t.setOffset(50)}e.setContentClass(i.tabClass),t.setContent(i,!1,null),e.setSelectedText(i.title),e.setSelectedIcon(o,i.iconClass),s&&r.sendEvent({action:r.Actions.SecondaryTab,label:i.tabClass})}a.selected(n),l.attr("aria-checked",String(!!n))},u=function(e,i,o,n){var a=t;return a.setSecondaryPosition?a.setSecondaryPosition(e,i,o,n):t.setPosition(e,n)},h=function(e){i=e,a.timeline(e.timeline),a.selected()&&t.setContent(e,!1,null)};return{getPlayer:function(){return t},render:function(){if(i.hiddenTab)n=$();else{var t=_.template($("#playerTabHeaderTemplate").html().trim());let o=$(t({content:i,type:"inline",tabindex:0})),a=$(t({content:i,type:"flyout",tabindex:0}));(l=o.add(a)).attr("role","menuitemradio").attr("aria-checked","false").attr("aria-label",_.escape(i.title)),e.addTab(o[0],a[0]),n=o.add(a)}a=Panopto.Viewer.Tabs.PlayerTabHeader(n,i.id,i.timeline,!1,o)},remove:function(){t.remove(),n.remove()},position:u,setPosition:u,playState:function(e){t.playState(e)},bitrate:function(e){t.bitrate(e)},numericBitrate:function(){return t.numericBitrate()},hasMBR:function(){return t.hasMBR()},bitrateLevelOffset:function(){return t.bitrateLevelOffset()},playSpeed:function(e){t.playSpeed(e)},content:function(e){if(void 0===e)return i;h(e)},setContent:h,resize:function(e,i){t.resize(e,i)},available:function(e){return a.available(e)},timeline:function(){return i.timeline},relativeStartTime:function(){return i.relativeStartTime},absoluteStartTime:function(){return i.absoluteStartTime},selected:p,setSelected:p,id:function(){return a.id()},owns:function(e){return a.owns(e)},seekTime:function(){return a.seekTime()},pauseWhenAvailable:function(){return i.pauseWhenAvailable},isSessionPlaybackBlocking:function(){return i.isSessionPlaybackBlocking},hiddenTab:function(){return i.hiddenTab},adjustTimeline:function(e){var t=e-s.TimedSyncRate/1e3*1.5;i.pauseWhenAvailable&&i.timeline[0]>t&&(i.timeline[0]=t)},enabled:c,setEnabled:c}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.TranscriptTab=function(e,t,i,o,n,a){const r=t.find("#transcriptPaneHeader"),s=Panopto.TranscriptTabHeader(r[0],{captionDownloadEnabled:Panopto.viewer.captionDownloadEnabled,deliveryId:o.id,deliveryTitle:o.title});var l=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,i,o.id,[],PanoptoViewer.EventType.Transcript,!0,Panopto.Viewer.Analytics.Labels.Transcript,n,a);const d=Panopto.Core.Extensions.base(l);return l.fetch=function(){l.toggleLoading(!0);const e=PanoptoViewer.Language.getCurrentCaptionLanguage().language;s.setProps({selectedLanguage:e}),PanoptoViewer.Services.getCaptions(o.id,n,e).then((e=>{o.captions=_.map(e,(e=>new PanoptoTS.Viewer.Data.Event(e))),l.render(o.captions,!0,void 0,void 0,void 0),l.error(!1),l.toggleLoading(!1),i.synchronize(!1)})).catch((()=>{l.fetchError(void 0,void 0,void 0,void 0),l.toggleLoading(!1)}))},l.resize=function(e,t){d.resize(e,t-(r.outerHeight()||0))},l.fetch(),l},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.ViewerEventTab=function(e,t,i,o,n,a,r,s,l,d){var c=PanoptoLegacy.Viewer.Tabs.EventTab(e,t,i,o,n,a,r,s,l,d),p=Panopto.Core.Extensions.base(c);return c.render=function(e,t,i,o,n){e=_.filter(e,(function(e){return!!jQuery.trim(e.text)})),p.render(e,t,i,o,n)},c},function(e){!function(e){!function(e){e.ViewerEventTabHelpers=class{static create(e,t,i,o){return{userSeekEnabled:e.userSeekEnabled,setPosition:e.setPosition,resize:()=>{e.resize&&e.resize()},isActiveBroadcast:e.isActiveBroadcast,fireFocused:t,isAudioDescriptionsSelected:()=>e.isAudioDescriptionsSelected(),togglePlayState:t=>{e.setPlayState(PanoptoViewer.Data.ViewerPlayState.Playing,!1,!1)},isLive:e.isLive,position:e.position,getPosition:e.getPosition,activePrimary:e.activePrimary,activeSecondary:e.activeSecondary,hotkey:e.hotkey,toggleScreens:e.toggleScreens,setSecondaryCount:e.setSecondaryCount,reinitializeDelivery:e.reinitializeDelivery,synchronize:e.synchronize,viewMode:t=>{var i;return e.viewMode&&(i=e.viewMode(t)),i},fireTabSelected:i,fireSearchStarted:o}}}}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){let t,i;e.PlayerScriptEvent=class{static toLogLine(e,t,i,o,n){return e+"\t"+t+"\t"+i+"\t"+o+(void 0!==n?"\t"+n:"")}static fromLogLine(e){var t=e.split("\t");return{source:t[0].toLowerCase(),time:parseInt(t[1]),playerName:t[2],type:t[3].toLowerCase(),value:t[4]}}},function(e){e[e.LogInput="loginput"]="LogInput",e[e.LogOutput="logoutput"]="LogOutput",e[e.LogDefer="logdefer"]="LogDefer",e[e.None="none"]="None",e[e.LogInputAndOutput="loginputandoutput"]="LogInputAndOutput"}(t=e.ViewerEventSource||(e.ViewerEventSource={})),function(e){e[e.Load="load"]="Load",e[e.Play="play"]="Play",e[e.Pause="pause"]="Pause",e[e.Stop="stop"]="Stop",e[e.Seek="seek"]="Seek",e[e.Speed="speed"]="Speed",e[e.Bitrate="bitrate"]="Bitrate",e[e.Fullscreen="fullscreen"]="Fullscreen",e[e.Volume="volume"]="Volume",e[e.Mute="mute"]="Mute"}(i=e.ViewerEventType||(e.ViewerEventType={}))}(e.Test||(e.Test={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.ScriptedViewer=class{constructor(e){this.script=this.parseScriptBlob(e),this.playerNames=_.uniq(_.pluck(this.script,"playerName"))}getPlayerNames(){return this.playerNames}start(e,t,o,n,a){var r={};_.each(t,(e=>{var t=$.parseHTML("<div />");n.append(t),r[e]=new i(e,$(t),o)})),this.beginScript(e,r,a)}beginScript(e,t,i){var o,n,a=-1,r=()=>{do{a++}while(a<this.script.length&&(!t[this.script[a].playerName]||this.script[a].source!==e));a<this.script.length?s():i&&i()},s=()=>{var e,i=this.script[a];o?e=i.time-o-((new Date).getTime()-n):(n=(new Date).getTime(),o=i.time,e=0),e>30?setTimeout(s,e-30):e>4?setTimeout(s):(t[i.playerName].runEvent(i,o-n),r())};r()}parseScriptBlob(e){return _.map(e.split("\n"),(e=>t.PlayerScriptEvent.fromLogLine(e)))}};class i{constructor(t,i,r){if("flowplayer"===r.toLowerCase())this.playerStub=new o(i);else if("video"===r.toLowerCase())this.playerStub=new n(i);else{if("panoptoflowplayer"!=r.toLowerCase())throw"Unknown player stub "+r;this.playerStub=new a(new e.Viewer.Players.FlowplayerMachine("primary"==t.toLowerCase(),i,{resize:$.noop,togglePlaying:$.noop}))}this.playerName=t}runEvent(e,i){switch(t.PlayerScriptEvent.toLogLine(e.source,i+(new Date).getTime(),e.playerName,e.type,e.value),e.type){case t.ViewerEventType.Load:this.playerStub.load(e.value);break;case t.ViewerEventType.Play:this.playerStub.play();break;case t.ViewerEventType.Pause:this.playerStub.pause();break;case t.ViewerEventType.Stop:this.playerStub.stop();break;case t.ViewerEventType.Seek:this.playerStub.seek(parseFloat(e.value)||0);break;case t.ViewerEventType.Speed:this.playerStub.speed(parseFloat(e.value)||0);break;case t.ViewerEventType.Bitrate:this.playerStub.bitrate(parseFloat(e.value)||0);break;case t.ViewerEventType.Fullscreen:this.playerStub.fullscreen("true"==e.value.toLowerCase());break;case t.ViewerEventType.Volume:this.playerStub.volume(parseFloat(e.value));break;case t.ViewerEventType.Mute:this.playerStub.mute("true"==e.value.toLowerCase())}}}class o{constructor(e){this.$element=e,this.ensureInitialized()}load(e){var t={sources:[{src:e,type:-1!==e.indexOf(".m3u8")?o.HLSMimeType:o.MP4MimeType}]};this.api?this.api.load(t):this.api=flowplayer(this.$element,{clip:t})}play(){this.api.resume()}pause(){this.api.pause()}stop(){this.api.stop()}seek(e){this.api.seek(e||0)}speed(e){this.api.speed(e)}bitrate(e){}fullscreen(e){e!=this.api.isFullscreen&&this.api.fullscreen()}volume(e){this.api.volume(e/100)}mute(){this.api.mute(!0)}ensureInitialized(){flowplayer.conf.hlsjs||(flowplayer.conf.hlsjs={startLevel:"auto",safari:!0})}}o.MP4MimeType="video/mp4",o.HLSMimeType="application/x-mpegURL";class n{constructor(e){this.video=$.parseHTML("<video />")[0],e.append(this.video),this.hls=new Hls,this.hls.attachMedia(this.video)}load(e){e.indexOf(".m3u8")?this.hls.loadSource(e):this.video.src=e}play(){this.video.play()}pause(){this.video.pause()}stop(){this.hls.stopLoad()}seek(e){this.video.currentTime=e}speed(e){this.video.playbackRate=e}bitrate(e){}fullscreen(e){e?this.video.requestFullscreen():this.video.stopFullscreen()}volume(e){this.video.volume=e/100}mute(){this.video.muted=!0}}class a{constructor(e){this.panoptoPlayer=e}load(e){this.panoptoPlayer.content({url:e,isBroadcast:!1,isAudioOnly:!1})}play(){this.panoptoPlayer.playState(1)}pause(){this.panoptoPlayer.playState(2)}stop(){this.panoptoPlayer.playState(3)}seek(e){this.panoptoPlayer.position(e)}speed(e){this.panoptoPlayer.playSpeed(e)}bitrate(e){this.panoptoPlayer.bitrate(e)}fullscreen(e){this.panoptoPlayer.isFullscreen(e)}volume(e){this.panoptoPlayer.volume(e)}mute(e){this.panoptoPlayer.muted(e)}}}(t.Test||(t.Test={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){const t=PanoptoCore.Logging.Logger;class i{static createLogger(t){if(!i.source){var a=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1),!1,!0);i.source=a.scriptmode?a.scriptmode.toString().toLowerCase():e.ViewerEventSource.None}return i.source!==e.ViewerEventSource.None?new o(i.source,t):new n}}e.ViewerScriptLoggerFactory=i;class o{constructor(e,t){this.scriptMode=e,this.playerName=t}log(i,o,n){i!==this.scriptMode&&(this.scriptMode!=e.ViewerEventSource.LogInputAndOutput||i!=e.ViewerEventSource.LogInput&&i!=e.ViewerEventSource.LogDefer&&i!=e.ViewerEventSource.LogOutput)||t.info(e.PlayerScriptEvent.toLogLine(i,(new Date).getTime(),this.playerName,o,n))}}class n{log(e,t,i){}}}(e.Test||(e.Test={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.Timeline=Panopto.Viewer.Controls.Timeline||{},function(e){!function(e){!function(e){!function(e){e.TimelineSegment=class{constructor(e,t,i){this.element=e,this.start=t,this.end=i,this.start=t/Panopto.Core.Constants.TimelineChunkMultiplier,this.end=i/Panopto.Core.Constants.TimelineChunkMultiplier}}}(e.Timeline||(e.Timeline={}))}(e.Controls||(e.Controls={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),Panopto.Viewer.Controls.Timeline.TimelineConverter=function(e,t){var i,o,n,a=function(){_.each(t.secondaryStreams,(function(e){e.segments.length=0,e.timeline.length=0,_.each(o,(function(t){var i=t.element.getStreamById(e.id);i&&(e.segments.push({relativeStart:t.start,relativeEnd:t.end,streamOffset:i.offset/Panopto.Core.Constants.TimelineChunkMultiplier,timelineStart:t.start}),e.timeline.push(t.start,t.end))}))}))},r=()=>{let e;if(n.length){e=n[n.length-1].end}else e=i.duration()/Panopto.Core.Constants.TimelineChunkMultiplier;return e};return{timelinePosition:function(e){var t,i=e;return n&&(_.some(n,(function(t){return t.start<=e&&t.end>=e}))||(i=(t=_.find(n,(function(t){return t.start>e})))?t.start:r())),i},timelineEndPosition:r,computeSegments:function(t,r){i=t;_.sortBy(i.streams(),"absoluteStart");var s,l,d=r?i.createTimeline(!0):i.timeline(),c=d.elements(),p=d.firstPrimaryIndex(),u=d.lastPrimaryIndex(),h=0,m=i.firstPrimaryOffset()/Panopto.Core.Constants.TimelineChunkMultiplier;for(o=[],n=[],s=0;s<=c.length-1;s++)s>=p&&s<=u&&(l=new PanoptoTS.Viewer.Controls.Timeline.TimelineSegment(c[s],h,h+c[s].length()),o.push(l),c[s].containsPrimary()&&n.push(l)),h+=c[s].length();_.each(o,(function(e){e.start-=m,e.end-=m})),e.setPrimarySegments(o,n,i.duration()/Panopto.Core.Constants.TimelineChunkMultiplier,!r),a()},getSegments:()=>o}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.Timeline=Panopto.Viewer.Controls.Timeline||{},Panopto.Viewer.Controls.Timeline.TimelineEditor=function(e,t,i,o,n,a){const r=PanoptoCore.Logging.Logger;var s,l,d,c,p,u,h,m,v,P,g,y,f,S,C,w={},b=!0,T=[],E=!1,V=[],I=new Panopto.Core.JobQueue({maxDegreeOfParallelism:1,maxAttempts:1,autoStart:!0}),R=[],D=!0;const k=new PanoptoTS.Core.Logic.Time.TimeConverter,L=Panopto.features.uploadApiEnabledForStreamUpload&&Panopto.features.useUploadAPIForWebUpload,x=Panopto.features.uploadApiForceUseMachineS3Credentials||Panopto.features.uploadApiForceCloudContentStore||Panopto.isPanoptoHosted,A=new PanoptoTS.Viewer.Tabs.Editor.EventService(k);A.eventAdded.add((e=>{me(),h.events().push(e),h.refreshTimeline(),de()}));const U=e=>{_e(e.uploadId)},M=e=>{he()},O=new PanoptoCore.TypedCallback;var H,B=$("#timelineContainer"),F=$("#playControls"),z=$("#saveMessageText"),N=$("#saveRetryLink"),G=$("#undoButton"),j=$("#redoButton"),Q=$("#commitButton"),W=$("#revertButton"),q=$("#closeButton"),K=$("#advancedEditorLink"),J=$("#toggleTimelineButton"),Y=$("#slideStackExpandedView"),X=$("#slideStackExpandedViewTriangle"),Z=Y.add(X);const ee=e=>{window.postMessage({messageState:e,source:"TimelineEditor_MessageState"})},te=e=>{const t=$.Deferred(),i=$.Deferred(),o=$.Deferred(),a=$.Deferred(),r=$.Deferred(),s=$.Deferred(),l=[i,o,a,r,s];return n.getAllStreams(e.referencedSessionId,(t=>{e.streams=t,i.resolve()}),(()=>{i.reject()})),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCuts(e.referencedSessionId,(t=>{e.cuts=t,o.resolve()}),(()=>{o.reject()})),Panopto.Core.ServiceInterface.Rest.Sessions.getAllEvents(e.referencedSessionId,{eventTypes:[Panopto.Core.EventType.Label,Panopto.Core.EventType.SmartOcrToc],pageSize:Panopto.viewer.timelineEditorEventsPageSize},(t=>{e.events=t,a.resolve()}),(()=>{a.reject()})),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideEvents(e.referencedSessionId,{pageSize:Panopto.viewer.timelineEditorEventsPageSize},(t=>{e.slideEvents=_.filter(t,(e=>e.timelineTime)),r.resolve()}),(()=>{r.reject()})),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCaptions(e.referencedSessionId,{pageSize:Panopto.viewer.timelineEditorEventsPageSize,Language:PanoptoViewer.Language.getCurrentCaptionLanguage().language},(function(t){e.captions=t,s.resolve()}),(()=>{s.reject()})),$.when(...l).then((()=>{const i=[].concat(e.events).concat(e.slideEvents).concat(e.captions);e.timelineState=new PanoptoTS.Core.UI.Components.Editor.TimelineState(e.streams,e.cuts,i,void 0,void 0,void 0,void 0,!1,null,null),_.chain(e.cuts).each((t=>{let o=t.start/Panopto.Core.Constants.TimelineChunkMultiplier,n=(t.start+t.duration)/Panopto.Core.Constants.TimelineChunkMultiplier;if(t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream){const i=(_.find(e.timelineState.streams(),(e=>e.id===t.targetId)).absoluteStart-e.timelineState.absoluteStart())/Panopto.Core.Constants.TimelineChunkMultiplier;o+=i,n+=i}_.each([...i],(e=>{(t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session||e.streamId===t.targetId)&&e.editorTime>=o&&e.editorTime<n&&(e.editorTime=-1,i.splice(_.findIndex(i,(t=>t.id===e.id)),1))}))})),e.events=_.filter(e.events,(e=>-1!==e.editorTime)),e.slideEvents=_.filter(e.slideEvents,(e=>-1!==e.editorTime)),e.captions=_.filter(e.captions,(e=>-1!==e.editorTime)),_.chain(e.cuts).sortBy((e=>-e.start)).each((e=>{if(e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session){const t=e.start/Panopto.Core.Constants.TimelineChunkMultiplier,o=e.duration/Panopto.Core.Constants.TimelineChunkMultiplier;_.each(i,(e=>{e.editorTime>=t&&(e.editorTime=e.editorTime-o)}))}})),t.resolve(e)})).fail((()=>{t.reject()})),t},ie=(e,t,i)=>{const o=$.Deferred();return n.getOne(e,(e=>{const n=new PanoptoTS.Core.ServiceInterface.Rest.Objects.SessionReference({id:_.uniqueId("newSessionReference"),referencedSessionId:e.id,referencedSessionDuration:e.duration,start:t,order:i,name:e.name,typeName:"SessionReference"});te(n).done((e=>{o.resolve(e)}))})),o.promise()};var oe=function(e){return _.find(h.streams(),(function(t){return t.id===e}))},ne=function(e){var t;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:t=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:t=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:t=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return t},ae=function(e,t,i,o){var n=(e=e||oe(t)).name;return n||(n=ne(e)),i?o?Panopto.GlobalResources.ViewerPlus_Edit_StreamNameAndType.format(n,e.isPrimary?`${Panopto.GlobalResources.ViewerPlus_Edit_Primary.toLowerCase()} ${o}`:`${Panopto.GlobalResources.ViewerPlus_Edit_Secondary.toLowerCase()} ${o}`):Panopto.GlobalResources.ViewerPlus_Edit_StreamNameAndType.format(n,e.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary.toLowerCase():Panopto.GlobalResources.ViewerPlus_Edit_Secondary.toLowerCase()):n},re=function(){var e=_.filter(h.getExpandedEvents(),(function(e){return!e.isDefaultThumbnail})),t=_.filter(e,(function(e){return e.type===Panopto.Core.EventType.Caption&&(!b||h.shouldPreviewEvent(e))})),i=_.filter(e,(function(e){return e.type===Panopto.Core.EventType.AudioDescription&&(!b||h.shouldPreviewEvent(e))}));o.hasCaptions=!!t.length,[...new Set(t.map((e=>e.language)))].forEach((e=>{o.availableCaptions.find((t=>t.language===e))||o.availableCaptions.push(PanoptoReactComponents.Helpers.createCaptionInfoFromLanguage(e))})),t.length&&(o.captions=[],_.each(t,(function(e){e.language==PanoptoViewer.Language.getCurrentCaptionLanguage().language&&o.captions.push({time:e.viewerTime,text:_.escape(e.name),captionDuration:e.duration?e.duration:void 0})}))),o.hasAudioDescriptions=!!i.length,o.availableAudioDescriptionLanguages=_.unique(i.map((e=>e.language))),i.length&&(o.audioDescriptions=[],_.each(i,(function(e){e.language===PanoptoViewer.Language.getCurrentADLanguage()&&o.audioDescriptions.push({time:e.viewerTime,text:_.escape(e.name),language:e.language})}))),PanoptoViewer.Language.setCaptionLanguages(o.availableCaptions),PanoptoViewer.Language.setADLanguages(o.availableAudioDescriptionLanguages)},se=function(){k.applyState(h),A.applyState(s.id,h),ze.applyState(h),y.events(h.streams()),d.cuts(h.cuts()),g.events(h.cuts()),f&&f.events(h.questionLists()),h.events().sort((function(e,t){return e.timelineTime-t.timelineTime||e.id.localeCompare(t.id)})),_.each(V,(function(e){e.events(h.events())})),S.thumbnails(h.events())},le=function(e){var i,n,a;c.computeSegments(h,b),he(),e?re():(S.toggle(!D),t.resize(),i=_.filter(h.getExpandedEvents(),(function(e){return!e.isDefaultThumbnail})),n=_.filter(i,(function(e){return e.link})),a=_.filter(i,(function(e){return e.type===Panopto.Core.EventType.SlideChange})),o.documents.length=0,_.each(h.questionLists(),(e=>{const t=k.toUneditedFirstPrimaryRelative(e.firstStreamRelativeTicks).seconds();o.documents.push({title:e.name,id:"urlTab"+e.id,timeline:[t,t+PanoptoViewer.Constants.UrlEventDuration],url:PanoptoTS.Viewer.Constants.QuizEditUrlTemplate.format(e.id,o.id),iconCode:Panopto.Core.Constants.QuestionListIconCode,pauseWhenAvailable:!0,hiddenTab:!0,isQuiz:!0})})),_.each(n,(function(e){var t=-1!==e.link.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl),i=t&&e.sessionId===o.id?PanoptoTS.Viewer.Constants.YouTubeEditUrlTemplate.format(e.id):e.link;o.documents.push({title:e.name||(t?Panopto.GlobalResources.ViewerPlus_YouTube:Panopto.GlobalResources.ViewerPlus_Website),id:"urlTab"+e.id,timeline:[e.viewerTime,e.viewerTime+PanoptoViewer.Constants.UrlEventDuration],url:i,pauseWhenAvailable:!0,iconClass:t?PanoptoTS.Viewer.Constants.YouTubeIconClass:void 0,iconCode:t?void 0:Panopto.Core.Constants.LinkIconCode})})),o.documents.sort((function(e,t){return e.timeline[0]-t.timeline[0]})),o.slideDecks.length=0,a.length&&o.slideDecks.push({title:Panopto.GlobalResources.ViewerPlus_SlidesTitle,id:PanoptoTS.Viewer.Constants.SlideDeckId,timeline:[0],slides:_.map(a,(function(e){return{time:e.viewerTime,url:e.slideUrl}})),iconCode:Panopto.Core.Constants.SlideIconCode,tabClass:PanoptoTS.Viewer.Constants.SlideDeckTabClass}),re(),_.each(h.sessionReferences,(e=>{_.chain(e.streams).filter((e=>!e.isPrimary)).each((e=>{const t=[],i=[];_.each(c.getSegments(),(o=>{var n=o.element.getStreamById(e.id);n&&(t.push({relativeStart:o.start,relativeEnd:o.end,streamOffset:n.offset/Panopto.Core.Constants.TimelineChunkMultiplier,timelineStart:o.start}),i.push(o.start,o.end))}));const n={title:ae(e,void 0),id:e.id,tabClass:e.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio||e.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen?PanoptoTS.Viewer.Constants.ScreenCaptureClass:PanoptoTS.Viewer.Constants.ObjectVideoTabClass,iconClass:void 0,iconCode:void 0,timeline:i,relativeStartTime:void 0,absoluteStartTime:e.absoluteStart,hiddenTab:!1,pauseWhenAvailable:!1,isSessionPlaybackBlocking:!1,isBroadcast:!1,isSecondaryPaneOnly:!1,interrupted:!1,isAudioOnly:!1,optimizationToken:void 0,url:e.url,mediaFileType:e.mediaFileType,type:e.type,relativeStart:void 0,relativeEnd:void 0,length:void 0,segments:t,vrType:e.vrType,variants:[]},a=_.findIndex(o.secondaryStreams,(t=>t.id===e.id));a>-1?o.secondaryStreams.splice(a,1,n):o.secondaryStreams.push(n)}))})),_.each(o.primaryStreams.concat(o.secondaryStreams),(function(e){e.title=void 0!==e.title?e.title:ae(void 0,e.id),e.vrType=void 0!==e.vrType?e.vrType:oe(e.id).vrType})),t.refreshPlayers()),t.synchronize(!e),V.forEach((e=>{e.refreshSmartChapters?.(),e.refreshAIChapters?.()}))},de=function(e){se(),e?p.applyStateWhenChangeIsTimelineViewTriggered(h):p.applyState(h),le(e),fe()},ce=function(){se(),p.applyState(h),le()},pe=function(){var e=T.indexOf(h);if(e){const i=t.getPosition(),o=k.toWin32EpochRelative(i);h=T[e-1],V.forEach((e=>{e.refreshSmartChapters?.(),e.refreshAIChapters?.()})),h.refreshTimeline(),de(),t.setPosition(h.calculateEditorTimeFromAbsolute(o.ticks()))}},ue=function(){var e=T.indexOf(h);if(e<T.length-1){const i=t.getPosition(),o=k.toWin32EpochRelative(i);h=T[e+1],V.forEach((e=>{e.refreshSmartChapters?.(),e.refreshAIChapters?.()})),h.refreshTimeline(),de(),t.setPosition(h.calculateEditorTimeFromAbsolute(o.ticks()))}},he=function(){var e=T.indexOf(h);const t=!e,i=e===T.length-1;G.toggleClass(Panopto.Core.Constants.DisabledClass,t),j.toggleClass(Panopto.Core.Constants.DisabledClass,i);const o=h!==u&&l.id;W.toggleClass(Panopto.Core.Constants.DisabledClass,!o);const n=window.streamUploader&&window.streamUploader.hasActiveUploads(),a=!o||n;var r;Q.toggleClass(Panopto.Core.Constants.DisabledClass,a),Q.attr("title",n?Panopto.GlobalResources.ViewerPlus_Edit_ApplyBlockedByNewStreams:Panopto.GlobalResources.ViewerPlus_Edit_ApplyButtonTooltip),r={actionButtonsDisabled:{revert:!o,undo:t,redo:i,apply:a}},window.postMessage({...r,source:"TimelineEditor_ButtonState"})},me=function(){var e=T.indexOf(h),t=h.copy();T.splice(e+1,T.length-1-e,t),h=t,se()},ve=function(e){return _.each(e,(function(e){e.sessionId=o.id})),_.filter(e,(function(e){return e.timelineTime}))},Pe=function(e){E=!0,clearTimeout(H),z.show(),z.text(e),z.removeClass(Panopto.Core.Constants.ErrorClass),Q.add(W).toggleClass(Panopto.Core.Constants.DisabledClass,!0),N.hide()},ge=function(e,t,i){E=!1,he(),t?(z.text(e.format(Panopto.Core.TimeHelpers.utcDateToFormattedString(Panopto.Core.TimeHelpers.toLocalPanoptoTime(Date.now(),Panopto.timeZone),"LT"))),H=setTimeout((function(){z.fadeOut()}),2e4)):(z.text(e),z.addClass(Panopto.Core.Constants.ErrorClass),N.toggle(!!i),Panopto.Core.UI.Handlers.button(N,i))},ye=function(e){"SessionChangeSet Update can't change the owner of the change set"!==e.responseJSON&&"Object not found"!==e.responseJSON&&"Session already has an uncommitted change set."!==e.responseJSON||(l.id=void 0,G.add(j).add(Q).add(W).toggleClass("disabled",!0),t.toggleMessage(Panopto.GlobalResources.ViewerPlus_Edit_ChangesLost))};var fe=function(){I.hasQueuedJobs()||I.queueJob({attempt:function(e){var t=function(){ge(Panopto.GlobalResources.ViewerPlus_Edit_SavedAt,!0),ee("save-ok"),e(!0)},i=function(t){ge(Panopto.GlobalResources.ViewerPlus_Edit_SaveFailure,!1,fe),ee("save-failed"),ye(t),e(!1)};h===u?Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(l.id,(function(){l=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:o.id}),t()}),i):((()=>{const e=_.object(_.map(m,(e=>e.id)),m),t=_.object(_.map(h.events(),(e=>e.id)),h.events()),i=_.object(_.map(v,(e=>e.id)),v),o=_.object(_.map(h.questionLists(),(e=>e.id)),h.questionLists()),n=_.object(_.map(P,(e=>e.id)),P),a=_.object(_.map(h.sessionReferences,(e=>e.id)),h.sessionReferences);l.cutsToReplace=_.map(h.cuts(),(e=>e.copy())),l.streamsToUpdate=h.streams(),l.slideDecksToDelete=h.slideDecksToDelete(),l.eventsToAdd=_.filter(h.events(),(t=>!e[t.id])),l.eventsToUpdate=_.filter(h.events(),(t=>e[t.id]&&t.edited)),l.eventsToDelete=_.filter(m,(e=>!t[e.id])),l.questionListRevisions=_.chain(h.questionLists()).filter((e=>!i[e.id]||e.isEdited)).map((e=>e.toClientModel())).value(),l.questionListIdsToDelete=_.map(_.filter(v,(e=>!o[e.id])),(e=>e.id)),l.sessionReferences.toAdd=_.chain(h.sessionReferences).filter((e=>!n[e.id])).map((e=>{const t=new AutoClientModels.SessionReferenceCreate;return t.referencedSessionId=e.referencedSessionId,t.order=e.order,t.start=e.start,t.cuts=[],_.chain(h.cuts()).filter((t=>t.targetId===e.id)).each((e=>{const i=new AutoClientModels.SessionReferenceCreateCut;i.start=e.start/Panopto.Core.Constants.TimelineChunkMultiplier,i.duration=e.duration/Panopto.Core.Constants.TimelineChunkMultiplier,t.cuts.push(i)})),l.cutsToReplace=_.reject(l.cutsToReplace,(t=>t.targetId===e.id)),t})).value(),l.sessionReferences.toUpdate=_.chain(h.sessionReferences).filter((e=>n[e.id]&&e.edited)).map((e=>{const t=new AutoClientModels.SessionReferenceUpdate;return t.id=e.id,t.order=e.order,t.start=e.start,t})).value(),l.sessionReferences.toDelete=_.chain(P).filter((e=>!a[e.id])).map((e=>e.id)).value(),h.addedStreams.length&&(l.streamChanges=new AutoClientModels.StreamChanges,l.streamChanges.toAdd=_.map(h.addedStreams,(e=>{const t=new AutoClientModels.StreamCreate;return t.copyFromStreamCreate(e),t})));const r=u.streams().filter((e=>!h.streams().some((t=>t.id===e.id))));r.length&&(l.streamChanges||(l.streamChanges=new AutoClientModels.StreamChanges),l.streamChanges.toDelete=r.map((e=>{let t=new AutoClientModels.StreamDelete;return t.streamId=e.id,t}))),l.normalizeVolume=h.getNormalizeVolume(),l.aiKeyPoints=h.getAIKeyPoints(),l.aiSummary=h.getAISummary()})(),Pe(Panopto.GlobalResources.ViewerPlus_Edit_Saving),ee("saving"),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.save(l,(function(e){l.id=e.id,t()}),i))}})},Se=function(){Ue(),I.queueJob({attempt:function(e){h!==u&&l.id&&(Pe(Panopto.GlobalResources.ViewerPlus_Edit_Applying),ee("committing"),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.commitChanges(l,(function(){ge(Panopto.GlobalResources.ViewerPlus_Edit_ApplySuccess,!0),ee("commit-ok"),l.id=void 0,e(!0),confirm(Panopto.GlobalResources.ViewerPlus_Edit_ContinueEditing)?q.click():window.location.reload()}),(function(t){ge(Panopto.GlobalResources.ViewerPlus_Edit_ApplyFailure,!1,Se),ee("commit-failed"),ye(t),e(!1)})))}})},Ce=function(){confirm(Panopto.GlobalResources.ViewerPlus_Edit_ConfirmRevert)&&(I.emptyQueue(),I.queueJob({attempt:function(e){h!==u&&l.id&&(Pe(Panopto.GlobalResources.ViewerPlus_Edit_Reverting),ee("reverting"),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(l.id,(function(){ge(Panopto.GlobalResources.ViewerPlus_Edit_RevertedAt,!0),ee("revert-ok"),l=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:o.id});const i=t.getPosition(),n=k.toWin32EpochRelative(i);T.length=0,h=u,V.forEach((e=>{e.refreshSmartChapters?.(),e.refreshAIChapters?.()})),h.refreshTimeline(),T.push(h),ce(),t.setPosition(h.calculateEditorTimeFromAbsolute(n.ticks())),e(!0)}),(function(t){ge(Panopto.GlobalResources.ViewerPlus_Edit_RevertFailed,!1,Ce),ee("revert-failed"),ye(t),e(!1)})))}}))},we=function(){const e=_.chain(h.streams()).sortBy((e=>e.absoluteStart)).filter((e=>e.isPrimary)).value();var t=_.pluck(e,"id"),i=_.filter(h.cuts(),(function(e){return e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream&&_.contains(t,e.targetId)})),o=Panopto.Core.Logic.Timeline.Timeline(e,i);_.each(o.elements(),(function(e){var t,i=e.streams();if(i.length>1)for(t=1;t<i.length;t++)d.addCut(i[t].offset,i[t].offset+e.length(),i[t].stream.id,Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream,!1)}))},be=function(e,t,i,n,a){var s;t<=e?r.error(`Could not create cut. Operation will create a negative cut. relativeStart: ${e} relativeEnd: ${t}`):(d.addCut(e,t,i||o.id,n,a),s=Panopto.Core.Logic.Timeline.Timeline(h.streams(),h.cuts()),n!==Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session||_.some(s.elements(),(e=>e.containsPrimary()))||(d.removeAll(o.id,Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session),p.applyState(h),alert(Panopto.GlobalResources.ViewerPlus_Edit_CutEntireSession)))},Te=function(e,t,i){let n;switch(i){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:t=o.id,n=h.calculateRelativeTimeForCut(e,t);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:n=h.calculateRelativeTimeForCut(e,t);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:n=e}d.removeCut(n,t,i)},Ee=function(e,t,i,o,n){i<=t?r.error(`Could not create cut. Operation will create a negative cut. relativeStart: ${t} relativeEnd: ${i}`):(Te(e,o,n),be(t,i,o,n,!1))};var Ve=function(){const e=new AutoClientModels.QuestionOption;e.id=_.uniqueId("questionOption"),e.name=Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultOption1,e.isCorrect=!0;const t=new AutoClientModels.QuestionOption;t.id=_.uniqueId("questionOption"),t.name=Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultOption2,t.isCorrect=!1;const i=new AutoClientModels.Question;return i.id=_.uniqueId("question"),i.name=Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultQuestionName,i.questionType=AutoRestModels.QuestionType.MultipleChoice,i.options=[e,t],i},Ie=function(e){let i,o=t.position(),n=!0;if(h.isTimeInSessionReference(o)){const e=h.findNextTimeNotInSessionReference(o);if(e>=h.duration())alert(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClipAtEnd),n=!1;else{confirm(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClip)?i=e:n=!1}}else i=o*Panopto.Core.Constants.TimelineChunkMultiplier;const a=Math.floor(h.duration()/Panopto.Core.Constants.TimelineChunkToMillisMultiplier)*Panopto.Core.Constants.TimelineChunkToMillisMultiplier;if(a<=i&&(i=a),n){me();const i=t.getPosition(),o=new PanoptoTS.Models.Editor.EditableQuestionList;o.id=_.uniqueId("questionList"),o.name=e||Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultName,o.sessionId=s.id,o.firstStreamRelativeTicks=k.toFirstStreamRelative(i),o.isEdited=!0,o.isSessionPlaybackBlocking=!0,o.allowRetake=!0,o.showFinalGrade=!0,o.allowReview=!0,o.questions=[Ve()],h.questionLists().push(o),h.refreshTimeline(),de(!1)}},_e=function(e){me();let t=new AutoClientModels.StreamCreate;t.uploadId=e,h.addedStreams.push(t),de()},Re=function(e){const i=t.getPosition(),o=k.toWin32EpochRelative(i);me();var n=_.find(h.events(),(e=>e.isDefaultThumbnail));n&&h.events().splice(h.events().indexOf(n),1);var a=e?t.activePrimary():t.activeSecondary(),r=Panopto.Core.ServiceInterface.Rest.Objects.Event({sessionId:s.id,timelineTime:o.ticks(),isDefaultThumbnail:!0});if(_.find(h.streams(),(function(e){return e.id===a.id})))r.type=Panopto.Core.EventType.Label,r.streamId=a.id;else if(a.id===PanoptoTS.Viewer.Constants.SlideDeckId){r.type=Panopto.Core.EventType.SlideChange;var l=_.filter(h.events(),(function(e){return e.type===Panopto.Core.EventType.SlideChange}));l=_.sortBy(l,"timelineTime"),r.slideId=l[0].slideId,_.find(l,(function(e){if(!(e.timelineTime<=o.ticks()))return!0;r.slideId=e.slideId}))}h.events().push(r),de()};const De=e=>{const t=e/Panopto.Core.Constants.TimelineChunkMultiplier;let i;return i=h.isTimeInSessionReference(t)?{valid:!1,nextValidTime:h.findNextTimeNotInSessionReference(t)/Panopto.Core.Constants.TimelineChunkMultiplier}:{valid:!0,nextValidTime:void 0},i};var ke=function(e){let t=_.find(h.questionLists(),(function(t){return t.id===e}));var i=t.toClientModel();return i.sessionRelativeTime=k.toUneditedFirstPrimaryRelative(t.firstStreamRelativeTicks).ticks(),i},Le=function(e){me();var i=new AutoClientModels.QuestionList;i.copyFromQuestionList(e);var o=new PanoptoTS.Models.Editor.EditableQuestionList;o.copyFromClientModel(i),o.isEdited=!0;const n=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(i.sessionRelativeTime);o.firstStreamRelativeTicks=k.toFirstStreamRelative(n);var a=_.find(h.questionLists(),(function(e){return e.id===o.id}));h.questionLists().splice(h.questionLists().indexOf(a),1,o);var r=a.firstStreamRelativeTicks.ticks()!==o.firstStreamRelativeTicks.ticks();return h.refreshTimeline(),de(a.name===o.name&&!r),r&&t.setPosition(n.seconds()),i},xe=function(e){var t=_.find(h.events(),(function(t){return t.id===e}));return t.sessionRelativeTime=h.calculateEditorTimeTicksFromAbsolute(t.timelineTime),t};const Ae=function(e){const t=oe(e.streamId);t&&(e.timelineTime<t.absoluteStart&&(e.timelineTime=t.absoluteStart),e.timelineTime+e.duration>t.absoluteEnd()&&(e.duration=t.absoluteEnd()-e.timelineTime))},Ue=function(){!function(){const e=[],t=PanoptoTS.Viewer.Constants.BoundaryCutTolerance*Panopto.Core.Constants.TimelineChunkMultiplier,i=h.firstPrimaryOffset(),o=h.duration()+h.firstPrimaryOffset();_.each(l.cutsToReplace,(n=>{if(n.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session)if(n.start>=o||n.end()<=i||n.duration<=0)e.push(n);else{if(n.start<i||Math.abs(n.start-i)<t){const e=n.end();n.start=i,n.duration=e-n.start}(n.end()>o||Math.abs(n.end()-o)<t)&&(n.duration=o-n.start)}})),_.each(e,(e=>{l.cutsToReplace.indexOf(e)>=0&&l.cutsToReplace.splice(l.cutsToReplace.indexOf(e),1)}))}(),function(){const e=_.filter(l.eventsToAdd,(e=>e.type===Panopto.Core.EventType.Caption)),t=_.filter(l.eventsToUpdate,(e=>e.type===Panopto.Core.EventType.Caption));_.each(e.concat(t),(e=>{Ae(e)}))}()};var Me=function(i,l,P,g,f,C,I,O,H,z,N){var ee=_.min(_.filter(i,(function(e){return e.isPrimary})),(function(e){return e.absoluteStart})),te=function(e,t){let i,o;switch(e.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:i=h.calculateRelativeTimeFromRelativeEditorTime(e.relativeEditorStart,e.targetId),o=h.calculateRelativeTimeFromRelativeEditorTime(e.relativeEditorEnd,e.targetId);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:i=e.relativeEditorStart,o=e.relativeEditorEnd}o<=i?r.error(`Could not create cut from CutView. Operation will create a negative cut. relativeStart: ${i} relativeEnd: ${o} cutView:`,e):be(i,o,e.targetId,e.targetType,t)},oe=function(e){const t=h.calculateEditorTimeFromRelativeEditorTime(e.relativeEditorStart,e.targetId);Te(t,e.targetId,e.targetType)};_.each(o.primaryStreams.concat(o.secondaryStreams),(function(e){var t=_.find(i,(function(t){return t.id===e.id}));t&&(e.length=t.duration/Panopto.Core.Constants.TimelineChunkMultiplier,e.url=t.url,e.variants=[])})),g=ve(g).concat(ve(f)).concat(ve(C)).concat(ve(I)),function(e){_.each(e,(function(e){e.sessionId=o.id}))}(O),m=g,g=_.map(g,(function(e){return e.copy()})),v=O;let ne=_.map(O,(function(e){var t=new PanoptoTS.Models.Editor.EditableQuestionList;return t.copyFromClientModel(e),t}));!function(e,t,i,o){var n=Panopto.Core.Logic.Timeline.Timeline(t),a=[],r=e.absoluteStart;t.forEach((e=>{r=Math.min(r,e.absoluteStart)})),_.each(n.elements(),(function(e){e.streams().length||a.push({start:r,end:r+e.length(),length:e.length()}),r+=e.length()})),a.reverse(),_.each(a,(function(n){var a=[];_.each(t,(function(e){e.absoluteStart>=n.start&&(e.absoluteStart-=n.length)})),_.each(i,(function(t){t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&t.start+e.absoluteStart>=n.start&&(t.start-=n.length)})),_.each(o,(function(e){var t;e.timelineTime>n.start&&e.timelineTime<n.end&&e.type===Panopto.Core.EventType.SlideChange?(t=_.find(o,(function(t){return t.type===Panopto.Core.EventType.SlideChange&&t.timelineTime>e.timelineTime})))&&t.timelineTime<=n.end?a.push(e):(e.timelineTime=n.start,e.edited=!0):e.timelineTime>=n.start&&(e.timelineTime-=n.length,e.edited=!0)})),_.each(a,(function(e){o.splice(o.indexOf(e),1)}))}))}(ee,i,l,g);if(_.some(i,(e=>e.isPrimary))?(F.show(),B.show()):(F.hide(),B.hide()),d=Panopto.Core.Logic.Timeline.CutEditor(l),c=Panopto.Viewer.Controls.Timeline.TimelineConverter(t,o),p=Panopto.Core.UI.Components.Editor.TimelineView(o.id,o.folder.id,{positionChanged:function(e){t.setPosition(e/Panopto.Core.Constants.TimelineChunkMultiplier)},cutAdded:function(e,t){me(),te(e,t),de(!0)},cutRemoved:function(e){me(),oe(e),de(!0)},cutResized:function(e,t){let i,o;switch(t.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:i=h.calculateRelativeTimeFromRelativeEditorTime(t.relativeEditorStart,t.targetId),o=h.calculateRelativeTimeFromRelativeEditorTime(t.relativeEditorEnd,t.targetId);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:i=t.relativeEditorStart,o=t.relativeEditorEnd}o<=i?r.error(`Could not create cut from CutView. Operation will create a negative cut. relativeStart: ${i} relativeEnd: ${o} cutView:`,t):(me(),Ee(e,i,o,t.targetId,t.targetType),de(!0))},focusAdded:function(e,t){me(),_.each(e,oe),_.each(t,(e=>{te(e,!1)})),de(!0)},previewChanged:function(e){b=e,le()},thumbnailChosen:Re,uploadChosen:function(){t.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(s.name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:s.id})})},stackExpanded:function(e,i){var o,n,a,r="expanded-view";e.length===R.length&&_.every(R,(t=>_.any(e,(e=>t.id===e.id))))?(Z.hide(),R=[]):(R=e,o=Panopto.Viewer.Controls.ThumbnailStrip(Y,e,t,w,!0),n=i.offset().left+i.outerWidth()/2,a=i.offset().top-10,Y.empty(),o.render((function(){Y.show().toggleClass("no-scroll",Y[0].scrollWidth===Y.innerWidth()).css({left:Math.clamp(n-Y.outerWidth()/2,0,$(window).width()-Y.outerWidth()),top:a-Y.outerHeight()}),X.show().css({left:n,top:a}),$(document).on("mousedown."+r,(function(e){Y.is(e.target)||X.is(e.target)||0!==Y.find(e.target).length||(Z.hide(),$(document).off("mousedown."+r))}))})))},sessionReferenceAdded:e=>{let i=h.calculateRelativeTime(t.position()*Panopto.Core.Constants.TimelineChunkMultiplier);i>h.hostDuration()-.1*Panopto.Core.Constants.TimelineChunkMultiplier&&(i=h.hostDuration());const o=_.chain(h.sessionReferences).filter((e=>e.start===i)).size().value();ie(e,i,o).done((e=>{const i=t.position();me(),h.sessionReferences.push(e),h.refreshTimeline(),de(),t.setPosition(i)}))},sessionReferenceEdited:(e,t)=>{V.forEach((i=>{i.handleSessionReferenceEdit&&i.handleSessionReferenceEdit(e,t)}))},sessionReferenceHovered:(e,t)=>{V.forEach((i=>{i.handleSessionReferenceHighlight&&i.handleSessionReferenceHighlight(e,t)}))},streamAddClicked:()=>{y.showUploadOverlay(void 0)},questionListAddClicked:()=>{Ie("")},youTubeAddClicked:()=>{A.addYouTubeEvent("",t.position())},webpageAddClicked:()=>{A.addUrlEvent("",t.position())},timelineExpansionToggled:e=>{t.expandTimeline(e)},addContentExpansionControlToggled:e=>{t.toggleScreens(!e)},normalizeVolumeChanged:e=>{me(),h.setNormalizeVolume(e),de(!0)}},{previewCuts:Panopto.GlobalResources.ViewerPlus_Edit_PreviewCuts,normalizeVolumeLabel:Panopto.GlobalResources.ViewerPlus_Edit_NormalizeVolume_Label,normalizeVolumeTooltip:Panopto.GlobalResources.ViewerPlus_Edit_NormalizeVolume_Tooltip,timeSeparator:Panopto.GlobalResources.TimeSeparator,millisecondPrecision:Panopto.Core.Constants.DisplayTimeMillisecondPrecision,ViewerPlus_Edit_Expand:Panopto.GlobalResources.ViewerPlus_Edit_Expand,ViewerPlus_Edit_Collapse:Panopto.GlobalResources.ViewerPlus_Edit_Collapse,cutTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Cut,quizTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Quiz,focusTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Focus,addContentButton:Panopto.GlobalResources.ViewerPlus_Edit_AddContent,thumbnailButton:Panopto.GlobalResources.ViewerPlus_Edit_SetDefaultThumbnail,setPrimaryAsDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_SetPrimaryAsDefaultThumbnail,setSecondaryAsDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_SetSecondaryAsDefaultThumbnail,uploadCustomDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_UploadCustomDefaultThumbnail,zoomIn:Panopto.GlobalResources.ViewerPlus_Edit_ZoomIn,zoomOut:Panopto.GlobalResources.ViewerPlus_Edit_ZoomOut,getStreamName:function(e,t){return ae(e,void 0,!0,t)},presentationName:Panopto.GlobalResources.ViewerPlus_Edit_PresentationViewTitle,noThumbnailUrl:Panopto.cacheRoot+"/Images/no_thumbnail.svg"}),u=h=new PanoptoTS.Core.UI.Components.Editor.TimelineState(i,l,g,[],ne,s.referencedSessions,[],H,z,N),T.push(h),we(),function(){var e=h.cuts(),t=[],i=PanoptoTS.Viewer.Constants.BoundaryCutTolerance*Panopto.Core.Constants.TimelineChunkMultiplier;_.each(e,(function(e){var o=_.find(h.streams(),(function(t){return t.id===e.targetId})),n=o?o.duration:h.duration()+h.firstPrimaryOffset(),a=e.start,r=e.end(),s=o?0:h.firstPrimaryOffset();a>=n||e.end()<=s||e.duration<=0?t.push(e):(a<s&&(e.start=s),(r>n||Math.abs(r-n)<i)&&(e.duration=n-a))})),_.each(t,(function(t){e.splice(e.indexOf(t),1)}))}(),L&&(Panopto.Core.ServiceInterface.MultipartUploadManager=Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager,Panopto.Core.ServiceInterface.MultipartUploadManager.setIsS3Upload(x)),!window.slideUploader){const t=e.debug?PanoptoTS.Viewer.Controls.StreamUploaderDebug:PanoptoTS.Viewer.Controls.StreamUploader;window.slideUploader=new t({sessionId:o.id,supportedExtensions:[".ppt",".pptx"],supportedStreamTypes:[Panopto.Core.StreamType.SecondaryPresentation],showStartTime:!1},n,Panopto.Core.ServiceInterface.SessionUploadManagement,Panopto.Core.ServiceInterface.MultipartUploadManager)}if(!window.streamUploader){const t=e.debug?PanoptoTS.Viewer.Controls.StreamUploaderDebug:PanoptoTS.Viewer.Controls.StreamUploader;window.streamUploader=new t({sessionId:o.id,supportedExtensions:Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS,supportedStreamTypes:[1,2],showStartTime:!0},n,Panopto.Core.ServiceInterface.SessionUploadManagement,Panopto.Core.ServiceInterface.MultipartUploadManager)}window.streamUploader.onUploaded.add(U),window.streamUploader.onUpdate.add(M),Oe(P),S=Panopto.Viewer.Players.ThumbnailPlayer(g,t,w),Panopto.Core.UI.Handlers.button(G,pe),Panopto.Core.UI.Handlers.button(j,ue),Panopto.Core.UI.Handlers.button(Q,(function(){Q.hasClass(Panopto.Core.Constants.DisabledClass)||Se()})),Panopto.Core.UI.Handlers.button(W,(function(){W.hasClass(Panopto.Core.Constants.DisabledClass)||Ce()})),he(),$(document).keydown((function(e){if(e.ctrlKey)switch(e.keyCode){case Panopto.Core.Key.Y:ue(),e.preventDefault();break;case Panopto.Core.Key.Z:pe(),e.preventDefault()}})),Panopto.viewer.enableSilverlightEditor&&K.show().find("a").attr("href",PanoptoTS.Viewer.Constants.SilverlightEditorUrlTemplate.format(o.id)),J.show(),Panopto.Core.UI.Handlers.button(J,(function(){D=!D,B.toggle(D),S.toggle(!D),J.text(D?Panopto.GlobalResources.ViewerPlus_Edit_PreviewButtonText:Panopto.GlobalResources.ViewerPlus_Edit_TimelineButtonText).attr("title",D?Panopto.GlobalResources.ViewerPlus_Edit_PreviewButtonTitle:Panopto.GlobalResources.ViewerPlus_Edit_TimelineButtonTitle).toggleClass("previewing",!D),t.resize()})),$(window).on("beforeunload",(function(){return E?Panopto.GlobalResources.ViewerPlus_Edit_UnsavedChanges:void 0})),Panopto.Core.UI.Handlers.button(q,(function(){window.location.search=window.location.search.replace("&edit=true","")})),k.applyState(h),A.applyState(o.id,h),a(),Be((()=>{Fe(P)}))},Oe=e=>{window.slidesTab?(e&&window.slidesTab.setSlideDecks(e),window.slidesTab.setTimelineEditor(w)):C=e,window.streamTab&&window.streamTab.setTimelineEditor(w)};const He=e=>{const t=[],i=[],o=[],n=[];if(h=h.copy(),T[0]=h,h.cuts().length=0,_.each(l.streamsToUpdate,(e=>{var t=_.find(h.streams(),(t=>e.id===t.id));t?(t.name=e.name,t.absoluteStart=e.absoluteStart,t.vrType=e.vrType,t.normalizeVolume=e.normalizeVolume):(i.push(e),l.cutsToReplace=_.filter(l.cutsToReplace,(t=>t.targetId!==e.id)),l.eventsToAdd=_.filter(l.eventsToAdd,(t=>t.streamId!==e.id)),l.eventsToUpdate=_.filter(l.eventsToUpdate,(t=>t.streamId!==e.id)),l.eventsToDelete=_.filter(l.eventsToDelete,(t=>t.streamId!==e.id)))})),_.each(i,(e=>{l.streamsToUpdate.splice(l.streamsToUpdate.indexOf(e),1)})),_.each(l.cutsToReplace,(e=>{h.cuts().push(e)})),_.each(l.slideDecksToDelete,(t=>{_.find(e,(e=>t.id===e.id))?h.slideDecksToDelete().push(t):o.push(t)})),_.each(o,(e=>{l.slideDecksToDelete.splice(l.slideDecksToDelete.indexOf(e),1)})),_.each(l.eventsToAdd,(e=>{e.type===Panopto.Core.EventType.SpeechRecognition&&(e.forceShow=!0),h.events().push(e)})),_.each(l.eventsToUpdate,(e=>{var t=h.events()[_.findIndex(h.events(),(t=>e.id===t.id))];t?(t.edited=!0,t.name=e.name,t.metadata=e.metadata,t.timelineTime=e.timelineTime,t.duration=e.duration,t.link=e.link,t.isDefaultThumbnail=e.isDefaultThumbnail):n.push(e)})),_.each(n,(e=>{l.eventsToUpdate.splice(l.eventsToUpdate.indexOf(e),1)})),n.length=0,_.each(l.eventsToDelete,(e=>{var t=_.find(h.events(),(t=>e.id===t.id));t?h.events().splice(h.events().indexOf(t),1):n.push(e)})),_.each(n,(e=>{l.eventsToDelete.splice(l.eventsToDelete.indexOf(e),1)})),_.each(l.questionListRevisions,(e=>{var t=_.findIndex(h.questionLists(),(t=>e.id===t.id)),i=new PanoptoTS.Models.Editor.EditableQuestionList;i.copyFromClientModel(e),t>=0?(i.isEdited=!0,h.questionLists()[t]=i):(i.id=_.uniqueId("questionList"),h.questionLists().push(i))})),_.each(l.questionListIdsToDelete,(e=>{h.questionLists().splice(_.findIndex(h.questionLists(),(t=>e===t.id)),1)})),_.each(l.sessionReferences.toAdd,(e=>{t.push((e=>ie(e.referencedSessionId,e.start,e.order).done((t=>{h.sessionReferences.push(t),_.each(e.cuts,(e=>{h.cuts().push(Panopto.Core.ServiceInterface.Rest.Objects.Cut({TargetType:Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference,TargetId:t.id,Start:e.start*Panopto.Core.Constants.TimelineChunkMultiplier,Duration:e.duration*Panopto.Core.Constants.TimelineChunkMultiplier}))}))})))(e))})),_.each(l.sessionReferences.toUpdate,(e=>{const t=_.findIndex(h.sessionReferences,(t=>e.id===t.id));if(t>-1){const i=h.sessionReferences[t].copy(!0,{order:e.order,start:e.start});h.sessionReferences.splice(t,1,i)}})),_.each(l.sessionReferences.toDelete,(e=>{const t=_.findIndex(h.sessionReferences,(t=>e===t.id));h.sessionReferences.splice(t,1)})),l.streamChanges){if(l.streamChanges.toAdd){_.each(l.streamChanges.toAdd,(e=>{const t=new AutoClientModels.StreamCreate;t.copyFromStreamCreate(e),h.addedStreams.push(t)}))}l.streamChanges.toDelete&&l.streamChanges.toDelete.forEach((e=>{const t=_.findIndex(h.streams(),(t=>t.id===e.streamId));-1!==t&&h.streams().splice(t,1)}))}return h.setNormalizeVolume(l.normalizeVolume),h.setAIKeyPoints(l.aiKeyPoints),h.setAISummary(l.aiSummary),$.when(...t)};var $e=function(){t.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,`mailto:${Panopto.supportEmailAddress}`)},Be=function(e){Panopto.Core.ServiceInterface.Rest.SessionReferences.get({referencedSessionId:o.id},(t=>{if(t.results.length){alert(Panopto.Core.StringHelpers.format(1===t.results.length?Panopto.GlobalResources.ViewerPlus_Edit_HasReferencedSession:Panopto.GlobalResources.ViewerPlus_Edit_HasReferencedSessions,t.results.length));const e=t.results.every((e=>!0===e.hostSession.isReferenceCopy));p.setCanAddClip(e)}e()}),$e)};var Fe=function(e){var i=function(){l=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:o.id}),ce()},n=function(i){Panopto.Core.ServiceInterface.Rest.SessionChangeSets.updateOwner(i.id,void 0,(function(i){l=i,He(e).done((()=>{t.toggleMessage(void 0),h.refreshTimeline(),d.cuts(h.cuts()),we(),ce(),PanoptoViewer.Language.getCaptionLanguages().length>0&&PanoptoViewer.Language.setCurrentCaptionLanguage(PanoptoViewer.Language.getCaptionLanguages()[0].language),PanoptoViewer.Language.getADLanguages().length>0&&PanoptoViewer.Language.setCurrentADLanguage(PanoptoViewer.Language.getADLanguages()[0]),fe()}))}),$e)};Panopto.Core.ServiceInterface.Rest.SessionChangeSets.get(o.id,(function(e){var o=e.results[0];o?o.ownerId!==Panopto.user.userId?(t.toggleMessage(_.template($("#pendingEditsMessageTemplate").html())({message:Panopto.GlobalResources.ViewerPlus_Edit_PendingChanges.format(o.ownerName,Panopto.Core.TimeHelpers.utcDateToFormattedString(Panopto.Core.TimeHelpers.toLocalPanoptoTime(o.updateDate,Panopto.timeZone),"LLL")),claim:Panopto.GlobalResources.ViewerPlus_Edit_TakeOver.format(o.ownerName),discard:Panopto.GlobalResources.ViewerPlus_Edit_Discard.format(o.ownerName)})),Panopto.Core.UI.Handlers.button($(".pending-edits-claim"),(function(){n(o)})),Panopto.Core.UI.Handlers.button($(".pending-edits-discard"),(function(){Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(o.id,(function(){t.toggleMessage(void 0),i()}),$e)}))):n(o):i()}),$e)};i.eventPane.onTabSetChanged=e=>{V=e.editEventTabs,g=e.editCutTab,y=e.editStreamTab,f=e.editQuestionListTab,Oe(C),C=void 0},Panopto.Core.ServiceInterface.Rest.Sessions.getOne(o.id,(e=>{const i=[];P=(s=e).referencedSessions;const a=[];let r;_.each(P,(e=>{const t=te(e);t.fail((()=>{a.push(e)})),i.push(t)}));const l=$.Deferred();let d;i.push(l),n.getAllStreams(o.id,(e=>{r=e,l.resolve()}),(()=>{l.reject()}));const c=$.Deferred();let p;i.push(c),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCuts(o.id,(e=>{d=e,c.resolve()}),(()=>{c.reject()}));const u=$.Deferred();let h;i.push(u),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(o.id,(e=>{p=e,u.resolve()}),(()=>{u.reject()}));const m=$.Deferred();let v;i.push(m),Panopto.Core.ServiceInterface.Rest.Sessions.getAllEvents(o.id,{eventTypes:[Panopto.Core.EventType.Label,Panopto.Core.EventType.SpeechRecognition,Panopto.Core.EventType.SmartOcrToc,Panopto.Core.EventType.CandidateSmartOcrToc,Panopto.Core.EventType.DefaultThumbnail,Panopto.Core.EventType.AIChapter],pageSize:Panopto.viewer.timelineEditorEventsPageSize},(e=>{h=e,m.resolve()}),(()=>{m.reject()}));const g=$.Deferred();let y;i.push(g),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideEvents(o.id,{pageSize:Panopto.viewer.timelineEditorEventsPageSize},(e=>{v=e,g.resolve()}),(()=>{g.reject()}));const f=$.Deferred();let S;i.push(f),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCaptions(o.id,{pageSize:Panopto.viewer.timelineEditorEventsPageSize,GetAllLanguages:!0,EventTargetTypes:[Panopto.Core.EventTargetType.Transcript,Panopto.Core.EventTargetType.UserCreatedTranscript]},(function(e){y=e,f.resolve()}),(()=>{f.reject()}));const C=$.Deferred();let w;i.push(C),Panopto.Core.ServiceInterface.Rest.Sessions.getAllAudioDescriptions(o.id,{pageSize:Panopto.viewer.timelineEditorEventsPageSize,GetAllLanguages:!0,EventTargetTypes:[Panopto.Core.EventTargetType.AudioDescription]},(function(e){S=e,C.resolve()}),(()=>{C.reject()}));const b=$.Deferred();i.push(b),Panopto.Core.ServiceInterface.Rest.Sessions.getAllQuestionLists(o.id,(e=>{w=e,b.resolve()}),(()=>{b.reject()})),$.when(...i).then((()=>{Me(r,d,p,h,v,y,S,w,o.normalizeVolume,o.aiKeyPoints,o.aiSummary)})).fail((()=>{a.length?function(e){const i=e.reduce(((e,t)=>`${e}\n                <br />\n                <a\n                    href="${(new PanoptoTS.Locations).getSessionViewerUrl(t.referencedSessionId)}"\n                    target="_blank"\n                >\n                    ${t.name}\n                </a>`),Panopto.GlobalResources.ViewerPlus_Edit_InaccessibleClips+"<br />");t.toggleMessage(i)}(a):$e()}))}),$e);const ze=new PanoptoTS.Viewer.Controls.OverlayUploader(t,k);ze.setAbsoluteSessionStart(o.date);const Ne=new PanoptoTS.Viewer.Controls.OverlayController(t.pageStructureElements(),ze,Panopto.GlobalResources);return Ne.onShowOverlays.add((()=>{t.forceLeftPlayerHeight=!0,t.resize()})),Ne.onCloseOverlays.add((()=>{t.forceLeftPlayerHeight=!1,t.resize()})),PanoptoViewer.Language.addLanguageEventListener("currentaudiodescription",(()=>{re(),t.getContentInitialized()&&t.synchronize(!0)})),PanoptoViewer.Language.addLanguageEventListener("currentcaption",(()=>{re(),t.getContentInitialized()&&t.synchronize()})),w.resize=function(e){p.resize(e)},w.synchronize=function(e,i){var o=t.activePrimary(),n=t.activeSecondary(),a=n&&(_.find(h.streams(),(function(e){return e.id===n.id}))||n.id===PanoptoTS.Viewer.Constants.SlideDeckId);p.synchronize(e*Panopto.Core.Constants.TimelineChunkMultiplier,{playing:i,primaryAudioOnly:o&&o.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,secondaryAvailable:a,canAddContent:A.isValidTimeForEvent(e),canAddEmbedEvent:A.isValidTimeForEmbeddedEvent(e),normalizeVolume:h.getNormalizeVolume()}),S.position(e),O.fire({canAddContent:A.isValidTimeForEvent(e),canAddEmbedEvent:A.isValidTimeForEmbeddedEvent(e)})},w.timelinePosition=function(e,t){return c&&b&&!e?c.timelinePosition(t):t},w.timelineEndPosition=()=>c&&b?c.timelineEndPosition():h.duration()/Panopto.Core.Constants.TimelineChunkMultiplier,w.pushEdit=me,w.applyState=de,w.openEventDialog=function(e){var t=_.find(h.events(),(function(t){return t.id===e}));_.find(V,(function(e){return e.ownsEvent(t)})).openEditDialog(t),Z.hide()},w.removeEvent=function(e){me(),h.events().splice(_.findIndex(h.events(),(function(t){return t.id===e})),1),de(),Z.hide()},w.resizeCut=Ee,w.addQuestionList=Ie,w.applyPrimaryHeuristicCuts=we,w.validateEventTime=De,w.getQuestionList=ke,w.updateQuestionList=Le,w.removeQuestionList=function(e){me();var t=h.questionLists();let i=_.find(t,(function(t){return e.id===t.id}));t.splice(t.indexOf(i),1),de()},w.getEvent=xe,w.updateEvent=function(e){me();var i=Panopto.Core.ServiceInterface.Rest.Objects.Event(e);i.edited=!0;const o=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(e.sessionRelativeTime);i.timelineTime=k.toWin32EpochRelative(o).ticks();var n=xe(i.id);h.events().splice(h.events().indexOf(n),1,i);var a=n.timelineTime!==i.timelineTime;return h.refreshTimeline(),de(n.name===i.name&&!a),a&&t.setPosition(h.calculateEditorTimeFromAbsolute(i.timelineTime)),i.sessionRelativeTime=e.sessionRelativeTime,i},w.highlightEventView=function(e,t){e.typeName===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference&&p.highlightSpliceView(e,t)},w.save=fe,w.undo=pe,w.redo=ue,w.commit=Se,w.revert=Ce,w.getAIChapters=function(){return o.aiChapters},w.propagateAIKeyPointsAndSummary=function(e,t){T.forEach((i=>{i.setAIKeyPoints(e),i.setAISummary(t)})),h!==u&&l.id?de():se()},w.getStreamFriendlyType=ne,w.getStream=oe,w.getStreamName=ae,w.getStreamIconClass=function(e,t){var i;switch((e=e||oe(t)).type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:i=PanoptoTS.Viewer.Constants.ScreenCaptureClass;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:i=PanoptoTS.Viewer.Constants.ObjectVideoTabClass}return i},w.getDeliveryId=function(){return o.id},w.savedEvents=function(){return m},w.getCurrentChangeset=()=>l,w.activeState=function(){return h},w.streamTab=function(){return y},w.getViewerPosition=function(){return t.getPosition()},w.setViewerPosition=function(e){t.setPosition(e)},w.session=function(){return s},w.deregisterCallbacks=()=>{window.streamUploader.onUploaded.remove(U),window.streamUploader.onUpdate.remove(M)},w.toggleSecondaryPlaceholder=function(e){Ne.toggleSecondaryPlaceholder(e)},w.onAddContentRequirementChanged=O,w.overlayController=Ne,w.eventService=A,w.timeConverter=k,w.editableQuizService={getQuestionList:e=>PanoptoQuiz.Api.fromEditorToFrontEndModel(ke(e)),updateQuestionList:e=>{Le(PanoptoQuiz.Api.toEditorModel(e))},getSessionLength:()=>h.duration()/Panopto.Core.Constants.TimelineChunkToMillisMultiplier,validateEventTime:e=>De(e)},w},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Channel=function(e,t,i){return{value:e,name:t||e,isUser:i}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},function(e){!function(e){!function(e){e.ContentHelpers=class{static createBaseContent(e,t,i,o,n,a,r,s,l,d,c,p){var u=(o=o||[])[0];return{title:e,id:t,tabClass:i,iconClass:a,iconCode:r,timeline:o,relativeStartTime:u,absoluteStartTime:n=n||u,hiddenTab:s,pauseWhenAvailable:l,isSessionPlaybackBlocking:d,isBroadcast:c,isSecondaryPaneOnly:p}}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.Document=class{constructor(e){let t=e.Url||e.URL;if(t){let e=/^.*?:\/\//;t=window.location.protocol+"//"+t.replace(e,"")}let i="number"!=typeof e.Time,o=this.constructBaseObject(e,t,i);_.extend(this,o),this.url=t,this.isPdf=i,this.isQuiz=e.IsQuestionList}constructBaseObject(t,i,o){let n=-1!==i.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl),a=t.Caption||(t.FileName?decodeURIComponent(t.FileName):n?Panopto.GlobalResources.ViewerPlus_YouTube:Panopto.GlobalResources.ViewerPlus_Website),r=t.ID||t.PublicId||t.PublicID,s=[];o?s.push(0):(s.push(t.Time),s.push(t.Time+PanoptoViewer.Constants.UrlEventDuration));let l=o?Panopto.Core.Constants.DocumentIconCode:t.IsQuestionList?Panopto.Core.Constants.QuestionListIconCode:n?void 0:Panopto.Core.Constants.LinkIconCode,d=n?e.Viewer.Constants.YouTubeIconClass:void 0;return e.Viewer.Data.ContentHelpers.createBaseContent(a,r,o?"pdf":e.Viewer.Constants.UrlTabClass,s,void 0,d,l,t.IsQuestionList,!o,t.IsSessionPlaybackBlocking,!1,!0)}}}(t.Data||(t.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.Event=class{constructor(e){let t=e.EventTargetType||"UserCreatedTranscript",i=e.ID||e.EventID,o=i||e.PublicId!==Panopto.Core.Constants.EmptyGuid&&e.PublicId,n=o?"event"+o:`${t}-${e.Time}`.replace(/\./gi,""),a=_.contains(["Transcript","UserCreatedTranscript"],t),r=_.contains(["ObjectVideo","Primary","PowerPoint","SmartOcrToc"],t),s=a?e.Data||e.Caption:r?e.Caption:e.Caption||e.Data,l=(e.UserName||"").toLowerCase(),d=t.replace(" ","");"Questions"===d&&(d="Comments"),this.id=n,this.eventId=i,this.eventPublicId=e.PublicId,this.sessionId=e.SessionID,this.time=e.Time,this.captionDuration=e.CaptionDuration,this.creationTime=e.CreationTime,this.text=s,this.user=l,this.userDisplayName=e.UserDisplayName||l,this.type=d,this.isQuestionList=e.IsQuestionList,this.saved=!0,this.createdDuringWebcast="Comments"===d&&e.CreatedDuringWebcast,this.url=e.Url,this.showInTableOfContents=e.ShowInTableOfContents}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Slide=function(e){return{time:e.Time,duration:e.Duration,absoluteTime:e.AbsoluteTime,queryParams:{id:e.ObjectIdentifier,number:e.ObjectSequenceNumber,x:void 0}}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.SlideDeck=function(e){var t=_.map(e,Panopto.Viewer.Data.Slide);let i=[];Panopto.features.serverAuthoritativeLeadingEvents||(t[0].time=0,i.push(t[0].time)),Panopto.features.serverAuthoritativeLeadingEvents&&t.forEach((function(e){i.push(e.time),i.push(e.time+e.duration)}));var o=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(Panopto.GlobalResources.ViewerPlus_SlidesTitle,PanoptoTS.Viewer.Constants.SlideDeckId,PanoptoTS.Viewer.Constants.SlideDeckTabClass,i,t[0].absoluteTime,"","",!1,!1,!1,!1,!1);return o.slides=t,o},function(e){!function(e){!function(e){e.TagHelper=class{static convertDeliveryToModel(e){return e.map((e=>{const t=new AutoClientModels.TagSearchItem;return t.content=e.Content,t.usageCount=e.UsageCount,t.id=e.PublicId,t}))}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.Thumbnail=class{constructor(t,i){this.time=t.Time,this.text=t.Caption,this.queryParams={eventTargetPID:t.ObjectPublicIdentifier,sessionPID:t.SessionID,number:t.ObjectSequenceNumber,isPrimary:"Primary"===t.EventTargetType||"SmartOcrToc"===t.EventTargetType,absoluteTime:t.AbsoluteTime},this.isSlide="PowerPoint"===t.EventTargetType,this.showInTableOfContents=t.ShowInTableOfContents,t.ObjectStreamID!==Panopto.Core.Constants.EmptyGuid?this.tabId=t.ObjectStreamID:this.isSlide&&(this.tabId=i?i.id:e.Viewer.Constants.SlideDeckId)}}}(t.Data||(t.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Hive=Panopto.Viewer.Hive||{};var PanoptoTS,ksdn=ksdn||{};!function(e){!function(t){!function(t){var i=e.Viewer.Constants,o=Panopto.Viewer.Analytics,n=Panopto.Viewer.Hive;let a=PanoptoCore.Logging.Logger;class r{constructor(t,s,l){this.helpers=l,this.onReady=$.Deferred(),this.isMediaReady=!1,this.currentLevel=0,this.requestedPosition=void 0,this.requestedStartPosition=void 0,this.requestedContentUri=void 0,this.requestedVrType=void 0,this.readyQueue={name:"ready"},this.isBroadcast=!1,this.isStreamOptimized=!1,this.playerEvents={ready:{name:"ready"},resumed:{name:"resume"},paused:{name:"pause"},stopped:{name:"stop"},finish:{name:"finish"},qualityChange:{name:"quality"},speedChange:{name:"speed"},volumeChange:{name:"volume"},muteChange:{name:"mute"}},this.triggers={load:{name:"load"},ready:{name:"ready"},play:{name:"play"},pause:{name:"pause"},stop:{name:"stop"},finish:{name:"finish"},updatePosition:{name:"updatePosition"},updateBitrate:{name:"updateBitrate"},updateSpeed:{name:"updateSpeed"},updateVolume:{name:"updateVolume"},updateMuted:{name:"updateMuted"}},this.states={uninitialized:{name:"uninitialized"},loaded:{name:"loaded",triggerOnEnter:this.triggers.ready},playing:{name:"playing"},paused:{name:"paused"},finished:{name:"finished"},stopping:{name:"stopping",triggerOnEnter:this.triggers.load},stopped:{name:"stopped",triggerOnEnter:this.triggers.load}},this.transitions={play:{trigger:this.triggers.play,toState:this.states.playing,action:(e,t)=>{this.component.playing?t():(this.component.play(),this.setBufferingTimeout(!0))},exitEvent:this.playerEvents.resumed},pause:{trigger:this.triggers.pause,toState:this.states.paused,action:(e,t)=>{this.component.playing?(this.component.pause(),this.clearBufferingTimeout()):t()},exitEvent:this.playerEvents.paused},ready:{trigger:this.triggers.ready,action:(e,t)=>{this.qualityReporter=o.QualityReporter({streamUrl:e.content.url,isBroadcast:e.content.isBroadcast,isAudioOnly:e.content.isAudioOnly,minDuration:i.QualityReportThreshold}),e.onLoad&&e.onLoad(),_.each(this.video.textTracks,(e=>{e.mode="disabled"})),this.video.textTracks.onaddtrack=e=>{e.track.mode="disabled"},this.isPrimary||this.component.mute(!0),e.playSpeed&&this.component.speed(e.playSpeed),this.setHlsJsEngineEvents(),this.component.video.width&&this.component.video.height?this.helpers.resize():this.component.one("progress",(()=>{this.helpers.resize()})),this.isMediaReady=!0,t()},releaseQueue:this.readyQueue},finish:{trigger:this.triggers.finish,triggerEvent:this.playerEvents.finish,toState:this.states.finished},initialLoad:{trigger:this.triggers.load,toState:this.states.loaded,action:(t,o)=>{this.isBroadcast=t.content.isBroadcast,this.broadcastSegmentDuration=t.content.broadcastSegmentDuration,this.broadcastSegmentBackoff=t.content.broadcastSegmentBackoff;var r=this.generatePlayerConfiguration(t);t.startPosition&&(r.hlsjs.startPosition=t.startPosition);var s=o;this.isBroadcast&&n.isHiveOptimized(t.content.optimizationToken)&&(s=()=>{o(),this.webcastDurationEstimator=new e.Viewer.Logic.HlsJsWebcastDurationEstimator(this.component,Panopto.viewer.enableWebcastServerAgeFactor)}),this.component=this.initializeFlowplayerComponent(r,t,s),this.isBroadcast&&!n.isHiveOptimized(t.content.optimizationToken)&&(this.webcastDurationEstimator=new e.Viewer.Logic.HlsJsWebcastDurationEstimator(this.component,Panopto.viewer.enableWebcastServerAgeFactor)),this.video=this.$container.find("video")[0];const l=this.isPrimary?"primary":"secondary",d=e=>a.verbose(`[<video/>] [${l}] > ${e.type} event`);var c,p;["durationchange","ended","error","loadeddata","loadedmetadata","pause","play","playing","seeked","seeking","stalled","waiting"].forEach((e=>this.video.addEventListener(e,d))),this.$container.find(".fp-ui").click((()=>!1)).mousedown((e=>{c=e.pageX,p=e.pageY})).mouseup((e=>{1===e.which&&c===e.pageX&&p===e.pageY&&this.helpers.togglePlaying()})),this.component.on("progress",(()=>{this.component.playing&&this.setBufferingTimeout(!0)})),setInterval((()=>this.checkForBuffering),i.BufferingTimeoutThreshold)}},load:{trigger:this.triggers.load,toState:this.states.loaded,action:(e,t)=>{e.clip.sources[0].src!==this.component.video.sources[0].src||e.clip.vr!==this.component.video.vr?(this.hlsjs&&(this.hlsjs.config.startPosition=e.startPosition||-1),this.loadClipIntoComponent(e)):t()},exitEvent:this.playerEvents.ready},stop:{trigger:this.triggers.load,action:(e,t)=>{this.flushQualityReport(),this.component.stop()},exitEvent:this.playerEvents.stopped,toState:this.states.stopped},inactiveSet:[{trigger:this.triggers.play,delayToQueue:this.readyQueue},{trigger:this.triggers.pause,delayToQueue:this.readyQueue},{trigger:this.triggers.updatePosition,delayToQueue:this.readyQueue},{trigger:this.triggers.updateBitrate,delayToQueue:this.readyQueue},{trigger:this.triggers.updateSpeed,delayToQueue:this.readyQueue},{trigger:this.triggers.updateVolume,delayToQueue:this.readyQueue},{trigger:this.triggers.updateMuted,delayToQueue:this.readyQueue}],activeSet:[{trigger:this.triggers.updatePosition,action:(t,i)=>{if(t===this.requestedPosition){var o=this.clampPosition(t);this.requestedPosition=o;const r=()=>{this.requestedPosition===o&&(this.requestedPosition=void 0),i()};if(!PanoptoCore.Browser.isChrome&&this.component.video.time!==o||Math.abs(o-this.component.video.time)>e.Viewer.Constants.BadSeekThreshold||0===o){let i=r;if("html5"===this.component.engine.engineName){i=()=>setTimeout(r,0);var n=!1;const e=()=>{n||t!==this.requestedPosition||this.component.seek(o,i)},a=()=>{n=!0};$(this.video).one("progress",e),$(this.video).one("seeking",a)}const s=$.Deferred();let l;s.then((()=>{"html5"===this.component.engine.engineName?setTimeout(i,0):i()})),this.isBroadcast&&PanoptoCore.Browser.isSafari&&(l=setTimeout((()=>{a.warning(`WARN: forcing callback after seek timeout elapsed. Checking seek correctness. ${this.component.video.time} vs. ${o}`),0===this.component.video.time&&0!==o&&(a.warning("ERROR: Repeating seek request."),this.position(o+.01,void 0)),s.resolve()}),e.Viewer.Constants.MissingSeekedEventTimeout)),this.component.seek(o,(()=>{clearTimeout(l),s.resolve()}))}else r()}else i()}},{trigger:this.triggers.updateBitrate,action:(e,t)=>{var i=PanoptoViewer.Services.getHlsJsQualityLevel(this.hlsjs.levels.length,e);i!=(this.hlsjs&&this.hlsjs.autoLevelEnabled?-1:this.hlsjs.currentLevel)?this.component.quality(i):t()},exitEvent:this.playerEvents.qualityChange},{trigger:this.triggers.updateSpeed,action:(e,t)=>{this.component.currentSpeed!==e?this.component.speed(e):t()},exitEvent:this.playerEvents.speedChange},{trigger:this.triggers.updateVolume,action:(e,t)=>{this.component.volumeLevel!=e?this.component.volume(e):t()},exitEvent:this.playerEvents.volumeChange},{trigger:this.triggers.updateMuted,action:(e,t)=>{this.component.mute(e)},exitEvent:this.playerEvents.muteChange},{trigger:this.triggers.load,toState:this.states.stopping}]},this.isPrimary=t,this.$container=s,this.initialize(),this.initializeTransitions();var d=t?"Primary":"Secondary_"+r.secondaryPlayerCount;this.machine=new e.Logic.StateMachine.Machine(d,this.states.uninitialized),this.machine.attachEvent=(e,t,i)=>this.attachEvent(e,t,i),this.machine.detachEvent=e=>this.detachEvent(e),this.$bufferingIndicator=$("#"+(t?"primaryBuffering":"secondaryBuffering")),t||r.secondaryPlayerCount++}attachEvent(e,t,i){var o=e?e.name:r.eventNamespace,n=t?t.name:"";this.component.on(n+"."+o,i)}detachEvent(e){var t=e?e.name:r.eventNamespace;this.component.off("."+t)}initializeTransitions(){this.states.uninitialized.transitions=this.transitions.inactiveSet.slice(),this.states.uninitialized.transitions.push(this.transitions.initialLoad),this.states.loaded.transitions=this.transitions.activeSet.slice(),this.states.loaded.transitions.push(this.transitions.ready),this.states.loaded.transitions.push(this.transitions.play),this.states.loaded.transitions.push(this.transitions.pause),this.states.playing.transitions=this.transitions.activeSet.slice(),this.states.playing.transitions.push(this.transitions.pause),this.states.playing.transitions.push(this.transitions.finish),this.states.playing.ignoreTriggers=[this.triggers.play],this.states.paused.transitions=this.transitions.activeSet.slice(),this.states.paused.transitions.push(this.transitions.play),this.states.paused.ignoreTriggers=[this.triggers.pause],this.states.stopping.transitions=this.transitions.inactiveSet.slice(),this.states.stopping.transitions.push(this.transitions.stop),this.states.stopped.transitions=this.transitions.inactiveSet.slice(),this.states.stopped.transitions.push(this.transitions.load),this.states.finished.transitions=this.transitions.activeSet.slice(),this.states.finished.transitions.push(this.transitions.play),this.states.finished.transitions.push(this.transitions.pause),this.states.finished.transitions.push(this.transitions.load)}clearBufferingTimeout(){this.$bufferingIndicator.hide(),clearTimeout(this.bufferingTimeout)}setBufferingTimeout(e){e&&this.clearBufferingTimeout(),this.bufferingTimeout=window.setTimeout((()=>{this.component.playing&&(this.$bufferingIndicator.show(),this.$bufferingIndicator.css({top:this.$container.offset().top+(this.$container.height()-this.$bufferingIndicator.height())/2,left:this.$container.offset().left+(this.$container.width()-this.$bufferingIndicator.width())/2}))}),i.BufferingTimeoutThreshold)}checkForBuffering(){this.machine.getCurrentState()!==this.states.paused?this.component&&this.component.video&&this.lastBufferingCheckPosition!==this.component.video.time?(this.$bufferingIndicator.hide(),this.lastBufferingCheckPosition=this.component.video.time):(this.$bufferingIndicator.show(),this.$bufferingIndicator.css({top:this.$container.offset().top+(this.$container.height()-this.$bufferingIndicator.height())/2,left:this.$container.offset().left+(this.$container.width()-this.$bufferingIndicator.width())/2})):(this.lastBufferingCheckPosition=void 0,this.$bufferingIndicator.hide())}flushQualityReport(){this.qualityReporter&&this.qualityReporter.flushQualityReport(this.hlsjs&&this.component.playing,this.component.video.time,this.currentLevel,this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels.length,this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels.length&&this.hlsjs.levels[this.currentLevel].bitrate,this.hlsjs&&this.hlsjs.autoLevelEnabled)}equalsLoadedContent(e){let t=!0;if(e.vrType!==this.requestedVrType)t=!1;else if(e.url&&e.url!==this.requestedContentUri){this.requestedContentUri.split("?")[0]!==e.url.split("?")[0]&&(t=!1)}return t}setContent(e,t,i){if(t||!this.equalsLoadedContent(e)){this.requestedContentUri=e.url,this.requestedVrType=e.vrType;var o=this.generatePlayerLoadData(e,i);this.machine.handleTrigger(this.triggers.load,o)}}initialize(){if(!flowplayer.conf.hlsjs){flowplayer.conf.fullscreen=!0,flowplayer.conf.hlsjs={listeners:["hlsLevelSwitch","hlsLevelLoaded","hlsMediaAttached","hlsFragLoaded","hlsManifestLoaded"],safari:!0,smoothSwitching:!1,livePositionOffset:0},PanoptoCore.Browser.isFirefox&&(flowplayer.conf.hlsjs.maxBufferHole=PanoptoViewer.Constants.FirefoxMaxBufferHole);var e={};try{e=JSON.parse(Panopto.viewer.hlsJsConfig)}catch(e){a.warning("Error parsing HlsJsConfig setting, ignored.")}_.extend(flowplayer.conf.hlsjs,e),_.extend(flowplayer.conf.hlsjs,PanoptoViewer.Data.getHlsConfigQueryParams(window.location.search.slice(1))),a.info(`[FlowplayerMachine] hls config: ${JSON.stringify(flowplayer.conf.hlsjs)}`)}}clampPosition(e){var t=0,i=this.machine.getCurrentState();if((i===this.states.finished||i===this.states.loaded||i===this.states.paused||i===this.states.playing)&&this.component&&this.component.video&&(this.component.video.duration||PanoptoCore.Browser.isSafari)){var o=this.isBroadcast&&this.webcastDurationEstimator?this.webcastDurationEstimator.getDuration()-this.broadcastSegmentBackoff*this.broadcastSegmentDuration:this.component.video.duration;t=Math.max(0,Math.min(e,o))}return t}generatePlayerConfiguration(e){const t=-1!==window.location.search.indexOf("debuglog=true");return this.isBroadcast&&(this.broadcastSegmentBackoff&&3!==this.broadcastSegmentBackoff||!Panopto.viewer.enableServerBasedBackoffCalculation)&&_.extend(flowplayer.conf.hlsjs,{initialLiveManifestSize:this.broadcastSegmentBackoff,liveSyncDurationCount:this.broadcastSegmentBackoff}),{key:Panopto.viewer.flowplayerKey,clip:e.clip,chromecast:!Panopto.features.disableFeaturesRequiringExternalNetworkAccess,vrvideo:{mode:e.content.vrType===PanoptoViewer.MediaVRType.Full?"full":e.content.vrType===PanoptoViewer.MediaVRType.Half?"half":void 0,renderOnPause:!0},dvr:!0,debug:t,hlsjs:_.extend({debug:new PanoptoViewer.HlsjsDebugLogger(e.content.id)},flowplayer.conf.hlsjs)}}generatePlayerLoadData(e,t){return{content:e,clip:{sources:[{src:e.url,type:-1!==e.url.indexOf(".m3u8")?i.HLSMimeType:i.MP4MimeType}],live:e.isBroadcast,dvr:e.isBroadcast,vr:e.vrType>PanoptoViewer.MediaVRType.None},onLoad:t,playSpeed:this.component?this.component.currentSpeed:void 0,startPosition:this.requestedStartPosition}}initializeFlowplayerComponent(e,t,i){return a.info("[FlowplayerMachine] > configuration:",JSON.stringify(e)),flowplayer(this.$container[0],e,(()=>{this.onReady.resolve(),i&&i()}))}loadClipIntoComponent(e){this.component.load(e.clip)}setHlsJsEngineEvents(){if(!this.hlsjs){this.hlsjs=this.component.engine.hls;var e=e=>{this.currentLevel!==e&&(this.currentLevel=e,a.info((this.isPrimary?"Primary":"Secondary")+" player started playing "+`segment at quality level ${this.currentLevel} of `+`${this.hlsjs.levels.length} (${this.hlsjs.levels[this.currentLevel].bitrate})`),this.flushQualityReport())};this.hlsjs&&(this.hlsjs.on(PanoptoViewer.HlsJsEvents.MANIFEST_LOADED,(()=>{const e=PanoptoViewer.Services.getInitialBitrate(),t=PanoptoViewer.Services.getHlsJsQualityLevel(this.hlsjs.levels.length,e);this.hlsjs.currentLevel=t})),this.hlsjs.on(PanoptoViewer.HlsJsEvents.LEVEL_SWITCHED,((t,i)=>e(i.level))),this.hlsjs.on(PanoptoViewer.HlsJsEvents.ERROR,((e,t)=>a.error(`[HlsJs] [${this.isPrimary?"primary":"secondary"}] > ERROR!`,e,t,this.video.error))))}}content(e,t,i){this.setContent(e,t,i)}position(t,i){if(void 0===t){var o=this.requestedPosition||this.requestedStartPosition;if(void 0===o)if(this.component&&this.component.video){o=this.component.video.time;const t=e.Viewer.Constants.NativePositionFallbackRegion;this.video&&(0===o||o===this.video.duration||o>t&&this.video.currentTime<t)&&(o=this.video.currentTime)}else o=0;return isFinite(o)?o:this.clampPosition(o)}this.requestedPosition!==t&&(this.requestedPosition=t,this.machine.handleTrigger(this.triggers.updatePosition,this.requestedPosition,i))}setStartPosition(e){this.requestedStartPosition=e}playState(e){e==PanoptoViewer.Data.ViewerPlayState.Playing?this.machine.handleTrigger(this.triggers.play):this.machine.handleTrigger(this.triggers.pause)}playSpeed(e){this.machine.handleTrigger(this.triggers.updateSpeed,e)}bitrate(e){this.machine.handleTrigger(this.triggers.updateBitrate,e)}volume(e){this.isPrimary&&this.machine.handleTrigger(this.triggers.updateVolume,e/100)}muted(e){this.isPrimary&&this.machine.handleTrigger(this.triggers.updateMuted,e)}isFullscreen(e){if(void 0===e)return this.component&&this.component.isFullscreen;this.component&&e!==this.component.isFullscreen&&(this.component.disabled=!1,this.component.fullscreen())}width(){return this.isMediaReady?this.component.video.width||this.video.videoWidth:16}height(){return this.isMediaReady?this.component.video.height||this.video.videoHeight:9}ended(){return this.machine.getCurrentState()===this.states.finished&&void 0===this.machine.getCurrentTransition()}streamLength(){return this.isMediaReady?this.component.video.duration:0}numericBitrate(){return this.isMediaReady&&this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels[this.currentLevel]?this.hlsjs.levels[this.currentLevel].bitrate:0}bitrateOptions(){return this.isMediaReady&&this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels[this.currentLevel]?_.map(this.hlsjs.levels,(e=>e.bitrate)):[]}syncPlayState(){}syncTimes(){}setCaptionText(){}setCaptionStyles(){}showShadow(){}canMoveAudioPlayerOffscreen(){return!0}}r.eventNamespace="machine",r.secondaryPlayerCount=0,t.FlowplayerMachine=r;t.HiveFlowplayerMachine=class extends r{clampPosition(e){var t=super.clampPosition(e);if(this.isBroadcast&&this.webcastDurationEstimator&&0===t){var i=this.relativeStart+this.component.video.duration;t=Math.min(e,i)}else if(this.isBroadcast&&!this.webcastDurationEstimator&&this.component.video.duration&&this.broadcastSegmentBackoff&&3!==this.broadcastSegmentBackoff){i=this.component.video.duration;i-=this.broadcastSegmentBackoff*this.broadcastSegmentDuration,t=Math.min(e,i)}return t}generatePlayerConfiguration(e){var t=super.generatePlayerConfiguration(e);return n.isHiveOptimized(e.content.optimizationToken)&&(t.hive=n.createFlowplayerPlugin(e.content,this.isPrimary),n.attachFlowplayerHlsJsConfig(e.content,t.hlsjs),this.isStreamOptimized=!0),t}generatePlayerLoadData(e,t){var i=super.generatePlayerLoadData(e,t);return n.isHiveOptimized(e.optimizationToken)&&(i.optimizationToken=e.optimizationToken,this.relativeStart=e.relativeStart),i}loadClipIntoComponent(e){n.isHiveOptimized(e.optimizationToken)?this.loadHiveTicketIntoPlayer(e,null):super.loadClipIntoComponent(e)}optimizationProvider(){return e.Viewer.Constants.Hive}loadHiveTicketIntoPlayer(e,t){const i=n.getHiveSourceForReload(this.component,e);n.loadHiveTicket(this.component,i,t,e,((e,t)=>{super.loadClipIntoComponent(e)}))}}}(t.Players||(t.Players={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.FlowplayerMachineLoadData=class{toString(){return`Load ${this.clip.sources[0].src} at position ${this.startPosition}`}}}(e.Players||(e.Players={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},function(e){!function(e){!function(e){const t=PanoptoCore.Logging.Logger;e.SingleStreamMediaPlayer=class{constructor(e,t,i){this.isPrimary=e,this.$container=t,this.helpers=i,this.streamPlayer=null,this.startPosition=void 0,this.cache={},this.bufferingStateChanged=()=>{this.streamPlayer?.isBuffering?this.bufferingIndicatorDiv.style.visibility="visible":this.bufferingIndicatorDiv.style.visibility="hidden"},this.containerDiv=this.$container[0],this.videoElement=this.$container.find("video")[0],this.bufferingIndicatorDiv=document.createElement("div"),this.bufferingIndicatorDiv.classList.add("bufferingIndicator"),this.containerDiv.appendChild(this.bufferingIndicatorDiv),PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.BufferingIndicator)(this.bufferingIndicatorDiv,{resources:Panopto.GlobalResources}),this.playerVolume=1,this.playerMuted=!1,this.playerSpeed=1}width(){return this.streamPlayer&&this.streamPlayer.isInitialized?this.videoElement.videoWidth||this.$container.width():this.$container.width()||16}height(){return this.streamPlayer&&this.streamPlayer.isInitialized?this.videoElement.videoHeight||this.$container.height():this.$container.height()||9}ended(){return this.streamPlayer?.isEnded||!1}streamLength(){return this.streamPlayer?.seekableDuration||0}numericBitrate(){return this.streamPlayer?.bitrate||0}bitrateOptions(){return this.streamPlayer?.bitrateOptions||[]}isFullscreen(e){return!!this.streamPlayer&&(void 0!==e&&e!==this.streamPlayer.fullscreen&&(this.streamPlayer.fullscreen=e),this.streamPlayer.fullscreen)}content(e,i,o){let n=this.streamPlayer;if(n)if(n.isPlaying&&n.pause(),n.id===e.id)t.info("[SingleStreamMediaPlayer.content] Same ID we are currently viewing");else if(void 0!==this.cache[e.id]){t.info("[SingleStreamMediaPlayer.content] Pulling player out of the cache");const i=this.cache[e.id];this.videoElement.hidden=!0,this.videoElement=i.video,this.videoElement.hidden=!1,this.streamPlayer=i.player}else{t.info("[SingleStreamMediaPlayer.content] new stream ID");const e=document.createElement("video");e.classList.add("video-js"),this.videoElement.hidden=!0,this.containerDiv.append(e),this.videoElement=e,this.streamPlayer=null}this.streamPlayer&&(i?(this.streamPlayer.dispose(),this.streamPlayer=null,t.info("[SingleStreamMediaPlayer.content] Forcing reload")):o&&o()),this.streamPlayer||(this.streamPlayer=new PanoptoViewer.Players.SingleStreamPlayer(e,this.containerDiv,this.videoElement,this.startPosition,(()=>{if(o&&o(),void 0!==this.onReady&&this.onReady.resolve(),this.helpers.resize)if(this.videoElement.videoWidth&&this.videoElement.videoHeight)this.helpers.resize();else{t.info("[SingleStreamMediaPlayer] Deferring resize until dimensions are available");const e=()=>{this.videoElement.videoWidth&&this.videoElement.videoHeight&&(this.helpers.resize(),this.videoElement.removeEventListener("progress",e))};this.videoElement.addEventListener("progress",e)}else t.error("[SingleStreamMediaPlayer] this.helpers.resize() is missing")}),(e=>{window.alert(`Playback error: ${e}`)}),this.isPrimary?"primary":"secondary"),this.streamPlayer.addEventListener("play",(()=>{2===this.lastSetPlayState&&this.streamPlayer.pause()})),this.streamPlayer.setOnBufferingStateChanged(this.bufferingStateChanged),this.isPrimary||(this.streamPlayer.muted=!0),this.cache[e.id]={video:this.videoElement,player:this.streamPlayer},this.isPrimary?(this.streamPlayer.volume=this.playerVolume,this.streamPlayer.muted=this.playerMuted,this.streamPlayer.playbackRate=this.playerSpeed):this.streamPlayer.muted=!0)}position(e,t){return void 0!==e?(this.streamPlayer&&this.streamPlayer.setStreamPosition(e,t),e):this.streamPlayer?this.streamPlayer.anticipatedStreamPosition:0}setStartPosition(e){this.startPosition=e}playState(e){this.streamPlayer?(this.lastSetPlayState=e,e===PanoptoViewer.Data.ViewerPlayState.Playing?this.streamPlayer.play():this.streamPlayer.pause()):t.error("[SingleStreamMediaPlayer.playState] setting playstate before initialized!")}playSpeed(e){this.playerSpeed=e,this.applyToPlayers((e=>{e.playbackRate=this.playerSpeed}))}bitrate(e){this.streamPlayer&&(this.streamPlayer.bitrate=e)}volume(e){this.isPrimary?(this.playerVolume=e/100,this.applyToPlayers((e=>{e.volume=this.playerVolume}))):t.error("[SingleStreamMediaPlayer] Setting volume on a secondary. Ignoring.")}muted(e){this.isPrimary?(this.playerMuted=e,this.applyToPlayers((e=>{e.muted=this.playerMuted}))):t.error("[SingleStreamMediaPlayer] Setting muted on a secondary. Ignoring.")}syncPlayState(e){}syncTimes(e,t){}setCaptionText(e){}setCaptionStyles(e){}showShadow(e){}optimizationProvider(){return this?.streamPlayer?.optimizationProvider||""}applyToPlayers(e){for(const t of Object.keys(this.cache))e(this.cache[t].player)}}}(e.Players||(e.Players={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){class t{constructor(e){this.params=e,this.isTopLevelComment=!1,this.animationSpeed=void 0!==e.animationSpeed?e.animationSpeed:"fast",this.setEventData(e.commentEvent)}setAsTopLevelComment(e){this.isTopLevelComment=e}isForEvent(t){return e.DiscussionUtils.eventsMatchById(this,t)}updateEvent(e){this.eventDataChanged(e)&&(this.setEventData(e),this.render(this.element,!0))}eventDataChanged(e){return this.id!==e.id||this.eventId!==e.eventId||this.text!==e.text||this.editable!==e.editable||this.deletable!==e.deletable}setEventData(t){this.commentEvent=_.clone(t),this.userDisplayName=t.userDisplayName,this.creationTimeInMillis=t.creationTime,this.sessionTime=e.DiscussionUtils.roundSessionTime(t.time),this.text=t.text,this.id=t.id,this.eventId=t.eventId,this.editable=t.editable,this.deletable=t.deletable,this.replyable=t.replyable;let i=this.params.panoptoGlobal.Core.TimeHelpers.toLocalPanoptoTime(this.params.panoptoGlobal.Core.TimeHelpers.formatWin32EpochTimeToDate(this.creationTimeInMillis),this.params.panoptoGlobal.timeZone),o=this.params.panoptoGlobal.GlobalResources.ViewerPlus_CommentTimestamp;this.commentTimestamp=o.format(this.params.panoptoGlobal.Util.displayDate(i,{format:"friendly",local:!0}),this.params.panoptoGlobal.Util.displayDate(i,{format:"time",local:!0})),this.creationDateString=this.params.panoptoGlobal.Util.displayDate(i,{format:"long",local:!0}),this.sessionTimestampString=this.params.panoptoGlobal.Core.TimeHelpers.formatDuration(this.sessionTime,this.params.panoptoGlobal.GlobalResources.TimeSeparator)}render(e,i=!1){let o=$(t.template({comment:this,resx:this.params.panoptoGlobal.GlobalResources}));if(o.keydown((e=>this.params.handleKeys(e))),o.mousedown((()=>o.addClass("clicked"))),o.blur((()=>o.removeClass("clicked"))),this.replyable){let e=o.find(".reply-link");e.show(),this.params.panoptoGlobal.Core.UI.Handlers.button(e,(()=>{this.params.replyCallback(this.commentEvent)}))}if(this.editable){let e=o.find(".edit-link");e.show(),this.params.panoptoGlobal.Core.UI.Handlers.button(e,(()=>{this.params.editClickedCallback(this.commentEvent)}))}if(this.deletable){let e=o.find(".delete-link");e.show(),this.params.panoptoGlobal.Core.UI.Handlers.button(e,(()=>{this.params.deleteClickedCallback(this.commentEvent)}))}this.isTopLevelComment&&this.params.panoptoGlobal.Core.UI.Handlers.button(o,(()=>{this.params.eventClickedCallback(this.commentEvent)})),i?e.replaceWith(o):e.append(o),this.element=o}remove(){this.element.slideUp(this.animationSpeed,(()=>{this.element.remove()}))}}t.template=_.template('\n            <li class="comment-block"\n                id="<@- comment.id @>"\n                tabindex="0">\n                <div class="comment-header">\n                    <span class="username"><@- comment.userDisplayName @></span>\n                    <@ if (comment.isTopLevelComment) { @>\n                        <span class="session-time">\n                            <@- comment.sessionTimestampString @>\n                        </span>\n                    <@ } @>\n                </div>\n                <div class="comment-body" dir="auto">\n                    <@- comment.text @>\n                </div>\n                <div class="comment-footer">\n                    <span class="comment-time" title="<@- comment.creationDateString @>">\n                        <@- comment.commentTimestamp @>\n                    </span>\n                    <a class="reply-link"\n                        href="#"\n                        aria-label="<@- comment.replyToString @>"\n                        style="display: none">\x3c!--\n                        --\x3e<@- resx.ViewerPlus_Reply @>\x3c!--\n                    --\x3e</a>\n                    <a class="edit-link"\n                        href="#"\n                        aria-label="<@- comment.ViewerPlus_Discussion_EditCommentArialabel @>"\n                        style="display: none">\x3c!--\n                        --\x3e<@- resx.ViewerPlus_EventEdit @>\x3c!--\n                    --\x3e</a>\n                    <a class="delete-link"\n                        href="#"\n                        aria-label="<@- comment.ViewerPlus_Discussion_DeleteCommentArialabel @>"\n                        style="display: none">\x3c!--\n                        --\x3e<@- resx.ViewerPlus_EventDelete @>\x3c!--\n                    --\x3e</a>\n                </div>\n            </li>\n        '),e.CommentViewModel=t}(e.Discussion||(e.Discussion={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){class t{constructor(e){this.params=e,this.handleKeys=e=>{let t,i=$(e.target),o=!0;switch(e.which){case this.params.panoptoGlobal.Core.Key.UpArrow:this.focusPrevComment(i);break;case this.params.panoptoGlobal.Core.Key.DownArrow:this.focusNextComment(i);break;case this.params.panoptoGlobal.Core.Key.LeftArrow:t=this.findTopLevelComment(i),t.collapseComments();break;case this.params.panoptoGlobal.Core.Key.RightArrow:t=this.findTopLevelComment(i),t.expandComments();break;default:o=!1}o&&(e.preventDefault(),e.stopPropagation())},this.target=e.target,this.events=e.events.slice(0),this.animationSpeed=void 0!==e.animationSpeed?e.animationSpeed:"fast",this.groupedComments=this.transformEventsToGroupedModel(e.events)}render(){this.container=$(t.template({resx:this.params.panoptoGlobal.GlobalResources}));let e=this.groupedCommentsToSortedArray(this.groupedComments);for(let t of e)t.render(this.container);this.target.append(this.container),$("#commentsTabPane").find(".event-input").hide()}syncComments(t,i=!1){if(i){let i=_.filter(this.events,(i=>!_.find(t,(t=>e.DiscussionUtils.eventsMatchById(i,t)))));_.each(i,(e=>{this.removeComment(e)}))}_.each(t,(e=>{this.addComment(e)})),this.events=t.slice(0)}addComment(t){let i=e.DiscussionUtils.roundSessionTime(t.time),o=this.groupedComments[i];o?o.addComment(t):this.addNewThread([t])}addNewThread(t){let i=new e.ThreadViewModel({commentEvents:t,animationSpeed:this.animationSpeed,handleKeys:this.handleKeys,eventClickedCallback:this.params.eventClickedCallback,editClickedCallback:this.params.editClickedCallback,deleteClickedCallback:this.params.deleteClickedCallback,submitNewEventCallback:this.params.submitNewEventCallback,panoptoGlobal:this.params.panoptoGlobal});i.render(this.container),this.groupedComments[i.comment.sessionTime]=i}removeComment(t){this.container.find("#"+t.id);let i=e.DiscussionUtils.roundSessionTime(t.time),o=this.groupedComments[i];o.removeComment(t)&&delete o[t.time.toFixed(2)]}scrollCommentIntoView(t){let i=e.DiscussionUtils.roundSessionTime(t.time),o=this.groupedComments[i];if(o){o.expandComments(0);let e=this.container.find("#"+t.id);e.length>0&&(e[0].scrollIntoView(),e.addClass("highlight-comment"),e.animate({backgroundColor:"transparent"},"slow"))}}transformEventsToGroupedModel(t){let i=_.groupBy(t,(t=>e.DiscussionUtils.roundSessionTime(t.time))),o={};return Object.keys(i).forEach((t=>{i[t]=_.sortBy(i[t],(e=>e.creationTime));let n=new e.ThreadViewModel({commentEvents:i[t],animationSpeed:this.animationSpeed,handleKeys:this.handleKeys,eventClickedCallback:this.params.eventClickedCallback,editClickedCallback:this.params.editClickedCallback,deleteClickedCallback:this.params.deleteClickedCallback,submitNewEventCallback:this.params.submitNewEventCallback,panoptoGlobal:this.params.panoptoGlobal});o[t]=n})),o}groupedCommentsToSortedArray(e){let t=_.values(e);return t=_.sortBy(t,(e=>e.comment.creationTimeInMillis)),t}focusNextComment(e){let t=$(".threaded-discussion").find(".comment-block:visible"),i=t.index(e);i+1<t.length&&t[i+1].focus()}focusPrevComment(e){let t=$(".threaded-discussion").find(".comment-block:visible"),i=t.index(e);i>0&&t[i-1].focus()}findTopLevelComment(e){let t=e.closest(".thread-wrapper").attr("data-timestamp");return this.groupedComments[t]}}t.template=_.template("\n        <ul\n            class='threaded-discussion'\n            aria-label=\"<@- resx.ViewerPlus_Discussion_OuterListArialabel @>\">\n        </ul>\n        "),e.Discussion=t}(e.Discussion||(e.Discussion={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){class t{constructor(e){this.params=e}render(){$(".discussion-input-wrapper").remove(),this.element=$(t.template({resx:this.params.panoptoGlobal.GlobalResources}));let e=this.element.find(".discussion-textarea");e.on("paste input",(()=>{this.resizeInput(e)})),e.keydown((t=>{if(!t.ctrlKey||t.keyCode!==Panopto.Core.Key.UpArrow)if(t.stopPropagation(),t.keyCode!==Panopto.Core.Key.Enter||t.shiftKey)t.keyCode===Panopto.Core.Key.Esc&&this.remove();else{var i=jQuery.trim(e.val());i&&(this.params.onSubmit(i,this.params.event.time),this.remove())}})),this.params.panoptoGlobal.Core.UI.Handlers.button(this.element.find(".cancel-link"),(()=>{this.remove()})),this.params.target.append(this.element),e.focus(),e[0].scrollIntoView()}resizeInput(e){var t=e.innerHeight()-e.height();e.height(1);var i=e[0].scrollHeight-t;e.height(i)}remove(){this.element.remove()}}t.template=_.template('\n        <div class="discussion-input-wrapper">\n            <textarea class="discussion-textarea"></textarea>\n            <a href="#" class="cancel-link">\n                <@- resx.ViewerPlus_EventTab_Cancel @>\n            </a>\n        </div>\n        '),e.DiscussionInputControl=t}(e.Discussion||(e.Discussion={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){e.DiscussionUtils=class{static eventsMatchById(e,t){let i=!1;return(e.id||t.id)&&e.id===t.id&&(i=!0),(e.eventId||t.eventId)&&e.eventId===t.eventId&&(i=!0),i}static roundSessionTime(e){return+e.toFixed(2)}}}(e.Discussion||(e.Discussion={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){class t{constructor(t){this.params=t,this.replyClickedCallback=t=>{new e.DiscussionInputControl({event:t,target:this.element,onSubmit:this.params.submitNewEventCallback,panoptoGlobal:this.params.panoptoGlobal}).render()},this.animationSpeed=void 0!==t.animationSpeed?t.animationSpeed:"fast";let i=_.map(t.commentEvents,(t=>new e.CommentViewModel({animationSpeed:this.animationSpeed,commentEvent:t,replyCallback:this.replyClickedCallback,handleKeys:this.params.handleKeys,eventClickedCallback:this.params.eventClickedCallback,editClickedCallback:this.params.editClickedCallback,deleteClickedCallback:this.params.deleteClickedCallback,panoptoGlobal:this.params.panoptoGlobal})));this.comment=i[0],this.nestedComments=[],i.length>1&&(this.nestedComments=i.slice(1,i.length),this.nestedComments=_.sortBy(this.nestedComments,"creationTimeInMillis"))}render(e,i=!1){let o=$(t.template({sessionTime:this.comment.sessionTime,resx:this.params.panoptoGlobal.GlobalResources}));this.comment.setAsTopLevelComment(!0),this.comment.render(o.find(".top-level-comment"));let n=this.params.panoptoGlobal.Core.StringHelpers.format(this.params.panoptoGlobal.GlobalResources.ViewerPlus_Discussion_ReplyCountArialabel,this.nestedComments.length),a=t.screenreaderOnlyReplyCountTemplate({replyString:n});o.find(".top-level-comment .comment-block").append(a);let r=o.find(".threaded-comments");_.each(this.nestedComments,(e=>{e.render(r)})),o.find(".reply-expander").toggle(this.nestedComments.length>0),this.attachToggleHandlers(o),i?e.replaceWith(o):e.append(o),this.element=o,this.updateReplyCountString()}addComment(t){if(this.comment.isForEvent(t))this.comment.updateEvent(t);else{let i=_.find(this.nestedComments,(e=>e.isForEvent(t)));if(i)i.updateEvent(t);else{let i=new e.CommentViewModel({animationSpeed:this.animationSpeed,commentEvent:t,replyCallback:this.replyClickedCallback,handleKeys:this.params.handleKeys,eventClickedCallback:this.params.eventClickedCallback,editClickedCallback:this.params.editClickedCallback,deleteClickedCallback:this.params.deleteClickedCallback,panoptoGlobal:this.params.panoptoGlobal}),o=this.element.find(".threaded-comments");i.render(o),this.nestedComments.push(i),this.updateReplyCountString(),this.element.find(".reply-expander").show()}}}removeComment(e){let t=!1;return this.comment.isForEvent(e)?this.nestedComments.length>0?(this.comment=this.nestedComments[0],this.nestedComments.length>1?this.nestedComments=this.nestedComments.slice(1,this.nestedComments.length):this.nestedComments=[],this.render(this.element,!0)):(this.element.slideUp(this.animationSpeed,(()=>{this.element.remove()})),t=!0):this.removeChildComment(e),t}removeChildComment(e){let t=_.findIndex(this.nestedComments,(t=>t.isForEvent(e)));void 0!==t&&(this.nestedComments[t].remove(),this.nestedComments.splice(t,1),0===this.nestedComments.length&&this.element.find(".reply-expander").hide(),this.updateReplyCountString())}remove(){this.element.slideUp(this.animationSpeed,(()=>{this.element.remove()}))}expandComments(e){let t=void 0!==e?e:this.animationSpeed;this.nestedComments.length>0&&!this.element.find(".threaded-comments").is(":visible")&&(this.setToggleText(this.element,!0),this.element.find(".threaded-comments").slideToggle(t))}collapseComments(){this.nestedComments.length>0&&this.element.find(".threaded-comments").is(":visible")&&(this.setToggleText(this.element,!1),this.element.find(".threaded-comments").slideToggle("fast"),this.element.find(".top-level-comment .comment-block").focus())}updateReplyCountString(){let e=this.params.panoptoGlobal.Core.StringHelpers.format(this.params.panoptoGlobal.GlobalResources.ViewerPlus_ViewReplies,this.nestedComments.length);this.element.find(".expand-replies").text(e)}attachToggleHandlers(e){this.params.panoptoGlobal.Core.UI.Handlers.button(e.find(".expandable"),(()=>{e.find(".threaded-comments").slideToggle("fast",(()=>{let t=e.find(".threaded-comments").is(":visible");this.setToggleText(e,t),(t?e.find(".hide-replies"):e.find(".expand-replies")).focus()}))}));let t=this.nestedComments.length>2;t&&e.find(".threaded-comments").hide(),this.setToggleText(e,!t)}setToggleText(e,t){e.find(".expand-replies").toggleClass("hidden",t),e.find(".hide-replies").toggleClass("hidden",!t)}}t.template=_.template('\n            <li class="thread-wrapper" data-timestamp="<@- sessionTime @>">\n                <ul class="top-level-comment"></ul>\n                <div class="reply-expander">\n                    <a href="#" class="expand-replies expandable right-arrow">\n                    </a>\n                    <a href="#" class="hide-replies expandable down-arrow">\n                        <@- resx.ViewerPlus_HideReplies @>\n                    </a>\n                    <ul class="threaded-comments">\n                    </ul>\n                </div>\n            </li>\n        '),t.screenreaderOnlyReplyCountTemplate=_.template('\n            <span class="screen-reader-only">\n                <@- replyString @>\n            </span>\n        '),e.ThreadViewModel=t}(e.Discussion||(e.Discussion={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.viewer=Panopto.viewer||{},PanoptoLegacy.Viewer.Tabs.Editor.EditAISummaryTab=function(e,t,i,o,n,a,r){const s=new PanoptoTS.API.Rest.SessionService(Panopto.Core.ServiceInterface.Rest.Api),l=t.find("#editKeyPointsSection"),d=l.find("#keyPointsWrapper"),c=l.find("#noKeyPointsMessage"),p=l.find("#processingKeyPointsMessage"),u=t.find("#editSummarySection"),h=u.find("#editSummaryInput"),m=u.find("#noSummaryMessage"),v=u.find("#processingSummaryMessage");let P,g=!1,y=!1,f=5e3;var S=PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab(e,t,o,Panopto.Viewer.Analytics.EditContents,n,a,[],Panopto.GlobalResources.ViewerPlus_Edit_AddTOC,r),C=Panopto.Core.Extensions.base(S);const w=()=>{d.hide(),c.hide(),p.show(),h.hide(),m.hide(),v.show()},b=()=>{d.hide(),c.show(),p.hide(),h.hide(),m.show(),v.hide()},T=()=>{const e=n.activeState().getAIKeyPoints()?.filter((e=>e?.length)),t=n.activeState().getAISummary();if(e?.length){d.show().empty(),c.hide(),p.hide();for(let t=0;t<e.length;t++){const i=_.template($("#aiKeyPointInputTemplate").html())({});d.append(i);const o=d.find("input").last();o.attr(Panopto.Core.Constants.InitAttribute,e[t]),o.val(e[t]),Panopto.Core.UI.Components.editableLabel(o,(e=>{n.pushEdit(),n.activeState().setAIKeyPoint(t,e),n.applyState()}),!1)}}else d.hide(),c.show(),p.hide();t?.length?(h.show().attr(Panopto.Core.Constants.InitAttribute,t).val(t),m.hide(),v.hide(),P||(P=Panopto.Core.UI.Components.editableLabel(h,(e=>{n.pushEdit(),n.activeState().setAISummary(e),n.applyState()}),!0,void 0,!0))):(h.hide(),m.show(),v.hide())},E=()=>{const e=()=>{s.getCaptionsAIState(n.getDeliveryId(),(({summaryState:t})=>{t===AutoInternal.CaptionsAIProcessingState.NotProcessed||t===AutoInternal.CaptionsAIProcessingState.Processing?(g=!0,w(),setTimeout(e,f),f=Math.min(1.5*f,6e4)):t===AutoInternal.CaptionsAIProcessingState.NotAvailable?b():t===AutoInternal.CaptionsAIProcessingState.Available?g?PanoptoViewer.Services.getDeliveryInfo(n.getDeliveryId(),i,void 0,{}).then((e=>{const t=e.Delivery;n.propagateAIKeyPointsAndSummary(t.AIKeyPoints,t.AISummary)})).then((()=>T())):T():b()}),(()=>{b()}))};e()};return S.render=function(){const e=n.activeState().getAIKeyPoints()?.filter((e=>e?.length)),t=n.activeState().getAISummary();e?.length||t?.length?T():y||(y=!0,w(),E())},S.resize=(e,t)=>{C.resize(e,t),u.height(t-l.height()-20),P?.resize()},S},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditAudioDescriptionsTab=function(e,t,i,o,n,a,r){const s=`\n        <span class='max-length-notification'>\n            ${Panopto.GlobalResources.ViewerPlus_Edit_AudioDescriptionLengthNotification}\n        </span>`;var l=[Panopto.Core.EventType.AudioDescription],d=PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab(e,t,i,Panopto.Viewer.Analytics.EditTranscript,o,n,l,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditAudioDescriptionsTitle,Panopto.GlobalResources.ViewerPlus_Edit_AddAudioDescription,r),c=Panopto.Core.Extensions.base(d),p=t.find("#editAudioDescriptionsPaneHeader"),u=p.find("#importAudioDescriptionsButton"),h=p.find("#importAudioDescriptionsPopup"),m=p.find("#requestAudioDescriptionsButton"),v=t.find(".event-input-wrapper"),P=v.find(".event-input"),g=v.find(".max-length-notification");const y=Panopto.LanguageSelector($("#editAudioDescriptionsPaneHeader .language-selector")[0],{availableCaptions:a.map(PanoptoReactComponents.Helpers.createCaptionInfoFromLanguage),selectedLanguage:PanoptoViewer.Language.getCurrentADLanguage(),onLanguageSelected:e=>{PanoptoViewer.Language.setCurrentADLanguage(e)}});PanoptoViewer.Language.addLanguageEventListener("currentaudiodescription",(()=>{y.setProps({selectedLanguage:PanoptoViewer.Language.getCurrentADLanguage()}),c.render(d.events(),!0,void 0,void 0,void 0,PanoptoViewer.Language.getCurrentADLanguage())})),PanoptoViewer.Language.addLanguageEventListener("availableaudiodescriptions",(()=>{y.setProps({availableLanguages:PanoptoViewer.Language.getADLanguages()})})),d.render=function(e,t,i,o,n){f(P,g),c.render(e,t,i,o,n,PanoptoViewer.Language.getCurrentADLanguage())},d.templateDialog=function(e,t){e.html(_.template($("#editAudioDescriptionTemplate").html())({event:{name:t.name,formattedTime:d.formatEventTime(t.timelineTime)}}))},d.hasChanges=function(e,t){var i=d.valueChanged(e.find(".edit-audio-description-title"),t.name);return i=i||d.valueChanged(e.find(".edit-audio-description-time"),d.formatEventTime(t.timelineTime))},d.validate=function(e,t){var i,n;if(i=!!$.trim(e.find(".edit-audio-description-title").val()),e.find(".edit-audio-description-title-error").text(i?"":Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_NoAudioDescription),!(n=d.validateTime(e.find(".edit-audio-description-time").val(),t.streamId,void 0))){var a=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-audio-description-time").val(),Panopto.GlobalResources.TimeSeparator);if(o.activeState().isTimeInSessionReference(a)){const e=o.activeState().findNextTimeNotInSessionReference(a),t=Panopto.Core.TimeHelpers.formatDuration(e/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Core.Constants.DisplayTimeMillisecondPrecision);n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_TimeInClip.format(t)}}return e.find(".edit-audio-description-time-error").text(n||""),i=i&&!n},d.populateEvent=function(e,t){d.updateName(t,e.find(".edit-audio-description-title").val()),t.timelineTime=d.eventTimeFromFormattedString(e.find(".edit-audio-description-time").val()),t.edited=!0},d.updateName=function(e,t){c.updateName(e,t),e.metadata&&(e.metadata=t)},d.addEvent=function(e){c.addEvent(e,Panopto.Core.EventType.AudioDescription,{language:PanoptoViewer.Language.getCurrentADLanguage()}),g.hide()},d.filterForRender=function(){return _.filter(d.events(),(function(e){return _.contains(l,e.type)&&PanoptoViewer.Language.getCurrentADLanguage()===e.language}))},Panopto.Core.UI.Components.popup(h,u,(function(){h.show().css({top:p.outerHeight()+"px"})})),Panopto.Core.UI.Handlers.button(m,(function(){h.hide(),i.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionAudioDescriptions",modalHeader:Panopto.Core.TextHelpers.innerText(o.session().name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:o.session().id})})})),d.afterRenderItem=function(e,t,i){c.afterRenderItem(e,t,i);let n=$(s);t.find(".event-text").append(n);let a=t.find(".event-text-input");f(a,n),a.keydown((e=>{if(e.keyCode===Panopto.Core.Key.Enter){const e=$("#editAudioDescriptionsTabPane .index-event"),i=e.index(t);if(e[i].tabIndex=-1,i+1<e.length){const t=e[i+1];t.focus(),t.tabIndex=0;const o=$(t).find(".event-text-input");o.focus(),o.select()}}})),a.focus((()=>{o.setViewerPosition(e.time)}))};var f=(e,t)=>{e.attr("maxlength",Panopto.viewer.sessionChangeSetEventNameMaxLength),e.on("input focus",(()=>{let i=e.val().length>=Panopto.viewer.sessionChangeSetEventNameMaxLength;t.toggle(i)})),e.on("blur",(()=>{t.hide()}))};return d},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.viewer=Panopto.viewer||{},PanoptoLegacy.Viewer.Tabs.Editor.EditContentsTab=function(e,t,i,o,n,a,r,s){var l=PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab(e,t,i,Panopto.Viewer.Analytics.EditContents,o,r,[Panopto.Core.EventType.Label,Panopto.Core.EventType.SlideChange,Panopto.Core.EventType.SmartOcrToc,Panopto.Core.EventType.CandidateSmartOcrToc,Panopto.Core.EventType.AIChapter],Panopto.GlobalResources.ViewerPlus_Edit_AddTOC,s),d=Panopto.Core.Extensions.base(l),c=t.find(".event-input"),p=t.find("#quizInputOption"),u=t.find("#youtubeInputOption"),h=$("#urlInputOption");const m=new PanoptoTS.Viewer.Controls.OrderedContainer(l.$eventList);var v,P={},g={},y={},f=()=>$.trim(c.val());a.eventAdded.add((e=>{const t=void 0!==e.link&&-1!==e.link.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl);e.type!==Panopto.Core.EventType.Label||t||l.openEditDialog(e)})),l.addEvent=e=>{d.addEvent(e,Panopto.Core.EventType.Label,{preferSecondary:!0})},l.position=e=>{p.add(u).toggleClass(Panopto.Core.Constants.DisabledClass,!a.isValidTimeForEmbeddedEvent(e)),h.toggleClass(Panopto.Core.Constants.DisabledClass,!a.isValidTimeForEvent(e)),d.position(e)},l.filterForRender=function(){var e=d.filterForRender();return _.filter(e,(function(e){return e.type!==Panopto.Core.EventType.CandidateSmartOcrToc}))},l.render=()=>{const e=o.activeState();S(e.sessionReferences),E(l.filterForRender()),I(e.questionLists()),l.refreshListTabbablePosition()},l.openEditDialog=e=>{d.openEditDialog(_.find(l.events(),(t=>t.id===e.id)))};const S=e=>{_.each(e,(e=>{P.hasOwnProperty(e.id)||(P[e.id]=w());const t=P[e.id];t.render(e),m.insert(t.element,e.editorStartTime/Panopto.Core.Constants.TimelineChunkMultiplier)})),_.each(Object.keys(P),(t=>{_.some(e,(e=>e.id===t))||(m.remove(P[t].element),delete P[t])}))},C=(e,t)=>{let i=0;const o=[],n=[],a={};return t.filter((t=>t.start===e.start)).sort(((e,t)=>e.order-t.order)).forEach((e=>{if(e.order!==i){o.push(e);const t=e.copy(!0,{order:i});n.push(t),a[e.id]=t.id}i++})),{sessionReferencesToRemove:o,sessionReferencesToAdd:n,oldToNewIDMap:a}},w=()=>{let e=new PanoptoTS.Viewer.Tabs.Editor.SessionReferenceRow;return e.seekCallbacks.add((e=>{i.setPosition(e.editorStartTime/Panopto.Core.Constants.TimelineChunkMultiplier)})),e.editCallbacks.add((e=>{T(e)})),e.deleteCallbacks.add((e=>{const t=r.toWin32EpochRelative(i.getPosition());o.pushEdit();const n=o.activeState().sessionReferences,a=_.findIndex(n,(t=>t.id===e.id));if(-1!==a){n.splice(a,1);const t=_.filter(o.activeState().cuts(),(t=>t.targetId===e.id));_.each(t,(e=>{o.activeState().cuts().splice(o.activeState().cuts().indexOf(e),1)}));const{sessionReferencesToRemove:i,sessionReferencesToAdd:r}=C(e,n);i.forEach((e=>{n.splice(n.indexOf(e),1)})),n.push(...r)}o.activeState().refreshTimeline(),o.applyState(),i.setPosition(o.activeState().calculateEditorTimeFromAbsolute(t.ticks()))})),e.eventSeekCallbacks.add((e=>{i.setPosition(e.editorTime)})),e.hoverCallbacks.add((({sessionReference:e,hoverEventType:t})=>{let i=!1,n=!1;o.activeState().sessionReferences.filter((t=>t.start===e.start)).map((t=>(t.order<e.order?i=!0:t.order>e.order&&(n=!0),P[t.id]))).forEach((e=>{e.handleHoverOutline(t)})),t===PanoptoCore.HoverEventType.HoverIn&&P[e.id].displayOrderArrows(i,n),o.highlightEventView(e,t===PanoptoCore.HoverEventType.HoverIn)})),e.orderChangeCallbacks.add((({sessionReference:e,orderChangeType:t})=>{const i=t===PanoptoCore.OrderChangeType.OrderUp?e.order-1:e.order+1,o=e.copy(!0,{order:i});b(e,o,!0)})),e},b=(e,t,i=!1)=>{o.pushEdit();const n=o.activeState().sessionReferences,a=_.findIndex(n,(t=>t.id===e.id)),r=o.getViewerPosition().ticks();let s,l=r;for(const e of n)if(e.editorStartTime<r){if(e.editorStartTime+e.getTimelineDuration()>r){s=e.id,l=r-e.editorStartTime;break}l-=e.getTimelineDuration()}if(-1!==a){t||(t=v.createModifiedContent());let r=t.order,d=t.start;if(t.start==-1/0)d=0;else if(t.start==1/0)d=o.activeState().hostDuration();else if(!i){let i=!1,o=0;for(const a of n){const n=a.editorStartTime;if(n<t.start){const s=a.getTimelineDuration();if(o+=s,n+s>=t.start){d=a.start,i=!0;r=t.start-n<n+s-t.start?a.order:a.order+1,e.start===a.start&&e.order<r&&r--;break}}}i||(d=t.start-o)}n.splice(a,1);const{sessionReferencesToRemove:c,sessionReferencesToAdd:p,oldToNewIDMap:u}=C(e,n);c.forEach((e=>{n.splice(n.indexOf(e),1)})),n.push(...p),s=u[s]??s;const h=n.filter((e=>!!PanoptoCore.Helpers.timesAreApproxEqual(e.start,d)&&(e.start!==d&&(d=e.start),!0))).length,m=PanoptoCore.Extensions.MathExtensions.clamp(r,0,h),P=n.map((e=>{if(e.start===d){if(e.order>=m){const t=e.copy(!0,{order:e.order+1});return e.id===s&&(s=t.id),t}return e}return e})),g=t.copy(!0,{start:d,order:m});s===e.id&&(s=g.id),P.push(g),n.length=0,n.push(...P),o.activeState().refreshTimeline(),o.applyState();let y=l;if(s){for(const e of n)if(e.id===s){y+=e.editorStartTime;break}}else for(const e of n)e.start<l&&(y+=e.getTimelineDuration());o.setViewerPosition(y/Panopto.Core.Constants.TimelineChunkMultiplier)}};l.handleSessionReferenceEdit=b;l.handleSessionReferenceHighlight=(e,t)=>{P[e.id].handleHoverHighlight(t)};const T=e=>{const t=o.activeState().duration();(v=new PanoptoTS.Viewer.Dialogs.SessionReferenceEditorDialog(0,t,Panopto.GlobalResources,Panopto.ModalPopup.defaultInstance)).saveCallbacks.add((()=>b(e))),i.toggleScreens(!1),v.showDialog(e)},E=e=>{_.each(e,(e=>{g.hasOwnProperty(e.id)||(g[e.id]=V());const t=g[e.id];t.render(e),m.insert(t.element,e.editorTime)})),_.each(Object.keys(g),(t=>{_.some(e,(e=>e.id===t))||(m.remove(g[t].element),delete g[t])}))},V=()=>{let e=new PanoptoTS.Viewer.Tabs.Editor.EditableEventRow;return e.seekCallbacks.add((e=>{i.setPosition(e.editorTime)})),e.editCallbacks.add((e=>{l.openEditDialog(e)})),e.changedCallbacks.add((e=>{o.pushEdit();const t=_.find(o.activeState().events(),(t=>e.event.id===t.id));t.name=e.name,t.edited=!0,o.activeState().refreshTimeline(),o.applyState()})),e.deleteCallbacks.add((e=>{o.pushEdit();const t=l.events(),i=_.find(t,(t=>e.id===t.id));t.splice(t.indexOf(i),1),o.applyState()})),e},I=e=>{_.each(e,(e=>{y.hasOwnProperty(e.id)||(y[e.id]=R());const t=y[e.id],i=r.toUneditedFirstPrimaryRelative(e.firstStreamRelativeTicks);t.render({id:e.id,name:e.name,editorTime:i.seconds()},{isQuestionList:!0}),m.insert(t.element,i.seconds())})),_.each(Object.keys(y),(t=>{_.some(e,(e=>e.id===t))||(m.remove(y[t].element),delete y[t])}))},R=()=>{let e=new PanoptoTS.Viewer.Tabs.Editor.EditableEventRow;return e.seekCallbacks.add((e=>{i.setPosition(e.editorTime)})),e.changedCallbacks.add((e=>{o.pushEdit();const t=_.find(o.activeState().questionLists(),(t=>e.event.id===t.id));t.name=e.name,t.isEdited=!0,o.activeState().refreshTimeline(),o.applyState()})),e.deleteCallbacks.add((e=>{o.removeQuestionList(e)})),e};n&&(Panopto.Core.UI.Handlers.button(p,(()=>{let e=l.startTime();void 0===e&&(e=i.position()),a.isValidTimeForEmbeddedEvent(e)&&(o.addQuestionList(f()),l.clearInput())})),p.show()),Panopto.features.disableFeaturesRequiringExternalNetworkAccess&&u.hide(),Panopto.Core.UI.Handlers.button(u,(()=>{const e=f()||Panopto.GlobalResources.ViewerPlus_Edit_YouTubeDefaultName;let t=l.startTime();void 0===t&&(t=i.position()),a.isValidTimeForEmbeddedEvent(t)&&(a.addYouTubeEvent(e,t),l.clearInput())})),Panopto.Core.UI.Handlers.button(h,(()=>{const e=f()||Panopto.GlobalResources.ViewerPlus_Edit_UrlEventDefaultName;let t=l.startTime();void 0===t&&(t=i.position()),a.isValidTimeForEvent(t)&&(a.addUrlEvent(e,t),l.clearInput())}));const D=$("#reactSmartChapterControls"),k=PanoptoReactComponents.bootstrapReactComponent(PanoptoReactComponents.Control.SmartChapterControls)(D[0],{toggleEnabled:!0,resources:Panopto.GlobalResources,statusText:"",onToggle:e=>L(e),onProcessingKickoff:()=>x()}),L=function(e){k.setProps({toggleState:e}),U(e?Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Hide:Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Show),o.pushEdit();const t=o.activeState().events().filter((t=>e?t.type===Panopto.Core.EventType.CandidateSmartOcrToc:t.type===Panopto.Core.EventType.SmartOcrToc)),i=t.map((t=>{const i=t.copy();return i.id=_.uniqueId("event"),i.name=t.name.substring(0,PanoptoTS.Viewer.Constants.TOCMaxLength),i.type=e?Panopto.Core.EventType.SmartOcrToc:Panopto.Core.EventType.CandidateSmartOcrToc,i}));t.forEach((e=>{const t=l.events().indexOf(e);-1!==t&&l.events().splice(t,1)})),i.forEach((e=>{l.events().push(e)})),o.activeState().refreshTimeline(),o.applyState()},x=function(){U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Processing),A.requestSmartChapters(o.session().id,(e=>O()),H)},A=new PanoptoTS.API.Rest.SessionService(Panopto.Core.ServiceInterface.Rest.Api),U=function(e,t){k.setProps({statusText:e})},M=function(){k.setProps({displayState:PanoptoReactComponents.Control.DisplayState.Available}),o.activeState().filterEvents(Panopto.Core.EventType.SmartOcrToc).length>0?(k.setProps({toggleState:!0}),U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Hide)):o.activeState().filterEvents(Panopto.Core.EventType.CandidateSmartOcrToc).length>0?(k.setProps({toggleState:!1}),U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Show)):H()},O=function(){U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Processing),k.setProps({displayState:PanoptoReactComponents.Control.DisplayState.Processing}),window.setTimeout((()=>{A.getSmartChaptersState(o.session().id,(e=>B(e.state)),H,(()=>null))}),5e3)},H=function(){k.setProps({displayState:PanoptoReactComponents.Control.DisplayState.Error}),U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_Error)},B=function(e){e===AutoInternal.SmartChaptersState.NotProcessed&&!0!==Panopto.viewer.isSmartChapteringEnabled||(D.show(),e===AutoInternal.SmartChaptersState.NoSmartChapters?(k.setProps({displayState:PanoptoReactComponents.Control.DisplayState.Ineligible,toggleEnabled:!1}),U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_NoSmartChapters)):e===AutoInternal.SmartChaptersState.Available?0===o.activeState().filterEvents(Panopto.Core.EventType.CandidateSmartOcrToc).length&&0===o.activeState().filterEvents(Panopto.Core.EventType.SmartOcrToc).length?Panopto.Core.ServiceInterface.Rest.Sessions.getAllEvents(o.getDeliveryId(),{eventTypes:[Panopto.Core.EventType.SmartOcrToc,Panopto.Core.EventType.CandidateSmartOcrToc],pageSize:Panopto.viewer.timelineEditorEventsPageSize},(e=>{o.pushEdit(),o.activeState().events().push(...e),o.savedEvents().push(...e),o.activeState().refreshTimeline(),o.applyState(),M()}),H):M():e===AutoInternal.SmartChaptersState.NotProcessed?(U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_NotProcessed),k.setProps({displayState:PanoptoReactComponents.Control.DisplayState.NotProcessed}),U(Panopto.GlobalResources.ViewerPlus_Edit_SmartChapters_NotProcessed)):e===AutoInternal.SmartChaptersState.Processing?O():H())};l.refreshSmartChapters=function(){if(Panopto.viewer.isAIChaptersEnabled||!o.activeState().streams().filter((e=>e.isPrimary)).length)return;const e=o.savedEvents().filter((e=>e.type===Panopto.Core.EventType.CandidateSmartOcrToc||e.type===Panopto.Core.EventType.SmartOcrToc));if(o.activeState().filterEvents(Panopto.Core.EventType.CandidateSmartOcrToc).length||o.activeState().filterEvents(Panopto.Core.EventType.SmartOcrToc).length)D.show(),M();else if(e.length){const t=e.map((e=>{if(e.type===Panopto.Core.EventType.CandidateSmartOcrToc)return e;{const t=e.copy();return t.id=_.uniqueId("event"),t.name=e.name.substring(0,PanoptoTS.Viewer.Constants.TOCMaxLength),t.type=Panopto.Core.EventType.CandidateSmartOcrToc,t}}));o.activeState().events().push(...t),D.show(),M()}else Panopto.viewer.isSmartChapteringEnabled&&A.getSmartChaptersState(o.session().id,(e=>B(e.state)),H,(()=>null))};const F=$("#reactAIChaptersControl");let z=!!o.getAIChapters()?.length,N=!!o.activeState().filterEvents(Panopto.Core.EventType.AIChapter).length;const G=Panopto.AIChaptersControl(F[0],{aiChaptersAvailable:z,aiChaptersEnabled:N,resources:Panopto.GlobalResources,onToggleAIChapters:function(){const e=!N;if(o.pushEdit(),e){const e=o.getAIChapters().map((e=>{const t=Panopto.Core.ServiceInterface.Rest.Objects.Event(e),i=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(e.Start*Panopto.Core.Constants.TimelineChunkMultiplier),n=r.toWin32EpochRelative(i).ticks(),a=o.activeState().activeStreams(n).find((e=>e.isPrimary));return t.name=e.Summary.substring(0,PanoptoTS.Viewer.Constants.TOCMaxLength),t.type=Panopto.Core.EventType.AIChapter,t.timelineTime=n,t.streamId=a?.id,t}));l.events().push(...e)}else{const e=l.events();e.splice(0,e.length,...e.filter((e=>e.type!==Panopto.Core.EventType.AIChapter)))}o.activeState().refreshTimeline(),o.applyState()}});return l.refreshAIChapters=function(){Panopto.viewer.isAIChaptersEnabled&&(F.show(),z=!!o.getAIChapters()?.length,N=!!o.activeState().filterEvents(Panopto.Core.EventType.AIChapter).length,G.setProps({aiChaptersAvailable:z,aiChaptersEnabled:N}))},l.refreshSmartChapters(),l.refreshAIChapters(),l},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditCutTab=function(e,t,i,o,n){var a=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,i,Panopto.Viewer.Analytics.Labels.EditCut,o,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditCutTitle,n),r=Panopto.Core.Extensions.base(a);return a.templateDialog=function(e,t){const i=o.activeState();let n,r,s,l,d;switch(t.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:s=i.calculateEditorTimeForCut(t.start,void 0),l=i.calculateEditorTimeForCut(t.end(),void 0),d=Panopto.Core.Constants.SessionIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:const e=o.getStream(t.targetId),c=i.calculateEditorTimeFromAbsolute(e.absoluteStart),p=i.calculateEditorTimeFromAbsolute(e.absoluteEnd());n=o.getStreamName(e,e.id,!0);r=`${a.formatTime(c)} - ${a.formatTime(p,!0)}`,s=i.calculateEditorTimeForCut(t.start,t.targetId),l=i.calculateEditorTimeForCut(t.end(),t.targetId),d=PanoptoTS.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(e);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:const u=_.find(i.sessionReferences,(e=>e.id===t.targetId)),h=i.calculateSessionReferenceEditorStartTime(u)/Panopto.Core.Constants.TimelineChunkMultiplier,m=h+u.referencedSessionDuration;n=u.name,r=`${a.formatTime(h)} - ${a.formatTime(m)}`,s=i.calculateEditorTimeForCutInClip(t.start,t.targetId),l=i.calculateEditorTimeForCutInClip(t.end(),t.targetId),d=Panopto.Core.Constants.SessionIconCode}e.html(_.template($("#editCutTemplate").html())({cut:{streamName:n,streamLength:r,startTime:a.formatTime(s/Panopto.Core.Constants.TimelineChunkMultiplier),endTime:a.formatTime(l/Panopto.Core.Constants.TimelineChunkMultiplier),streamIconCode:d}}))},a.hasChanges=function(e,t){const i=o.activeState(),n=i.calculateEditorTimeForCut(t.start,t.targetId)/Panopto.Core.Constants.TimelineChunkMultiplier,r=i.calculateEditorTimeForCut(t.end(),t.targetId)/Panopto.Core.Constants.TimelineChunkMultiplier;return e.find(".edit-cut-start-time").val()!==a.formatTime(n)||e.find(".edit-cut-end-time").val()!==a.formatTime(r)},a.validate=function(e,t){var i,o=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?t.targetId:void 0,n=a.validateTime(e.find(".edit-cut-start-time").val(),o,void 0),r=a.validateTime(e.find(".edit-cut-end-time").val(),o,void 0);if(e.find(".edit-cut-start-time-error").text(n||""),e.find(".edit-cut-end-time-error").text(r||""),i=!n&&!r){const t=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-start-time").val(),Panopto.GlobalResources.TimeSeparator);i=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-end-time").val(),Panopto.GlobalResources.TimeSeparator)>t,e.find(".edit-cut-end-time-error").text(i?"":Panopto.GlobalResources.ViewerPlus_Edit_Modal_CutEndError)}return i},a.populateEvent=function(e,t){const i=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?t.targetId:void 0,n=o.activeState().calculateEditorTimeForCut(t.start,i),a=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-start-time").val(),Panopto.GlobalResources.TimeSeparator)*Panopto.Core.Constants.TimelineChunkMultiplier,r=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-end-time").val(),Panopto.GlobalResources.TimeSeparator)*Panopto.Core.Constants.TimelineChunkMultiplier,s=o.activeState(),l=s.calculateRelativeTimeForCut(a,t.targetId),d=s.calculateRelativeTimeForCut(r,t.targetId);o.resizeCut(n,l,d,i,t.targetType)},a.render=function(){const e=_.map(a.events(),(e=>{const t=o.activeState();let i,n,a,r,s,l;switch(e.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:i=t.calculateEditorTimeForCut(e.start,void 0),n=t.calculateEditorTimeForCut(e.end(),void 0),a=Panopto.GlobalResources.ViewerPlus_Edit_SessionCutName,r=!0,s=!0,l=Panopto.Core.Constants.SessionIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:const d=o.getStream(e.targetId);i=t.calculateEditorTimeForCut(e.start,e.targetId),n=t.calculateEditorTimeForCut(e.end(),e.targetId),a=o.getStreamName(d,e.targetId,!0),r=!d.isPrimary,s=!d.isPrimary,l=PanoptoTS.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(d);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:const c=_.find(t.sessionReferences,(t=>t.id===e.targetId));i=t.calculateEditorTimeForCutInClip(e.start,e.targetId),n=t.calculateEditorTimeForCutInClip(e.end(),e.targetId),a=c.name,r=!1,s=!0,l=Panopto.Core.Constants.SessionIconCode}const d=i/Panopto.Core.Constants.TimelineChunkMultiplier,c=n/Panopto.Core.Constants.TimelineChunkMultiplier;return{id:e.id,eventId:e.id,time:d,displayTime:`\n                        ${Panopto.Core.TimeHelpers.formatDuration(d,Panopto.GlobalResources.TimeSeparator)} -\n                        ${Panopto.Core.TimeHelpers.formatDuration(c,Panopto.GlobalResources.TimeSeparator)}`,text:a,editable:r,deletable:s,iconCode:l}}));r.render(e)},a},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.viewer=Panopto.viewer||{},PanoptoLegacy.Viewer.Tabs.Editor.EditDetailsTab=function(e,t,i,o,n,a,r,s,l,d,c,p,u,h,m,v,P){const g=Panopto.features.tagsEnabled?PanoptoTS.Viewer.Data.TagHelper.convertDeliveryToModel(d):[],y=Panopto.DetailsTab(document.getElementById("editDetailsTab"),{isVisible:!1,editor:n,sessionId:r,name:s,description:l,tags:g,ownerId:c,ownerFullName:p,ownerBio:u,linkify:!1,tagsEnabled:Panopto.features.tagsEnabled,tagService:m,subscriptionsEnabled:Panopto.features.subscriptionsEnabled,subscriptionService:v,userService:P,resources:Panopto.GlobalResources,onSessionNameUpdate:e=>i.updateSessionName(e,{fromHeader:!1})});i.addSessionNameUpdateListener((e=>y.setProps({name:e})));var f=PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab(e,t,o,Panopto.Viewer.Analytics.EditContents,n,a,[Panopto.Core.EventType.Label,Panopto.Core.EventType.SlideChange,Panopto.Core.EventType.SmartOcrToc,Panopto.Core.EventType.CandidateSmartOcrToc],Panopto.GlobalResources.ViewerPlus_Edit_AddTOC,h),S=Panopto.Core.Extensions.base(f);return f.onSelectChangeRendered=({selected:e})=>y.setProps({isVisible:e}),f.resize=(e,t)=>{S.resize(e,t),y.setProps({tabWidth:e,tabHeight:t})},f},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab=function(e,t,i,o,n,a,r,s,l,d){var c,p,u,h=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,i,o,n,s,d),m=h,v=Panopto.Core.Extensions.base(h),P=t.find(".event-input"),g=t.find(".event-input-options"),y={},f=function(e){e.keyCode===Panopto.Core.Key.Space&&e.shiftKey&&(e.preventDefault(),i.hotkey(e.keyCode))},S=function(e,t){var i=t.find(".event-text-input"),o=t.find(".event-text-content");Panopto.Core.UI.Handlers.hoverableParent(t,i,(function(t){t?(i.show(),o.hide(),function(e,t,i){var o=y[e.id];o||(o=Panopto.Core.UI.Components.editableLabel(i,(function(t){var i=$.trim(t);if(i){n.pushEdit();var a=_.find(n.activeState().events(),(function(t){return e.id===t.id}));m.updateName(a,i),a.edited=!0,n.applyState()}else o.revert()}),!0),i.attr("placeholder",Panopto.GlobalResources.ViewerPlus_EventTab_NoContent),i.keydown(f),y[e.id]=o),o.resize()}(e,0,i)):i.is(":focus")||(i.hide(),o.show())}),{preserveExisting:!0})},C=function(){var e=$.trim(P.val());e&&void 0===c?m.setStartTime():e||m.clearStartTime()};m.setStartTime=function(){c=i.position(),p=i.activePrimary().id;const e=i.activeSecondary();e&&_.find(n.activeState().streams(),(function(t){return t.id===e.id}))&&(u=e.id)},m.clearStartTime=function(){c=void 0,p=void 0,u=void 0},m.filterForRender=function(e){return _.filter(h.events(),(function(t){return _.contains(r,t.type)&&e==t.language&&!t.isDefaultThumbnail}))},h.render=function(e,t,i,o,n,a){var r=m.filterForRender(a),s=_.map(r,(function(e){var t=e.link&&-1!==e.link.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl);return{id:e.id,eventId:e.id,time:h.toTimelineRelativeTime(e.timelineTime),text:e.name,editable:!t,deletable:!0,language:a,inlineEditable:!0,iconClass:t?PanoptoTS.Viewer.Constants.YouTubeIconClass:void 0}}));v.render(s),y={}},h.afterRenderItem=function(e,t,i){v.afterRenderItem(e,t,i),S(e,t)},m.formatEventTime=function(e){return h.formatTime(h.toTimelineRelativeTime(e))},m.eventTimeFromFormattedString=function(e){var t=Panopto.Core.TimeHelpers.durationFromFormattedString(e,Panopto.GlobalResources.TimeSeparator),i=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(t*Panopto.Core.Constants.TimelineChunkMultiplier);return a.toWin32EpochRelative(i).ticks()},m.ownsEvent=function(e){return _.contains(r,e.type)},m.clearInput=function(){P.val(""),m.clearStartTime(),P.attr("placeholder",l)},m.addEvent=function(e,t,{preferSecondary:i,link:o,language:r}={}){let s;void 0===c&&m.setStartTime();let l=!0;if(n.activeState().isTimeInSessionReference(c)){const e=n.activeState().findNextTimeNotInSessionReference(c);if(e>=n.activeState().duration())alert(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClipAtEnd),l=!1,m.clearStartTime();else{if(confirm(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClip)){s=e;const t=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(e);let i=a.toWin32EpochRelative(t).ticks(),o=n.activeState().activeStreams(i),r=_.find(o,(e=>!0===e.isPrimary));p=r?r.id:void 0;const l=_.find(o,(e=>!0!==e.isPrimary));u=l?l.id:void 0}else l=!1}}else s=c*Panopto.Core.Constants.TimelineChunkMultiplier;if(l){const l=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(s);var d=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e,sessionId:n.session().id,timelineTime:a.toWin32EpochRelative(l).ticks(),type:t,language:r,streamId:i&&u?u:p});return o&&(d.link=o),n.pushEdit(),h.events().push(d),n.activeState().refreshTimeline(),n.applyState(),m.clearInput(),d}},h.resize=function(e,t){P.width(e-PanoptoTS.Viewer.Constants.InputMargin),g.width(e-PanoptoTS.Viewer.Constants.InputOptionsMargin),v.resize(e,t-(P.length?P.outerHeight(!0):0)-(g.length?g.outerHeight(!0):0))},m.updateName=function(e,t){e.name=t},m.toggleControlsRequiringPrimaryStream=function(){w?(P.show(),g.show()):(P.hide(),g.hide())},m.startTime=function(){return c},P.length&&(P.off(),P.attr("placeholder",l),P.keyup(C),P.keydown((function(e){e.keyCode===Panopto.Core.Key.Enter&&(e.preventDefault(),C(),void 0!==c&&m.addEvent($.trim(P.val()),void 0,{})),e.stopPropagation()})),P.keydown(f)),h.setTimelineEditor=function(e){v.setTimelineEditor(e),n=e};const w=_.some(n.activeState().streams(),(e=>e.isPrimary));return m.toggleControlsRequiringPrimaryStream(),m},function(e){!function(t){!function(t){!function(t){class i{get seekCallbacks(){return this._seekCallbacks}constructor(){this._seekCallbacks=new PanoptoCore.TypedCallback,this.createElement(),this.eventIcon=this.element.find(".event-icon"),this.eventName=this.element.find(".event-name"),this.eventDisplayTime=this.element.find(".event-display-time"),Panopto.Core.UI.Handlers.button(this.element,(()=>{this._seekCallbacks.fire(this.event)}))}render(t,i){this.event=t;const o=Panopto.Core.TimeHelpers.formatDuration(t.editorTime,Panopto.GlobalResources.TimeSeparator);this.updateName(t.name),this.eventDisplayTime.text(o);const n=this.isSmartChapterEvent(t),a=this.isAIChapterEvent(t),r=n&&this.isLinkEvent(t),s=!n&&this.isLinkEvent(t),l=i&&i.isQuestionList?Panopto.Core.Constants.QuestionListIconCode:s?Panopto.Core.Constants.LinkIconCode:void 0,d=this.isYoutubeEvent(t)?e.Viewer.Constants.YouTubeIconClass:r?e.Viewer.Constants.SmartChapterLinkIconClass:n?e.Viewer.Constants.SmartChapterIconClass:a?e.Viewer.Constants.AIChapterIconClass:l?void 0:e.Viewer.Constants.TocIconClass;this.eventIcon.attr("class","event-icon"),l&&this.eventIcon.addClass("material-icons"),d&&this.eventIcon.addClass(d),this.eventIcon.html(l||"")}createElement(){this.element=$(i.template())}updateName(e){this.eventName.text(e)}isLinkEvent(e){return-1===e.link?.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl)}isYoutubeEvent(e){return e.link&&-1!==e.link.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl)}isSmartChapterEvent(e){return e.type===Panopto.Core.EventType.SmartOcrToc}isAIChapterEvent(e){return e.type===Panopto.Core.EventType.AIChapter}}i.template=_.template('\n            <li class="editor-event-row" tabindex="0">\n                <div class="event-icon"></div>\n                <div class="event-name" dir="auto"></div>\n                <div class="event-display-time"></div>\n            </li>'),t.EditorEventRow=i;class o extends i{get editCallbacks(){return this._editCallbacks}get changedCallbacks(){return this._changedCallbacks}get deleteCallbacks(){return this._deleteCallbacks}constructor(){super(),this._editCallbacks=new PanoptoCore.TypedCallback,this._changedCallbacks=new PanoptoCore.TypedCallback,this._deleteCallbacks=new PanoptoCore.TypedCallback,this.eventInput=Panopto.Core.UI.Components.editableLabel(this.eventName.find("input")),Panopto.Core.UI.Handlers.button(this.element,(()=>{this.element.addClass("focused"),this.eventInput.focus()}),{preserveExisting:!0}),this.eventInput.onChanged.add((e=>{this._changedCallbacks.fire({event:this.event,name:e})})),this.eventInput.onBlur.add((()=>{this.element.removeClass("focused")})),this.editEventMenu=new e.Viewer.Controls.EditEventMenu(this.element,this.element.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0}),this.editEventMenu.editCallbacks.add((e=>{this._editCallbacks.fire(e)})),this.editEventMenu.deleteCallbacks.add((e=>{this._deleteCallbacks.fire(e)}))}render(e,t){super.render(e,t),this.editEventMenu.setEvent(e,{canEdit:!(t&&t.isQuestionList||this.isYoutubeEvent(e)),canDelete:!0})}createElement(){this.element=$(o.editableTemplate())}updateName(e){this.eventInput.resetValue(e)}}o.editableTemplate=_.template('\n            <li class="editor-event-row" tabindex="0">\n                <div class="event-icon"></div>\n                <div class="event-name">\n                    <input\n                        dir="auto"\n                        type="text"\n                        placeholder="<@- Panopto.GlobalResources.ViewerPlus_EventTab_NoContent @>"\n                    />\n                </div>\n                <div\n                    class="event-edit-toggle material-icons"\n                    tabindex="0"\n                    title="<@- Panopto.GlobalResources.ViewerPlus_EventMore @>"\n                >\n                    &#xE5D4;\n                </div>\n                <div class="event-display-time"></div>\n            </li>'),t.EditableEventRow=o}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditorTab=function(e,t,i,o,n,a,r){var s=PanoptoLegacy.Viewer.Tabs.EventTab(e,t,i,void 0,[],void 0,!1,o,void 0,r),l=s,d=Panopto.Core.Extensions.base(s),c=t.find(".event-tab-pane-header"),p=[],u=t.find(".event-tab-list");return l.templateDialog=function(e,t){$.noop()},l.hasChanges=function(e,t){return!1},l.validate=function(e,t){return!0},l.populateEvent=function(e,t){$.noop()},l.formatTime=function(e,t){return Panopto.Core.TimeHelpers.formatDuration(e,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Core.Constants.DisplayTimeMillisecondPrecision,t)},l.validateTime=function(e,t,i){var o,a,r,s,d;return e?Panopto.Core.TimeHelpers.validateFormattedDuration(e,Panopto.GlobalResources.TimeSeparator,Panopto.Core.Constants.DisplayTimeMillisecondPrecision)?i||((r=t?_.find(n.activeState().streams(),(function(e){return e.id===t})):void 0)?(s=n.activeState().calculateEditorTimeFromAbsolute(r.absoluteStart),d=n.activeState().calculateEditorTimeFromAbsolute(r.absoluteEnd())):(s=0,d=n.activeState().duration()/Panopto.Core.Constants.TimelineChunkMultiplier),s=Math.floor(s*PanoptoTS.Viewer.Constants.DisplayTimePrecisionMultiplier)/PanoptoTS.Viewer.Constants.DisplayTimePrecisionMultiplier,d=Math.ceil(d*PanoptoTS.Viewer.Constants.DisplayTimePrecisionMultiplier)/PanoptoTS.Viewer.Constants.DisplayTimePrecisionMultiplier,((a=Panopto.Core.TimeHelpers.durationFromFormattedString(e,Panopto.GlobalResources.TimeSeparator))<s||a>d)&&(o=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_OutOfBounds.format(l.formatTime(s),l.formatTime(d)))):o=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_InvalidTime:o=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_NoTime,o},l.openEditDialog=function(e,t){var o;i.toggleScreens(!1),Panopto.ModalPopup.defaultInstance.show("#editorDialog",t||a,""),$("#editorDialog").show(),o=$("#editorDialogContent"),l.templateDialog(o,e),Panopto.ModalPopup.defaultInstance.closeCriteria.push((function(){return!l.hasChanges(o,e)||confirm(Panopto.GlobalResources.ViewerPlus_Edit_Modal_Confirm)})),Panopto.Core.UI.Handlers.button($("#editorDialogSave"),(function(){var t=e.copy();if(l.validate(o,t)){var i=_.find(p,(function(e){return e.id===t.id})),a=p.indexOf(i);(l.hasChanges(o,t)||-1===a)&&(n.pushEdit(),-1!==a?p.splice(a,1,t):p.push(t),l.populateEvent(o,t),n.activeState().refreshTimeline(),n.applyState()),Panopto.ModalPopup.defaultInstance.closeCriteria.length=0,Panopto.ModalPopup.defaultInstance.close()}})),Panopto.Core.UI.Handlers.button($("#editorDialogCancel"),(function(){Panopto.ModalPopup.defaultInstance.close()})),o.keydown((function(e){e.stopPropagation()})),o.find("textarea, input").first().focus()},l.render=function(e){var t=!1,i=!0;0===d.events().length&&(t=!0,i=!1),d.render(e,t,!1,i,!0)},l.afterRenderItem=function(e,t,i){d.afterRenderItem(e,t,i);var o=new PanoptoTS.Viewer.Controls.EditEventMenu(t,t.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0});o.editCallbacks.add((e=>{l.openEditDialog(_.find(s.events(),(function(t){return e.id===t.id})))})),o.deleteCallbacks.add((e=>{var t;n.pushEdit(),t=_.find(s.events(),(function(t){return e.id===t.id})),s.events().splice(s.events().indexOf(t),1),n.applyState()})),o.setEvent(e,{canEdit:e.editable,canDelete:e.deletable})},l.events=function(e){if(void 0===e)return p;p=e,l.render(void 0,void 0,void 0,void 0,void 0)},l.valueChanged=function(e,t){var i=e.val();return e.val(t),t=e.val(),e.val(i),i!==t},l.toTimelineRelativeTime=function(e){return n.activeState().calculateEditorTimeFromAbsolute(e)},s.resize=function(e,t){d.resize(e,t-(c.outerHeight()||0))},l.setTimelineEditor=function(e){n=e},l.$eventList=u,l},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditQuestionListTab=function(e,t,i,o,n,a,r){var s=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,i,Panopto.Viewer.Analytics.Labels.EditQuestionList,o,void 0,r),l=s,d=Panopto.Core.Extensions.base(s),c=$("#addQuestionListButton");s.render=function(){var e=_.map(s.events(),(function(e){var t=n.toUneditedFirstPrimaryRelative(e.firstStreamRelativeTicks);return{id:e.id,eventId:e.id,time:t.seconds(),displayTime:Panopto.Core.TimeHelpers.formatDuration(t.seconds(),Panopto.GlobalResources.TimeSeparator),text:e.name,deletable:!0,iconCode:Panopto.Core.Constants.QuestionListIconCode}}));d.render(e)},s.position=function(e){l.toggleControlsRequiringPrimaryStreamOrEvent(e),d.position(e)},l.toggleControlsRequiringPrimaryStreamOrEvent=function(e){c.toggleClass(Panopto.Core.Constants.DisabledClass,!p||!a.isValidTimeForEmbeddedEvent(e))},Panopto.Core.UI.Handlers.button(c,(function(){c.hasClass(Panopto.Core.Constants.DisabledClass)||o.addQuestionList(void 0)}));var p=_.some(o.activeState().streams(),(e=>e.isPrimary));return l},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditSlidesTab=function(e,t,i,o,n,a,r,s){var l,d=Panopto.Viewer.Analytics.EditSlides,c=PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab(e,t,i,d,o,r,[Panopto.Core.EventType.SlideChange],void 0,s),p=c,u=Panopto.Core.Extensions.base(c),h={},m={},v={},P=function(e){var t=$.Deferred(),i=[];return _.each(e,(e=>{i.push(g(e))})),$.when(...i).then((()=>{t.resolve(e)})).fail((()=>{t.reject()})),t.promise()},g=function(e){var t=$.Deferred();return Panopto.Core.ServiceInterface.Rest.SlideDecks.getAllSlides(e.id,(i=>{h[e.id]=i,t.resolve(i)}),(()=>{t.reject()})),t.promise()},y=function(e){let t=new PanoptoTS.Viewer.Tabs.Editor.SlideDeckRow(c.$eventList);return t.slideDeckDeletedCallbacks.add((()=>{var t,i;o.pushEdit(),t=o.activeState().events(),i=_.filter(t,(t=>_.some(h[e.id],(e=>e.id===t.slideId)))),_.each(i,(function(e){t.splice(t.indexOf(e),1)})),o.activeState().slideDecksToDelete().push(e),o.applyState()})),t.slideEventAddCallbacks.add((e=>{let t,n=i.position(),a=!0;if(o.activeState().isTimeInSessionReference(n)){const e=o.activeState().findNextTimeNotInSessionReference(n);if(e>=o.activeState().duration())alert(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClipAtEnd),a=!1,c.clearStartTime();else{confirm(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClip)?t=e:a=!1}}else t=n*Panopto.Core.Constants.TimelineChunkMultiplier;if(a){const i=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(t);var s=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e.name,metadata:e.content,timelineTime:r.toWin32EpochRelative(i).ticks(),type:Panopto.Core.EventType.SlideChange,slideId:e.id,slideUrl:e.imageUrl,thumbnailUrl:e.imageUrl,slideDeckId:e.slideDeckId,sessionId:o.session().id});o.pushEdit(),c.events().push(s),o.activeState().refreshTimeline(),o.applyState()}})),t.slideEventSelectedCallbacks.add(((e,t)=>{i.setPosition(t.editorTime),Panopto.Viewer.Analytics.sendEvent({action:Panopto.Viewer.Analytics.Actions.Navigate,label:d})})),t.slideEventEditCallbacks.add(((e,t)=>{c.openEditDialog(_.find(c.events(),(e=>e.id===t.id)))})),t.slideEventDeleteCallbacks.add(((e,t)=>{o.pushEdit();var i=c.events(),n=_.find(i,(e=>t.id===e.id));i.splice(i.indexOf(n),1),o.applyState()})),t},f=function(e){var t=_.filter(c.events(),(function(t){return t.type===Panopto.Core.EventType.SlideChange&&t.slideId===e.id}));return _.each(t,(function(t){t.slideDeckId||(t.slideDeckId=e.slideDeckId),t.displayTime=Panopto.Core.TimeHelpers.formatDuration(t.editorTime,Panopto.GlobalResources.TimeSeparator)})),t};a.onReady.add((e=>{_.each(e,(e=>{S(e)})),p.setReadyStreamUploader(),p.hasAnyUploadingRow()&&i.fireTabSelected(c)})),p.setReadyStreamUploader=()=>{o.overlayController.setEditSlidesTabAddButton($("#addSlideDeckButton")),o.overlayController.setOverlaysSlideUploader(a)},a.onBeforeUpload.add((()=>{i.fireTabSelected(c)})),a.onUpdate.add((e=>{S(e)})),a.onComplete.add((e=>{var t;C(e),t=$.Deferred(),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(o.session().id,(e=>{P(e).then((()=>{t.resolve(e)})).fail((()=>{t.reject()}))}),(()=>{t.reject()})),l=t.promise(),c.render(void 0,void 0,void 0,void 0,void 0)})),a.onDelete.add((e=>{C(e)})),a.getCurrentUploads();var S=function(e){if(!v.hasOwnProperty(e.uploadId)){const t=new(n.debug?PanoptoTS.Viewer.Tabs.Editor.PendingUploadRowDebug:PanoptoTS.Viewer.Tabs.Editor.PendingUploadRow)(Panopto.GlobalResources.ViewerPlus_Edit_InvalidSlideDeck,Panopto.GlobalResources);t.onPendingUploadDeleting.add((e=>{a.cancelUpload(e)})),v[e.uploadId]=t,c.$eventList.append(t.element)}v[e.uploadId].render(o.activeState(),e)},C=function(e){var t=v[e.uploadId];t&&(t.element.remove(),delete v[e.uploadId])};return c.render=function(){l.then((e=>{!function(e){_.each(e,(e=>{m.hasOwnProperty(e.id)||(m[e.id]=y(e));var t=m[e.id];t.render(e),_.each(h[e.id],(e=>{var i=f(e);t.renderSlide(e,i)}))}))}(e),_.each(m,((e,t)=>{_.some(o.activeState().slideDecksToDelete(),(e=>e.id===t))&&e.hide();var i=_.some(o.activeState().streams(),(e=>e.isPrimary));e.setCanAddSlide(i)})),c.refreshListTabbablePosition()}))},p.hasAnyUploadingRow=function(){return Object.keys(v).length>0},c.setTimelineEditor=function(e){u.setTimelineEditor(e),o=e},p.setSlideDecks=function(e){l=P(e),c.render(void 0,void 0,void 0,void 0,void 0)},p},function(e){!function(t){!function(t){!function(t){class i{constructor(t){this.element=$(i.template({label:t})),this.element.hide();const o=$(i.listContainerTemplate({label:t}));this.orderedContainer=new e.Viewer.Controls.OrderedContainer(o),this.element.append(this.orderedContainer.element)}addStreamRow(e,t){this.orderedContainer.insert(e.element,t),this.element.show()}addPendingUploadRow(e,t){this.orderedContainer.insert(e.element,t),this.element.show()}removeStreamRow(e){this.orderedContainer.remove(e.element),0===this.orderedContainer.rowCount()&&this.element.hide()}removePendingUploadRow(e){this.orderedContainer.remove(e.element),0===this.orderedContainer.rowCount()&&this.element.hide()}}i.template=_.template('\n            <div class="edit-stream-list">\n                <div class="edit-stream-list-label"><@- label @></div>\n            </div>'),i.listContainerTemplate=_.template('<ul aria-label="<@- label @>" tabindex="-1">'),t.EditStreamList=i}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditStreamTab=function(e,t,i,o,n,a,r,s,l){const d=$(".add-streams");var c=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,i,Panopto.Viewer.Analytics.Labels.EditStream,o,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditStreamTitle,l),p=c,u=Panopto.Core.Extensions.base(c),h=new PanoptoTS.Viewer.Tabs.Editor.EditStreamList(Panopto.GlobalResources.ViewerPlus_Edit_Primary),m=new PanoptoTS.Viewer.Tabs.Editor.EditStreamList(Panopto.GlobalResources.ViewerPlus_Edit_Secondary);c.$eventList.append(h.element).append(m.element);var v=_.template($("#editStreamTemplate").html()),P=$.Deferred(),g=!1;const y=new PanoptoViewer.StreamDeleteUtils;var f={},S={};Panopto.Core.UI.Handlers.button(d,(()=>{d.hasClass(Panopto.Core.Constants.DisabledClass)||o.streamTab().showUploadOverlay({secondaryOnly:!1})}));const C=PanoptoReactComponents.bootstrapReactComponent(PanoptoReactComponents.Dialogs.DeletingEventsDialog)(document.getElementById("deletingEventsPopupWrapper"),{isOpen:!1,eventsToDelete:[],handleButtonClick:e=>{},resources:Panopto.GlobalResources});var w=function(e){if(!S.hasOwnProperty(e.uploadId)){let t=R(e.streamType);const i=new(n.debug?PanoptoTS.Viewer.Tabs.Editor.PendingUploadRowDebug:PanoptoTS.Viewer.Tabs.Editor.PendingUploadRow)(Panopto.GlobalResources.ViewerPlus_Edit_InvalidStreamFile,Panopto.GlobalResources);i.onPendingUploadDeleting.add((e=>{a.cancelUpload(e)})),S[e.uploadId]=i,t.addPendingUploadRow(i,Panopto.Core.TimeHelpers.dateToWin32EpochTime(e.startTime))}S[e.uploadId].render(o.activeState(),e)},b=function(e){var t=S[e.uploadId];if(t){let i=R(e.streamType);delete S[e.uploadId],i.removePendingUploadRow(t)}},T=function(){return _.some(c.events(),(e=>e.isPrimary))},E=function(){const e=_.some(c.events(),(e=>!e.isPrimary)),t=_.some(o.activeState().events(),(e=>e.slideId));return e||t},V=function(){o.overlayController.updateOverlayProcessing(_.map(_.values(S),(e=>e.pendingUpload)))},I=function(e){const t=T(),n=E(),a=!n&&p.hasPendingSecondaryUploads();i.synchronize(!0),!t||a||e?p.showUploadOverlay({secondaryOnly:t&&a}):(o.overlayController.forceCloseOverlays(),(i.viewMode()===PanoptoTS.Viewer.ViewMode.Primary||n)&&o.overlayController.toggleSecondaryPlaceholder(!1)),p.hasAnyUploadingRow()&&(i.fireTabSelected(c),V())},R=function(e){let t;switch(e){case 1:t=h;break;case 2:t=m}return t},D=function(e){const t=o.activeState().firstPrimaryOffset(),i=[],n=[],a=function(e,t,i){let n,a=0,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;c.events().forEach((t=>{t.isPrimary&&t.id===e?(a++,n=t):t.isPrimary||t.id!==e?t.isPrimary&&t.id!==e?(a++,s=Math.min(s,t.absoluteStart),r=Math.min(r,t.absoluteStart)):s=Math.min(s,t.absoluteStart):n=t}));const p=Math.max(0,r-s);if(!n||!a)return{case:PanoptoViewer.StreamDeleteCase.Unexpected};const u=o.activeState().events().filter((e=>e.streamId===n.id&&e.type===Panopto.Core.EventType.Caption)).length>0;if(n.isPrimary)return 1===a?{case:PanoptoViewer.StreamDeleteCase.OnlyPrimary,streamObj:n,minTime:l,maxTime:d,newPrimaryOffset:p}:o.activeState().cuts().filter((e=>e.targetId===n.id&&e.duration===n.duration)).length?{case:PanoptoViewer.StreamDeleteCase.InactivePrimary,streamObj:n,minTime:l,maxTime:d,newPrimaryOffset:p,captionsWillBeDeleted:u}:(c.events().filter((t=>t.isPrimary&&t.id!==e)).forEach((e=>{const t=o.activeState().calculateEditorTimeFromAbsolute(e.absoluteStart),i=o.activeState().calculateEditorTimeFromAbsolute(e.absoluteStart+e.duration);l=Math.min(l,t),d=Math.max(d,i)})),t.push(...o.activeState().questionLists().filter((e=>{const t=e.firstStreamRelativeTicks.ticks()/Panopto.Core.Constants.TimelineChunkMultiplier;return t<l||t>d}))),i.push(...o.activeState().events().filter((e=>!(e.type!==Panopto.Core.EventType.Label||!e.link||-1===e.link.toLowerCase().indexOf("www.youtube.com/embed"))&&(e.editorTime<l||e.editorTime>d)))),{case:PanoptoViewer.StreamDeleteCase.ActivePrimary,streamObj:n,minTime:l,maxTime:d,newPrimaryOffset:p,captionsWillBeDeleted:u});return{case:PanoptoViewer.StreamDeleteCase.Secondary,streamObj:n,minTime:l,maxTime:d,newPrimaryOffset:p,captionsWillBeDeleted:u}}(e.id,i,n),r=a.case,s=a.streamObj,l=a.minTime,d=a.maxTime,p=a.newPrimaryOffset,u=a.captionsWillBeDeleted;if(r!==PanoptoViewer.StreamDeleteCase.Unexpected)if(r!==PanoptoViewer.StreamDeleteCase.OnlyPrimary)if(u||i.length||n.length){const o=i.map((e=>({name:e.name,type:"Quiz",timeInSeconds:e.firstStreamRelativeTicks.ticks()/Panopto.Core.Constants.TimelineChunkMultiplier}))).concat(...n.map((e=>({name:e.name,type:"YouTube",timeInSeconds:e.editorTime})))).sort(((e,t)=>e.timeInSeconds-t.timeInSeconds));C.setProps({isOpen:!0,eventsToDelete:o,captionsWillBeDeleted:u,handleButtonClick:o=>{C.setProps({isOpen:!1}),o&&k(e,r,s,l,d,p,t,i,n)}})}else k(e,r,s,l,d,p,t,i,n);else window.alert(Panopto.GlobalResources.ViewerPlus_Edit_DeleteStream_DeletingOnlyPrimary)},k=function(e,t,i,n,a,r,s,l,d){o.pushEdit();const p=[];var u,h,m;o.activeState().cuts().forEach((t=>{t.targetId===e.id&&p.push(t)})),t===PanoptoViewer.StreamDeleteCase.ActivePrimary?function(e,t,i,n,a,r){o.activeState().cuts().sort(((e,t)=>e.targetId===t.targetId?e.start-t.start:e.targetId<t.targetId?-1:1));let s=y.computeActiveSegments(e.absoluteStart,e.duration,o.activeState().cuts().filter((t=>t.targetId===e.id)));const l=o.activeState().cuts().filter((e=>e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream)),d=y.computeNewStreamCuts(o.activeState().streams().filter((t=>t.isPrimary&&t.id!==e.id)),l,s,PanoptoTS.Viewer.Constants.StreamDeleteCutTolerance*Panopto.Core.Constants.TimelineChunkMultiplier);r.push(...d),o.activeState().cuts().filter((e=>e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream)).forEach((e=>{let t=o.activeState().cuts().indexOf(e);-1!==t&&o.activeState().cuts().splice(t,1)})),o.activeState().cuts().push(...l);const c=o.activeState().cuts().filter((e=>e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session)),p=y.computeNewSessionCuts(c,t,i,n,a,Panopto.Core.Constants.TimelineChunkMultiplier);r.push(...p.cutsToRemove),p.resizeHandlers.forEach((e=>{o.resizeCut(e.oldStart,e.newStart,e.newEnd,e.newTargetId,e.newTargetType)}))}(i,n,a,s,r,p):t===PanoptoViewer.StreamDeleteCase.Secondary&&function(e,t){e!==t&&o.activeState().cuts().filter((e=>e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session)).forEach((i=>{o.resizeCut(i.start-t,i.start-t+e,i.start+i.duration-t+e,i.targetId,i.targetType)}))}(r,s),p.forEach((e=>{let t=o.activeState().cuts().indexOf(e);-1!==t&&o.activeState().cuts().splice(t,1)})),u=i.id,h=d,m=l,o.activeState().events().filter((e=>e.streamId===u)).forEach((e=>{if(e.type===Panopto.Core.EventType.Label&&e.link&&-1!==e.link.toLowerCase().indexOf("www.youtube.com/embed")){let t=!0;for(const i of h)if(i.id===e.id){t=!1;break}let i=!1;if(t){const t=o.activeState().streams().filter((e=>e.isPrimary));for(const n of t){if(n.id===u)continue;const t=n.absoluteStart,a=n.absoluteStart+n.duration,r=e.timelineTime;if(t<=r&&a>=r){let a=!0;const s=o.activeState().cuts().filter((e=>e.targetId===n.id));for(const e of s){const i=t+e.start,o=t+e.start+e.duration;if(i<=r&&o>=r){a=!1;break}}if(a){e.id=_.uniqueId("event"),e.streamId=n.id,i=!0;break}}}}if(i)return}o.activeState().events().splice(o.activeState().events().indexOf(e),1)})),h.forEach((e=>{const t=o.activeState().events();let i=-1;for(let o=0;o<t.length;o++)if(t[o].id===e.id){i=o;break}-1!==i&&t.splice(i,1)})),m.forEach((e=>{const t=o.activeState().questionLists();let i=-1;for(let o=0;o<t.length;o++)if(t[o].id===e.id){i=o;break}-1!==i&&t.splice(i,1)}));const v=_.find(c.events(),(t=>e.id===t.id));c.events().splice(c.events().indexOf(v),1),o.activeState().refreshTimeline(),o.applyState(),v.isPrimary&&o.setViewerPosition(0)};return c.templateDialog=function(e,t){var i=[];PanoptoCore.forEachEnum(PanoptoViewer.MediaVRType,((e,t)=>{i.push({value:t,name:Panopto.GlobalResources["ViewerPlus_Edit_Modal_VRType_"+e]})})),e.html(v({stream:{name:t.name,isPrimary:t.isPrimary,streamType:o.getStreamFriendlyType(t),displayType:t.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary:Panopto.GlobalResources.ViewerPlus_Edit_Secondary,length:Panopto.Core.TimeHelpers.formatDuration(t.duration/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!1,Panopto.Core.Constants.DisplayTimeMillisecondPrecision),startTime:c.formatTime(c.toTimelineRelativeTime(t.absoluteStart)),normalizeVolume:t.normalizeVolume,iconCode:t.iconCode,vrType:t.vrType},vrTypes:i,sessionNormalizeVolumeEnabled:o.activeState().getNormalizeVolume()}))},c.hasChanges=function(e,t){var i=c.valueChanged(e.find(".edit-stream-name"),t.name);return i=(i=(i=i||e.find(".edit-stream-time").val()!==c.formatTime(c.toTimelineRelativeTime(t.absoluteStart)))||e.find(".edit-stream-normalize-volume").is(":checked")!==t.normalizeVolume&&!o.activeState().getNormalizeVolume())||parseInt(e.find(".edit-stream-vr-type").val(),10)!==t.vrType},c.validate=function(e,t){var i=c.validateTime(e.find(".edit-stream-time").val(),t.id,!0);return e.find(".edit-stream-time-error").text(i||""),!i},c.populateEvent=function(e,t){var i,n=o.activeState().absoluteStart(),a=o.activeState().firstPrimaryOffset(),r=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-stream-time").val(),Panopto.GlobalResources.TimeSeparator),l=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(r*Panopto.Core.Constants.TimelineChunkMultiplier),d=s.toWin32EpochRelative(l),c=d.ticks()-t.absoluteStart,p=function(e){var t=[];e&&(_.each(o.activeState().cuts(),(function(i){i.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&(i.end()+e<=o.activeState().firstPrimaryOffset()||i.start+e>=o.activeState().hostDuration()?t.push(i):(i.start=Math.max(i.start+e,o.activeState().firstPrimaryOffset()),i.duration=Math.min(i.duration,o.activeState().hostDuration()-i.start)))})),_.each(t,(function(e){o.activeState().cuts().splice(o.activeState().cuts().indexOf(e),1)})))};if(t.name=e.find(".edit-stream-name").val(),t.absoluteStart=d.ticks(),t.vrType=parseInt(e.find(".edit-stream-vr-type").val(),10),o.activeState().refreshTimeline(),o.activeState().getNormalizeVolume()||(t.normalizeVolume=e.find(".edit-stream-normalize-volume").is(":checked")),c){_.each(o.activeState().events(),(function(e){e.streamId===t.id&&(e.timelineTime+=c,e.edited=!0)}));let e=o.activeState().absoluteStart()-n;p(e||o.activeState().firstPrimaryOffset()-a),t.isPrimary&&(i=_.filter(o.activeState().cuts(),(function(e){return e.targetId===t.id})),_.each(i,(function(e){o.activeState().cuts().splice(o.activeState().cuts().indexOf(e),1)})),o.applyPrimaryHeuristicCuts())}},c.render=function(){_.each(c.events(),(e=>{var t=PanoptoTS.Viewer.Data.Stream.convertFromApiModel(e);let n=R(t.streamType);if(!f.hasOwnProperty(t.id)){let e=function(){const e=new PanoptoTS.Viewer.Tabs.Editor.StreamRow;return e.streamSeekCallbacks.add((e=>{i.setPosition(c.toTimelineRelativeTime(e.absoluteStart))})),e.streamEditCallbacks.add((e=>{c.openEditDialog(_.find(c.events(),(t=>t.id===e.id)))})),e.streamDeleteCallbacks.add((e=>{D(e)})),e}();f[t.id]=e}n.addStreamRow(f[t.id],t.absoluteStart),f[t.id].render(o.activeState(),t)})),_.each(f,((e,t)=>{if(!_.some(c.events(),(e=>e.id===t))){R(e.getStream().streamType).removeStreamRow(e),delete f[t]}})),c.refreshListTabbablePosition(),P.resolve()},p.hasAnyUploadingRow=function(){return Object.keys(S).length>0},p.hasPendingSecondaryUploads=function(){return _.some(_.values(S),(e=>2===e.pendingUpload.streamType))},p.showUploadOverlay=({secondaryOnly:e=!1}={})=>{o.overlayController.showOverlays(T(),E(),_.map(_.values(S),(e=>e.pendingUpload)),i.viewMode(),{secondaryOnly:e})},P.then((()=>{a.getCurrentUploads()})),a.onReady.add((e=>{_.each(e,(e=>{w(e)})),p.setReadyStreamUploader(),g=!0,I(!1)})),p.setReadyStreamUploader=()=>{o.overlayController.setOverlaysStreamUploader(a)},a.onBeforeUpload.add((()=>{I(!0)})),a.onUpdate.add((e=>{let t=!S[e.uploadId];w(e),g&&(t?I(!0):V())})),a.onComplete.add((e=>{b(e),r.getAllStreams(o.session().id,(function(e){o.pushEdit(),o.activeState().streams().length=0,_.each(e,(function(e){o.activeState().streams().push(e)})),o.activeState().refreshTimeline(),I(!1),i.setSecondaryCount(0),i.reinitializeDelivery()}))})),a.onDelete.add((e=>{b(e),I(!1)})),c.setTimelineEditor=function(e){u.setTimelineEditor(e),(o=e).onAddContentRequirementChanged.add((e=>{d.toggleClass(Panopto.Core.Constants.DisabledClass,!e.canAddContent)}))},p},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab=function(e,t,i,o,n,a,r,s,l){var d=PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab(e,t,i,o,n,a,r,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditTOCTitle,s,l),c=Panopto.Core.Extensions.base(d),p=window.location.protocol+"//",u=/^.*?:\/\//;return d.templateDialog=function(e,t){var i=function(){var i,o=[];if(d.validateTime(e.find(".edit-contents-time").val(),void 0,void 0))o.push(_.find(n.activeState().streams(),(function(e){return e.id===t.streamId})));else{const i=d.valueChanged(e.find(".edit-contents-time"),d.formatEventTime(t.timelineTime))?d.eventTimeFromFormattedString(e.find(".edit-contents-time").val()):t.timelineTime;o=n.activeState().activeStreams(i)}e.find(".edit-contents-stream").html(_.template($("#editStreamOptionTemplate").html())({streams:_.map(o,(function(e){return{id:e.id,displayName:n.getStreamName(e,e.id,!0)}}))})),i=_.find(o,(function(e){return e.id===t.streamId}))||o[0],e.find(".edit-contents-stream").val(i.id)};e.html(_.template($("#editContentsTemplate").html())({event:{name:t.name,formattedTime:d.formatEventTime(t.timelineTime),thumbnailSrc:t.thumbnailUrl||Panopto.cacheRoot+"/Images/no_thumbnail.svg",thumbnailGenerated:!t.thumbnailUrl,metadata:t.metadata,scheme:p,link:t.link?t.link.replace(u,""):"",streamId:t.streamId}})),t.streamId&&(i(),e.find(".edit-contents-time").blur(i)),e.find(".edit-contents-link").width(e.find(".edit-contents-link").width()-e.find(".edit-contents-link-scheme").width()-5)},d.hasChanges=function(e,t){var i=d.valueChanged(e.find(".edit-contents-title"),t.name);return i=(i=(i=(i=i||d.valueChanged(e.find(".edit-contents-time"),d.formatEventTime(t.timelineTime)))||t.streamId&&t.streamId!==e.find(".edit-contents-stream").val())||d.valueChanged(e.find(".edit-contents-metadata"),t.metadata))||d.valueChanged(e.find(".edit-contents-link"),t.link?t.link.replace(u,""):"")},d.validate=function(e,t){var i=d.validateTime(e.find(".edit-contents-time").val(),e.find(".edit-contents-stream").val()||void 0,void 0);if(!i){var o=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-contents-time").val(),Panopto.GlobalResources.TimeSeparator);if(n.activeState().isTimeInSessionReference(o)){const e=n.activeState().findNextTimeNotInSessionReference(o),t=Panopto.Core.TimeHelpers.formatDuration(e/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Core.Constants.DisplayTimeMillisecondPrecision);i=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_TimeInClip.format(t)}}return e.find(".edit-contents-time-error").text(i||""),!i},d.populateEvent=function(e,t){var i=e.find(".edit-contents-link").val(),o=e.find(".edit-contents-stream").val();t.name=e.find(".edit-contents-title").val(),t.timelineTime=d.eventTimeFromFormattedString(e.find(".edit-contents-time").val()),t.metadata=e.find(".edit-contents-metadata").val(),t.link=i?p+i.replace(u,""):void 0,t.streamId&&t.streamId!==o&&(t.id=_.uniqueId("event"),t.streamId=o,t.thumbnailUrl=void 0,t.slideUrl=void 0),t.edited=!0},d.setTimelineEditor=function(e){c.setTimelineEditor(e),n=e},d},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditTranscriptTab=function(e,t,i,o,n,a){var r=[Panopto.Core.EventType.Caption],s=PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab(e,t,i,Panopto.Viewer.Analytics.EditTranscript,o,n,r,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditCaptionTitle,Panopto.GlobalResources.ViewerPlus_Edit_AddCaption,a),l=Panopto.Core.Extensions.base(s);s.selected=function(e){return c.setProps({selected:e}),l.selected(e)},s.render=function(){c.setProps({captions:s.filterForRender(),machineTranscriptAvailable:d()})},s.templateDialog=function(e,t){e.html(_.template($("#editTranscriptTemplate").html())({event:{startTime:s.formatEventTime(t.timelineTime),endTime:s.formatEventTime(p(t))}}))},s.hasChanges=function(e,t){return s.valueChanged(e.find(".edit-transcript-startTime"),s.formatEventTime(t.timelineTime))||s.valueChanged(e.find(".edit-transcript-endTime"),s.formatEventTime(p(t)))},s.validate=function(e,t){const i=e.find(".edit-transcript-startTime").val(),n=e.find(".edit-transcript-endTime").val();let a=s.validateTime(i,t.streamId,!1),r=Panopto.viewer.enableCaptionEndTimeInEditor?s.validateTime(n,t.streamId,!1):void 0;if(!a){const e=Panopto.Core.TimeHelpers.durationFromFormattedString(i,Panopto.GlobalResources.TimeSeparator);if(o.activeState().isTimeInSessionReference(e)){const t=o.activeState().findNextTimeNotInSessionReference(e),i=Panopto.Core.TimeHelpers.formatDuration(t/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Core.Constants.DisplayTimeMillisecondPrecision);a=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_TimeInClip.format(i)}}if(!r&&Panopto.viewer.enableCaptionEndTimeInEditor){const e=Panopto.Core.TimeHelpers.durationFromFormattedString(n,Panopto.GlobalResources.TimeSeparator);if(o.activeState().isTimeInSessionReference(e)){const t=o.activeState().findNextTimeNotInSessionReference(e),i=Panopto.Core.TimeHelpers.formatDuration(t/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Core.Constants.DisplayTimeMillisecondPrecision);r=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_TimeInClip.format(i)}}n<=i&&(r=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_Caption_Bounds),e.find(".edit-transcript-startTime-error").text(a||""),e.find(".edit-transcript-endTime-error").text(r||"");return!a&&!r},s.populateEvent=function(e,t){const i=s.eventTimeFromFormattedString(e.find(".edit-transcript-startTime").val());if(t.timelineTime=i,Panopto.viewer.enableCaptionEndTimeInEditor){const o=s.eventTimeFromFormattedString(e.find(".edit-transcript-endTime").val())-i;t.duration=o/Panopto.Core.Constants.TimelineChunkMultiplier}t.edited=!0},s.filterForRender=function(){return _.filter(s.events(),(function(e){return(_.contains(r,e.type)||e.forceShow&&e.type===Panopto.Core.EventType.SpeechRecognition)&&PanoptoViewer.Language.getCurrentCaptionLanguage().language==e.language}))};const d=function(){const e=o.activeState().filterEvents(Panopto.Core.EventType.SpeechRecognition);return e.length>0&&Number(PanoptoViewer.Language.getCurrentCaptionLanguage().language??-1)===Number(e[0].language??-1)},c=Panopto.CaptionPane(document.getElementById("editTranscriptTabPane"),{lang:Panopto.lang,resources:Panopto.GlobalResources,selected:!1,lowConfidenceThreshold:Panopto.viewer.captionConfidenceThreshold,captions:s.filterForRender(),machineTranscriptAvailable:d(),maxCaptionLength:Panopto.viewer.sessionChangeSetEventNameMaxLength,onCaptionAdded:e=>{l.addEvent(e,Panopto.Core.EventType.Caption,{language:PanoptoViewer.Language.getCurrentCaptionLanguage().language})},onCaptionDeleted:e=>{o.pushEdit();const t=_.find(s.events(),(t=>e.id===t.id));t&&s.events().splice(s.events().indexOf(t),1),o.applyState()},onCaptionsEdited:e=>{o.pushEdit(),e.forEach((e=>{e.edited=!0,e.metadata&&(e.metadata=e.name),e.confidence&&(e.confidence=Panopto.Core.ServiceInterface.Rest.Objects.CaptionConfidence(e.confidence));const t=s.events().findIndex((t=>e.id===t.id));t>-1&&s.events().splice(t,1,e)})),o.activeState().refreshTimeline(),o.applyState()},onMachineTranscriptImported:()=>{let e;o.pushEdit();const t=_.filter(o.activeState().events(),(e=>e.type===Panopto.Core.EventType.SpeechRecognition&&!e.forceShow));e=_.map(t,(function(e){let t=e.copy();return t.forceShow=!0,t.id=_.uniqueId("event"),t.language=PanoptoViewer.Language.getCurrentCaptionLanguage().language,t}));const i=_.filter(o.activeState().events(),(e=>(e.type===Panopto.Core.EventType.Caption||e.type===Panopto.Core.EventType.SpeechRecognition&&e.forceShow)&&e.language==PanoptoViewer.Language.getCurrentCaptionLanguage().language));_.each(i,(function(e){s.events().splice(s.events().indexOf(e),1)})),_.each(e,(function(e){s.events().push(e)})),o.activeState().refreshTimeline(),o.applyState()},onToolbarToggled:e=>{$("#eventTabControl").toggleClass("toolbar-open",e)},onCaptionModalOpened:()=>{i.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionTranscript",modalHeader:Panopto.Core.TextHelpers.innerText(o.session().name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:o.session().id})})},onSeek:e=>{o.setViewerPosition(e)},onCaptionEditModalOpened:e=>{s.openEditDialog(e)},onSetStartTime:()=>{s.setStartTime()}});PanoptoViewer.Language.addLanguageEventListener("currentcaption",(()=>{c.setProps({captions:s.filterForRender(),machineTranscriptAvailable:d()})}));const p=e=>e.duration?e.duration*Panopto.Core.Constants.TimelineChunkMultiplier+e.timelineTime:((e,t)=>{const i=e.find((e=>e.timelineTime>t)),a=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(o.timelineEndPosition()*Panopto.Core.Constants.TimelineChunkMultiplier);return i?i.timelineTime:n.toWin32EpochRelative(a).ticks()})(s.filterForRender(),e.timelineTime);return s},function(e){!function(t){!function(t){!function(t){var i=PanoptoCore.TypedCallback,o=e.Core.Logic.Time.UneditedFirstPrimaryRelative;t.EventService=class{get eventAdded(){return this._eventAdded}constructor(e){this.timeConverter=e,this._eventAdded=new i}getActiveStreamIdAtTime(e,t){const i=this.timelineState.activeStreams(e),o=_.find(i,(e=>!0===e.isPrimary)),n=_.find(i,(e=>!0!==e.isPrimary)),a=void 0!==o?o.id:void 0,r=void 0!==n?n.id:void 0;return t&&void 0!==r?r:a}isCloseToAnotherEmbeddedEvent(t){const i=(t,i,o)=>t>i-e.Viewer.Constants.UrlEventClosenessTolerance&&t<o+e.Viewer.Constants.UrlEventClosenessTolerance,o=_.any(this.timelineState.questionLists(),(e=>{const o=this.timeConverter.toFirstPrimaryRelative(e.firstStreamRelativeTicks).seconds(),n=o+PanoptoViewer.Constants.UrlEventDuration;return i(t,o,n)})),n=_.any(this.timelineState.events(),(e=>{if(e.link&&-1!==e.link.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl)){var o=this.timelineState.calculateEditorTimeTicksFromAbsolute(e.timelineTime)/Panopto.Core.Constants.TimelineChunkMultiplier,n=o+PanoptoViewer.Constants.UrlEventDuration;return i(t,o,n)}}));return o||n}addEvent(e,t,i,o,n){var a=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e,sessionId:this.sessionId,timelineTime:t,type:i,streamId:o,link:n});this._eventAdded.fire(a)}applyState(e,t){this.sessionId=e,this.timelineState=t}isValidTimeForEmbeddedEvent(e){return!this.isCloseToAnotherEmbeddedEvent(e)&&this.isValidTimeForEvent(e)}isValidTimeForEvent(e){return!this.timelineState.isTimeInSessionReference(e)}addYouTubeEvent(e,t){if(this.isValidTimeForEmbeddedEvent(t)){const i=new o(t*Panopto.Core.Constants.TimelineChunkMultiplier),n=this.timeConverter.toWin32EpochRelative(i),a=this.getActiveStreamIdAtTime(n.ticks(),!1);this.addEvent(e,n.ticks(),Panopto.Core.EventType.Label,a,PanoptoViewer.Constants.YouTubeEmbedBaseUrl)}}addUrlEvent(e,t){if(this.isValidTimeForEvent(t)){const i=new o(t*Panopto.Core.Constants.TimelineChunkMultiplier),n=this.timeConverter.toWin32EpochRelative(i),a=this.getActiveStreamIdAtTime(n.ticks(),!1),r=e.match(Panopto.Core.Constants.UrlMatcher)?e:void 0;this.addEvent(e,n.ticks(),Panopto.Core.EventType.Label,a,r)}}}}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){!function(e){class t{get onPendingUploadDeleting(){return this._onPendingUploadDeleting}constructor(e,i){this.invalidFileErrorLabel=e,this.resources=i,this._onPendingUploadDeleting=new PanoptoCore.TypedCallback,this.element=$(t.template()),this.uploadIcon=this.element.find(".upload-icon"),this.uploadName=this.element.find(".upload-name"),this.uploadDelete=this.element.find(".upload-delete"),this.uploadEventTime=this.element.find(".upload-event-time"),this.uploadProgress=this.element.find(".upload-progress"),this.uploadProgressBar=this.element.find(".upload-progress-bar"),this.uploadBytes=this.element.find(".upload-bytes"),this.uploadProcessing=this.element.find(".upload-processing"),this.uploadError=this.element.find(".upload-error"),Panopto.Core.UI.Handlers.button(this.uploadDelete,(()=>{this._onPendingUploadDeleting.fire(this.pendingUpload)}))}render(e,t){if(this.pendingUpload=t,t.startTime){let i;if(e.absoluteStart()===1/0)i=0;else{const o=Panopto.Core.TimeHelpers.dateToWin32EpochTime(t.startTime)*Panopto.Core.Constants.TimelineChunkMultiplier;i=e.calculateEditorTimeFromAbsolute(o)}const o=Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator);this.uploadEventTime.text(`${o} - ...`)}else this.uploadEventTime.text("");switch(this.uploadIcon.html(t.iconCode),this.uploadName.text(t.filename),t.state){case 1:this.renderUploadProgress(t.bytesUploaded,t.fileSize);break;case 2:this.renderProcessing();break;case 3:this.renderError(this.invalidFileErrorLabel);break;case 4:this.renderError(Panopto.Core.StringHelpers.format(this.resources.ViewerPlus_Edit_LargeFile,Panopto.Core.StringHelpers.readableByteCount(Panopto.features.uploadByteLimit,this.resources)));break;case 5:this.renderError(Panopto.GlobalResources.ViewerPlus_Edit_UploadError);break;case 6:this.renderError(t.errorMessage?t.errorMessage:Panopto.GlobalResources.ViewerPlus_Edit_UploadProcessingError);break;case 7:this.renderError(Panopto.GlobalResources.ViewerPlus_Edit_UploadDeleteError);break;default:$.noop()}this.element.show()}renderUploadProgress(e,t){this.setUploadProgress(e,t),this.uploadProgress.show(),this.uploadProcessing.hide(),this.uploadError.text("").hide()}renderError(e){this.unsetUploadProgress(),this.uploadProgress.hide(),this.uploadProcessing.hide(),this.uploadError.text(e).attr("title",e).show()}renderProcessing(){this.unsetUploadProgress(),this.uploadProgress.hide(),this.uploadProcessing.show(),this.uploadError.text("").hide()}setUploadProgress(e,t){let i=Panopto.Core.StringHelpers.readableUploadProgress(e,t,Panopto.GlobalResources,"ViewerPlus_Edit_UploadProgress");this.uploadBytes.text(i).show(),this.uploadProgressBar.css("width",e/t*100+"%").show(),this.uploadDelete.show()}unsetUploadProgress(){this.uploadBytes.text("").hide(),this.uploadProgressBar.hide(),this.uploadDelete.hide()}}t.template=_.template('\n            <div class="upload-row">\n                <div class="upload-metadata">\n                    <div class="upload-icon material-icons"></div>\n                    <div class="upload-name ellipsis"></div>\n                    <div class="upload-delete material-icons">&#xE14C;</div>\n                    <div class="upload-event-time"></div>\n                </div>\n                <div class="upload-progress">\n                    <div class="upload-progress-bar"></div>\n                    <div class="upload-bytes"></div>\n                </div>\n                <div class="upload-processing">\n                    <span><@- Panopto.GlobalResources.ViewerPlus_Edit_UploadProcessing @></span>\n                    <span class="upload-spinner"></span>\n                </div>\n                <div class="upload-error error"></div>\n            </div>'),e.PendingUploadRow=t}(e.Editor||(e.Editor={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(t){!function(t){const i="PendingUploadRow_Uploading",o="PendingUploadRow_Processing",n="PendingUploadRow_Error";class a extends t.PendingUploadRow{constructor(e,t){super(e,t),document.addEventListener(i,(e=>{e instanceof CustomEvent&&this.renderUploadProgress(e.detail.bytesUploaded,e.detail.fileSize)})),document.addEventListener(o,(e=>{e instanceof CustomEvent&&this.renderProcessing()})),document.addEventListener(n,(e=>{e instanceof CustomEvent&&this.renderError(e.detail.error)}))}}t.PendingUploadRowDebug=a;class r extends e.DebugEventModel{constructor(e,t){super(),this.bytesUploaded=e,this.fileSize=t}typeArg(){return i}}t.PendingUploadRowUploadingModel=r;class s extends e.DebugEventModel{typeArg(){return o}}t.PendingUploadRowProcessingModel=s;class l extends e.DebugEventModel{constructor(e){super(),this.error=e}typeArg(){return n}}t.PendingUploadRowErrorModel=l}(t.Editor||(t.Editor={}))}(e.Tabs||(e.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){!function(t){var i=PanoptoCore.TypedCallback,o=PanoptoCore.HoverEventType,n=PanoptoCore.OrderChangeType,a=e.Viewer.Controls.EditEventMenu,r=e.Viewer.Controls.OrderedContainer;class s{get seekCallbacks(){return this._seekCallbacks}get editCallbacks(){return this._editCallbacks}get deleteCallbacks(){return this._deleteCallbacks}get eventSeekCallbacks(){return this._eventSeekCallbacks}get hoverCallbacks(){return this._hoverCallbacks}get orderChangeCallbacks(){return this._orderChangeCallbacks}constructor(){this.orderClass="outline-order-group",this.hoverClass="session-reference-hovering",this._seekCallbacks=new i,this._editCallbacks=new i,this._deleteCallbacks=new i,this._eventSeekCallbacks=new i,this._hoverCallbacks=new i,this._orderChangeCallbacks=new i,this.orderedContainer=new r($("<ul>")),this.expanded=!1,this.eventRows={},this.element=$(s.template()),this.sessionReferenceRow=this.element.find(".session-reference-row"),this.sessionReferenceName=this.element.find(".session-reference-name"),this.sessionReferenceDisplayTime=this.element.find(".session-reference-display-time"),this.sessionReferenceToggle=this.element.find(".session-reference-toggle"),this.sessionReferenceExpandedToc=this.element.find(".session-reference-expanded-toc"),this.sessionReferenceOrderUp=this.element.find(".session-reference-order-up"),this.sessionReferenceOrderDown=this.element.find(".session-reference-order-down"),Panopto.Core.UI.Handlers.button(this.element,(()=>{this._seekCallbacks.fire(this.sessionReference)})),this.editMenu=new a(this.sessionReferenceRow,this.sessionReferenceRow.find(".session-reference-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0}),this.editMenu.editCallbacks.add((e=>{this._editCallbacks.fire(e)})),this.editMenu.deleteCallbacks.add((e=>{this._deleteCallbacks.fire(e)})),Panopto.Core.UI.Handlers.button(this.sessionReferenceToggle,(()=>{this.toggleExpandedToc()})),this.sessionReferenceToggle.attr("title",Panopto.GlobalResources.ViewerPlus_Edit_SessionReference_ExpandTooltip),Panopto.Core.UI.Handlers.hoverableParent(this.element,void 0,(e=>{this.handleHoverHighlight(e),this._hoverCallbacks.fire({sessionReference:this.sessionReference,hoverEventType:e?o.HoverIn:o.HoverOut})}),{preserveExisting:!0}),Panopto.Core.UI.Handlers.button(this.sessionReferenceOrderUp,(()=>{this.sessionReferenceOrderUp.hasClass("disabled")||this._orderChangeCallbacks.fire({sessionReference:this.sessionReference,orderChangeType:n.OrderUp})})),Panopto.Core.UI.Handlers.button(this.sessionReferenceOrderDown,(()=>{this.sessionReferenceOrderDown.hasClass("disabled")||this._orderChangeCallbacks.fire({sessionReference:this.sessionReference,orderChangeType:n.OrderDown})})),this.sessionReferenceOrderUp.attr("title",Panopto.GlobalResources.ViewerPlus_Edit_SessionReference_OrderUpTooltip),this.sessionReferenceOrderDown.attr("title",Panopto.GlobalResources.ViewerPlus_Edit_SessionReference_OrderDownTooltip)}render(e){this.sessionReference=e;let t=e.editorStartTime/Panopto.Core.Constants.TimelineChunkMultiplier,i=t+e.referencedSessionDuration,o=`${Panopto.Core.TimeHelpers.formatDuration(t,Panopto.GlobalResources.TimeSeparator)} -\n                ${Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator)}`;this.sessionReferenceName.text(e.name),this.sessionReferenceDisplayTime.text(o),this.editMenu.setEvent(e,{canEdit:!0,canDelete:!0}),this.renderToc()}toggleExpandedToc(){this.expanded=!this.expanded,this.sessionReferenceToggle.toggleClass("expanded",this.expanded),this.sessionReferenceExpandedToc.toggle(this.expanded),this.sessionReferenceToggle.attr("title",this.expanded?Panopto.GlobalResources.ViewerPlus_Edit_SessionReference_CollapseTooltip:Panopto.GlobalResources.ViewerPlus_Edit_SessionReference_ExpandTooltip)}renderToc(){this.sessionReferenceExpandedToc.append(this.orderedContainer.element),_.each(this.sessionReference.events.concat(this.sessionReference.slideEvents),(e=>{e.isDefaultThumbnail||(this.eventRows.hasOwnProperty(e.id)||this.createTocRow(e),this.eventRows[e.id].render({name:e.name,editorTime:e.viewerTime,link:e.link}))}))}createTocRow(e){const i=new t.EditorEventRow;this.orderedContainer.insert(i.element,e.viewerTime),i.seekCallbacks.add((e=>{this._eventSeekCallbacks.fire(e)})),this.eventRows[e.id]=i}handleHoverHighlight(e){e?this.element.addClass(this.hoverClass):(this.element.removeClass(this.hoverClass),this.sessionReferenceOrderUp.hide(),this.sessionReferenceOrderDown.hide())}handleHoverOutline(e){e===o.HoverIn?this.element.addClass(this.orderClass):e===o.HoverOut&&this.element.removeClass(this.orderClass)}displayOrderArrows(e,t){this.sessionReferenceOrderUp.show(),this.sessionReferenceOrderDown.show(),e?(this.sessionReferenceOrderUp.removeClass("disabled"),this.sessionReferenceOrderUp.attr("tabindex",0)):(this.sessionReferenceOrderUp.addClass("disabled"),this.sessionReferenceOrderUp.attr("tabindex",-1)),t?(this.sessionReferenceOrderDown.removeClass("disabled"),this.sessionReferenceOrderDown.attr("tabindex",0)):(this.sessionReferenceOrderDown.addClass("disabled"),this.sessionReferenceOrderDown.attr("tabindex",-1))}}s.template=_.template('\n            <li class="session-reference-row-wrapper" tabindex="0">\n                <div class="session-reference-row">\n                    <div class="session-reference-toggle material-icons" tabindex="0">&#xE5C5;</div>\n                    <div class="session-reference-icon"></div>\n                    <div class="session-reference-name ellipsis"></div>\n                    <div class="session-reference-order-up material-icons" tabindex="0">&#xE5D8</div>\n                    <div class="session-reference-order-down material-icons" tabindex="0">&#xE5DB</div>\n                    <div\n                        class="session-reference-edit-toggle material-icons"\n                        tabindex="0"\n                        title="<@- Panopto.GlobalResources.ViewerPlus_EventMore @>"\n                    >\n                        &#xE5D4;\n                    </div>\n                    <div class="session-reference-display-time"></div>\n                </div>\n                <div class="session-reference-expanded-toc" style="display: none;"></div>\n            </li>'),t.SessionReferenceRow=s}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){!function(t){t.SlideDeckRow=class{constructor(t){this.slideDeckTemplate=_.template('\n            <li class="slide-deck" style="display:none;" tabindex="0">\n                <div class="slide-deck-row">\n                    <div class="slide-deck-expand expanded"></div>\n                    <div class="slide-deck-name ellipsis"></div>\n                    <div\n                        class="slide-deck-edit-toggle material-icons"\n                        tabindex="0"\n                        title="<@- Panopto.GlobalResources.ViewerPlus_EventMore @>"\n                    >\n                        &#xE5D4;\n                    </div>\n                </div>\n                <div class="slide-list"></div>\n            </li>\n        '),this.slideEventSelectedCallbacks=$.Callbacks(),this.slideEventAddCallbacks=$.Callbacks(),this.slideEventEditCallbacks=$.Callbacks(),this.slideEventDeleteCallbacks=$.Callbacks(),this.slideDeckDeletedCallbacks=$.Callbacks(),this.slideRows={},this.element=$(this.slideDeckTemplate()),this.slideDeckExpand=this.element.find(".slide-deck-expand"),this.slideDeckName=this.element.find(".slide-deck-name"),this.slideList=this.element.find(".slide-list"),Panopto.Core.UI.Handlers.button(this.slideDeckExpand,(()=>{this.slideDeckExpand.toggleClass(Panopto.Core.Constants.ExpandedClass),this.slideList.toggle(this.slideDeckExpand.hasClass(Panopto.Core.Constants.ExpandedClass))})),this.editMenu=new e.Viewer.Controls.EditEventMenu(this.element,this.element.find(".slide-deck-edit-toggle"),Panopto.GlobalResources),this.editMenu.deleteCallbacks.add((e=>{this.slideDeckDeletedCallbacks.fire()})),t.append(this.element)}render(e){this.slideDeckId=e.id,this.slideDeckName.html(e.name),this.editMenu.setEvent(e,{canEdit:!1,canDelete:!0}),this.element.show()}hide(){this.element.hide()}remove(){this.element.remove()}renderSlide(e,i){if(!this.slideRows.hasOwnProperty(e.id)){let i=new t.SlideRow(this.slideList,e);i.slideEventSelectedCallbacks.add((t=>{this.slideEventSelectedCallbacks.fire(e,t)})),i.slideEventAddCallbacks.add((()=>{this.slideEventAddCallbacks.fire(e)})),i.slideEventEditCallbacks.add((t=>{this.slideEventEditCallbacks.fire(e,t)})),i.slideEventDeleteCallbacks.add((t=>{this.slideEventDeleteCallbacks.fire(e,t)})),this.slideRows[e.id]=i}this.slideRows[e.id].renderEvents(i)}setCanAddSlide(e){_.each(this.slideRows,(t=>{t.setCanAddSlide(e)}))}}}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){!function(t){t.SlideRow=class{constructor(t,i){this.container=t,this.slide=i,this.template=_.template('\n            <div class="slide">\n                <div class="slide-preview-wrapper">\n                    <div class="slide-preview">\n                        <img class="slide-image" src="<@- imageUrl @>" />\n                        <div class="slide-add">\n                            <i class="material-icons">&#xE145;</i>\n                        </div>\n                    </div>\n                </div>\n                <div class="slide-event-list"></div>\n            </div>\n        '),this.eventTemplate=_.template('\n            <div class="index-event" tabindex="0">\n                <div class="index-event-row">\n                    <div\n                        class="event-edit-toggle material-icons"\n                        tabindex="0"\n                        title="<@- Panopto.GlobalResources.ViewerPlus_EventMore @>"\n                    >\n                        &#xE5D4;\n                    </div>\n                    <div class="event-time"></div>\n                </div>\n            </div>\n        '),this.slideEventSelectedCallbacks=$.Callbacks(),this.slideEventAddCallbacks=$.Callbacks(),this.slideEventEditCallbacks=$.Callbacks(),this.slideEventDeleteCallbacks=$.Callbacks(),this.eventElements={},this.eventEditMenus={},this.element=$(this.template(i)),this.eventList=this.element.find(".slide-event-list"),Panopto.Core.UI.Handlers.button(this.element.find(".slide-add"),(()=>{this.canAddSlide&&this.slideEventAddCallbacks.fire(i)})),this.eventListScrollingHighlight=Panopto.Core.UI.Components.scrollingHighlight(this.eventList,!0,e.Viewer.Constants.EventScrollTimeout),t.append(this.element)}renderEvents(t){_.each(t,(t=>{if(!this.eventElements.hasOwnProperty(t.id)){let i=$(this.eventTemplate(t));i.find(".event-edit-controls");Panopto.Core.UI.Handlers.button(i,(()=>{this.eventListScrollingHighlight.highlight(t),this.slideEventSelectedCallbacks.fire(t)})),this.eventElements[t.id]=i;const o=new e.Viewer.Controls.EditEventMenu(i,i.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0});o.editCallbacks.add((e=>{this.slideEventEditCallbacks.fire(e)})),o.deleteCallbacks.add((e=>{this.slideEventDeleteCallbacks.fire(e)})),this.eventEditMenus[t.id]=o}this.eventElements[t.id].find(".event-time").text(t.displayTime),this.eventList.append(this.eventElements[t.id]),this.eventEditMenus[t.id].setEvent(t,{canEdit:!0,canDelete:!0})})),_.each(this.eventElements,((e,i)=>{_.some(t,(e=>e.id===i))||(e.remove(),delete this.eventElements[i])}))}setCanAddSlide(e){this.canAddSlide=e}}}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){!function(t){class i{get streamSeekCallbacks(){return this._streamSeekCallbacks}get streamEditCallbacks(){return this._streamEditCallbacks}get streamDeleteCallbacks(){return this._streamDeleteCallbacks}constructor(){this._streamSeekCallbacks=new PanoptoCore.TypedCallback,this._streamEditCallbacks=new PanoptoCore.TypedCallback,this._streamDeleteCallbacks=new PanoptoCore.TypedCallback,this.element=$(i.template()),this.streamIconCode=this.element.find(".stream-icon-code"),this.streamName=this.element.find(".stream-name"),this.streamDisplayTime=this.element.find(".stream-display-time"),Panopto.Core.UI.Handlers.button(this.element,(()=>{this._streamSeekCallbacks.fire(this.stream)})),this.editEventMenu=new e.Viewer.Controls.EditEventMenu(this.element,this.element.find(".stream-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0}),this.editEventMenu.editCallbacks.add((e=>{this._streamEditCallbacks.fire(e)})),this.editEventMenu.deleteCallbacks.add((e=>{this._streamDeleteCallbacks.fire(e)}))}render(e,t){this.stream=t;let i=e.calculateEditorTimeFromAbsolute(t.absoluteStart),o=e.calculateEditorTimeFromAbsolute(t.absoluteEnd),n=`\n            ${Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator)} -\n            ${Panopto.Core.TimeHelpers.formatDuration(o,Panopto.GlobalResources.TimeSeparator)}`;this.streamIconCode.html(t.iconCode),this.streamName.text(t.getStreamName()),this.streamDisplayTime.text(n),this.element.show(),this.editEventMenu.setEvent(t,{canEdit:!0,canDelete:!0})}getStream(){return this.stream}}i.template=_.template('\n            <li class="stream-row" tabindex="0">\n                <div class="stream-icon-code material-icons"></div>\n                <div class="stream-name ellipsis"></div>\n                <div\n                    class="stream-edit-toggle material-icons"\n                    tabindex="0"\n                    title="<@- Panopto.GlobalResources.ViewerPlus_EventMore @>"\n                >\n                    &#xE5D4;\n                </div>\n                <div class="stream-display-time"></div>\n            </li>'),t.StreamRow=i}(t.Editor||(t.Editor={}))}(t.Tabs||(t.Tabs={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={}));
//# sourceMappingURL=file://engfs.d.panopto.com/share/jenkinsbuilds/rel_rtc_16.4.0/16.4.0.00038/_PublishedWebsites/WebUI/Scripts/Panopto/Bundles/Viewer.js.map
